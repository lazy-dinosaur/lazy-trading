import{Q as zx,N as Fa,O as Tx,U as kx,W as Rx,b as de,r as B,d as Dt,t as Gt,j as f,D as dt,Y as Ao,k as Uu,c as Lt,M as Ox,x as $e,F as bs,Z as Ax,_ as Dx,$ as $x,A as $i,u as Ix,a0 as Ba,i as Xo,B as Fe,X as Hu,V as Bt,a1 as Ku,I as ws,a2 as Va,q as Wx,m as Fx,l as Bx,P as qu,o as Vx,a3 as Ux,T as Xu,f as Gu,g as Ju,h as Qu,a4 as fn}from"./index--mJaizsc.js";import{S as Hx,a as Kx,b as qx,c as Xx,e as Gx,d as Jx,u as Qx,C as Yx,f as Zx}from"./select-DUTwnW6M.js";import{W as Yu,B as tb,a as eb,T as mo}from"./badge-DiYZZrWm.js";import{a as Zu,b as vi,S as ib}from"./screen-wrapper-ka0X-mpj.js";import{a as Bi,b as tc,c as nb}from"./coin-BD38kp2d.js";import{C as As,a as Do}from"./card-BfKKBDHD.js";import{L as sb}from"./loader-circle-B8TOKiKB.js";import{u as Ve}from"./use-CR7JZOh1.js";import{D as rb,a as ob,b as lb,c as hb,d as ab,e as ub,f as cb}from"./dialog-Cmf3KlYu.js";import{L as De}from"./label-DparRnXT.js";import{I as ec}from"./info-CBKQO1mY.js";import{T as Ua,a as Ha,b as _s,c as ys}from"./tabs-DTNzbAxj.js";import"./index-BdQq_4o_.js";import"./arrow-left-CNAqUfmD.js";var fb=class extends zx{constructor(o,t){super(o,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(o,t){super.setOptions({...o,behavior:Fa()},t)}getOptimisticResult(o){return o.behavior=Fa(),super.getOptimisticResult(o)}fetchNextPage(o){return this.fetch({...o,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(o){return this.fetch({...o,meta:{fetchMore:{direction:"backward"}}})}createResult(o,t){var C,y;const{state:e}=o,s=super.createResult(o,t),{isFetching:r,isRefetching:h,isError:a,isRefetchError:c}=s,d=(y=(C=e.fetchMeta)==null?void 0:C.fetchMore)==null?void 0:y.direction,m=a&&d==="forward",p=r&&d==="forward",v=a&&d==="backward",w=r&&d==="backward";return{...s,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:kx(t,e.data),hasPreviousPage:Tx(t,e.data),isFetchNextPageError:m,isFetchingNextPage:p,isFetchPreviousPageError:v,isFetchingPreviousPage:w,isRefetchError:c&&!m&&!v,isRefetching:h&&!p&&!w}}};function db(o,t){return Rx(o,fb)}/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ic=de("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nc=de("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mb=de("ChartColumnIncreasing",[["path",{d:"M13 17V9",key:"1fwyjl"}],["path",{d:"M18 17V5",key:"sfb6ij"}],["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gb=de("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=de("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sc=de("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pb=de("Layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=de("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vb=de("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=de("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xb=de("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bb=de("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),rc=B.createContext(void 0),Be=()=>{const o=B.useContext(rc);if(o===void 0)throw new Error("useTrade must be used within a TradeProvider");return o},wb=()=>{var p,v,w;const{t:o}=Dt(),[t,e]=Gt(),{exchangeAccounts:s,accountsBalance:r,isAccountsLoading:h}=Be(),a=t.get("id"),c=t.get("exchange"),d=a&&s?s.find(_=>_.id===a):null,m=a&&r?(w=(v=(p=r[a])==null?void 0:p.balance)==null?void 0:v.usd)==null?void 0:w.total:null;return h?f.jsx("div",{className:"flex items-center gap-2 bg-card border p-2 rounded-md min-w-36 h-9",children:f.jsx(dt,{className:"h-4 w-24"})}):a&&!d?f.jsx("div",{className:"flex items-center gap-2 bg-card border p-2 rounded-md min-w-36 h-9 text-sm text-red-500",children:o("trade.account_not_found")}):!s||s.length===0?f.jsxs(Ao,{to:`/account/add${c?`?exchange=${c}`:""}`,className:"flex items-center gap-2 bg-primary/10 hover:bg-primary/20 text-primary p-2 rounded-md min-w-36 transition-colors",onClick:()=>{const _=t.toString();sessionStorage.setItem("returnToTradeScreen",_)},children:[f.jsx(Ka,{className:"h-4 w-4"}),f.jsx("span",{className:"text-sm font-medium",children:o("trade.add_account")})]}):f.jsxs("div",{className:"flex flex-col",children:[f.jsxs(Hx,{value:a||void 0,onValueChange:_=>{const C=new URLSearchParams(t);C.set("id",_),e(C)},children:[f.jsx(Kx,{className:"min-w-36 h-9 bg-card/80 border rounded-md",children:f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Yu,{className:"h-4 w-4 text-muted-foreground"}),f.jsx(qx,{placeholder:o("trade.select_account")})]})}),f.jsxs(Xx,{className:"max-h-[40vh]",children:[f.jsx(Gx,{children:s.map(_=>{var E,P,A;const{id:C}=_,y=r&&((A=(P=(E=r[C])==null?void 0:E.balance)==null?void 0:P.usd)==null?void 0:A.total);return f.jsxs("div",{className:"py-1 border-b last:border-b-0",children:[f.jsx(Jx,{className:"h-8 flex gap-2 items-center",value:C,children:f.jsx("span",{className:"text-sm font-medium",children:_.name})}),f.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground px-8 pb-1",children:[f.jsxs("span",{children:[o("account.balance"),":"]}),f.jsxs("span",{className:"font-semibold",children:["$",(y==null?void 0:y.toFixed(2))||"0.00"]})]})]},C)})}),f.jsx("div",{className:"pt-2 px-2 border-t mt-1",children:f.jsxs(Ao,{to:`/account/add${c?`?exchange=${c}`:""}`,className:"flex items-center gap-2 text-primary/80 hover:text-primary p-1 text-xs transition-colors",onClick:()=>{const _=t.toString();sessionStorage.setItem("returnToTradeScreen",_)},children:[f.jsx(Ka,{className:"h-3 w-3"}),f.jsx("span",{children:o("trade.add_new_account")})]})})]})]}),d&&m&&f.jsxs("div",{className:"text-xs text-right text-muted-foreground mt-1",children:[o("account.balance"),": $",m.toFixed(2)]})]})},_b=({value:o,label:t,isActive:e,onClick:s})=>f.jsx("button",{onClick:()=>s(o),className:Lt("px-2 py-1 rounded text-xs md:text-sm transition-all","hover:bg-accent focus:outline-none focus:ring-1 focus:ring-primary",e?"bg-primary/20 text-primary font-medium":"text-muted-foreground hover:text-foreground"),children:t}),yb=()=>{const{t:o}=Dt(),[t,e]=Gt(),s=t.get("timeframe")||"1",{trackEvent:r}=Uu(),h=B.useCallback(c=>{const d=new URLSearchParams(t),m=d.get("symbol"),p=d.get("exchange"),v=d.get("timeframe");r({action:"timeframe_changed",category:"chart",label:c,previous_timeframe:v,symbol:m,exchange:p}),d.set("timeframe",c),e(d)},[t,e,r]),a=[{value:"1",label:o("timeframe.1m")},{value:"5",label:o("timeframe.5m")},{value:"15",label:o("timeframe.15m")},{value:"30",label:o("timeframe.30m")},{value:"60",label:o("timeframe.1h")},{value:"240",label:o("timeframe.4h")},{value:"D",label:o("timeframe.1d")},{value:"W",label:o("timeframe.1w")},{value:"M",label:o("timeframe.1M")}];return f.jsxs("div",{className:"flex items-center",children:[f.jsxs("div",{className:"mr-2 text-xs text-muted-foreground hidden md:block",children:[o("trade.time"),":"]}),f.jsx("div",{className:"flex flex-wrap gap-1 border bg-card/50 p-1 rounded-md",children:a.map(c=>f.jsx(_b,{value:c.value,label:c.label,isActive:s===c.value,onClick:h},c.value))})]})},Sb=()=>{var C,y;const{t:o}=Dt(),[t]=Gt(),e=t.get("exchange"),s=t.get("symbol"),r=Bi(),{tickerQuery:{data:h,isLoading:a}}=Be(),[c,d]=B.useState({price:h==null?void 0:h.last,color:"default",timestamp:Date.now()});if(B.useEffect(()=>{if(h&&h.last){const E=h.last;d(P=>P.price?P.price>E?{price:E,color:"down",percentage:h.percentage,timestamp:Date.now()}:P.price<E?{price:E,color:"up",percentage:h.percentage,timestamp:Date.now()}:{...P,percentage:h.percentage,timestamp:Date.now()}:{price:E,color:"default",percentage:h.percentage,timestamp:Date.now()})}},[h]),a)return f.jsx(As,{className:"w-full bg-card/30",children:f.jsx(Do,{className:"p-3 md:p-4",children:f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsx("div",{className:"flex items-center gap-2",children:f.jsx(dt,{className:"h-7 w-32"})}),f.jsxs("div",{className:"flex gap-2 items-center",children:[f.jsx(dt,{className:"h-4 w-5"}),f.jsx(dt,{className:"h-4 w-20"})]})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsxs("div",{className:"flex items-center justify-end gap-2",children:[f.jsxs("span",{className:"text-xs text-muted-foreground",children:[o("trade.high"),":"]}),f.jsx(dt,{className:"h-4 w-16"})]}),f.jsxs("div",{className:"flex items-center justify-end gap-2",children:[f.jsxs("span",{className:"text-xs text-muted-foreground",children:[o("trade.low"),":"]}),f.jsx(dt,{className:"h-4 w-16"})]})]})]})})});const m=c.color==="up"?"text-green-500":c.color==="down"?"text-red-500":"text-foreground",p=c.percentage?Number(c.percentage):0,v=p>0?"text-green-500":p<0?"text-red-500":"text-muted-foreground",w=p>0?f.jsx(eb,{className:"h-5 w-5 text-green-500"}):p<0?f.jsx(xb,{className:"h-5 w-5 text-red-500"}):null,_=c.timestamp?new Date(c.timestamp).toLocaleTimeString():"";return f.jsx(As,{className:"w-full bg-card/10 border shadow-sm",children:f.jsx(Do,{className:"p-3 md:p-4",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("h1",{className:Lt("text-xl md:text-2xl font-bold tracking-tighter",m),children:c.price&&((C=r==null?void 0:r[e])==null?void 0:C.ccxt.priceToPrecision(s,Number(c.price)))}),p!==0&&f.jsxs(tb,{variant:"outline",className:Lt("flex items-center gap-1 font-medium px-2 py-1 rounded-full text-sm",p>0?"bg-green-500/10 border-green-500/20":"bg-red-500/10 border-red-500/20"),children:[w,f.jsxs("span",{className:v,children:[p>0?"+":"",p.toFixed(2),"%"]})]})]}),f.jsxs("div",{className:"flex flex-col space-y-2",children:[f.jsxs("div",{className:"flex gap-2 items-center text-sm",children:[f.jsx(mb,{className:"h-3.5 w-3.5 text-muted-foreground"}),f.jsxs("span",{className:"capitalize text-muted-foreground",children:[o("trade.volume"),":"]}),f.jsx("span",{className:"font-medium",children:Ox(Number(h==null?void 0:h.quoteVolume))})]}),f.jsxs("div",{className:"flex gap-2 items-center text-xs text-muted-foreground",children:[f.jsx(sc,{className:"h-3 w-3"}),f.jsxs("span",{children:[o("trade.updated"),": ",_]})]})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 bg-accent/10 p-2 rounded-md text-right",children:[f.jsxs("div",{className:"flex flex-col",children:[f.jsxs("span",{className:"text-xs text-muted-foreground",children:[o("trade.high")," (24h)"]}),f.jsx("span",{className:"text-sm font-semibold text-green-500",children:$e(Number(h==null?void 0:h.high))})]}),f.jsxs("div",{className:"flex flex-col",children:[f.jsxs("span",{className:"text-xs text-muted-foreground",children:[o("trade.low")," (24h)"]}),f.jsx("span",{className:"text-sm font-semibold text-red-500",children:$e(Number(h==null?void 0:h.low))})]}),e==="bybit"?f.jsxs("div",{className:"flex flex-col col-span-2 mt-1",children:[f.jsx("span",{className:"text-xs text-muted-foreground",children:o("trade.turnover")}),f.jsx("span",{className:"text-sm font-semibold",children:$e(Number(h==null?void 0:h.info.turnover24h))})]}):f.jsxs("div",{className:"flex flex-col col-span-2 mt-1",children:[f.jsx("span",{className:"text-xs text-muted-foreground",children:o("trade.vwap")}),f.jsx("span",{className:"text-sm font-semibold",children:(h==null?void 0:h.vwap)&&((y=r==null?void 0:r[e])==null?void 0:y.ccxt.priceToPrecision(s,Number(h.vwap)))})]})]})]})})})};function vt(o){var t=o.width,e=o.height;if(t<0)throw new Error("Negative width is not allowed for Size");if(e<0)throw new Error("Negative height is not allowed for Size");return{width:t,height:e}}function fi(o,t){return o.width===t.width&&o.height===t.height}var Cb=function(){function o(t){var e=this;this._resolutionListener=function(){return e._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return o.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(o.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),o.prototype.subscribe=function(t){var e=this,s={next:t};return this._observers.push(s),{unsubscribe:function(){e._observers=e._observers.filter(function(r){return r!==s})}}},o.prototype._installResolutionListener=function(){if(this._resolutionMediaQueryList!==null)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},o.prototype._uninstallResolutionListener=function(){this._resolutionMediaQueryList!==null&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},o.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},o.prototype._onResolutionChanged=function(){var t=this;this._observers.forEach(function(e){return e.next(t._window.devicePixelRatio)}),this._reinstallResolutionListener()},o}();function Nb(o){return new Cb(o)}var Mb=function(){function o(t,e,s){var r;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=vt({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=e??function(h){return h},this._allowResizeObserver=(r=s==null?void 0:s.allowResizeObserver)!==null&&r!==void 0?r:!0,this._chooseAndInitObserver()}return o.prototype.dispose=function(){var t,e;if(this._canvasElement===null)throw new Error("Object is disposed");(t=this._canvasElementResizeObserver)===null||t===void 0||t.disconnect(),this._canvasElementResizeObserver=null,(e=this._devicePixelRatioObservable)===null||e===void 0||e.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(o.prototype,"canvasElement",{get:function(){if(this._canvasElement===null)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"bitmapSize",{get:function(){return vt({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),o.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=vt(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},o.prototype.subscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners.push(t)},o.prototype.unsubscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(e){return e!==t})},Object.defineProperty(o.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),o.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},o.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(e){return e!==t})},o.prototype.applySuggestedBitmapSize=function(){if(this._suggestedBitmapSize!==null){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},o.prototype._resizeBitmap=function(t){var e=this.bitmapSize;fi(e,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(e,t))},o.prototype._emitBitmapSizeChanged=function(t,e){var s=this;this._bitmapSizeChangedListeners.forEach(function(r){return r.call(s,t,e)})},o.prototype._suggestNewBitmapSize=function(t){var e=this._suggestedBitmapSize,s=vt(this._transformBitmapSize(t,this._canvasElementClientSize)),r=fi(this.bitmapSize,s)?null:s;e===null&&r===null||e!==null&&r!==null&&fi(e,r)||(this._suggestedBitmapSize=r,this._emitSuggestedBitmapSizeChanged(e,r))},o.prototype._emitSuggestedBitmapSizeChanged=function(t,e){var s=this;this._suggestedBitmapSizeChangedListeners.forEach(function(r){return r.call(s,t,e)})},o.prototype._chooseAndInitObserver=function(){var t=this;if(!this._allowResizeObserver){this._initDevicePixelRatioObservable();return}Eb().then(function(e){return e?t._initResizeObserver():t._initDevicePixelRatioObservable()})},o.prototype._initDevicePixelRatioObservable=function(){var t=this;if(this._canvasElement!==null){var e=qa(this._canvasElement);if(e===null)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=Nb(e),this._devicePixelRatioObservable.subscribe(function(){return t._invalidateBitmapSize()}),this._invalidateBitmapSize()}},o.prototype._invalidateBitmapSize=function(){var t,e;if(this._canvasElement!==null){var s=qa(this._canvasElement);if(s!==null){var r=(e=(t=this._devicePixelRatioObservable)===null||t===void 0?void 0:t.value)!==null&&e!==void 0?e:s.devicePixelRatio,h=this._canvasElement.getClientRects(),a=h[0]!==void 0?Pb(h[0],r):vt({width:this._canvasElementClientSize.width*r,height:this._canvasElementClientSize.height*r});this._suggestNewBitmapSize(a)}}},o.prototype._initResizeObserver=function(){var t=this;this._canvasElement!==null&&(this._canvasElementResizeObserver=new ResizeObserver(function(e){var s=e.find(function(a){return a.target===t._canvasElement});if(!(!s||!s.devicePixelContentBoxSize||!s.devicePixelContentBoxSize[0])){var r=s.devicePixelContentBoxSize[0],h=vt({width:r.inlineSize,height:r.blockSize});t._suggestNewBitmapSize(h)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},o}();function Lb(o,t){return new Mb(o,t.transform,t.options)}function qa(o){return o.ownerDocument.defaultView}function Eb(){return new Promise(function(o){var t=new ResizeObserver(function(e){o(e.every(function(s){return"devicePixelContentBoxSize"in s})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})}function Pb(o,t){return vt({width:Math.round(o.left*t+o.width*t)-Math.round(o.left*t),height:Math.round(o.top*t+o.height*t)-Math.round(o.top*t)})}var jb=function(){function o(t,e,s){if(e.width===0||e.height===0)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=e,s.width===0||s.height===0)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=s,this._context=t}return o.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},o.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(o.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),o}();function di(o,t){var e=o.canvasElementClientSize;if(e.width===0||e.height===0)return null;var s=o.bitmapSize;if(s.width===0||s.height===0)return null;var r=o.canvasElement.getContext("2d",t);return r===null?null:new jb(r,e,s)}/*!
 * @license
 * TradingView Lightweight Charts™ v4.2.3
 * Copyright (c) 2025 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */const zb={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Tb={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},kb={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},Rb={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},Ob={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},Ab={color:"#26a69a",base:0},oc={color:"#2196f3"},lc={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};var Xa,gn;function mi(o,t){const e={0:[],1:[o.lineWidth,o.lineWidth],2:[2*o.lineWidth,2*o.lineWidth],3:[6*o.lineWidth,6*o.lineWidth],4:[o.lineWidth,4*o.lineWidth]}[t];o.setLineDash(e)}function hc(o,t,e,s){o.beginPath();const r=o.lineWidth%2?.5:0;o.moveTo(e,t+r),o.lineTo(s,t+r),o.stroke()}function ti(o,t){if(!o)throw new Error("Assertion failed"+(t?": "+t:""))}function Vt(o){if(o===void 0)throw new Error("Value is undefined");return o}function D(o){if(o===null)throw new Error("Value is null");return o}function Oi(o){return D(Vt(o))}(function(o){o[o.Simple=0]="Simple",o[o.WithSteps=1]="WithSteps",o[o.Curved=2]="Curved"})(Xa||(Xa={})),function(o){o[o.Solid=0]="Solid",o[o.Dotted=1]="Dotted",o[o.Dashed=2]="Dashed",o[o.LargeDashed=3]="LargeDashed",o[o.SparseDotted=4]="SparseDotted"}(gn||(gn={}));const Ga={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function fe(o){return o<0?0:o>255?255:Math.round(o)||0}function ac(o){return o<=0||o>1?Math.min(Math.max(o,0),1):Math.round(1e4*o)/1e4}const Db=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,$b=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,Ib=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,Wb=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d*\.?\d+)\s*\)$/;function wn(o){(o=o.toLowerCase())in Ga&&(o=Ga[o]);{const t=Wb.exec(o)||Ib.exec(o);if(t)return[fe(parseInt(t[1],10)),fe(parseInt(t[2],10)),fe(parseInt(t[3],10)),ac(t.length<5?1:parseFloat(t[4]))]}{const t=$b.exec(o);if(t)return[fe(parseInt(t[1],16)),fe(parseInt(t[2],16)),fe(parseInt(t[3],16)),1]}{const t=Db.exec(o);if(t)return[fe(17*parseInt(t[1],16)),fe(17*parseInt(t[2],16)),fe(17*parseInt(t[3],16)),1]}throw new Error(`Cannot parse color: ${o}`)}function uc(o){return .199*o[0]+.687*o[1]+.114*o[2]}function Is(o){const t=wn(o);return{t:`rgb(${t[0]}, ${t[1]}, ${t[2]})`,i:uc(t)>160?"black":"white"}}class Ct{constructor(){this.h=[]}l(t,e,s){const r={o:t,_:e,u:s===!0};this.h.push(r)}v(t){const e=this.h.findIndex(s=>t===s.o);e>-1&&this.h.splice(e,1)}p(t){this.h=this.h.filter(e=>e._!==t)}m(t,e,s){const r=[...this.h];this.h=this.h.filter(h=>!h.u),r.forEach(h=>h.o(t,e,s))}M(){return this.h.length>0}S(){this.h=[]}}function we(o,...t){for(const e of t)for(const s in e)e[s]!==void 0&&Object.prototype.hasOwnProperty.call(e,s)&&!["__proto__","constructor","prototype"].includes(s)&&(typeof e[s]!="object"||o[s]===void 0||Array.isArray(e[s])?o[s]=e[s]:we(o[s],e[s]));return o}function Me(o){return typeof o=="number"&&isFinite(o)}function _n(o){return typeof o=="number"&&o%1==0}function Nn(o){return typeof o=="string"}function Ss(o){return typeof o=="boolean"}function Ie(o){const t=o;if(!t||typeof t!="object")return t;let e,s,r;for(s in e=Array.isArray(t)?[]:{},t)t.hasOwnProperty(s)&&(r=t[s],e[s]=r&&typeof r=="object"?Ie(r):r);return e}function Fb(o){return o!==null}function yn(o){return o===null?void 0:o}const Go="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function Ii(o,t,e){return t===void 0&&(t=Go),`${e=e!==void 0?`${e} `:""}${o}px ${t}`}class Bb{constructor(t){this.k={C:1,T:5,P:NaN,R:"",D:"",V:"",O:"",B:0,A:0,I:0,L:0,N:0},this.F=t}W(){const t=this.k,e=this.j(),s=this.H();return t.P===e&&t.D===s||(t.P=e,t.D=s,t.R=Ii(e,s),t.L=2.5/12*e,t.B=t.L,t.A=e/12*t.T,t.I=e/12*t.T,t.N=0),t.V=this.$(),t.O=this.U(),this.k}$(){return this.F.W().layout.textColor}U(){return this.F.q()}j(){return this.F.W().layout.fontSize}H(){return this.F.W().layout.fontFamily}}class Jo{constructor(){this.Y=[]}Z(t){this.Y=t}X(t,e,s){this.Y.forEach(r=>{r.X(t,e,s)})}}class _e{X(t,e,s){t.useBitmapCoordinateSpace(r=>this.K(r,e,s))}}class Vb extends _e{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:s}){if(this.G===null||this.G.tt===null)return;const r=this.G.tt,h=this.G,a=Math.max(1,Math.floor(e))%2/2,c=d=>{t.beginPath();for(let m=r.to-1;m>=r.from;--m){const p=h.it[m],v=Math.round(p.nt*e)+a,w=p.st*s,_=d*s+a;t.moveTo(v,w),t.arc(v,w,_,0,2*Math.PI)}t.fill()};h.et>0&&(t.fillStyle=h.rt,c(h.ht+h.et)),t.fillStyle=h.lt,c(h.ht)}}function Ub(){return{it:[{nt:0,st:0,ot:0,_t:0}],lt:"",rt:"",ht:0,et:0,tt:null}}const Hb={from:0,to:1};class Kb{constructor(t,e){this.ut=new Jo,this.ct=[],this.dt=[],this.ft=!0,this.F=t,this.vt=e,this.ut.Z(this.ct)}bt(t){const e=this.F.wt();e.length!==this.ct.length&&(this.dt=e.map(Ub),this.ct=this.dt.map(s=>{const r=new Vb;return r.J(s),r}),this.ut.Z(this.ct)),this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.ut}Mt(){const t=this.vt.W().mode===2,e=this.F.wt(),s=this.vt.xt(),r=this.F.St();e.forEach((h,a)=>{var c;const d=this.dt[a],m=h.kt(s);if(t||m===null||!h.yt())return void(d.tt=null);const p=D(h.Ct());d.lt=m.Tt,d.ht=m.ht,d.et=m.Pt,d.it[0]._t=m._t,d.it[0].st=h.Dt().Rt(m._t,p.Vt),d.rt=(c=m.Ot)!==null&&c!==void 0?c:this.F.Bt(d.it[0].st/h.Dt().At()),d.it[0].ot=s,d.it[0].nt=r.It(s),d.tt=Hb})}}class qb extends _e{constructor(t){super(),this.zt=t}K({context:t,bitmapSize:e,horizontalPixelRatio:s,verticalPixelRatio:r}){if(this.zt===null)return;const h=this.zt.Lt.yt,a=this.zt.Et.yt;if(!h&&!a)return;const c=Math.round(this.zt.nt*s),d=Math.round(this.zt.st*r);t.lineCap="butt",h&&c>=0&&(t.lineWidth=Math.floor(this.zt.Lt.et*s),t.strokeStyle=this.zt.Lt.V,t.fillStyle=this.zt.Lt.V,mi(t,this.zt.Lt.Nt),function(m,p,v,w){m.beginPath();const _=m.lineWidth%2?.5:0;m.moveTo(p+_,v),m.lineTo(p+_,w),m.stroke()}(t,c,0,e.height)),a&&d>=0&&(t.lineWidth=Math.floor(this.zt.Et.et*r),t.strokeStyle=this.zt.Et.V,t.fillStyle=this.zt.Et.V,mi(t,this.zt.Et.Nt),hc(t,d,0,e.width))}}class Xb{constructor(t){this.ft=!0,this.Ft={Lt:{et:1,Nt:0,V:"",yt:!1},Et:{et:1,Nt:0,V:"",yt:!1},nt:0,st:0},this.Wt=new qb(this.Ft),this.jt=t}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt}Mt(){const t=this.jt.yt(),e=D(this.jt.Ht()),s=e.$t().W().crosshair,r=this.Ft;if(s.mode===2)return r.Et.yt=!1,void(r.Lt.yt=!1);r.Et.yt=t&&this.jt.Ut(e),r.Lt.yt=t&&this.jt.qt(),r.Et.et=s.horzLine.width,r.Et.Nt=s.horzLine.style,r.Et.V=s.horzLine.color,r.Lt.et=s.vertLine.width,r.Lt.Nt=s.vertLine.style,r.Lt.V=s.vertLine.color,r.nt=this.jt.Yt(),r.st=this.jt.Zt()}}function Gb(o,t,e,s,r,h){o.fillRect(t+h,e,s-2*h,h),o.fillRect(t+h,e+r-h,s-2*h,h),o.fillRect(t,e,h,r),o.fillRect(t+s-h,e,h,r)}function Ws(o,t,e,s,r,h){o.save(),o.globalCompositeOperation="copy",o.fillStyle=h,o.fillRect(t,e,s,r),o.restore()}function Ja(o,t,e,s,r,h){o.beginPath(),o.roundRect?o.roundRect(t,e,s,r,h):(o.lineTo(t+s-h[1],e),h[1]!==0&&o.arcTo(t+s,e,t+s,e+h[1],h[1]),o.lineTo(t+s,e+r-h[2]),h[2]!==0&&o.arcTo(t+s,e+r,t+s-h[2],e+r,h[2]),o.lineTo(t+h[3],e+r),h[3]!==0&&o.arcTo(t,e+r,t,e+r-h[3],h[3]),o.lineTo(t,e+h[0]),h[0]!==0&&o.arcTo(t,e,t+h[0],e,h[0]))}function Qa(o,t,e,s,r,h,a=0,c=[0,0,0,0],d=""){if(o.save(),!a||!d||d===h)return Ja(o,t,e,s,r,c),o.fillStyle=h,o.fill(),void o.restore();const m=a/2;var p;Ja(o,t+m,e+m,s-a,r-a,(p=-m,c.map(v=>v===0?v:v+p))),h!=="transparent"&&(o.fillStyle=h,o.fill()),d!=="transparent"&&(o.lineWidth=a,o.strokeStyle=d,o.closePath(),o.stroke()),o.restore()}function cc(o,t,e,s,r,h,a){o.save(),o.globalCompositeOperation="copy";const c=o.createLinearGradient(0,0,0,r);c.addColorStop(0,h),c.addColorStop(1,a),o.fillStyle=c,o.fillRect(t,e,s,r),o.restore()}class Ya{constructor(t,e){this.J(t,e)}J(t,e){this.zt=t,this.Xt=e}At(t,e){return this.zt.yt?t.P+t.L+t.B:0}X(t,e,s,r){if(!this.zt.yt||this.zt.Kt.length===0)return;const h=this.zt.V,a=this.Xt.t,c=t.useBitmapCoordinateSpace(d=>{const m=d.context;m.font=e.R;const p=this.Gt(d,e,s,r),v=p.Jt;return p.Qt?Qa(m,v.ti,v.ii,v.ni,v.si,a,v.ei,[v.ht,0,0,v.ht],a):Qa(m,v.ri,v.ii,v.ni,v.si,a,v.ei,[0,v.ht,v.ht,0],a),this.zt.hi&&(m.fillStyle=h,m.fillRect(v.ri,v.li,v.ai-v.ri,v.oi)),this.zt._i&&(m.fillStyle=e.O,m.fillRect(p.Qt?v.ui-v.ei:0,v.ii,v.ei,v.ci-v.ii)),p});t.useMediaCoordinateSpace(({context:d})=>{const m=c.di;d.font=e.R,d.textAlign=c.Qt?"right":"left",d.textBaseline="middle",d.fillStyle=h,d.fillText(this.zt.Kt,m.fi,(m.ii+m.ci)/2+m.pi)})}Gt(t,e,s,r){var h;const{context:a,bitmapSize:c,mediaSize:d,horizontalPixelRatio:m,verticalPixelRatio:p}=t,v=this.zt.hi||!this.zt.mi?e.T:0,w=this.zt.bi?e.C:0,_=e.L+this.Xt.wi,C=e.B+this.Xt.gi,y=e.A,E=e.I,P=this.zt.Kt,A=e.P,$=s.Mi(a,P),U=Math.ceil(s.xi(a,P)),W=A+_+C,I=e.C+y+E+U+v,R=Math.max(1,Math.floor(p));let V=Math.round(W*p);V%2!=R%2&&(V+=1);const q=w>0?Math.max(1,Math.floor(w*m)):0,rt=Math.round(I*m),X=Math.round(v*m),tt=(h=this.Xt.Si)!==null&&h!==void 0?h:this.Xt.ki,G=Math.round(tt*p)-Math.floor(.5*p),wt=Math.floor(G+R/2-V/2),Et=wt+V,ne=r==="right",Jt=ne?d.width-w:w,kt=ne?c.width-q:q;let Rt,$t,at;return ne?(Rt=kt-rt,$t=kt-X,at=Jt-v-y-w):(Rt=kt+rt,$t=kt+X,at=Jt+v+y),{Qt:ne,Jt:{ii:wt,li:G,ci:Et,ni:rt,si:V,ht:2*m,ei:q,ti:Rt,ri:kt,ai:$t,oi:R,ui:c.width},di:{ii:wt/p,ci:Et/p,fi:at,pi:$}}}}class Fs{constructor(t){this.yi={ki:0,t:"#000",gi:0,wi:0},this.Ci={Kt:"",yt:!1,hi:!0,mi:!1,Ot:"",V:"#FFF",_i:!1,bi:!1},this.Ti={Kt:"",yt:!1,hi:!1,mi:!0,Ot:"",V:"#FFF",_i:!0,bi:!0},this.ft=!0,this.Pi=new(t||Ya)(this.Ci,this.yi),this.Ri=new(t||Ya)(this.Ti,this.yi)}Kt(){return this.Di(),this.Ci.Kt}ki(){return this.Di(),this.yi.ki}bt(){this.ft=!0}At(t,e=!1){return Math.max(this.Pi.At(t,e),this.Ri.At(t,e))}Vi(){return this.yi.Si||0}Oi(t){this.yi.Si=t}Bi(){return this.Di(),this.Ci.yt||this.Ti.yt}Ai(){return this.Di(),this.Ci.yt}gt(t){return this.Di(),this.Ci.hi=this.Ci.hi&&t.W().ticksVisible,this.Ti.hi=this.Ti.hi&&t.W().ticksVisible,this.Pi.J(this.Ci,this.yi),this.Ri.J(this.Ti,this.yi),this.Pi}Ii(){return this.Di(),this.Pi.J(this.Ci,this.yi),this.Ri.J(this.Ti,this.yi),this.Ri}Di(){this.ft&&(this.Ci.hi=!0,this.Ti.hi=!1,this.zi(this.Ci,this.Ti,this.yi))}}class Jb extends Fs{constructor(t,e,s){super(),this.jt=t,this.Li=e,this.Ei=s}zi(t,e,s){if(t.yt=!1,this.jt.W().mode===2)return;const r=this.jt.W().horzLine;if(!r.labelVisible)return;const h=this.Li.Ct();if(!this.jt.yt()||this.Li.Ni()||h===null)return;const a=Is(r.labelBackgroundColor);s.t=a.t,t.V=a.i;const c=2/12*this.Li.P();s.wi=c,s.gi=c;const d=this.Ei(this.Li);s.ki=d.ki,t.Kt=this.Li.Fi(d._t,h),t.yt=!0}}const Qb=/[1-9]/g;class fc{constructor(){this.zt=null}J(t){this.zt=t}X(t,e){if(this.zt===null||this.zt.yt===!1||this.zt.Kt.length===0)return;const s=t.useMediaCoordinateSpace(({context:w})=>(w.font=e.R,Math.round(e.Wi.xi(w,D(this.zt).Kt,Qb))));if(s<=0)return;const r=e.ji,h=s+2*r,a=h/2,c=this.zt.Hi;let d=this.zt.ki,m=Math.floor(d-a)+.5;m<0?(d+=Math.abs(0-m),m=Math.floor(d-a)+.5):m+h>c&&(d-=Math.abs(c-(m+h)),m=Math.floor(d-a)+.5);const p=m+h,v=Math.ceil(0+e.C+e.T+e.L+e.P+e.B);t.useBitmapCoordinateSpace(({context:w,horizontalPixelRatio:_,verticalPixelRatio:C})=>{const y=D(this.zt);w.fillStyle=y.t;const E=Math.round(m*_),P=Math.round(0*C),A=Math.round(p*_),$=Math.round(v*C),U=Math.round(2*_);if(w.beginPath(),w.moveTo(E,P),w.lineTo(E,$-U),w.arcTo(E,$,E+U,$,U),w.lineTo(A-U,$),w.arcTo(A,$,A,$-U,U),w.lineTo(A,P),w.fill(),y.hi){const W=Math.round(y.ki*_),I=P,R=Math.round((I+e.T)*C);w.fillStyle=y.V;const V=Math.max(1,Math.floor(_)),q=Math.floor(.5*_);w.fillRect(W-q,I,V,R-I)}}),t.useMediaCoordinateSpace(({context:w})=>{const _=D(this.zt),C=0+e.C+e.T+e.L+e.P/2;w.font=e.R,w.textAlign="left",w.textBaseline="middle",w.fillStyle=_.V;const y=e.Wi.Mi(w,"Apr0");w.translate(m+r,C+y),w.fillText(_.Kt,0,0)})}}class Yb{constructor(t,e,s){this.ft=!0,this.Wt=new fc,this.Ft={yt:!1,t:"#4c525e",V:"white",Kt:"",Hi:0,ki:NaN,hi:!0},this.vt=t,this.$i=e,this.Ei=s}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt.J(this.Ft),this.Wt}Mt(){const t=this.Ft;if(t.yt=!1,this.vt.W().mode===2)return;const e=this.vt.W().vertLine;if(!e.labelVisible)return;const s=this.$i.St();if(s.Ni())return;t.Hi=s.Hi();const r=this.Ei();if(r===null)return;t.ki=r.ki;const h=s.Ui(this.vt.xt());t.Kt=s.qi(D(h)),t.yt=!0;const a=Is(e.labelBackgroundColor);t.t=a.t,t.V=a.i,t.hi=s.W().ticksVisible}}class Qo{constructor(){this.Yi=null,this.Zi=0}Xi(){return this.Zi}Ki(t){this.Zi=t}Dt(){return this.Yi}Gi(t){this.Yi=t}Ji(t){return[]}Qi(){return[]}yt(){return!0}}var Za;(function(o){o[o.Normal=0]="Normal",o[o.Magnet=1]="Magnet",o[o.Hidden=2]="Hidden"})(Za||(Za={}));class Zb extends Qo{constructor(t,e){super(),this.tn=null,this.nn=NaN,this.sn=0,this.en=!0,this.rn=new Map,this.hn=!1,this.ln=NaN,this.an=NaN,this._n=NaN,this.un=NaN,this.$i=t,this.cn=e,this.dn=new Kb(t,this),this.fn=((r,h)=>a=>{const c=h(),d=r();if(a===D(this.tn).vn())return{_t:d,ki:c};{const m=D(a.Ct());return{_t:a.pn(c,m),ki:c}}})(()=>this.nn,()=>this.an);const s=((r,h)=>()=>{const a=this.$i.St().mn(r()),c=h();return a&&Number.isFinite(c)?{ot:a,ki:c}:null})(()=>this.sn,()=>this.Yt());this.bn=new Yb(this,t,s),this.wn=new Xb(this)}W(){return this.cn}gn(t,e){this._n=t,this.un=e}Mn(){this._n=NaN,this.un=NaN}xn(){return this._n}Sn(){return this.un}kn(t,e,s){this.hn||(this.hn=!0),this.en=!0,this.yn(t,e,s)}xt(){return this.sn}Yt(){return this.ln}Zt(){return this.an}yt(){return this.en}Cn(){this.en=!1,this.Tn(),this.nn=NaN,this.ln=NaN,this.an=NaN,this.tn=null,this.Mn()}Pn(t){return this.tn!==null?[this.wn,this.dn]:[]}Ut(t){return t===this.tn&&this.cn.horzLine.visible}qt(){return this.cn.vertLine.visible}Rn(t,e){this.en&&this.tn===t||this.rn.clear();const s=[];return this.tn===t&&s.push(this.Dn(this.rn,e,this.fn)),s}Qi(){return this.en?[this.bn]:[]}Ht(){return this.tn}Vn(){this.wn.bt(),this.rn.forEach(t=>t.bt()),this.bn.bt(),this.dn.bt()}On(t){return t&&!t.vn().Ni()?t.vn():null}yn(t,e,s){this.Bn(t,e,s)&&this.Vn()}Bn(t,e,s){const r=this.ln,h=this.an,a=this.nn,c=this.sn,d=this.tn,m=this.On(s);this.sn=t,this.ln=isNaN(t)?NaN:this.$i.St().It(t),this.tn=s;const p=m!==null?m.Ct():null;return m!==null&&p!==null?(this.nn=e,this.an=m.Rt(e,p)):(this.nn=NaN,this.an=NaN),r!==this.ln||h!==this.an||c!==this.sn||a!==this.nn||d!==this.tn}Tn(){const t=this.$i.wt().map(s=>s.In().An()).filter(Fb),e=t.length===0?null:Math.max(...t);this.sn=e!==null?e:NaN}Dn(t,e,s){let r=t.get(e);return r===void 0&&(r=new Jb(this,e,s),t.set(e,r)),r}}function Bs(o){return o==="left"||o==="right"}class Tt{constructor(t){this.zn=new Map,this.Ln=[],this.En=t}Nn(t,e){const s=function(r,h){return r===void 0?h:{Fn:Math.max(r.Fn,h.Fn),Wn:r.Wn||h.Wn}}(this.zn.get(t),e);this.zn.set(t,s)}jn(){return this.En}Hn(t){const e=this.zn.get(t);return e===void 0?{Fn:this.En}:{Fn:Math.max(this.En,e.Fn),Wn:e.Wn}}$n(){this.Un(),this.Ln=[{qn:0}]}Yn(t){this.Un(),this.Ln=[{qn:1,Vt:t}]}Zn(t){this.Xn(),this.Ln.push({qn:5,Vt:t})}Un(){this.Xn(),this.Ln.push({qn:6})}Kn(){this.Un(),this.Ln=[{qn:4}]}Gn(t){this.Un(),this.Ln.push({qn:2,Vt:t})}Jn(t){this.Un(),this.Ln.push({qn:3,Vt:t})}Qn(){return this.Ln}ts(t){for(const e of t.Ln)this.ns(e);this.En=Math.max(this.En,t.En),t.zn.forEach((e,s)=>{this.Nn(s,e)})}static ss(){return new Tt(2)}static es(){return new Tt(3)}ns(t){switch(t.qn){case 0:this.$n();break;case 1:this.Yn(t.Vt);break;case 2:this.Gn(t.Vt);break;case 3:this.Jn(t.Vt);break;case 4:this.Kn();break;case 5:this.Zn(t.Vt);break;case 6:this.Xn()}}Xn(){const t=this.Ln.findIndex(e=>e.qn===5);t!==-1&&this.Ln.splice(t,1)}}const tu=".";function We(o,t){if(!Me(o))return"n/a";if(!_n(t))throw new TypeError("invalid length");if(t<0||t>16)throw new TypeError("invalid length");return t===0?o.toString():("0000000000000000"+o.toString()).slice(-t)}class Vs{constructor(t,e){if(e||(e=1),Me(t)&&_n(t)||(t=100),t<0)throw new TypeError("invalid base");this.Li=t,this.rs=e,this.hs()}format(t){const e=t<0?"−":"";return t=Math.abs(t),e+this.ls(t)}hs(){if(this._s=0,this.Li>0&&this.rs>0){let t=this.Li;for(;t>1;)t/=10,this._s++}}ls(t){const e=this.Li/this.rs;let s=Math.floor(t),r="";const h=this._s!==void 0?this._s:NaN;if(e>1){let a=+(Math.round(t*e)-s*e).toFixed(this._s);a>=e&&(a-=e,s+=1),r=tu+We(+a.toFixed(this._s)*this.rs,h)}else s=Math.round(s*e)/e,h>0&&(r=tu+We(0,h));return s.toFixed(0)+r}}class dc extends Vs{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class tw{constructor(t){this.us=t}format(t){let e="";return t<0&&(e="-",t=-t),t<995?e+this.cs(t):t<999995?e+this.cs(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),e+this.cs(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),e+this.cs(t/1e9)+"B")}cs(t){let e;const s=Math.pow(10,this.us);return e=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.us).replace(/\.?0+$/,""):String(t),e.replace(/(\.[1-9]*)0+$/,(r,h)=>h)}}function mc(o,t,e,s,r,h,a){if(t.length===0||s.from>=t.length||s.to<=0)return;const{context:c,horizontalPixelRatio:d,verticalPixelRatio:m}=o,p=t[s.from];let v=h(o,p),w=p;if(s.to-s.from<2){const _=r/2;c.beginPath();const C={nt:p.nt-_,st:p.st},y={nt:p.nt+_,st:p.st};c.moveTo(C.nt*d,C.st*m),c.lineTo(y.nt*d,y.st*m),a(o,v,C,y)}else{const _=(y,E)=>{a(o,v,w,E),c.beginPath(),v=y,w=E};let C=w;c.beginPath(),c.moveTo(p.nt*d,p.st*m);for(let y=s.from+1;y<s.to;++y){C=t[y];const E=h(o,C);switch(e){case 0:c.lineTo(C.nt*d,C.st*m);break;case 1:c.lineTo(C.nt*d,t[y-1].st*m),E!==v&&(_(E,C),c.lineTo(C.nt*d,t[y-1].st*m)),c.lineTo(C.nt*d,C.st*m);break;case 2:{const[P,A]=ew(t,y-1,y);c.bezierCurveTo(P.nt*d,P.st*m,A.nt*d,A.st*m,C.nt*d,C.st*m);break}}e!==1&&E!==v&&(_(E,C),c.moveTo(C.nt*d,C.st*m))}(w!==C||w===C&&e===1)&&a(o,v,w,C)}}const eu=6;function go(o,t){return{nt:o.nt-t.nt,st:o.st-t.st}}function iu(o,t){return{nt:o.nt/t,st:o.st/t}}function ew(o,t,e){const s=Math.max(0,t-1),r=Math.min(o.length-1,e+1);var h,a;return[(h=o[t],a=iu(go(o[e],o[s]),eu),{nt:h.nt+a.nt,st:h.st+a.st}),go(o[e],iu(go(o[r],o[t]),eu))]}function iw(o,t,e,s,r){const{context:h,horizontalPixelRatio:a,verticalPixelRatio:c}=t;h.lineTo(r.nt*a,o*c),h.lineTo(s.nt*a,o*c),h.closePath(),h.fillStyle=e,h.fill()}class gc extends _e{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K(t){var e;if(this.G===null)return;const{it:s,tt:r,ds:h,et:a,Nt:c,fs:d}=this.G,m=(e=this.G.vs)!==null&&e!==void 0?e:this.G.ps?0:t.mediaSize.height;if(r===null)return;const p=t.context;p.lineCap="butt",p.lineJoin="round",p.lineWidth=a,mi(p,c),p.lineWidth=1,mc(t,s,d,r,h,this.bs.bind(this),iw.bind(null,m))}}function Wo(o,t,e){return Math.min(Math.max(o,t),e)}function Cs(o,t,e){return t-o<=e}function pc(o){const t=Math.ceil(o);return t%2==0?t-1:t}class Yo{ws(t,e){const s=this.gs,{Ms:r,xs:h,Ss:a,ks:c,ys:d,vs:m}=e;if(this.Cs===void 0||s===void 0||s.Ms!==r||s.xs!==h||s.Ss!==a||s.ks!==c||s.vs!==m||s.ys!==d){const p=t.context.createLinearGradient(0,0,0,d);if(p.addColorStop(0,r),m!=null){const v=Wo(m*t.verticalPixelRatio/d,0,1);p.addColorStop(v,h),p.addColorStop(v,a)}p.addColorStop(1,c),this.Cs=p,this.gs=e}return this.Cs}}class nw extends gc{constructor(){super(...arguments),this.Ts=new Yo}bs(t,e){return this.Ts.ws(t,{Ms:e.Ps,xs:"",Ss:"",ks:e.Rs,ys:t.bitmapSize.height})}}function sw(o,t){const e=o.context;e.strokeStyle=t,e.stroke()}class vc extends _e{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K(t){if(this.G===null)return;const{it:e,tt:s,ds:r,fs:h,et:a,Nt:c,Ds:d}=this.G;if(s===null)return;const m=t.context;m.lineCap="butt",m.lineWidth=a*t.verticalPixelRatio,mi(m,c),m.lineJoin="round";const p=this.Vs.bind(this);h!==void 0&&mc(t,e,h,s,r,p,sw),d&&function(v,w,_,C,y){const{horizontalPixelRatio:E,verticalPixelRatio:P,context:A}=v;let $=null;const U=Math.max(1,Math.floor(E))%2/2,W=_*P+U;for(let I=C.to-1;I>=C.from;--I){const R=w[I];if(R){const V=y(v,R);V!==$&&(A.beginPath(),$!==null&&A.fill(),A.fillStyle=V,$=V);const q=Math.round(R.nt*E)+U,rt=R.st*P;A.moveTo(q,rt),A.arc(q,rt,W,0,2*Math.PI)}}A.fill()}(t,e,d,s,p)}}class xc extends vc{Vs(t,e){return e.lt}}function bc(o,t,e,s,r=0,h=t.length){let a=h-r;for(;0<a;){const c=a>>1,d=r+c;s(t[d],e)===o?(r=d+1,a-=c+1):a=c}return r}const Mn=bc.bind(null,!0),wc=bc.bind(null,!1);function rw(o,t){return o.ot<t}function ow(o,t){return t<o.ot}function _c(o,t,e){const s=t.Os(),r=t.ui(),h=Mn(o,s,rw),a=wc(o,r,ow);if(!e)return{from:h,to:a};let c=h,d=a;return h>0&&h<o.length&&o[h].ot>=s&&(c=h-1),a>0&&a<o.length&&o[a-1].ot<=r&&(d=a+1),{from:c,to:d}}class Zo{constructor(t,e,s){this.Bs=!0,this.As=!0,this.Is=!0,this.zs=[],this.Ls=null,this.Es=t,this.Ns=e,this.Fs=s}bt(t){this.Bs=!0,t==="data"&&(this.As=!0),t==="options"&&(this.Is=!0)}gt(){return this.Es.yt()?(this.Ws(),this.Ls===null?null:this.js):null}Hs(){this.zs=this.zs.map(t=>Object.assign(Object.assign({},t),this.Es.Us().$s(t.ot)))}qs(){this.Ls=null}Ws(){this.As&&(this.Ys(),this.As=!1),this.Is&&(this.Hs(),this.Is=!1),this.Bs&&(this.Zs(),this.Bs=!1)}Zs(){const t=this.Es.Dt(),e=this.Ns.St();if(this.qs(),e.Ni()||t.Ni())return;const s=e.Xs();if(s===null||this.Es.In().Ks()===0)return;const r=this.Es.Ct();r!==null&&(this.Ls=_c(this.zs,s,this.Fs),this.Gs(t,e,r.Vt),this.Js())}}class Us extends Zo{constructor(t,e){super(t,e,!0)}Gs(t,e,s){e.Qs(this.zs,yn(this.Ls)),t.te(this.zs,s,yn(this.Ls))}ie(t,e){return{ot:t,_t:e,nt:NaN,st:NaN}}Ys(){const t=this.Es.Us();this.zs=this.Es.In().ne().map(e=>{const s=e.Vt[3];return this.se(e.ee,s,t)})}}class lw extends Us{constructor(t,e){super(t,e),this.js=new Jo,this.re=new nw,this.he=new xc,this.js.Z([this.re,this.he])}se(t,e,s){return Object.assign(Object.assign({},this.ie(t,e)),s.$s(t))}Js(){const t=this.Es.W();this.re.J({fs:t.lineType,it:this.zs,Nt:t.lineStyle,et:t.lineWidth,vs:null,ps:t.invertFilledArea,tt:this.Ls,ds:this.Ns.St().le()}),this.he.J({fs:t.lineVisible?t.lineType:void 0,it:this.zs,Nt:t.lineStyle,et:t.lineWidth,tt:this.Ls,ds:this.Ns.St().le(),Ds:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0})}}class hw extends _e{constructor(){super(...arguments),this.zt=null,this.ae=0,this.oe=0}J(t){this.zt=t}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:s}){if(this.zt===null||this.zt.In.length===0||this.zt.tt===null)return;this.ae=this._e(e),this.ae>=2&&Math.max(1,Math.floor(e))%2!=this.ae%2&&this.ae--,this.oe=this.zt.ue?Math.min(this.ae,Math.floor(e)):this.ae;let r=null;const h=this.oe<=this.ae&&this.zt.le>=Math.floor(1.5*e);for(let a=this.zt.tt.from;a<this.zt.tt.to;++a){const c=this.zt.In[a];r!==c.ce&&(t.fillStyle=c.ce,r=c.ce);const d=Math.floor(.5*this.oe),m=Math.round(c.nt*e),p=m-d,v=this.oe,w=p+v-1,_=Math.min(c.de,c.fe),C=Math.max(c.de,c.fe),y=Math.round(_*s)-d,E=Math.round(C*s)+d,P=Math.max(E-y,this.oe);t.fillRect(p,y,v,P);const A=Math.ceil(1.5*this.ae);if(h){if(this.zt.ve){const I=m-A;let R=Math.max(y,Math.round(c.pe*s)-d),V=R+v-1;V>y+P-1&&(V=y+P-1,R=V-v+1),t.fillRect(I,R,p-I,V-R+1)}const $=m+A;let U=Math.max(y,Math.round(c.me*s)-d),W=U+v-1;W>y+P-1&&(W=y+P-1,U=W-v+1),t.fillRect(w+1,U,$-w,W-U+1)}}}_e(t){const e=Math.floor(t);return Math.max(e,Math.floor(function(s,r){return Math.floor(.3*s*r)}(D(this.zt).le,t)))}}class yc extends Zo{constructor(t,e){super(t,e,!1)}Gs(t,e,s){e.Qs(this.zs,yn(this.Ls)),t.be(this.zs,s,yn(this.Ls))}we(t,e,s){return{ot:t,ge:e.Vt[0],Me:e.Vt[1],xe:e.Vt[2],Se:e.Vt[3],nt:NaN,pe:NaN,de:NaN,fe:NaN,me:NaN}}Ys(){const t=this.Es.Us();this.zs=this.Es.In().ne().map(e=>this.se(e.ee,e,t))}}class aw extends yc{constructor(){super(...arguments),this.js=new hw}se(t,e,s){return Object.assign(Object.assign({},this.we(t,e,s)),s.$s(t))}Js(){const t=this.Es.W();this.js.J({In:this.zs,le:this.Ns.St().le(),ve:t.openVisible,ue:t.thinBars,tt:this.Ls})}}class uw extends gc{constructor(){super(...arguments),this.Ts=new Yo}bs(t,e){const s=this.G;return this.Ts.ws(t,{Ms:e.ke,xs:e.ye,Ss:e.Ce,ks:e.Te,ys:t.bitmapSize.height,vs:s.vs})}}class cw extends vc{constructor(){super(...arguments),this.Pe=new Yo}Vs(t,e){const s=this.G;return this.Pe.ws(t,{Ms:e.Re,xs:e.Re,Ss:e.De,ks:e.De,ys:t.bitmapSize.height,vs:s.vs})}}class fw extends Us{constructor(t,e){super(t,e),this.js=new Jo,this.Ve=new uw,this.Oe=new cw,this.js.Z([this.Ve,this.Oe])}se(t,e,s){return Object.assign(Object.assign({},this.ie(t,e)),s.$s(t))}Js(){const t=this.Es.Ct();if(t===null)return;const e=this.Es.W(),s=this.Es.Dt().Rt(e.baseValue.price,t.Vt),r=this.Ns.St().le();this.Ve.J({it:this.zs,et:e.lineWidth,Nt:e.lineStyle,fs:e.lineType,vs:s,ps:!1,tt:this.Ls,ds:r}),this.Oe.J({it:this.zs,et:e.lineWidth,Nt:e.lineStyle,fs:e.lineVisible?e.lineType:void 0,Ds:e.pointMarkersVisible?e.pointMarkersRadius||e.lineWidth/2+2:void 0,vs:s,tt:this.Ls,ds:r})}}class dw extends _e{constructor(){super(...arguments),this.zt=null,this.ae=0}J(t){this.zt=t}K(t){if(this.zt===null||this.zt.In.length===0||this.zt.tt===null)return;const{horizontalPixelRatio:e}=t;this.ae=function(h,a){if(h>=2.5&&h<=4)return Math.floor(3*a);const c=1-.2*Math.atan(Math.max(4,h)-4)/(.5*Math.PI),d=Math.floor(h*c*a),m=Math.floor(h*a),p=Math.min(d,m);return Math.max(Math.floor(a),p)}(this.zt.le,e),this.ae>=2&&Math.floor(e)%2!=this.ae%2&&this.ae--;const s=this.zt.In;this.zt.Be&&this.Ae(t,s,this.zt.tt),this.zt._i&&this.Ie(t,s,this.zt.tt);const r=this.ze(e);(!this.zt._i||this.ae>2*r)&&this.Le(t,s,this.zt.tt)}Ae(t,e,s){if(this.zt===null)return;const{context:r,horizontalPixelRatio:h,verticalPixelRatio:a}=t;let c="",d=Math.min(Math.floor(h),Math.floor(this.zt.le*h));d=Math.max(Math.floor(h),Math.min(d,this.ae));const m=Math.floor(.5*d);let p=null;for(let v=s.from;v<s.to;v++){const w=e[v];w.Ee!==c&&(r.fillStyle=w.Ee,c=w.Ee);const _=Math.round(Math.min(w.pe,w.me)*a),C=Math.round(Math.max(w.pe,w.me)*a),y=Math.round(w.de*a),E=Math.round(w.fe*a);let P=Math.round(h*w.nt)-m;const A=P+d-1;p!==null&&(P=Math.max(p+1,P),P=Math.min(P,A));const $=A-P+1;r.fillRect(P,y,$,_-y),r.fillRect(P,C+1,$,E-C),p=A}}ze(t){let e=Math.floor(1*t);this.ae<=2*e&&(e=Math.floor(.5*(this.ae-1)));const s=Math.max(Math.floor(t),e);return this.ae<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}Ie(t,e,s){if(this.zt===null)return;const{context:r,horizontalPixelRatio:h,verticalPixelRatio:a}=t;let c="";const d=this.ze(h);let m=null;for(let p=s.from;p<s.to;p++){const v=e[p];v.Ne!==c&&(r.fillStyle=v.Ne,c=v.Ne);let w=Math.round(v.nt*h)-Math.floor(.5*this.ae);const _=w+this.ae-1,C=Math.round(Math.min(v.pe,v.me)*a),y=Math.round(Math.max(v.pe,v.me)*a);if(m!==null&&(w=Math.max(m+1,w),w=Math.min(w,_)),this.zt.le*h>2*d)Gb(r,w,C,_-w+1,y-C+1,d);else{const E=_-w+1;r.fillRect(w,C,E,y-C+1)}m=_}}Le(t,e,s){if(this.zt===null)return;const{context:r,horizontalPixelRatio:h,verticalPixelRatio:a}=t;let c="";const d=this.ze(h);for(let m=s.from;m<s.to;m++){const p=e[m];let v=Math.round(Math.min(p.pe,p.me)*a),w=Math.round(Math.max(p.pe,p.me)*a),_=Math.round(p.nt*h)-Math.floor(.5*this.ae),C=_+this.ae-1;if(p.ce!==c){const y=p.ce;r.fillStyle=y,c=y}this.zt._i&&(_+=d,v+=d,C-=d,w-=d),v>w||r.fillRect(_,v,C-_+1,w-v+1)}}}class mw extends yc{constructor(){super(...arguments),this.js=new dw}se(t,e,s){return Object.assign(Object.assign({},this.we(t,e,s)),s.$s(t))}Js(){const t=this.Es.W();this.js.J({In:this.zs,le:this.Ns.St().le(),Be:t.wickVisible,_i:t.borderVisible,tt:this.Ls})}}class gw{constructor(t,e){this.Fe=t,this.Li=e}X(t,e,s){this.Fe.draw(t,this.Li,e,s)}}class po extends Zo{constructor(t,e,s){super(t,e,!1),this.wn=s,this.js=new gw(this.wn.renderer(),r=>{const h=t.Ct();return h===null?null:t.Dt().Rt(r,h.Vt)})}We(t){return this.wn.priceValueBuilder(t)}je(t){return this.wn.isWhitespace(t)}Ys(){const t=this.Es.Us();this.zs=this.Es.In().ne().map(e=>Object.assign(Object.assign({ot:e.ee,nt:NaN},t.$s(e.ee)),{He:e.$e}))}Gs(t,e){e.Qs(this.zs,yn(this.Ls))}Js(){this.wn.update({bars:this.zs.map(pw),barSpacing:this.Ns.St().le(),visibleRange:this.Ls},this.Es.W())}}function pw(o){return{x:o.nt,time:o.ot,originalData:o.He,barColor:o.ce}}class vw extends _e{constructor(){super(...arguments),this.zt=null,this.Ue=[]}J(t){this.zt=t,this.Ue=[]}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:s}){if(this.zt===null||this.zt.it.length===0||this.zt.tt===null)return;this.Ue.length||this.qe(e);const r=Math.max(1,Math.floor(s)),h=Math.round(this.zt.Ye*s)-Math.floor(r/2),a=h+r;for(let c=this.zt.tt.from;c<this.zt.tt.to;c++){const d=this.zt.it[c],m=this.Ue[c-this.zt.tt.from],p=Math.round(d.st*s);let v,w;t.fillStyle=d.ce,p<=h?(v=p,w=a):(v=h,w=p-Math.floor(r/2)+r),t.fillRect(m.Os,v,m.ui-m.Os+1,w-v)}}qe(t){if(this.zt===null||this.zt.it.length===0||this.zt.tt===null)return void(this.Ue=[]);const e=Math.ceil(this.zt.le*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.zt.le*t)-e;this.Ue=new Array(this.zt.tt.to-this.zt.tt.from);for(let h=this.zt.tt.from;h<this.zt.tt.to;h++){const a=this.zt.it[h],c=Math.round(a.nt*t);let d,m;if(s%2){const p=(s-1)/2;d=c-p,m=c+p}else{const p=s/2;d=c-p,m=c+p-1}this.Ue[h-this.zt.tt.from]={Os:d,ui:m,Ze:c,Xe:a.nt*t,ot:a.ot}}for(let h=this.zt.tt.from+1;h<this.zt.tt.to;h++){const a=this.Ue[h-this.zt.tt.from],c=this.Ue[h-this.zt.tt.from-1];a.ot===c.ot+1&&a.Os-c.ui!==e+1&&(c.Ze>c.Xe?c.ui=a.Os-e-1:a.Os=c.ui+e+1)}let r=Math.ceil(this.zt.le*t);for(let h=this.zt.tt.from;h<this.zt.tt.to;h++){const a=this.Ue[h-this.zt.tt.from];a.ui<a.Os&&(a.ui=a.Os);const c=a.ui-a.Os+1;r=Math.min(c,r)}if(e>0&&r<4)for(let h=this.zt.tt.from;h<this.zt.tt.to;h++){const a=this.Ue[h-this.zt.tt.from];a.ui-a.Os+1>r&&(a.Ze>a.Xe?a.ui-=1:a.Os+=1)}}}class xw extends Us{constructor(){super(...arguments),this.js=new vw}se(t,e,s){return Object.assign(Object.assign({},this.ie(t,e)),s.$s(t))}Js(){const t={it:this.zs,le:this.Ns.St().le(),tt:this.Ls,Ye:this.Es.Dt().Rt(this.Es.W().base,D(this.Es.Ct()).Vt)};this.js.J(t)}}class bw extends Us{constructor(){super(...arguments),this.js=new xc}se(t,e,s){return Object.assign(Object.assign({},this.ie(t,e)),s.$s(t))}Js(){const t=this.Es.W(),e={it:this.zs,Nt:t.lineStyle,fs:t.lineVisible?t.lineType:void 0,et:t.lineWidth,Ds:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0,tt:this.Ls,ds:this.Ns.St().le()};this.js.J(e)}}const ww=/[2-9]/g;class Sn{constructor(t=50){this.Ke=0,this.Ge=1,this.Je=1,this.Qe={},this.tr=new Map,this.ir=t}nr(){this.Ke=0,this.tr.clear(),this.Ge=1,this.Je=1,this.Qe={}}xi(t,e,s){return this.sr(t,e,s).width}Mi(t,e,s){const r=this.sr(t,e,s);return((r.actualBoundingBoxAscent||0)-(r.actualBoundingBoxDescent||0))/2}sr(t,e,s){const r=s||ww,h=String(e).replace(r,"0");if(this.tr.has(h))return Vt(this.tr.get(h)).er;if(this.Ke===this.ir){const c=this.Qe[this.Je];delete this.Qe[this.Je],this.tr.delete(c),this.Je++,this.Ke--}t.save(),t.textBaseline="middle";const a=t.measureText(h);return t.restore(),a.width===0&&e.length||(this.tr.set(h,{er:a,rr:this.Ge}),this.Qe[this.Ge]=h,this.Ke++,this.Ge++),a}}class _w{constructor(t){this.hr=null,this.k=null,this.lr="right",this.ar=t}_r(t,e,s){this.hr=t,this.k=e,this.lr=s}X(t){this.k!==null&&this.hr!==null&&this.hr.X(t,this.k,this.ar,this.lr)}}class Sc{constructor(t,e,s){this.ur=t,this.ar=new Sn(50),this.cr=e,this.F=s,this.j=-1,this.Wt=new _w(this.ar)}gt(){const t=this.F.dr(this.cr);if(t===null)return null;const e=t.vr(this.cr)?t.pr():this.cr.Dt();if(e===null)return null;const s=t.mr(e);if(s==="overlay")return null;const r=this.F.br();return r.P!==this.j&&(this.j=r.P,this.ar.nr()),this.Wt._r(this.ur.Ii(),r,s),this.Wt}}class yw extends _e{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}wr(t,e){var s;if(!(!((s=this.zt)===null||s===void 0)&&s.yt))return null;const{st:r,et:h,gr:a}=this.zt;return e>=r-h-7&&e<=r+h+7?{Mr:this.zt,gr:a}:null}K({context:t,bitmapSize:e,horizontalPixelRatio:s,verticalPixelRatio:r}){if(this.zt===null||this.zt.yt===!1)return;const h=Math.round(this.zt.st*r);h<0||h>e.height||(t.lineCap="butt",t.strokeStyle=this.zt.V,t.lineWidth=Math.floor(this.zt.et*s),mi(t,this.zt.Nt),hc(t,h,0,e.width))}}class tl{constructor(t){this.Sr={st:0,V:"rgba(0, 0, 0, 0)",et:1,Nt:0,yt:!1},this.kr=new yw,this.ft=!0,this.Es=t,this.Ns=t.$t(),this.kr.J(this.Sr)}bt(){this.ft=!0}gt(){return this.Es.yt()?(this.ft&&(this.yr(),this.ft=!1),this.kr):null}}class Sw extends tl{constructor(t){super(t)}yr(){this.Sr.yt=!1;const t=this.Es.Dt(),e=t.Cr().Cr;if(e!==2&&e!==3)return;const s=this.Es.W();if(!s.baseLineVisible||!this.Es.yt())return;const r=this.Es.Ct();r!==null&&(this.Sr.yt=!0,this.Sr.st=t.Rt(r.Vt,r.Vt),this.Sr.V=s.baseLineColor,this.Sr.et=s.baseLineWidth,this.Sr.Nt=s.baseLineStyle)}}class Cw extends _e{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}$e(){return this.zt}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:s}){const r=this.zt;if(r===null)return;const h=Math.max(1,Math.floor(e)),a=h%2/2,c=Math.round(r.Xe.x*e)+a,d=r.Xe.y*s;t.fillStyle=r.Tr,t.beginPath();const m=Math.max(2,1.5*r.Pr)*e;t.arc(c,d,m,0,2*Math.PI,!1),t.fill(),t.fillStyle=r.Rr,t.beginPath(),t.arc(c,d,r.ht*e,0,2*Math.PI,!1),t.fill(),t.lineWidth=h,t.strokeStyle=r.Dr,t.beginPath(),t.arc(c,d,r.ht*e+h/2,0,2*Math.PI,!1),t.stroke()}}const Nw=[{Vr:0,Or:.25,Br:4,Ar:10,Ir:.25,zr:0,Lr:.4,Er:.8},{Vr:.25,Or:.525,Br:10,Ar:14,Ir:0,zr:0,Lr:.8,Er:0},{Vr:.525,Or:1,Br:14,Ar:14,Ir:0,zr:0,Lr:0,Er:0}];function nu(o,t,e,s){return function(r,h){if(r==="transparent")return r;const a=wn(r),c=a[3];return`rgba(${a[0]}, ${a[1]}, ${a[2]}, ${h*c})`}(o,e+(s-e)*t)}function su(o,t){const e=o%2600/2600;let s;for(const d of Nw)if(e>=d.Vr&&e<=d.Or){s=d;break}ti(s!==void 0,"Last price animation internal logic error");const r=(e-s.Vr)/(s.Or-s.Vr);return{Rr:nu(t,r,s.Ir,s.zr),Dr:nu(t,r,s.Lr,s.Er),ht:(h=r,a=s.Br,c=s.Ar,a+(c-a)*h)};var h,a,c}class Mw{constructor(t){this.Wt=new Cw,this.ft=!0,this.Nr=!0,this.Fr=performance.now(),this.Wr=this.Fr-1,this.jr=t}Hr(){this.Wr=this.Fr-1,this.bt()}$r(){if(this.bt(),this.jr.W().lastPriceAnimation===2){const t=performance.now(),e=this.Wr-t;if(e>0)return void(e<650&&(this.Wr+=2600));this.Fr=t,this.Wr=t+2600}}bt(){this.ft=!0}Ur(){this.Nr=!0}yt(){return this.jr.W().lastPriceAnimation!==0}qr(){switch(this.jr.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Wr}}gt(){return this.ft?(this.Mt(),this.ft=!1,this.Nr=!1):this.Nr&&(this.Yr(),this.Nr=!1),this.Wt}Mt(){this.Wt.J(null);const t=this.jr.$t().St(),e=t.Xs(),s=this.jr.Ct();if(e===null||s===null)return;const r=this.jr.Zr(!0);if(r.Xr||!e.Kr(r.ee))return;const h={x:t.It(r.ee),y:this.jr.Dt().Rt(r._t,s.Vt)},a=r.V,c=this.jr.W().lineWidth,d=su(this.Gr(),a);this.Wt.J({Tr:a,Pr:c,Rr:d.Rr,Dr:d.Dr,ht:d.ht,Xe:h})}Yr(){const t=this.Wt.$e();if(t!==null){const e=su(this.Gr(),t.Tr);t.Rr=e.Rr,t.Dr=e.Dr,t.ht=e.ht}}Gr(){return this.qr()?performance.now()-this.Fr:2599}}function pn(o,t){return pc(Math.min(Math.max(o,12),30)*t)}function Cn(o,t){switch(o){case"arrowDown":case"arrowUp":return pn(t,1);case"circle":return pn(t,.8);case"square":return pn(t,.7)}}function Cc(o){return function(t){const e=Math.ceil(t);return e%2!=0?e-1:e}(pn(o,1))}function ru(o){return Math.max(pn(o,.1),3)}function ou(o,t,e){return t?o:e?Math.ceil(o/2):0}function Nc(o,t,e,s,r){const h=Cn("square",e),a=(h-1)/2,c=o-a,d=t-a;return s>=c&&s<=c+h&&r>=d&&r<=d+h}function lu(o,t,e,s){const r=(Cn("arrowUp",s)-1)/2*e.Jr,h=(pc(s/2)-1)/2*e.Jr;t.beginPath(),o?(t.moveTo(e.nt-r,e.st),t.lineTo(e.nt,e.st-r),t.lineTo(e.nt+r,e.st),t.lineTo(e.nt+h,e.st),t.lineTo(e.nt+h,e.st+r),t.lineTo(e.nt-h,e.st+r),t.lineTo(e.nt-h,e.st)):(t.moveTo(e.nt-r,e.st),t.lineTo(e.nt,e.st+r),t.lineTo(e.nt+r,e.st),t.lineTo(e.nt+h,e.st),t.lineTo(e.nt+h,e.st-r),t.lineTo(e.nt-h,e.st-r),t.lineTo(e.nt-h,e.st)),t.fill()}function Lw(o,t,e,s,r,h){return Nc(t,e,s,r,h)}class Ew extends _e{constructor(){super(...arguments),this.zt=null,this.ar=new Sn,this.j=-1,this.H="",this.Qr=""}J(t){this.zt=t}_r(t,e){this.j===t&&this.H===e||(this.j=t,this.H=e,this.Qr=Ii(t,e),this.ar.nr())}wr(t,e){if(this.zt===null||this.zt.tt===null)return null;for(let s=this.zt.tt.from;s<this.zt.tt.to;s++){const r=this.zt.it[s];if(jw(r,t,e))return{Mr:r.th,gr:r.gr}}return null}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:s},r,h){if(this.zt!==null&&this.zt.tt!==null){t.textBaseline="middle",t.font=this.Qr;for(let a=this.zt.tt.from;a<this.zt.tt.to;a++){const c=this.zt.it[a];c.Kt!==void 0&&(c.Kt.Hi=this.ar.xi(t,c.Kt.ih),c.Kt.At=this.j,c.Kt.nt=c.nt-c.Kt.Hi/2),Pw(c,t,e,s)}}}}function Pw(o,t,e,s){t.fillStyle=o.V,o.Kt!==void 0&&function(r,h,a,c,d,m){r.save(),r.scale(d,m),r.fillText(h,a,c),r.restore()}(t,o.Kt.ih,o.Kt.nt,o.Kt.st,e,s),function(r,h,a){if(r.Ks!==0){switch(r.nh){case"arrowDown":return void lu(!1,h,a,r.Ks);case"arrowUp":return void lu(!0,h,a,r.Ks);case"circle":return void function(c,d,m){const p=(Cn("circle",m)-1)/2;c.beginPath(),c.arc(d.nt,d.st,p*d.Jr,0,2*Math.PI,!1),c.fill()}(h,a,r.Ks);case"square":return void function(c,d,m){const p=Cn("square",m),v=(p-1)*d.Jr/2,w=d.nt-v,_=d.st-v;c.fillRect(w,_,p*d.Jr,p*d.Jr)}(h,a,r.Ks)}r.nh}}(o,t,function(r,h,a){const c=Math.max(1,Math.floor(h))%2/2;return{nt:Math.round(r.nt*h)+c,st:r.st*a,Jr:h}}(o,e,s))}function jw(o,t,e){return!(o.Kt===void 0||!function(s,r,h,a,c,d){const m=a/2;return c>=s&&c<=s+h&&d>=r-m&&d<=r+m}(o.Kt.nt,o.Kt.st,o.Kt.Hi,o.Kt.At,t,e))||function(s,r,h){if(s.Ks===0)return!1;switch(s.nh){case"arrowDown":case"arrowUp":return Lw(0,s.nt,s.st,s.Ks,r,h);case"circle":return function(a,c,d,m,p){const v=2+Cn("circle",d)/2,w=a-m,_=c-p;return Math.sqrt(w*w+_*_)<=v}(s.nt,s.st,s.Ks,r,h);case"square":return Nc(s.nt,s.st,s.Ks,r,h)}}(o,t,e)}function zw(o,t,e,s,r,h,a,c,d){const m=Me(e)?e:e.Se,p=Me(e)?e:e.Me,v=Me(e)?e:e.xe,w=Me(t.size)?Math.max(t.size,0):1,_=Cc(c.le())*w,C=_/2;switch(o.Ks=_,t.position){case"inBar":return o.st=a.Rt(m,d),void(o.Kt!==void 0&&(o.Kt.st=o.st+C+h+.6*r));case"aboveBar":return o.st=a.Rt(p,d)-C-s.sh,o.Kt!==void 0&&(o.Kt.st=o.st-C-.6*r,s.sh+=1.2*r),void(s.sh+=_+h);case"belowBar":return o.st=a.Rt(v,d)+C+s.eh,o.Kt!==void 0&&(o.Kt.st=o.st+C+h+.6*r,s.eh+=1.2*r),void(s.eh+=_+h)}t.position}class Tw{constructor(t,e){this.ft=!0,this.rh=!0,this.hh=!0,this.ah=null,this.oh=null,this.Wt=new Ew,this.jr=t,this.$i=e,this.zt={it:[],tt:null}}bt(t){this.ft=!0,this.hh=!0,t==="data"&&(this.rh=!0,this.oh=null)}gt(t){if(!this.jr.yt())return null;this.ft&&this._h();const e=this.$i.W().layout;return this.Wt._r(e.fontSize,e.fontFamily),this.Wt.J(this.zt),this.Wt}uh(){if(this.hh){if(this.jr.dh().length>0){const t=this.$i.St().le(),e=ru(t),s=1.5*Cc(t)+2*e,r=this.fh();this.ah={above:ou(s,r.aboveBar,r.inBar),below:ou(s,r.belowBar,r.inBar)}}else this.ah=null;this.hh=!1}return this.ah}fh(){return this.oh===null&&(this.oh=this.jr.dh().reduce((t,e)=>(t[e.position]||(t[e.position]=!0),t),{inBar:!1,aboveBar:!1,belowBar:!1})),this.oh}_h(){const t=this.jr.Dt(),e=this.$i.St(),s=this.jr.dh();this.rh&&(this.zt.it=s.map(p=>({ot:p.time,nt:0,st:0,Ks:0,nh:p.shape,V:p.color,th:p.th,gr:p.id,Kt:void 0})),this.rh=!1);const r=this.$i.W().layout;this.zt.tt=null;const h=e.Xs();if(h===null)return;const a=this.jr.Ct();if(a===null||this.zt.it.length===0)return;let c=NaN;const d=ru(e.le()),m={sh:d,eh:d};this.zt.tt=_c(this.zt.it,h,!0);for(let p=this.zt.tt.from;p<this.zt.tt.to;p++){const v=s[p];v.time!==c&&(m.sh=d,m.eh=d,c=v.time);const w=this.zt.it[p];w.nt=e.It(v.time),v.text!==void 0&&v.text.length>0&&(w.Kt={ih:v.text,nt:0,st:0,Hi:0,At:0});const _=this.jr.ph(v.time);_!==null&&zw(w,v,_,m,r.fontSize,d,t,e,a.Vt)}this.ft=!1}}class kw extends tl{constructor(t){super(t)}yr(){const t=this.Sr;t.yt=!1;const e=this.Es.W();if(!e.priceLineVisible||!this.Es.yt())return;const s=this.Es.Zr(e.priceLineSource===0);s.Xr||(t.yt=!0,t.st=s.ki,t.V=this.Es.mh(s.V),t.et=e.priceLineWidth,t.Nt=e.priceLineStyle)}}class Rw extends Fs{constructor(t){super(),this.jt=t}zi(t,e,s){t.yt=!1,e.yt=!1;const r=this.jt;if(!r.yt())return;const h=r.W(),a=h.lastValueVisible,c=r.bh()!=="",d=h.seriesLastValueMode===0,m=r.Zr(!1);if(m.Xr)return;a&&(t.Kt=this.wh(m,a,d),t.yt=t.Kt.length!==0),(c||d)&&(e.Kt=this.gh(m,a,c,d),e.yt=e.Kt.length>0);const p=r.mh(m.V),v=Is(p);s.t=v.t,s.ki=m.ki,e.Ot=r.$t().Bt(m.ki/r.Dt().At()),t.Ot=p,t.V=v.i,e.V=v.i}gh(t,e,s,r){let h="";const a=this.jt.bh();return s&&a.length!==0&&(h+=`${a} `),e&&r&&(h+=this.jt.Dt().Mh()?t.xh:t.Sh),h.trim()}wh(t,e,s){return e?s?this.jt.Dt().Mh()?t.Sh:t.xh:t.Kt:""}}function hu(o,t,e,s){const r=Number.isFinite(t),h=Number.isFinite(e);return r&&h?o(t,e):r||h?r?t:e:s}class Xt{constructor(t,e){this.kh=t,this.yh=e}Ch(t){return t!==null&&this.kh===t.kh&&this.yh===t.yh}Th(){return new Xt(this.kh,this.yh)}Ph(){return this.kh}Rh(){return this.yh}Dh(){return this.yh-this.kh}Ni(){return this.yh===this.kh||Number.isNaN(this.yh)||Number.isNaN(this.kh)}ts(t){return t===null?this:new Xt(hu(Math.min,this.Ph(),t.Ph(),-1/0),hu(Math.max,this.Rh(),t.Rh(),1/0))}Vh(t){if(!Me(t)||this.yh-this.kh===0)return;const e=.5*(this.yh+this.kh);let s=this.yh-e,r=this.kh-e;s*=t,r*=t,this.yh=e+s,this.kh=e+r}Oh(t){Me(t)&&(this.yh+=t,this.kh+=t)}Bh(){return{minValue:this.kh,maxValue:this.yh}}static Ah(t){return t===null?null:new Xt(t.minValue,t.maxValue)}}class Ds{constructor(t,e){this.Ih=t,this.zh=e||null}Lh(){return this.Ih}Eh(){return this.zh}Bh(){return this.Ih===null?null:{priceRange:this.Ih.Bh(),margins:this.zh||void 0}}static Ah(t){return t===null?null:new Ds(Xt.Ah(t.priceRange),t.margins)}}class Ow extends tl{constructor(t,e){super(t),this.Nh=e}yr(){const t=this.Sr;t.yt=!1;const e=this.Nh.W();if(!this.Es.yt()||!e.lineVisible)return;const s=this.Nh.Fh();s!==null&&(t.yt=!0,t.st=s,t.V=e.color,t.et=e.lineWidth,t.Nt=e.lineStyle,t.gr=this.Nh.W().id)}}class Aw extends Fs{constructor(t,e){super(),this.jr=t,this.Nh=e}zi(t,e,s){t.yt=!1,e.yt=!1;const r=this.Nh.W(),h=r.axisLabelVisible,a=r.title!=="",c=this.jr;if(!h||!c.yt())return;const d=this.Nh.Fh();if(d===null)return;a&&(e.Kt=r.title,e.yt=!0),e.Ot=c.$t().Bt(d/c.Dt().At()),t.Kt=this.Wh(r.price),t.yt=!0;const m=Is(r.axisLabelColor||r.color);s.t=m.t;const p=r.axisLabelTextColor||m.i;t.V=p,e.V=p,s.ki=d}Wh(t){const e=this.jr.Ct();return e===null?"":this.jr.Dt().Fi(t,e.Vt)}}class Dw{constructor(t,e){this.jr=t,this.cn=e,this.jh=new Ow(t,this),this.ur=new Aw(t,this),this.Hh=new Sc(this.ur,t,t.$t())}$h(t){we(this.cn,t),this.bt(),this.jr.$t().Uh()}W(){return this.cn}qh(){return this.jh}Yh(){return this.Hh}Zh(){return this.ur}bt(){this.jh.bt(),this.ur.bt()}Fh(){const t=this.jr,e=t.Dt();if(t.$t().St().Ni()||e.Ni())return null;const s=t.Ct();return s===null?null:e.Rt(this.cn.price,s.Vt)}}class $w extends Qo{constructor(t){super(),this.$i=t}$t(){return this.$i}}const Iw={Bar:(o,t,e,s)=>{var r;const h=t.upColor,a=t.downColor,c=D(o(e,s)),d=Oi(c.Vt[0])<=Oi(c.Vt[3]);return{ce:(r=c.V)!==null&&r!==void 0?r:d?h:a}},Candlestick:(o,t,e,s)=>{var r,h,a;const c=t.upColor,d=t.downColor,m=t.borderUpColor,p=t.borderDownColor,v=t.wickUpColor,w=t.wickDownColor,_=D(o(e,s)),C=Oi(_.Vt[0])<=Oi(_.Vt[3]);return{ce:(r=_.V)!==null&&r!==void 0?r:C?c:d,Ne:(h=_.Ot)!==null&&h!==void 0?h:C?m:p,Ee:(a=_.Xh)!==null&&a!==void 0?a:C?v:w}},Custom:(o,t,e,s)=>{var r;return{ce:(r=D(o(e,s)).V)!==null&&r!==void 0?r:t.color}},Area:(o,t,e,s)=>{var r,h,a,c;const d=D(o(e,s));return{ce:(r=d.lt)!==null&&r!==void 0?r:t.lineColor,lt:(h=d.lt)!==null&&h!==void 0?h:t.lineColor,Ps:(a=d.Ps)!==null&&a!==void 0?a:t.topColor,Rs:(c=d.Rs)!==null&&c!==void 0?c:t.bottomColor}},Baseline:(o,t,e,s)=>{var r,h,a,c,d,m;const p=D(o(e,s));return{ce:p.Vt[3]>=t.baseValue.price?t.topLineColor:t.bottomLineColor,Re:(r=p.Re)!==null&&r!==void 0?r:t.topLineColor,De:(h=p.De)!==null&&h!==void 0?h:t.bottomLineColor,ke:(a=p.ke)!==null&&a!==void 0?a:t.topFillColor1,ye:(c=p.ye)!==null&&c!==void 0?c:t.topFillColor2,Ce:(d=p.Ce)!==null&&d!==void 0?d:t.bottomFillColor1,Te:(m=p.Te)!==null&&m!==void 0?m:t.bottomFillColor2}},Line:(o,t,e,s)=>{var r,h;const a=D(o(e,s));return{ce:(r=a.V)!==null&&r!==void 0?r:t.color,lt:(h=a.V)!==null&&h!==void 0?h:t.color}},Histogram:(o,t,e,s)=>{var r;return{ce:(r=D(o(e,s)).V)!==null&&r!==void 0?r:t.color}}};class Ww{constructor(t){this.Kh=(e,s)=>s!==void 0?s.Vt:this.jr.In().Gh(e),this.jr=t,this.Jh=Iw[t.Qh()]}$s(t,e){return this.Jh(this.Kh,this.jr.W(),t,e)}}var au;(function(o){o[o.NearestLeft=-1]="NearestLeft",o[o.None=0]="None",o[o.NearestRight=1]="NearestRight"})(au||(au={}));const Ze=30;class Fw{constructor(){this.tl=[],this.il=new Map,this.nl=new Map}sl(){return this.Ks()>0?this.tl[this.tl.length-1]:null}el(){return this.Ks()>0?this.rl(0):null}An(){return this.Ks()>0?this.rl(this.tl.length-1):null}Ks(){return this.tl.length}Ni(){return this.Ks()===0}Kr(t){return this.hl(t,0)!==null}Gh(t){return this.ll(t)}ll(t,e=0){const s=this.hl(t,e);return s===null?null:Object.assign(Object.assign({},this.al(s)),{ee:this.rl(s)})}ne(){return this.tl}ol(t,e,s){if(this.Ni())return null;let r=null;for(const h of s)r=Ns(r,this._l(t,e,h));return r}J(t){this.nl.clear(),this.il.clear(),this.tl=t}rl(t){return this.tl[t].ee}al(t){return this.tl[t]}hl(t,e){const s=this.ul(t);if(s===null&&e!==0)switch(e){case-1:return this.cl(t);case 1:return this.dl(t);default:throw new TypeError("Unknown search mode")}return s}cl(t){let e=this.fl(t);return e>0&&(e-=1),e!==this.tl.length&&this.rl(e)<t?e:null}dl(t){const e=this.vl(t);return e!==this.tl.length&&t<this.rl(e)?e:null}ul(t){const e=this.fl(t);return e===this.tl.length||t<this.tl[e].ee?null:e}fl(t){return Mn(this.tl,t,(e,s)=>e.ee<s)}vl(t){return wc(this.tl,t,(e,s)=>e.ee>s)}pl(t,e,s){let r=null;for(let h=t;h<e;h++){const a=this.tl[h].Vt[s];Number.isNaN(a)||(r===null?r={ml:a,bl:a}:(a<r.ml&&(r.ml=a),a>r.bl&&(r.bl=a)))}return r}_l(t,e,s){if(this.Ni())return null;let r=null;const h=D(this.el()),a=D(this.An()),c=Math.max(t,h),d=Math.min(e,a),m=Math.ceil(c/Ze)*Ze,p=Math.max(m,Math.floor(d/Ze)*Ze);{const w=this.fl(c),_=this.vl(Math.min(d,m,e));r=Ns(r,this.pl(w,_,s))}let v=this.il.get(s);v===void 0&&(v=new Map,this.il.set(s,v));for(let w=Math.max(m+1,c);w<p;w+=Ze){const _=Math.floor(w/Ze);let C=v.get(_);if(C===void 0){const y=this.fl(_*Ze),E=this.vl((_+1)*Ze-1);C=this.pl(y,E,s),v.set(_,C)}r=Ns(r,C)}{const w=this.fl(p),_=this.vl(d);r=Ns(r,this.pl(w,_,s))}return r}}function Ns(o,t){return o===null?t:t===null?o:{ml:Math.min(o.ml,t.ml),bl:Math.max(o.bl,t.bl)}}class Bw{constructor(t){this.wl=t}X(t,e,s){this.wl.draw(t)}gl(t,e,s){var r,h;(h=(r=this.wl).drawBackground)===null||h===void 0||h.call(r,t)}}class vo{constructor(t){this.tr=null,this.wn=t}gt(){var t;const e=this.wn.renderer();if(e===null)return null;if(((t=this.tr)===null||t===void 0?void 0:t.Ml)===e)return this.tr.xl;const s=new Bw(e);return this.tr={Ml:e,xl:s},s}Sl(){var t,e,s;return(s=(e=(t=this.wn).zOrder)===null||e===void 0?void 0:e.call(t))!==null&&s!==void 0?s:"normal"}}function Mc(o){var t,e,s,r,h;return{Kt:o.text(),ki:o.coordinate(),Si:(t=o.fixedCoordinate)===null||t===void 0?void 0:t.call(o),V:o.textColor(),t:o.backColor(),yt:(s=(e=o.visible)===null||e===void 0?void 0:e.call(o))===null||s===void 0||s,hi:(h=(r=o.tickVisible)===null||r===void 0?void 0:r.call(o))===null||h===void 0||h}}class Vw{constructor(t,e){this.Wt=new fc,this.kl=t,this.yl=e}gt(){return this.Wt.J(Object.assign({Hi:this.yl.Hi()},Mc(this.kl))),this.Wt}}class Uw extends Fs{constructor(t,e){super(),this.kl=t,this.Li=e}zi(t,e,s){const r=Mc(this.kl);s.t=r.t,t.V=r.V;const h=2/12*this.Li.P();s.wi=h,s.gi=h,s.ki=r.ki,s.Si=r.Si,t.Kt=r.Kt,t.yt=r.yt,t.hi=r.hi}}class Hw{constructor(t,e){this.Cl=null,this.Tl=null,this.Pl=null,this.Rl=null,this.Dl=null,this.Vl=t,this.jr=e}Ol(){return this.Vl}Vn(){var t,e;(e=(t=this.Vl).updateAllViews)===null||e===void 0||e.call(t)}Pn(){var t,e,s,r;const h=(s=(e=(t=this.Vl).paneViews)===null||e===void 0?void 0:e.call(t))!==null&&s!==void 0?s:[];if(((r=this.Cl)===null||r===void 0?void 0:r.Ml)===h)return this.Cl.xl;const a=h.map(c=>new vo(c));return this.Cl={Ml:h,xl:a},a}Qi(){var t,e,s,r;const h=(s=(e=(t=this.Vl).timeAxisViews)===null||e===void 0?void 0:e.call(t))!==null&&s!==void 0?s:[];if(((r=this.Tl)===null||r===void 0?void 0:r.Ml)===h)return this.Tl.xl;const a=this.jr.$t().St(),c=h.map(d=>new Vw(d,a));return this.Tl={Ml:h,xl:c},c}Rn(){var t,e,s,r;const h=(s=(e=(t=this.Vl).priceAxisViews)===null||e===void 0?void 0:e.call(t))!==null&&s!==void 0?s:[];if(((r=this.Pl)===null||r===void 0?void 0:r.Ml)===h)return this.Pl.xl;const a=this.jr.Dt(),c=h.map(d=>new Uw(d,a));return this.Pl={Ml:h,xl:c},c}Bl(){var t,e,s,r;const h=(s=(e=(t=this.Vl).priceAxisPaneViews)===null||e===void 0?void 0:e.call(t))!==null&&s!==void 0?s:[];if(((r=this.Rl)===null||r===void 0?void 0:r.Ml)===h)return this.Rl.xl;const a=h.map(c=>new vo(c));return this.Rl={Ml:h,xl:a},a}Al(){var t,e,s,r;const h=(s=(e=(t=this.Vl).timeAxisPaneViews)===null||e===void 0?void 0:e.call(t))!==null&&s!==void 0?s:[];if(((r=this.Dl)===null||r===void 0?void 0:r.Ml)===h)return this.Dl.xl;const a=h.map(c=>new vo(c));return this.Dl={Ml:h,xl:a},a}Il(t,e){var s,r,h;return(h=(r=(s=this.Vl).autoscaleInfo)===null||r===void 0?void 0:r.call(s,t,e))!==null&&h!==void 0?h:null}wr(t,e){var s,r,h;return(h=(r=(s=this.Vl).hitTest)===null||r===void 0?void 0:r.call(s,t,e))!==null&&h!==void 0?h:null}}function xo(o,t,e,s){o.forEach(r=>{t(r).forEach(h=>{h.Sl()===e&&s.push(h)})})}function bo(o){return o.Pn()}function Kw(o){return o.Bl()}function qw(o){return o.Al()}class el extends $w{constructor(t,e,s,r,h){super(t),this.zt=new Fw,this.jh=new kw(this),this.zl=[],this.Ll=new Sw(this),this.El=null,this.Nl=null,this.Fl=[],this.Wl=[],this.jl=null,this.Hl=[],this.cn=e,this.$l=s;const a=new Rw(this);this.rn=[a],this.Hh=new Sc(a,this,t),s!=="Area"&&s!=="Line"&&s!=="Baseline"||(this.El=new Mw(this)),this.Ul(),this.ql(h)}S(){this.jl!==null&&clearTimeout(this.jl)}mh(t){return this.cn.priceLineColor||t}Zr(t){const e={Xr:!0},s=this.Dt();if(this.$t().St().Ni()||s.Ni()||this.zt.Ni())return e;const r=this.$t().St().Xs(),h=this.Ct();if(r===null||h===null)return e;let a,c;if(t){const v=this.zt.sl();if(v===null)return e;a=v,c=v.ee}else{const v=this.zt.ll(r.ui(),-1);if(v===null||(a=this.zt.Gh(v.ee),a===null))return e;c=v.ee}const d=a.Vt[3],m=this.Us().$s(c,{Vt:a}),p=s.Rt(d,h.Vt);return{Xr:!1,_t:d,Kt:s.Fi(d,h.Vt),xh:s.Yl(d),Sh:s.Zl(d,h.Vt),V:m.ce,ki:p,ee:c}}Us(){return this.Nl!==null||(this.Nl=new Ww(this)),this.Nl}W(){return this.cn}$h(t){const e=t.priceScaleId;e!==void 0&&e!==this.cn.priceScaleId&&this.$t().Xl(this,e),we(this.cn,t),t.priceFormat!==void 0&&(this.Ul(),this.$t().Kl()),this.$t().Gl(this),this.$t().Jl(),this.wn.bt("options")}J(t,e){this.zt.J(t),this.Ql(),this.wn.bt("data"),this.dn.bt("data"),this.El!==null&&(e&&e.ta?this.El.$r():t.length===0&&this.El.Hr());const s=this.$t().dr(this);this.$t().ia(s),this.$t().Gl(this),this.$t().Jl(),this.$t().Uh()}na(t){this.Fl=t,this.Ql();const e=this.$t().dr(this);this.dn.bt("data"),this.$t().ia(e),this.$t().Gl(this),this.$t().Jl(),this.$t().Uh()}sa(){return this.Fl}dh(){return this.Wl}ea(t){const e=new Dw(this,t);return this.zl.push(e),this.$t().Gl(this),e}ra(t){const e=this.zl.indexOf(t);e!==-1&&this.zl.splice(e,1),this.$t().Gl(this)}Qh(){return this.$l}Ct(){const t=this.ha();return t===null?null:{Vt:t.Vt[3],la:t.ot}}ha(){const t=this.$t().St().Xs();if(t===null)return null;const e=t.Os();return this.zt.ll(e,1)}In(){return this.zt}ph(t){const e=this.zt.Gh(t);return e===null?null:this.$l==="Bar"||this.$l==="Candlestick"||this.$l==="Custom"?{ge:e.Vt[0],Me:e.Vt[1],xe:e.Vt[2],Se:e.Vt[3]}:e.Vt[3]}aa(t){const e=[];xo(this.Hl,bo,"top",e);const s=this.El;return s!==null&&s.yt()&&(this.jl===null&&s.qr()&&(this.jl=setTimeout(()=>{this.jl=null,this.$t().oa()},0)),s.Ur(),e.unshift(s)),e}Pn(){const t=[];this._a()||t.push(this.Ll),t.push(this.wn,this.jh,this.dn);const e=this.zl.map(s=>s.qh());return t.push(...e),xo(this.Hl,bo,"normal",t),t}ua(){return this.ca(bo,"bottom")}da(t){return this.ca(Kw,t)}fa(t){return this.ca(qw,t)}va(t,e){return this.Hl.map(s=>s.wr(t,e)).filter(s=>s!==null)}Ji(t){return[this.Hh,...this.zl.map(e=>e.Yh())]}Rn(t,e){if(e!==this.Yi&&!this._a())return[];const s=[...this.rn];for(const r of this.zl)s.push(r.Zh());return this.Hl.forEach(r=>{s.push(...r.Rn())}),s}Qi(){const t=[];return this.Hl.forEach(e=>{t.push(...e.Qi())}),t}Il(t,e){if(this.cn.autoscaleInfoProvider!==void 0){const s=this.cn.autoscaleInfoProvider(()=>{const r=this.pa(t,e);return r===null?null:r.Bh()});return Ds.Ah(s)}return this.pa(t,e)}ma(){return this.cn.priceFormat.minMove}ba(){return this.wa}Vn(){var t;this.wn.bt(),this.dn.bt();for(const e of this.rn)e.bt();for(const e of this.zl)e.bt();this.jh.bt(),this.Ll.bt(),(t=this.El)===null||t===void 0||t.bt(),this.Hl.forEach(e=>e.Vn())}Dt(){return D(super.Dt())}kt(t){if(!((this.$l==="Line"||this.$l==="Area"||this.$l==="Baseline")&&this.cn.crosshairMarkerVisible))return null;const e=this.zt.Gh(t);return e===null?null:{_t:e.Vt[3],ht:this.ga(),Ot:this.Ma(),Pt:this.xa(),Tt:this.Sa(t)}}bh(){return this.cn.title}yt(){return this.cn.visible}ka(t){this.Hl.push(new Hw(t,this))}ya(t){this.Hl=this.Hl.filter(e=>e.Ol()!==t)}Ca(){if(this.wn instanceof po)return t=>this.wn.We(t)}Ta(){if(this.wn instanceof po)return t=>this.wn.je(t)}_a(){return!Bs(this.Dt().Pa())}pa(t,e){if(!_n(t)||!_n(e)||this.zt.Ni())return null;const s=this.$l==="Line"||this.$l==="Area"||this.$l==="Baseline"||this.$l==="Histogram"?[3]:[2,1],r=this.zt.ol(t,e,s);let h=r!==null?new Xt(r.ml,r.bl):null;if(this.Qh()==="Histogram"){const c=this.cn.base,d=new Xt(c,c);h=h!==null?h.ts(d):d}let a=this.dn.uh();return this.Hl.forEach(c=>{const d=c.Il(t,e);if(d!=null&&d.priceRange){const _=new Xt(d.priceRange.minValue,d.priceRange.maxValue);h=h!==null?h.ts(_):_}var m,p,v,w;d!=null&&d.margins&&(m=a,p=d.margins,a={above:Math.max((v=m==null?void 0:m.above)!==null&&v!==void 0?v:0,p.above),below:Math.max((w=m==null?void 0:m.below)!==null&&w!==void 0?w:0,p.below)})}),new Ds(h,a)}ga(){switch(this.$l){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerRadius}return 0}Ma(){switch(this.$l){case"Line":case"Area":case"Baseline":{const t=this.cn.crosshairMarkerBorderColor;if(t.length!==0)return t}}return null}xa(){switch(this.$l){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerBorderWidth}return 0}Sa(t){switch(this.$l){case"Line":case"Area":case"Baseline":{const e=this.cn.crosshairMarkerBackgroundColor;if(e.length!==0)return e}}return this.Us().$s(t).ce}Ul(){switch(this.cn.priceFormat.type){case"custom":this.wa={format:this.cn.priceFormat.formatter};break;case"volume":this.wa=new tw(this.cn.priceFormat.precision);break;case"percent":this.wa=new dc(this.cn.priceFormat.precision);break;default:{const t=Math.pow(10,this.cn.priceFormat.precision);this.wa=new Vs(t,this.cn.priceFormat.minMove*t)}}this.Yi!==null&&this.Yi.Ra()}Ql(){const t=this.$t().St();if(!t.Da()||this.zt.Ni())return void(this.Wl=[]);const e=D(this.zt.el());this.Wl=this.Fl.map((s,r)=>{const h=D(t.Va(s.time,!0)),a=h<e?1:-1;return{time:D(this.zt.ll(h,a)).ee,position:s.position,shape:s.shape,color:s.color,id:s.id,th:r,text:s.text,size:s.size,originalTime:s.originalTime}})}ql(t){switch(this.dn=new Tw(this,this.$t()),this.$l){case"Bar":this.wn=new aw(this,this.$t());break;case"Candlestick":this.wn=new mw(this,this.$t());break;case"Line":this.wn=new bw(this,this.$t());break;case"Custom":this.wn=new po(this,this.$t(),Vt(t));break;case"Area":this.wn=new lw(this,this.$t());break;case"Baseline":this.wn=new fw(this,this.$t());break;case"Histogram":this.wn=new xw(this,this.$t());break;default:throw Error("Unknown chart style assigned: "+this.$l)}}ca(t,e){const s=[];return xo(this.Hl,t,e,s),s}}class Xw{constructor(t){this.cn=t}Oa(t,e,s){let r=t;if(this.cn.mode===0)return r;const h=s.vn(),a=h.Ct();if(a===null)return r;const c=h.Rt(t,a),d=s.Ba().filter(p=>p instanceof el).reduce((p,v)=>{if(s.vr(v)||!v.yt())return p;const w=v.Dt(),_=v.In();if(w.Ni()||!_.Kr(e))return p;const C=_.Gh(e);if(C===null)return p;const y=Oi(v.Ct());return p.concat([w.Rt(C.Vt[3],y.Vt)])},[]);if(d.length===0)return r;d.sort((p,v)=>Math.abs(p-c)-Math.abs(v-c));const m=d[0];return r=h.pn(m,a),r}}class Gw extends _e{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}K({context:t,bitmapSize:e,horizontalPixelRatio:s,verticalPixelRatio:r}){if(this.zt===null)return;const h=Math.max(1,Math.floor(s));t.lineWidth=h,function(a,c){a.save(),a.lineWidth%2&&a.translate(.5,.5),c(),a.restore()}(t,()=>{const a=D(this.zt);if(a.Aa){t.strokeStyle=a.Ia,mi(t,a.za),t.beginPath();for(const c of a.La){const d=Math.round(c.Ea*s);t.moveTo(d,-h),t.lineTo(d,e.height+h)}t.stroke()}if(a.Na){t.strokeStyle=a.Fa,mi(t,a.Wa),t.beginPath();for(const c of a.ja){const d=Math.round(c.Ea*r);t.moveTo(-h,d),t.lineTo(e.width+h,d)}t.stroke()}})}}class Jw{constructor(t){this.Wt=new Gw,this.ft=!0,this.tn=t}bt(){this.ft=!0}gt(){if(this.ft){const t=this.tn.$t().W().grid,e={Na:t.horzLines.visible,Aa:t.vertLines.visible,Fa:t.horzLines.color,Ia:t.vertLines.color,Wa:t.horzLines.style,za:t.vertLines.style,ja:this.tn.vn().Ha(),La:(this.tn.$t().St().Ha()||[]).map(s=>({Ea:s.coord}))};this.Wt.J(e),this.ft=!1}return this.Wt}}class Qw{constructor(t){this.wn=new Jw(t)}qh(){return this.wn}}const wo={$a:4,Ua:1e-4};function Ai(o,t){const e=100*(o-t)/t;return t<0?-e:e}function Yw(o,t){const e=Ai(o.Ph(),t),s=Ai(o.Rh(),t);return new Xt(e,s)}function vn(o,t){const e=100*(o-t)/t+100;return t<0?-e:e}function Zw(o,t){const e=vn(o.Ph(),t),s=vn(o.Rh(),t);return new Xt(e,s)}function $s(o,t){const e=Math.abs(o);if(e<1e-15)return 0;const s=Math.log10(e+t.Ua)+t.$a;return o<0?-s:s}function xn(o,t){const e=Math.abs(o);if(e<1e-15)return 0;const s=Math.pow(10,e-t.$a)-t.Ua;return o<0?-s:s}function dn(o,t){if(o===null)return null;const e=$s(o.Ph(),t),s=$s(o.Rh(),t);return new Xt(e,s)}function Ms(o,t){if(o===null)return null;const e=xn(o.Ph(),t),s=xn(o.Rh(),t);return new Xt(e,s)}function _o(o){if(o===null)return wo;const t=Math.abs(o.Rh()-o.Ph());if(t>=1||t<1e-15)return wo;const e=Math.ceil(Math.abs(Math.log10(t))),s=wo.$a+e;return{$a:s,Ua:1/Math.pow(10,s)}}class yo{constructor(t,e){if(this.qa=t,this.Ya=e,function(s){if(s<0)return!1;for(let r=s;r>1;r/=10)if(r%10!=0)return!1;return!0}(this.qa))this.Za=[2,2.5,2];else{this.Za=[];for(let s=this.qa;s!==1;){if(s%2==0)this.Za.push(2),s/=2;else{if(s%5!=0)throw new Error("unexpected base");this.Za.push(2,2.5),s/=5}if(this.Za.length>100)throw new Error("something wrong with base")}}}Xa(t,e,s){const r=this.qa===0?0:1/this.qa;let h=Math.pow(10,Math.max(0,Math.ceil(Math.log10(t-e)))),a=0,c=this.Ya[0];for(;;){const v=Cs(h,r,1e-14)&&h>r+1e-14,w=Cs(h,s*c,1e-14),_=Cs(h,1,1e-14);if(!(v&&w&&_))break;h/=c,c=this.Ya[++a%this.Ya.length]}if(h<=r+1e-14&&(h=r),h=Math.max(1,h),this.Za.length>0&&(d=h,m=1,p=1e-14,Math.abs(d-m)<p))for(a=0,c=this.Za[0];Cs(h,s*c,1e-14)&&h>r+1e-14;)h/=c,c=this.Za[++a%this.Za.length];var d,m,p;return h}}class uu{constructor(t,e,s,r){this.Ka=[],this.Li=t,this.qa=e,this.Ga=s,this.Ja=r}Xa(t,e){if(t<e)throw new Error("high < low");const s=this.Li.At(),r=(t-e)*this.Qa()/s,h=new yo(this.qa,[2,2.5,2]),a=new yo(this.qa,[2,2,2.5]),c=new yo(this.qa,[2.5,2,2]),d=[];return d.push(h.Xa(t,e,r),a.Xa(t,e,r),c.Xa(t,e,r)),function(m){if(m.length<1)throw Error("array is empty");let p=m[0];for(let v=1;v<m.length;++v)m[v]<p&&(p=m[v]);return p}(d)}io(){const t=this.Li,e=t.Ct();if(e===null)return void(this.Ka=[]);const s=t.At(),r=this.Ga(s-1,e),h=this.Ga(0,e),a=this.Li.W().entireTextOnly?this.no()/2:0,c=a,d=s-1-a,m=Math.max(r,h),p=Math.min(r,h);if(m===p)return void(this.Ka=[]);let v=this.Xa(m,p),w=m%v;w+=w<0?v:0;const _=m>=p?1:-1;let C=null,y=0;for(let E=m-w;E>p;E-=v){const P=this.Ja(E,e,!0);C!==null&&Math.abs(P-C)<this.Qa()||P<c||P>d||(y<this.Ka.length?(this.Ka[y].Ea=P,this.Ka[y].so=t.eo(E)):this.Ka.push({Ea:P,so:t.eo(E)}),y++,C=P,t.ro()&&(v=this.Xa(E*_,p)))}this.Ka.length=y}Ha(){return this.Ka}no(){return this.Li.P()}Qa(){return Math.ceil(2.5*this.no())}}function Lc(o){return o.slice().sort((t,e)=>D(t.Xi())-D(e.Xi()))}var cu;(function(o){o[o.Normal=0]="Normal",o[o.Logarithmic=1]="Logarithmic",o[o.Percentage=2]="Percentage",o[o.IndexedTo100=3]="IndexedTo100"})(cu||(cu={}));const fu=new dc,du=new Vs(100,1);class t1{constructor(t,e,s,r){this.ho=0,this.lo=null,this.Ih=null,this.ao=null,this.oo={_o:!1,uo:null},this.co=0,this.do=0,this.fo=new Ct,this.vo=new Ct,this.po=[],this.mo=null,this.bo=null,this.wo=null,this.Mo=null,this.wa=du,this.xo=_o(null),this.So=t,this.cn=e,this.ko=s,this.yo=r,this.Co=new uu(this,100,this.To.bind(this),this.Po.bind(this))}Pa(){return this.So}W(){return this.cn}$h(t){if(we(this.cn,t),this.Ra(),t.mode!==void 0&&this.Ro({Cr:t.mode}),t.scaleMargins!==void 0){const e=Vt(t.scaleMargins.top),s=Vt(t.scaleMargins.bottom);if(e<0||e>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${e}`);if(s<0||s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(e+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${e+s}`);this.Do(),this.bo=null}}Vo(){return this.cn.autoScale}ro(){return this.cn.mode===1}Mh(){return this.cn.mode===2}Oo(){return this.cn.mode===3}Cr(){return{Wn:this.cn.autoScale,Bo:this.cn.invertScale,Cr:this.cn.mode}}Ro(t){const e=this.Cr();let s=null;t.Wn!==void 0&&(this.cn.autoScale=t.Wn),t.Cr!==void 0&&(this.cn.mode=t.Cr,t.Cr!==2&&t.Cr!==3||(this.cn.autoScale=!0),this.oo._o=!1),e.Cr===1&&t.Cr!==e.Cr&&(function(h,a){if(h===null)return!1;const c=xn(h.Ph(),a),d=xn(h.Rh(),a);return isFinite(c)&&isFinite(d)}(this.Ih,this.xo)?(s=Ms(this.Ih,this.xo),s!==null&&this.Ao(s)):this.cn.autoScale=!0),t.Cr===1&&t.Cr!==e.Cr&&(s=dn(this.Ih,this.xo),s!==null&&this.Ao(s));const r=e.Cr!==this.cn.mode;r&&(e.Cr===2||this.Mh())&&this.Ra(),r&&(e.Cr===3||this.Oo())&&this.Ra(),t.Bo!==void 0&&e.Bo!==t.Bo&&(this.cn.invertScale=t.Bo,this.Io()),this.vo.m(e,this.Cr())}zo(){return this.vo}P(){return this.ko.fontSize}At(){return this.ho}Lo(t){this.ho!==t&&(this.ho=t,this.Do(),this.bo=null)}Eo(){if(this.lo)return this.lo;const t=this.At()-this.No()-this.Fo();return this.lo=t,t}Lh(){return this.Wo(),this.Ih}Ao(t,e){const s=this.Ih;(e||s===null&&t!==null||s!==null&&!s.Ch(t))&&(this.bo=null,this.Ih=t)}Ni(){return this.Wo(),this.ho===0||!this.Ih||this.Ih.Ni()}jo(t){return this.Bo()?t:this.At()-1-t}Rt(t,e){return this.Mh()?t=Ai(t,e):this.Oo()&&(t=vn(t,e)),this.Po(t,e)}te(t,e,s){this.Wo();const r=this.Fo(),h=D(this.Lh()),a=h.Ph(),c=h.Rh(),d=this.Eo()-1,m=this.Bo(),p=d/(c-a),v=s===void 0?0:s.from,w=s===void 0?t.length:s.to,_=this.Ho();for(let C=v;C<w;C++){const y=t[C],E=y._t;if(isNaN(E))continue;let P=E;_!==null&&(P=_(y._t,e));const A=r+p*(P-a),$=m?A:this.ho-1-A;y.st=$}}be(t,e,s){this.Wo();const r=this.Fo(),h=D(this.Lh()),a=h.Ph(),c=h.Rh(),d=this.Eo()-1,m=this.Bo(),p=d/(c-a),v=s===void 0?0:s.from,w=s===void 0?t.length:s.to,_=this.Ho();for(let C=v;C<w;C++){const y=t[C];let E=y.ge,P=y.Me,A=y.xe,$=y.Se;_!==null&&(E=_(y.ge,e),P=_(y.Me,e),A=_(y.xe,e),$=_(y.Se,e));let U=r+p*(E-a),W=m?U:this.ho-1-U;y.pe=W,U=r+p*(P-a),W=m?U:this.ho-1-U,y.de=W,U=r+p*(A-a),W=m?U:this.ho-1-U,y.fe=W,U=r+p*($-a),W=m?U:this.ho-1-U,y.me=W}}pn(t,e){const s=this.To(t,e);return this.$o(s,e)}$o(t,e){let s=t;return this.Mh()?s=function(r,h){return h<0&&(r=-r),r/100*h+h}(s,e):this.Oo()&&(s=function(r,h){return r-=100,h<0&&(r=-r),r/100*h+h}(s,e)),s}Ba(){return this.po}Uo(){if(this.mo)return this.mo;let t=[];for(let e=0;e<this.po.length;e++){const s=this.po[e];s.Xi()===null&&s.Ki(e+1),t.push(s)}return t=Lc(t),this.mo=t,this.mo}qo(t){this.po.indexOf(t)===-1&&(this.po.push(t),this.Ra(),this.Yo())}Zo(t){const e=this.po.indexOf(t);if(e===-1)throw new Error("source is not attached to scale");this.po.splice(e,1),this.po.length===0&&(this.Ro({Wn:!0}),this.Ao(null)),this.Ra(),this.Yo()}Ct(){let t=null;for(const e of this.po){const s=e.Ct();s!==null&&(t===null||s.la<t.la)&&(t=s)}return t===null?null:t.Vt}Bo(){return this.cn.invertScale}Ha(){const t=this.Ct()===null;if(this.bo!==null&&(t||this.bo.Xo===t))return this.bo.Ha;this.Co.io();const e=this.Co.Ha();return this.bo={Ha:e,Xo:t},this.fo.m(),e}Ko(){return this.fo}Go(t){this.Mh()||this.Oo()||this.wo===null&&this.ao===null&&(this.Ni()||(this.wo=this.ho-t,this.ao=D(this.Lh()).Th()))}Jo(t){if(this.Mh()||this.Oo()||this.wo===null)return;this.Ro({Wn:!1}),(t=this.ho-t)<0&&(t=0);let e=(this.wo+.2*(this.ho-1))/(t+.2*(this.ho-1));const s=D(this.ao).Th();e=Math.max(e,.1),s.Vh(e),this.Ao(s)}Qo(){this.Mh()||this.Oo()||(this.wo=null,this.ao=null)}t_(t){this.Vo()||this.Mo===null&&this.ao===null&&(this.Ni()||(this.Mo=t,this.ao=D(this.Lh()).Th()))}i_(t){if(this.Vo()||this.Mo===null)return;const e=D(this.Lh()).Dh()/(this.Eo()-1);let s=t-this.Mo;this.Bo()&&(s*=-1);const r=s*e,h=D(this.ao).Th();h.Oh(r),this.Ao(h,!0),this.bo=null}n_(){this.Vo()||this.Mo!==null&&(this.Mo=null,this.ao=null)}ba(){return this.wa||this.Ra(),this.wa}Fi(t,e){switch(this.cn.mode){case 2:return this.s_(Ai(t,e));case 3:return this.ba().format(vn(t,e));default:return this.Wh(t)}}eo(t){switch(this.cn.mode){case 2:return this.s_(t);case 3:return this.ba().format(t);default:return this.Wh(t)}}Yl(t){return this.Wh(t,D(this.e_()).ba())}Zl(t,e){return t=Ai(t,e),this.s_(t,fu)}r_(){return this.po}h_(t){this.oo={uo:t,_o:!1}}Vn(){this.po.forEach(t=>t.Vn())}Ra(){this.bo=null;const t=this.e_();let e=100;t!==null&&(e=Math.round(1/t.ma())),this.wa=du,this.Mh()?(this.wa=fu,e=100):this.Oo()?(this.wa=new Vs(100,1),e=100):t!==null&&(this.wa=t.ba()),this.Co=new uu(this,e,this.To.bind(this),this.Po.bind(this)),this.Co.io()}Yo(){this.mo=null}e_(){return this.po[0]||null}No(){return this.Bo()?this.cn.scaleMargins.bottom*this.At()+this.do:this.cn.scaleMargins.top*this.At()+this.co}Fo(){return this.Bo()?this.cn.scaleMargins.top*this.At()+this.co:this.cn.scaleMargins.bottom*this.At()+this.do}Wo(){this.oo._o||(this.oo._o=!0,this.l_())}Do(){this.lo=null}Po(t,e){if(this.Wo(),this.Ni())return 0;t=this.ro()&&t?$s(t,this.xo):t;const s=D(this.Lh()),r=this.Fo()+(this.Eo()-1)*(t-s.Ph())/s.Dh();return this.jo(r)}To(t,e){if(this.Wo(),this.Ni())return 0;const s=this.jo(t),r=D(this.Lh()),h=r.Ph()+r.Dh()*((s-this.Fo())/(this.Eo()-1));return this.ro()?xn(h,this.xo):h}Io(){this.bo=null,this.Co.io()}l_(){const t=this.oo.uo;if(t===null)return;let e=null;const s=this.r_();let r=0,h=0;for(const d of s){if(!d.yt())continue;const m=d.Ct();if(m===null)continue;const p=d.Il(t.Os(),t.ui());let v=p&&p.Lh();if(v!==null){switch(this.cn.mode){case 1:v=dn(v,this.xo);break;case 2:v=Yw(v,m.Vt);break;case 3:v=Zw(v,m.Vt)}if(e=e===null?v:e.ts(D(v)),p!==null){const w=p.Eh();w!==null&&(r=Math.max(r,w.above),h=Math.max(h,w.below))}}}if(r===this.co&&h===this.do||(this.co=r,this.do=h,this.bo=null,this.Do()),e!==null){if(e.Ph()===e.Rh()){const d=this.e_(),m=5*(d===null||this.Mh()||this.Oo()?1:d.ma());this.ro()&&(e=Ms(e,this.xo)),e=new Xt(e.Ph()-m,e.Rh()+m),this.ro()&&(e=dn(e,this.xo))}if(this.ro()){const d=Ms(e,this.xo),m=_o(d);if(a=m,c=this.xo,a.$a!==c.$a||a.Ua!==c.Ua){const p=this.ao!==null?Ms(this.ao,this.xo):null;this.xo=m,e=dn(d,m),p!==null&&(this.ao=dn(p,m))}}this.Ao(e)}else this.Ih===null&&(this.Ao(new Xt(-.5,.5)),this.xo=_o(null));var a,c;this.oo._o=!0}Ho(){return this.Mh()?Ai:this.Oo()?vn:this.ro()?t=>$s(t,this.xo):null}a_(t,e,s){return e===void 0?(s===void 0&&(s=this.ba()),s.format(t)):e(t)}Wh(t,e){return this.a_(t,this.yo.priceFormatter,e)}s_(t,e){return this.a_(t,this.yo.percentageFormatter,e)}}class e1{constructor(t,e){this.po=[],this.o_=new Map,this.ho=0,this.__=0,this.u_=1e3,this.mo=null,this.c_=new Ct,this.yl=t,this.$i=e,this.d_=new Qw(this);const s=e.W();this.f_=this.v_("left",s.leftPriceScale),this.p_=this.v_("right",s.rightPriceScale),this.f_.zo().l(this.m_.bind(this,this.f_),this),this.p_.zo().l(this.m_.bind(this,this.p_),this),this.b_(s)}b_(t){if(t.leftPriceScale&&this.f_.$h(t.leftPriceScale),t.rightPriceScale&&this.p_.$h(t.rightPriceScale),t.localization&&(this.f_.Ra(),this.p_.Ra()),t.overlayPriceScales){const e=Array.from(this.o_.values());for(const s of e){const r=D(s[0].Dt());r.$h(t.overlayPriceScales),t.localization&&r.Ra()}}}w_(t){switch(t){case"left":return this.f_;case"right":return this.p_}return this.o_.has(t)?Vt(this.o_.get(t))[0].Dt():null}S(){this.$t().g_().p(this),this.f_.zo().p(this),this.p_.zo().p(this),this.po.forEach(t=>{t.S&&t.S()}),this.c_.m()}M_(){return this.u_}x_(t){this.u_=t}$t(){return this.$i}Hi(){return this.__}At(){return this.ho}S_(t){this.__=t,this.k_()}Lo(t){this.ho=t,this.f_.Lo(t),this.p_.Lo(t),this.po.forEach(e=>{if(this.vr(e)){const s=e.Dt();s!==null&&s.Lo(t)}}),this.k_()}Ba(){return this.po}vr(t){const e=t.Dt();return e===null||this.f_!==e&&this.p_!==e}qo(t,e,s){const r=s!==void 0?s:this.C_().y_+1;this.T_(t,e,r)}Zo(t){const e=this.po.indexOf(t);ti(e!==-1,"removeDataSource: invalid data source"),this.po.splice(e,1);const s=D(t.Dt()).Pa();if(this.o_.has(s)){const h=Vt(this.o_.get(s)),a=h.indexOf(t);a!==-1&&(h.splice(a,1),h.length===0&&this.o_.delete(s))}const r=t.Dt();r&&r.Ba().indexOf(t)>=0&&r.Zo(t),r!==null&&(r.Yo(),this.P_(r)),this.mo=null}mr(t){return t===this.f_?"left":t===this.p_?"right":"overlay"}R_(){return this.f_}D_(){return this.p_}V_(t,e){t.Go(e)}O_(t,e){t.Jo(e),this.k_()}B_(t){t.Qo()}A_(t,e){t.t_(e)}I_(t,e){t.i_(e),this.k_()}z_(t){t.n_()}k_(){this.po.forEach(t=>{t.Vn()})}vn(){let t=null;return this.$i.W().rightPriceScale.visible&&this.p_.Ba().length!==0?t=this.p_:this.$i.W().leftPriceScale.visible&&this.f_.Ba().length!==0?t=this.f_:this.po.length!==0&&(t=this.po[0].Dt()),t===null&&(t=this.p_),t}pr(){let t=null;return this.$i.W().rightPriceScale.visible?t=this.p_:this.$i.W().leftPriceScale.visible&&(t=this.f_),t}P_(t){t!==null&&t.Vo()&&this.L_(t)}E_(t){const e=this.yl.Xs();t.Ro({Wn:!0}),e!==null&&t.h_(e),this.k_()}N_(){this.L_(this.f_),this.L_(this.p_)}F_(){this.P_(this.f_),this.P_(this.p_),this.po.forEach(t=>{this.vr(t)&&this.P_(t.Dt())}),this.k_(),this.$i.Uh()}Uo(){return this.mo===null&&(this.mo=Lc(this.po)),this.mo}W_(){return this.c_}j_(){return this.d_}L_(t){const e=t.r_();if(e&&e.length>0&&!this.yl.Ni()){const s=this.yl.Xs();s!==null&&t.h_(s)}t.Vn()}C_(){const t=this.Uo();if(t.length===0)return{H_:0,y_:0};let e=0,s=0;for(let r=0;r<t.length;r++){const h=t[r].Xi();h!==null&&(h<e&&(e=h),h>s&&(s=h))}return{H_:e,y_:s}}T_(t,e,s){let r=this.w_(e);if(r===null&&(r=this.v_(e,this.$i.W().overlayPriceScales)),this.po.push(t),!Bs(e)){const h=this.o_.get(e)||[];h.push(t),this.o_.set(e,h)}r.qo(t),t.Gi(r),t.Ki(s),this.P_(r),this.mo=null}m_(t,e,s){e.Cr!==s.Cr&&this.L_(t)}v_(t,e){const s=Object.assign({visible:!0,autoScale:!0},Ie(e)),r=new t1(t,s,this.$i.W().layout,this.$i.W().localization);return r.Lo(this.At()),r}}class i1{constructor(t,e,s=50){this.Ke=0,this.Ge=1,this.Je=1,this.tr=new Map,this.Qe=new Map,this.U_=t,this.q_=e,this.ir=s}Y_(t){const e=t.time,s=this.q_.cacheKey(e),r=this.tr.get(s);if(r!==void 0)return r.Z_;if(this.Ke===this.ir){const a=this.Qe.get(this.Je);this.Qe.delete(this.Je),this.tr.delete(Vt(a)),this.Je++,this.Ke--}const h=this.U_(t);return this.tr.set(s,{Z_:h,rr:this.Ge}),this.Qe.set(this.Ge,s),this.Ke++,this.Ge++,h}}class bn{constructor(t,e){ti(t<=e,"right should be >= left"),this.X_=t,this.K_=e}Os(){return this.X_}ui(){return this.K_}G_(){return this.K_-this.X_+1}Kr(t){return this.X_<=t&&t<=this.K_}Ch(t){return this.X_===t.Os()&&this.K_===t.ui()}}function mu(o,t){return o===null||t===null?o===t:o.Ch(t)}class n1{constructor(){this.J_=new Map,this.tr=null,this.Q_=!1}tu(t){this.Q_=t,this.tr=null}iu(t,e){this.nu(e),this.tr=null;for(let s=e;s<t.length;++s){const r=t[s];let h=this.J_.get(r.timeWeight);h===void 0&&(h=[],this.J_.set(r.timeWeight,h)),h.push({index:s,time:r.time,weight:r.timeWeight,originalTime:r.originalTime})}}su(t,e){const s=Math.ceil(e/t);return this.tr!==null&&this.tr.eu===s||(this.tr={Ha:this.ru(s),eu:s}),this.tr.Ha}nu(t){if(t===0)return void this.J_.clear();const e=[];this.J_.forEach((s,r)=>{t<=s[0].index?e.push(r):s.splice(Mn(s,t,h=>h.index<t),1/0)});for(const s of e)this.J_.delete(s)}ru(t){let e=[];for(const s of Array.from(this.J_.keys()).sort((r,h)=>h-r)){if(!this.J_.get(s))continue;const r=e;e=[];const h=r.length;let a=0;const c=Vt(this.J_.get(s)),d=c.length;let m=1/0,p=-1/0;for(let v=0;v<d;v++){const w=c[v],_=w.index;for(;a<h;){const C=r[a],y=C.index;if(!(y<_)){m=y;break}a++,e.push(C),p=y,m=1/0}if(m-_>=t&&_-p>=t)e.push(w),p=_;else if(this.Q_)return r}for(;a<h;a++)e.push(r[a])}return e}}class Di{constructor(t){this.hu=t}lu(){return this.hu===null?null:new bn(Math.floor(this.hu.Os()),Math.ceil(this.hu.ui()))}au(){return this.hu}static ou(){return new Di(null)}}function s1(o,t){return o.weight>t.weight?o:t}class r1{constructor(t,e,s,r){this.__=0,this._u=null,this.uu=[],this.Mo=null,this.wo=null,this.cu=new n1,this.du=new Map,this.fu=Di.ou(),this.vu=!0,this.pu=new Ct,this.mu=new Ct,this.bu=new Ct,this.wu=null,this.gu=null,this.Mu=[],this.cn=e,this.yo=s,this.xu=e.rightOffset,this.Su=e.barSpacing,this.$i=t,this.q_=r,this.ku(),this.cu.tu(e.uniformDistribution)}W(){return this.cn}yu(t){we(this.yo,t),this.Cu(),this.ku()}$h(t,e){var s;we(this.cn,t),this.cn.fixLeftEdge&&this.Tu(),this.cn.fixRightEdge&&this.Pu(),t.barSpacing!==void 0&&this.$i.Gn(t.barSpacing),t.rightOffset!==void 0&&this.$i.Jn(t.rightOffset),t.minBarSpacing!==void 0&&this.$i.Gn((s=t.barSpacing)!==null&&s!==void 0?s:this.Su),this.Cu(),this.ku(),this.bu.m()}mn(t){var e,s;return(s=(e=this.uu[t])===null||e===void 0?void 0:e.time)!==null&&s!==void 0?s:null}Ui(t){var e;return(e=this.uu[t])!==null&&e!==void 0?e:null}Va(t,e){if(this.uu.length<1)return null;if(this.q_.key(t)>this.q_.key(this.uu[this.uu.length-1].time))return e?this.uu.length-1:null;const s=Mn(this.uu,this.q_.key(t),(r,h)=>this.q_.key(r.time)<h);return this.q_.key(t)<this.q_.key(this.uu[s].time)?e?s:null:s}Ni(){return this.__===0||this.uu.length===0||this._u===null}Da(){return this.uu.length>0}Xs(){return this.Ru(),this.fu.lu()}Du(){return this.Ru(),this.fu.au()}Vu(){const t=this.Xs();if(t===null)return null;const e={from:t.Os(),to:t.ui()};return this.Ou(e)}Ou(t){const e=Math.round(t.from),s=Math.round(t.to),r=D(this.Bu()),h=D(this.Au());return{from:D(this.Ui(Math.max(r,e))),to:D(this.Ui(Math.min(h,s)))}}Iu(t){return{from:D(this.Va(t.from,!0)),to:D(this.Va(t.to,!0))}}Hi(){return this.__}S_(t){if(!isFinite(t)||t<=0||this.__===t)return;const e=this.Du(),s=this.__;if(this.__=t,this.vu=!0,this.cn.lockVisibleTimeRangeOnResize&&s!==0){const r=this.Su*t/s;this.Su=r}if(this.cn.fixLeftEdge&&e!==null&&e.Os()<=0){const r=s-t;this.xu-=Math.round(r/this.Su)+1,this.vu=!0}this.zu(),this.Lu()}It(t){if(this.Ni()||!_n(t))return 0;const e=this.Eu()+this.xu-t;return this.__-(e+.5)*this.Su-1}Qs(t,e){const s=this.Eu(),r=e===void 0?0:e.from,h=e===void 0?t.length:e.to;for(let a=r;a<h;a++){const c=t[a].ot,d=s+this.xu-c,m=this.__-(d+.5)*this.Su-1;t[a].nt=m}}Nu(t){return Math.ceil(this.Fu(t))}Jn(t){this.vu=!0,this.xu=t,this.Lu(),this.$i.Wu(),this.$i.Uh()}le(){return this.Su}Gn(t){this.ju(t),this.Lu(),this.$i.Wu(),this.$i.Uh()}Hu(){return this.xu}Ha(){if(this.Ni())return null;if(this.gu!==null)return this.gu;const t=this.Su,e=5*(this.$i.W().layout.fontSize+4)/8*(this.cn.tickMarkMaxCharacterLength||8),s=Math.round(e/t),r=D(this.Xs()),h=Math.max(r.Os(),r.Os()-s),a=Math.max(r.ui(),r.ui()-s),c=this.cu.su(t,e),d=this.Bu()+s,m=this.Au()-s,p=this.$u(),v=this.cn.fixLeftEdge||p,w=this.cn.fixRightEdge||p;let _=0;for(const C of c){if(!(h<=C.index&&C.index<=a))continue;let y;_<this.Mu.length?(y=this.Mu[_],y.coord=this.It(C.index),y.label=this.Uu(C),y.weight=C.weight):(y={needAlignCoordinate:!1,coord:this.It(C.index),label:this.Uu(C),weight:C.weight},this.Mu.push(y)),this.Su>e/2&&!p?y.needAlignCoordinate=!1:y.needAlignCoordinate=v&&C.index<=d||w&&C.index>=m,_++}return this.Mu.length=_,this.gu=this.Mu,this.Mu}qu(){this.vu=!0,this.Gn(this.cn.barSpacing),this.Jn(this.cn.rightOffset)}Yu(t){this.vu=!0,this._u=t,this.Lu(),this.Tu()}Zu(t,e){const s=this.Fu(t),r=this.le(),h=r+e*(r/10);this.Gn(h),this.cn.rightBarStaysOnScroll||this.Jn(this.Hu()+(s-this.Fu(t)))}Go(t){this.Mo&&this.n_(),this.wo===null&&this.wu===null&&(this.Ni()||(this.wo=t,this.Xu()))}Jo(t){if(this.wu===null)return;const e=Wo(this.__-t,0,this.__),s=Wo(this.__-D(this.wo),0,this.__);e!==0&&s!==0&&this.Gn(this.wu.le*e/s)}Qo(){this.wo!==null&&(this.wo=null,this.Ku())}t_(t){this.Mo===null&&this.wu===null&&(this.Ni()||(this.Mo=t,this.Xu()))}i_(t){if(this.Mo===null)return;const e=(this.Mo-t)/this.le();this.xu=D(this.wu).Hu+e,this.vu=!0,this.Lu()}n_(){this.Mo!==null&&(this.Mo=null,this.Ku())}Gu(){this.Ju(this.cn.rightOffset)}Ju(t,e=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(e)||e<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.xu,r=performance.now();this.$i.Zn({Qu:h=>(h-r)/e>=1,tc:h=>{const a=(h-r)/e;return a>=1?t:s+(t-s)*a}})}bt(t,e){this.vu=!0,this.uu=t,this.cu.iu(t,e),this.Lu()}nc(){return this.pu}sc(){return this.mu}ec(){return this.bu}Eu(){return this._u||0}rc(t){const e=t.G_();this.ju(this.__/e),this.xu=t.ui()-this.Eu(),this.Lu(),this.vu=!0,this.$i.Wu(),this.$i.Uh()}hc(){const t=this.Bu(),e=this.Au();t!==null&&e!==null&&this.rc(new bn(t,e+this.cn.rightOffset))}lc(t){const e=new bn(t.from,t.to);this.rc(e)}qi(t){return this.yo.timeFormatter!==void 0?this.yo.timeFormatter(t.originalTime):this.q_.formatHorzItem(t.time)}$u(){const{handleScroll:t,handleScale:e}=this.$i.W();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||e.axisDoubleClickReset.time||e.axisPressedMouseMove.time||e.mouseWheel||e.pinch)}Bu(){return this.uu.length===0?null:0}Au(){return this.uu.length===0?null:this.uu.length-1}ac(t){return(this.__-1-t)/this.Su}Fu(t){const e=this.ac(t),s=this.Eu()+this.xu-e;return Math.round(1e6*s)/1e6}ju(t){const e=this.Su;this.Su=t,this.zu(),e!==this.Su&&(this.vu=!0,this.oc())}Ru(){if(!this.vu)return;if(this.vu=!1,this.Ni())return void this._c(Di.ou());const t=this.Eu(),e=this.__/this.Su,s=this.xu+t,r=new bn(s-e+1,s);this._c(new Di(r))}zu(){const t=this.uc();if(this.Su<t&&(this.Su=t,this.vu=!0),this.__!==0){const e=.5*this.__;this.Su>e&&(this.Su=e,this.vu=!0)}}uc(){return this.cn.fixLeftEdge&&this.cn.fixRightEdge&&this.uu.length!==0?this.__/this.uu.length:this.cn.minBarSpacing}Lu(){const t=this.cc();t!==null&&this.xu<t&&(this.xu=t,this.vu=!0);const e=this.dc();this.xu>e&&(this.xu=e,this.vu=!0)}cc(){const t=this.Bu(),e=this._u;return t===null||e===null?null:t-e-1+(this.cn.fixLeftEdge?this.__/this.Su:Math.min(2,this.uu.length))}dc(){return this.cn.fixRightEdge?0:this.__/this.Su-Math.min(2,this.uu.length)}Xu(){this.wu={le:this.le(),Hu:this.Hu()}}Ku(){this.wu=null}Uu(t){let e=this.du.get(t.weight);return e===void 0&&(e=new i1(s=>this.fc(s),this.q_),this.du.set(t.weight,e)),e.Y_(t)}fc(t){return this.q_.formatTickmark(t,this.yo)}_c(t){const e=this.fu;this.fu=t,mu(e.lu(),this.fu.lu())||this.pu.m(),mu(e.au(),this.fu.au())||this.mu.m(),this.oc()}oc(){this.gu=null}Cu(){this.oc(),this.du.clear()}ku(){this.q_.updateFormatter(this.yo)}Tu(){if(!this.cn.fixLeftEdge)return;const t=this.Bu();if(t===null)return;const e=this.Xs();if(e===null)return;const s=e.Os()-t;if(s<0){const r=this.xu-s-1;this.Jn(r)}this.zu()}Pu(){this.Lu(),this.zu()}}class o1{X(t,e,s){t.useMediaCoordinateSpace(r=>this.K(r,e,s))}gl(t,e,s){t.useMediaCoordinateSpace(r=>this.vc(r,e,s))}vc(t,e,s){}}class l1 extends o1{constructor(t){super(),this.mc=new Map,this.zt=t}K(t){}vc(t){if(!this.zt.yt)return;const{context:e,mediaSize:s}=t;let r=0;for(const a of this.zt.bc){if(a.Kt.length===0)continue;e.font=a.R;const c=this.wc(e,a.Kt);c>s.width?a.Zu=s.width/c:a.Zu=1,r+=a.gc*a.Zu}let h=0;switch(this.zt.Mc){case"top":h=0;break;case"center":h=Math.max((s.height-r)/2,0);break;case"bottom":h=Math.max(s.height-r,0)}e.fillStyle=this.zt.V;for(const a of this.zt.bc){e.save();let c=0;switch(this.zt.xc){case"left":e.textAlign="left",c=a.gc/2;break;case"center":e.textAlign="center",c=s.width/2;break;case"right":e.textAlign="right",c=s.width-1-a.gc/2}e.translate(c,h),e.textBaseline="top",e.font=a.R,e.scale(a.Zu,a.Zu),e.fillText(a.Kt,0,a.Sc),e.restore(),h+=a.gc*a.Zu}}wc(t,e){const s=this.kc(t.font);let r=s.get(e);return r===void 0&&(r=t.measureText(e).width,s.set(e,r)),r}kc(t){let e=this.mc.get(t);return e===void 0&&(e=new Map,this.mc.set(t,e)),e}}class h1{constructor(t){this.ft=!0,this.Ft={yt:!1,V:"",bc:[],Mc:"center",xc:"center"},this.Wt=new l1(this.Ft),this.jt=t}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt}Mt(){const t=this.jt.W(),e=this.Ft;e.yt=t.visible,e.yt&&(e.V=t.color,e.xc=t.horzAlign,e.Mc=t.vertAlign,e.bc=[{Kt:t.text,R:Ii(t.fontSize,t.fontFamily,t.fontStyle),gc:1.2*t.fontSize,Sc:0,Zu:0}])}}class a1 extends Qo{constructor(t,e){super(),this.cn=e,this.wn=new h1(this)}Rn(){return[]}Pn(){return[this.wn]}W(){return this.cn}Vn(){this.wn.bt()}}var gu,pu,vu,xu,bu;(function(o){o[o.OnTouchEnd=0]="OnTouchEnd",o[o.OnNextTap=1]="OnNextTap"})(gu||(gu={}));class u1{constructor(t,e,s){this.yc=[],this.Cc=[],this.__=0,this.Tc=null,this.Pc=new Ct,this.Rc=new Ct,this.Dc=null,this.Vc=t,this.cn=e,this.q_=s,this.Oc=new Bb(this),this.yl=new r1(this,e.timeScale,this.cn.localization,s),this.vt=new Zb(this,e.crosshair),this.Bc=new Xw(e.crosshair),this.Ac=new a1(this,e.watermark),this.Ic(),this.yc[0].x_(2e3),this.zc=this.Lc(0),this.Ec=this.Lc(1)}Kl(){this.Nc(Tt.es())}Uh(){this.Nc(Tt.ss())}oa(){this.Nc(new Tt(1))}Gl(t){const e=this.Fc(t);this.Nc(e)}Wc(){return this.Tc}jc(t){const e=this.Tc;this.Tc=t,e!==null&&this.Gl(e.Hc),t!==null&&this.Gl(t.Hc)}W(){return this.cn}$h(t){we(this.cn,t),this.yc.forEach(e=>e.b_(t)),t.timeScale!==void 0&&this.yl.$h(t.timeScale),t.localization!==void 0&&this.yl.yu(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Pc.m(),this.zc=this.Lc(0),this.Ec=this.Lc(1),this.Kl()}$c(t,e){if(t==="left")return void this.$h({leftPriceScale:e});if(t==="right")return void this.$h({rightPriceScale:e});const s=this.Uc(t);s!==null&&(s.Dt.$h(e),this.Pc.m())}Uc(t){for(const e of this.yc){const s=e.w_(t);if(s!==null)return{Ht:e,Dt:s}}return null}St(){return this.yl}qc(){return this.yc}Yc(){return this.Ac}Zc(){return this.vt}Xc(){return this.Rc}Kc(t,e){t.Lo(e),this.Wu()}S_(t){this.__=t,this.yl.S_(this.__),this.yc.forEach(e=>e.S_(t)),this.Wu()}Ic(t){const e=new e1(this.yl,this);t!==void 0?this.yc.splice(t,0,e):this.yc.push(e);const s=t===void 0?this.yc.length-1:t,r=Tt.es();return r.Nn(s,{Fn:0,Wn:!0}),this.Nc(r),e}V_(t,e,s){t.V_(e,s)}O_(t,e,s){t.O_(e,s),this.Jl(),this.Nc(this.Gc(t,2))}B_(t,e){t.B_(e),this.Nc(this.Gc(t,2))}A_(t,e,s){e.Vo()||t.A_(e,s)}I_(t,e,s){e.Vo()||(t.I_(e,s),this.Jl(),this.Nc(this.Gc(t,2)))}z_(t,e){e.Vo()||(t.z_(e),this.Nc(this.Gc(t,2)))}E_(t,e){t.E_(e),this.Nc(this.Gc(t,2))}Jc(t){this.yl.Go(t)}Qc(t,e){const s=this.St();if(s.Ni()||e===0)return;const r=s.Hi();t=Math.max(1,Math.min(t,r)),s.Zu(t,e),this.Wu()}td(t){this.nd(0),this.sd(t),this.ed()}rd(t){this.yl.Jo(t),this.Wu()}hd(){this.yl.Qo(),this.Uh()}nd(t){this.yl.t_(t)}sd(t){this.yl.i_(t),this.Wu()}ed(){this.yl.n_(),this.Uh()}wt(){return this.Cc}ld(t,e,s,r,h){this.vt.gn(t,e);let a=NaN,c=this.yl.Nu(t);const d=this.yl.Xs();d!==null&&(c=Math.min(Math.max(d.Os(),c),d.ui()));const m=r.vn(),p=m.Ct();p!==null&&(a=m.pn(e,p)),a=this.Bc.Oa(a,c,r),this.vt.kn(c,a,r),this.oa(),h||this.Rc.m(this.vt.xt(),{x:t,y:e},s)}ad(t,e,s){const r=s.vn(),h=r.Ct(),a=r.Rt(t,D(h)),c=this.yl.Va(e,!0),d=this.yl.It(D(c));this.ld(d,a,null,s,!0)}od(t){this.Zc().Cn(),this.oa(),t||this.Rc.m(null,null,null)}Jl(){const t=this.vt.Ht();if(t!==null){const e=this.vt.xn(),s=this.vt.Sn();this.ld(e,s,null,t)}this.vt.Vn()}_d(t,e,s){const r=this.yl.mn(0);e!==void 0&&s!==void 0&&this.yl.bt(e,s);const h=this.yl.mn(0),a=this.yl.Eu(),c=this.yl.Xs();if(c!==null&&r!==null&&h!==null){const d=c.Kr(a),m=this.q_.key(r)>this.q_.key(h),p=t!==null&&t>a&&!m,v=this.yl.W().allowShiftVisibleRangeOnWhitespaceReplacement,w=d&&(s!==void 0||v)&&this.yl.W().shiftVisibleRangeOnNewBar;if(p&&!w){const _=t-a;this.yl.Jn(this.yl.Hu()-_)}}this.yl.Yu(t)}ia(t){t!==null&&t.F_()}dr(t){const e=this.yc.find(s=>s.Uo().includes(t));return e===void 0?null:e}Wu(){this.Ac.Vn(),this.yc.forEach(t=>t.F_()),this.Jl()}S(){this.yc.forEach(t=>t.S()),this.yc.length=0,this.cn.localization.priceFormatter=void 0,this.cn.localization.percentageFormatter=void 0,this.cn.localization.timeFormatter=void 0}ud(){return this.Oc}br(){return this.Oc.W()}g_(){return this.Pc}dd(t,e,s){const r=this.yc[0],h=this.fd(e,t,r,s);return this.Cc.push(h),this.Cc.length===1?this.Kl():this.Uh(),h}vd(t){const e=this.dr(t),s=this.Cc.indexOf(t);ti(s!==-1,"Series not found"),this.Cc.splice(s,1),D(e).Zo(t),t.S&&t.S()}Xl(t,e){const s=D(this.dr(t));s.Zo(t);const r=this.Uc(e);if(r===null){const h=t.Xi();s.qo(t,e,h)}else{const h=r.Ht===s?t.Xi():void 0;r.Ht.qo(t,e,h)}}hc(){const t=Tt.ss();t.$n(),this.Nc(t)}pd(t){const e=Tt.ss();e.Yn(t),this.Nc(e)}Kn(){const t=Tt.ss();t.Kn(),this.Nc(t)}Gn(t){const e=Tt.ss();e.Gn(t),this.Nc(e)}Jn(t){const e=Tt.ss();e.Jn(t),this.Nc(e)}Zn(t){const e=Tt.ss();e.Zn(t),this.Nc(e)}Un(){const t=Tt.ss();t.Un(),this.Nc(t)}md(){return this.cn.rightPriceScale.visible?"right":"left"}bd(){return this.Ec}q(){return this.zc}Bt(t){const e=this.Ec,s=this.zc;if(e===s)return e;if(t=Math.max(0,Math.min(100,Math.round(100*t))),this.Dc===null||this.Dc.Ps!==s||this.Dc.Rs!==e)this.Dc={Ps:s,Rs:e,wd:new Map};else{const h=this.Dc.wd.get(t);if(h!==void 0)return h}const r=function(h,a,c){const[d,m,p,v]=wn(h),[w,_,C,y]=wn(a),E=[fe(d+c*(w-d)),fe(m+c*(_-m)),fe(p+c*(C-p)),ac(v+c*(y-v))];return`rgba(${E[0]}, ${E[1]}, ${E[2]}, ${E[3]})`}(s,e,t/100);return this.Dc.wd.set(t,r),r}Gc(t,e){const s=new Tt(e);if(t!==null){const r=this.yc.indexOf(t);s.Nn(r,{Fn:e})}return s}Fc(t,e){return e===void 0&&(e=2),this.Gc(this.dr(t),e)}Nc(t){this.Vc&&this.Vc(t),this.yc.forEach(e=>e.j_().qh().bt())}fd(t,e,s,r){const h=new el(this,t,e,s,r),a=t.priceScaleId!==void 0?t.priceScaleId:this.md();return s.qo(h,a),Bs(a)||h.$h(t),h}Lc(t){const e=this.cn.layout;return e.background.type==="gradient"?t===0?e.background.topColor:e.background.bottomColor:e.background.color}}function Fo(o){return!Me(o)&&!Nn(o)}function Ec(o){return Me(o)}(function(o){o[o.Disabled=0]="Disabled",o[o.Continuous=1]="Continuous",o[o.OnDataUpdate=2]="OnDataUpdate"})(pu||(pu={})),function(o){o[o.LastBar=0]="LastBar",o[o.LastVisible=1]="LastVisible"}(vu||(vu={})),function(o){o.Solid="solid",o.VerticalGradient="gradient"}(xu||(xu={})),function(o){o[o.Year=0]="Year",o[o.Month=1]="Month",o[o.DayOfMonth=2]="DayOfMonth",o[o.Time=3]="Time",o[o.TimeWithSeconds=4]="TimeWithSeconds"}(bu||(bu={}));const wu=o=>o.getUTCFullYear();function c1(o,t,e){return t.replace(/yyyy/g,(s=>We(wu(s),4))(o)).replace(/yy/g,(s=>We(wu(s)%100,2))(o)).replace(/MMMM/g,((s,r)=>new Date(s.getUTCFullYear(),s.getUTCMonth(),1).toLocaleString(r,{month:"long"}))(o,e)).replace(/MMM/g,((s,r)=>new Date(s.getUTCFullYear(),s.getUTCMonth(),1).toLocaleString(r,{month:"short"}))(o,e)).replace(/MM/g,(s=>We((r=>r.getUTCMonth()+1)(s),2))(o)).replace(/dd/g,(s=>We((r=>r.getUTCDate())(s),2))(o))}class Pc{constructor(t="yyyy-MM-dd",e="default"){this.gd=t,this.Md=e}Y_(t){return c1(t,this.gd,this.Md)}}class f1{constructor(t){this.xd=t||"%h:%m:%s"}Y_(t){return this.xd.replace("%h",We(t.getUTCHours(),2)).replace("%m",We(t.getUTCMinutes(),2)).replace("%s",We(t.getUTCSeconds(),2))}}const d1={Sd:"yyyy-MM-dd",kd:"%h:%m:%s",yd:" ",Cd:"default"};class m1{constructor(t={}){const e=Object.assign(Object.assign({},d1),t);this.Td=new Pc(e.Sd,e.Cd),this.Pd=new f1(e.kd),this.Rd=e.yd}Y_(t){return`${this.Td.Y_(t)}${this.Rd}${this.Pd.Y_(t)}`}}function Ls(o){return 60*o*60*1e3}function So(o){return 60*o*1e3}const Es=[{Dd:(_u=1,1e3*_u),Vd:10},{Dd:So(1),Vd:20},{Dd:So(5),Vd:21},{Dd:So(30),Vd:22},{Dd:Ls(1),Vd:30},{Dd:Ls(3),Vd:31},{Dd:Ls(6),Vd:32},{Dd:Ls(12),Vd:33}];var _u;function yu(o,t){if(o.getUTCFullYear()!==t.getUTCFullYear())return 70;if(o.getUTCMonth()!==t.getUTCMonth())return 60;if(o.getUTCDate()!==t.getUTCDate())return 50;for(let e=Es.length-1;e>=0;--e)if(Math.floor(t.getTime()/Es[e].Dd)!==Math.floor(o.getTime()/Es[e].Dd))return Es[e].Vd;return 0}function Co(o){let t=o;if(Nn(o)&&(t=il(o)),!Fo(t))throw new Error("time must be of type BusinessDay");const e=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{Od:Math.round(e.getTime()/1e3),Bd:t}}function Su(o){if(!Ec(o))throw new Error("time must be of type isUTCTimestamp");return{Od:o}}function il(o){const t=new Date(o);if(isNaN(t.getTime()))throw new Error(`Invalid date string=${o}, expected format=yyyy-mm-dd`);return{day:t.getUTCDate(),month:t.getUTCMonth()+1,year:t.getUTCFullYear()}}function Cu(o){Nn(o.time)&&(o.time=il(o.time))}class Nu{options(){return this.cn}setOptions(t){this.cn=t,this.updateFormatter(t.localization)}preprocessData(t){Array.isArray(t)?function(e){e.forEach(Cu)}(t):Cu(t)}createConverterToInternalObj(t){return D(function(e){return e.length===0?null:Fo(e[0].time)||Nn(e[0].time)?Co:Su}(t))}key(t){return typeof t=="object"&&"Od"in t?t.Od:this.key(this.convertHorzItemToInternal(t))}cacheKey(t){const e=t;return e.Bd===void 0?new Date(1e3*e.Od).getTime():new Date(Date.UTC(e.Bd.year,e.Bd.month-1,e.Bd.day)).getTime()}convertHorzItemToInternal(t){return Ec(e=t)?Su(e):Fo(e)?Co(e):Co(il(e));var e}updateFormatter(t){if(!this.cn)return;const e=t.dateFormat;this.cn.timeScale.timeVisible?this.Ad=new m1({Sd:e,kd:this.cn.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",yd:"   ",Cd:t.locale}):this.Ad=new Pc(e,t.locale)}formatHorzItem(t){const e=t;return this.Ad.Y_(new Date(1e3*e.Od))}formatTickmark(t,e){const s=function(h,a,c){switch(h){case 0:case 10:return a?c?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return a?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.weight,this.cn.timeScale.timeVisible,this.cn.timeScale.secondsVisible),r=this.cn.timeScale;if(r.tickMarkFormatter!==void 0){const h=r.tickMarkFormatter(t.originalTime,s,e.locale);if(h!==null)return h}return function(h,a,c){const d={};switch(a){case 0:d.year="numeric";break;case 1:d.month="short";break;case 2:d.day="numeric";break;case 3:d.hour12=!1,d.hour="2-digit",d.minute="2-digit";break;case 4:d.hour12=!1,d.hour="2-digit",d.minute="2-digit",d.second="2-digit"}const m=h.Bd===void 0?new Date(1e3*h.Od):new Date(Date.UTC(h.Bd.year,h.Bd.month-1,h.Bd.day));return new Date(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate(),m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds()).toLocaleString(c,d)}(t.time,s,e.locale)}maxTickMarkWeight(t){let e=t.reduce(s1,t[0]).weight;return e>30&&e<50&&(e=30),e}fillWeightsForPoints(t,e){(function(s,r=0){if(s.length===0)return;let h=r===0?null:s[r-1].time.Od,a=h!==null?new Date(1e3*h):null,c=0;for(let d=r;d<s.length;++d){const m=s[d],p=new Date(1e3*m.time.Od);a!==null&&(m.timeWeight=yu(p,a)),c+=m.time.Od-(h||m.time.Od),h=m.time.Od,a=p}if(r===0&&s.length>1){const d=Math.ceil(c/(s.length-1)),m=new Date(1e3*(s[0].time.Od-d));s[0].timeWeight=yu(new Date(1e3*s[0].time.Od),m)}})(t,e)}static Id(t){return we({localization:{dateFormat:"dd MMM 'yy"}},t??{})}}const Wi=typeof window<"u";function Mu(){return!!Wi&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function No(){return!!Wi&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Bo(o){return o+o%2}function Mo(o,t){return o.zd-t.zd}function Lo(o,t,e){const s=(o.zd-t.zd)/(o.ot-t.ot);return Math.sign(s)*Math.min(Math.abs(s),e)}class g1{constructor(t,e,s,r){this.Ld=null,this.Ed=null,this.Nd=null,this.Fd=null,this.Wd=null,this.jd=0,this.Hd=0,this.$d=t,this.Ud=e,this.qd=s,this.rs=r}Yd(t,e){if(this.Ld!==null){if(this.Ld.ot===e)return void(this.Ld.zd=t);if(Math.abs(this.Ld.zd-t)<this.rs)return}this.Fd=this.Nd,this.Nd=this.Ed,this.Ed=this.Ld,this.Ld={ot:e,zd:t}}Vr(t,e){if(this.Ld===null||this.Ed===null||e-this.Ld.ot>50)return;let s=0;const r=Lo(this.Ld,this.Ed,this.Ud),h=Mo(this.Ld,this.Ed),a=[r],c=[h];if(s+=h,this.Nd!==null){const m=Lo(this.Ed,this.Nd,this.Ud);if(Math.sign(m)===Math.sign(r)){const p=Mo(this.Ed,this.Nd);if(a.push(m),c.push(p),s+=p,this.Fd!==null){const v=Lo(this.Nd,this.Fd,this.Ud);if(Math.sign(v)===Math.sign(r)){const w=Mo(this.Nd,this.Fd);a.push(v),c.push(w),s+=w}}}}let d=0;for(let m=0;m<a.length;++m)d+=c[m]/s*a[m];Math.abs(d)<this.$d||(this.Wd={zd:t,ot:e},this.Hd=d,this.jd=function(m,p){const v=Math.log(p);return Math.log(1*v/-m)/v}(Math.abs(d),this.qd))}tc(t){const e=D(this.Wd),s=t-e.ot;return e.zd+this.Hd*(Math.pow(this.qd,s)-1)/Math.log(this.qd)}Qu(t){return this.Wd===null||this.Zd(t)===this.jd}Zd(t){const e=t-D(this.Wd).ot;return Math.min(e,this.jd)}}class p1{constructor(t,e){this.Xd=void 0,this.Kd=void 0,this.Gd=void 0,this.en=!1,this.Jd=t,this.Qd=e,this.tf()}bt(){this.tf()}if(){this.Xd&&this.Jd.removeChild(this.Xd),this.Kd&&this.Jd.removeChild(this.Kd),this.Xd=void 0,this.Kd=void 0}nf(){return this.en!==this.sf()||this.Gd!==this.ef()}ef(){return uc(wn(this.Qd.W().layout.textColor))>160?"dark":"light"}sf(){return this.Qd.W().layout.attributionLogo}rf(){const t=new URL(location.href);return t.hostname?"&utm_source="+t.hostname+t.pathname:""}tf(){this.nf()&&(this.if(),this.en=this.sf(),this.en&&(this.Gd=this.ef(),this.Kd=document.createElement("style"),this.Kd.innerText="a#tv-attr-logo{--fill:#131722;--stroke:#fff;position:absolute;left:10px;bottom:10px;height:19px;width:35px;margin:0;padding:0;border:0;z-index:3;}a#tv-attr-logo[data-dark]{--fill:#D1D4DC;--stroke:#131722;}",this.Xd=document.createElement("a"),this.Xd.href=`https://www.tradingview.com/?utm_medium=lwc-link&utm_campaign=lwc-chart${this.rf()}`,this.Xd.title="Charting by TradingView",this.Xd.id="tv-attr-logo",this.Xd.target="_blank",this.Xd.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 19" width="35" height="19" fill="none"><g fill-rule="evenodd" clip-path="url(#a)" clip-rule="evenodd"><path fill="var(--stroke)" d="M2 0H0v10h6v9h21.4l.5-1.3 6-15 1-2.7H23.7l-.5 1.3-.2.6a5 5 0 0 0-7-.9V0H2Zm20 17h4l5.2-13 .8-2h-7l-1 2.5-.2.5-1.5 3.8-.3.7V17Zm-.8-10a3 3 0 0 0 .7-2.7A3 3 0 1 0 16.8 7h4.4ZM14 7V2H2v6h6v9h4V7h2Z"/><path fill="var(--fill)" d="M14 2H2v6h6v9h6V2Zm12 15h-7l6-15h7l-6 15Zm-7-9a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></g><defs><clipPath id="a"><path fill="var(--stroke)" d="M0 0h35v19H0z"/></clipPath></defs></svg>',this.Xd.toggleAttribute("data-dark",this.Gd==="dark"),this.Jd.appendChild(this.Kd),this.Jd.appendChild(this.Xd)))}}function gi(o,t){const e=D(o.ownerDocument).createElement("canvas");o.appendChild(e);const s=Lb(e,{options:{allowResizeObserver:!1},transform:(r,h)=>({width:Math.max(r.width,h.width),height:Math.max(r.height,h.height)})});return s.resizeCanvasElement(t),s}function pi(o){var t;o.width=1,o.height=1,(t=o.getContext("2d"))===null||t===void 0||t.clearRect(0,0,1,1)}function Vo(o,t,e,s){o.gl&&o.gl(t,e,s)}function Os(o,t,e,s){o.X(t,e,s)}function Uo(o,t,e,s){const r=o(e,s);for(const h of r){const a=h.gt();a!==null&&t(a)}}function v1(o){Wi&&window.chrome!==void 0&&o.addEventListener("mousedown",t=>{if(t.button===1)return t.preventDefault(),!1})}class nl{constructor(t,e,s){this.hf=0,this.lf=null,this.af={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this._f=0,this.uf=null,this.cf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.df=null,this.ff=!1,this.vf=null,this.pf=null,this.mf=!1,this.bf=!1,this.wf=!1,this.gf=null,this.Mf=null,this.xf=null,this.Sf=null,this.kf=null,this.yf=null,this.Cf=null,this.Tf=0,this.Pf=!1,this.Rf=!1,this.Df=!1,this.Vf=0,this.Of=null,this.Bf=!No(),this.Af=r=>{this.If(r)},this.zf=r=>{if(this.Lf(r)){const h=this.Ef(r);if(++this._f,this.uf&&this._f>1){const{Nf:a}=this.Ff(Ne(r),this.cf);a<30&&!this.wf&&this.Wf(h,this.Hf.jf),this.$f()}}else{const h=this.Ef(r);if(++this.hf,this.lf&&this.hf>1){const{Nf:a}=this.Ff(Ne(r),this.af);a<5&&!this.bf&&this.Uf(h,this.Hf.qf),this.Yf()}}},this.Zf=t,this.Hf=e,this.cn=s,this.Xf()}S(){this.gf!==null&&(this.gf(),this.gf=null),this.Mf!==null&&(this.Mf(),this.Mf=null),this.Sf!==null&&(this.Sf(),this.Sf=null),this.kf!==null&&(this.kf(),this.kf=null),this.yf!==null&&(this.yf(),this.yf=null),this.xf!==null&&(this.xf(),this.xf=null),this.Kf(),this.Yf()}Gf(t){this.Sf&&this.Sf();const e=this.Jf.bind(this);if(this.Sf=()=>{this.Zf.removeEventListener("mousemove",e)},this.Zf.addEventListener("mousemove",e),this.Lf(t))return;const s=this.Ef(t);this.Uf(s,this.Hf.Qf),this.Bf=!0}Yf(){this.lf!==null&&clearTimeout(this.lf),this.hf=0,this.lf=null,this.af={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}$f(){this.uf!==null&&clearTimeout(this.uf),this._f=0,this.uf=null,this.cf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}Jf(t){if(this.Df||this.pf!==null||this.Lf(t))return;const e=this.Ef(t);this.Uf(e,this.Hf.tv),this.Bf=!0}iv(t){const e=Eo(t.changedTouches,D(this.Of));if(e===null||(this.Vf=Ps(t),this.Cf!==null)||this.Rf)return;this.Pf=!0;const s=this.Ff(Ne(e),D(this.pf)),{nv:r,sv:h,Nf:a}=s;if(this.mf||!(a<5)){if(!this.mf){const c=.5*r,d=h>=c&&!this.cn.ev(),m=c>h&&!this.cn.rv();d||m||(this.Rf=!0),this.mf=!0,this.wf=!0,this.Kf(),this.$f()}if(!this.Rf){const c=this.Ef(t,e);this.Wf(c,this.Hf.hv),Ri(t)}}}lv(t){if(t.button!==0)return;const e=this.Ff(Ne(t),D(this.vf)),{Nf:s}=e;if(s>=5&&(this.bf=!0,this.Yf()),this.bf){const r=this.Ef(t);this.Uf(r,this.Hf.av)}}Ff(t,e){const s=Math.abs(e.nt-t.nt),r=Math.abs(e.st-t.st);return{nv:s,sv:r,Nf:s+r}}ov(t){let e=Eo(t.changedTouches,D(this.Of));if(e===null&&t.touches.length===0&&(e=t.changedTouches[0]),e===null)return;this.Of=null,this.Vf=Ps(t),this.Kf(),this.pf=null,this.yf&&(this.yf(),this.yf=null);const s=this.Ef(t,e);if(this.Wf(s,this.Hf._v),++this._f,this.uf&&this._f>1){const{Nf:r}=this.Ff(Ne(e),this.cf);r<30&&!this.wf&&this.Wf(s,this.Hf.jf),this.$f()}else this.wf||(this.Wf(s,this.Hf.uv),this.Hf.uv&&Ri(t));this._f===0&&Ri(t),t.touches.length===0&&this.ff&&(this.ff=!1,Ri(t))}If(t){if(t.button!==0)return;const e=this.Ef(t);if(this.vf=null,this.Df=!1,this.kf&&(this.kf(),this.kf=null),Mu()&&this.Zf.ownerDocument.documentElement.removeEventListener("mouseleave",this.Af),!this.Lf(t))if(this.Uf(e,this.Hf.cv),++this.hf,this.lf&&this.hf>1){const{Nf:s}=this.Ff(Ne(t),this.af);s<5&&!this.bf&&this.Uf(e,this.Hf.qf),this.Yf()}else this.bf||this.Uf(e,this.Hf.dv)}Kf(){this.df!==null&&(clearTimeout(this.df),this.df=null)}fv(t){if(this.Of!==null)return;const e=t.changedTouches[0];this.Of=e.identifier,this.Vf=Ps(t);const s=this.Zf.ownerDocument.documentElement;this.wf=!1,this.mf=!1,this.Rf=!1,this.pf=Ne(e),this.yf&&(this.yf(),this.yf=null);{const h=this.iv.bind(this),a=this.ov.bind(this);this.yf=()=>{s.removeEventListener("touchmove",h),s.removeEventListener("touchend",a)},s.addEventListener("touchmove",h,{passive:!1}),s.addEventListener("touchend",a,{passive:!1}),this.Kf(),this.df=setTimeout(this.vv.bind(this,t),240)}const r=this.Ef(t,e);this.Wf(r,this.Hf.pv),this.uf||(this._f=0,this.uf=setTimeout(this.$f.bind(this),500),this.cf=Ne(e))}mv(t){if(t.button!==0)return;const e=this.Zf.ownerDocument.documentElement;Mu()&&e.addEventListener("mouseleave",this.Af),this.bf=!1,this.vf=Ne(t),this.kf&&(this.kf(),this.kf=null);{const r=this.lv.bind(this),h=this.If.bind(this);this.kf=()=>{e.removeEventListener("mousemove",r),e.removeEventListener("mouseup",h)},e.addEventListener("mousemove",r),e.addEventListener("mouseup",h)}if(this.Df=!0,this.Lf(t))return;const s=this.Ef(t);this.Uf(s,this.Hf.bv),this.lf||(this.hf=0,this.lf=setTimeout(this.Yf.bind(this),500),this.af=Ne(t))}Xf(){this.Zf.addEventListener("mouseenter",this.Gf.bind(this)),this.Zf.addEventListener("touchcancel",this.Kf.bind(this));{const t=this.Zf.ownerDocument,e=s=>{this.Hf.wv&&(s.composed&&this.Zf.contains(s.composedPath()[0])||s.target&&this.Zf.contains(s.target)||this.Hf.wv())};this.Mf=()=>{t.removeEventListener("touchstart",e)},this.gf=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}No()&&(this.xf=()=>{this.Zf.removeEventListener("dblclick",this.zf)},this.Zf.addEventListener("dblclick",this.zf)),this.Zf.addEventListener("mouseleave",this.gv.bind(this)),this.Zf.addEventListener("touchstart",this.fv.bind(this),{passive:!0}),v1(this.Zf),this.Zf.addEventListener("mousedown",this.mv.bind(this)),this.Mv(),this.Zf.addEventListener("touchmove",()=>{},{passive:!1})}Mv(){this.Hf.xv===void 0&&this.Hf.Sv===void 0&&this.Hf.kv===void 0||(this.Zf.addEventListener("touchstart",t=>this.yv(t.touches),{passive:!0}),this.Zf.addEventListener("touchmove",t=>{if(t.touches.length===2&&this.Cf!==null&&this.Hf.Sv!==void 0){const e=Lu(t.touches[0],t.touches[1])/this.Tf;this.Hf.Sv(this.Cf,e),Ri(t)}},{passive:!1}),this.Zf.addEventListener("touchend",t=>{this.yv(t.touches)}))}yv(t){t.length===1&&(this.Pf=!1),t.length!==2||this.Pf||this.ff?this.Cv():this.Tv(t)}Tv(t){const e=this.Zf.getBoundingClientRect()||{left:0,top:0};this.Cf={nt:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,st:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this.Tf=Lu(t[0],t[1]),this.Hf.xv!==void 0&&this.Hf.xv(),this.Kf()}Cv(){this.Cf!==null&&(this.Cf=null,this.Hf.kv!==void 0&&this.Hf.kv())}gv(t){if(this.Sf&&this.Sf(),this.Lf(t)||!this.Bf)return;const e=this.Ef(t);this.Uf(e,this.Hf.Pv),this.Bf=!No()}vv(t){const e=Eo(t.touches,D(this.Of));if(e===null)return;const s=this.Ef(t,e);this.Wf(s,this.Hf.Rv),this.wf=!0,this.ff=!0}Lf(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents!==void 0?t.sourceCapabilities.firesTouchEvents:Ps(t)<this.Vf+500}Wf(t,e){e&&e.call(this.Hf,t)}Uf(t,e){e&&e.call(this.Hf,t)}Ef(t,e){const s=e||t,r=this.Zf.getBoundingClientRect()||{left:0,top:0};return{clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,localX:s.clientX-r.left,localY:s.clientY-r.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,Dv:!t.type.startsWith("mouse")&&t.type!=="contextmenu"&&t.type!=="click",Vv:t.type,Ov:s.target,Bv:t.view,Av:()=>{t.type!=="touchstart"&&Ri(t)}}}}function Lu(o,t){const e=o.clientX-t.clientX,s=o.clientY-t.clientY;return Math.sqrt(e*e+s*s)}function Ri(o){o.cancelable&&o.preventDefault()}function Ne(o){return{nt:o.pageX,st:o.pageY}}function Ps(o){return o.timeStamp||performance.now()}function Eo(o,t){for(let e=0;e<o.length;++e)if(o[e].identifier===t)return o[e];return null}function js(o){return{Hc:o.Hc,Iv:{gr:o.zv.externalId},Lv:o.zv.cursorStyle}}function x1(o,t,e){for(const s of o){const r=s.gt();if(r!==null&&r.wr){const h=r.wr(t,e);if(h!==null)return{Bv:s,Iv:h}}}return null}function Po(o,t){return e=>{var s,r,h,a;return((r=(s=e.Dt())===null||s===void 0?void 0:s.Pa())!==null&&r!==void 0?r:"")!==t?[]:(a=(h=e.da)===null||h===void 0?void 0:h.call(e,o))!==null&&a!==void 0?a:[]}}function Eu(o,t,e,s){if(!o.length)return;let r=0;const h=e/2,a=o[0].At(s,!0);let c=t===1?h-(o[0].Vi()-a/2):o[0].Vi()-a/2-h;c=Math.max(0,c);for(let d=1;d<o.length;d++){const m=o[d],p=o[d-1],v=p.At(s,!1),w=m.Vi(),_=p.Vi();if(t===1?w>_-v:w<_+v){const C=_-v*t;m.Oi(C);const y=C-t*v/2;if((t===1?y<0:y>e)&&c>0){const E=t===1?-1-y:y-e,P=Math.min(E,c);for(let A=r;A<o.length;A++)o[A].Oi(o[A].Vi()+t*P);c-=P}}else r=d,c=t===1?_-v-w:w-(_+v)}}class Pu{constructor(t,e,s,r){this.Li=null,this.Ev=null,this.Nv=!1,this.Fv=new Sn(200),this.Qr=null,this.Wv=0,this.jv=!1,this.Hv=()=>{this.jv||this.tn.$v().$t().Uh()},this.Uv=()=>{this.jv||this.tn.$v().$t().Uh()},this.tn=t,this.cn=e,this.ko=e.layout,this.Oc=s,this.qv=r==="left",this.Yv=Po("normal",r),this.Zv=Po("top",r),this.Xv=Po("bottom",r),this.Kv=document.createElement("div"),this.Kv.style.height="100%",this.Kv.style.overflow="hidden",this.Kv.style.width="25px",this.Kv.style.left="0",this.Kv.style.position="relative",this.Gv=gi(this.Kv,vt({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.Hv);const h=this.Gv.canvasElement;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this.Jv=gi(this.Kv,vt({width:16,height:16})),this.Jv.subscribeSuggestedBitmapSizeChanged(this.Uv);const a=this.Jv.canvasElement;a.style.position="absolute",a.style.zIndex="2",a.style.left="0",a.style.top="0";const c={bv:this.Qv.bind(this),pv:this.Qv.bind(this),av:this.tp.bind(this),hv:this.tp.bind(this),wv:this.ip.bind(this),cv:this.np.bind(this),_v:this.np.bind(this),qf:this.sp.bind(this),jf:this.sp.bind(this),Qf:this.ep.bind(this),Pv:this.rp.bind(this)};this.hp=new nl(this.Jv.canvasElement,c,{ev:()=>!this.cn.handleScroll.vertTouchDrag,rv:()=>!0})}S(){this.hp.S(),this.Jv.unsubscribeSuggestedBitmapSizeChanged(this.Uv),pi(this.Jv.canvasElement),this.Jv.dispose(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.Hv),pi(this.Gv.canvasElement),this.Gv.dispose(),this.Li!==null&&this.Li.Ko().p(this),this.Li=null}lp(){return this.Kv}P(){return this.ko.fontSize}ap(){const t=this.Oc.W();return this.Qr!==t.R&&(this.Fv.nr(),this.Qr=t.R),t}op(){if(this.Li===null)return 0;let t=0;const e=this.ap(),s=D(this.Gv.canvasElement.getContext("2d"));s.save();const r=this.Li.Ha();s.font=this._p(),r.length>0&&(t=Math.max(this.Fv.xi(s,r[0].so),this.Fv.xi(s,r[r.length-1].so)));const h=this.up();for(let m=h.length;m--;){const p=this.Fv.xi(s,h[m].Kt());p>t&&(t=p)}const a=this.Li.Ct();if(a!==null&&this.Ev!==null&&(c=this.cn.crosshair).mode!==2&&c.horzLine.visible&&c.horzLine.labelVisible){const m=this.Li.pn(1,a),p=this.Li.pn(this.Ev.height-2,a);t=Math.max(t,this.Fv.xi(s,this.Li.Fi(Math.floor(Math.min(m,p))+.11111111111111,a)),this.Fv.xi(s,this.Li.Fi(Math.ceil(Math.max(m,p))-.11111111111111,a)))}var c;s.restore();const d=t||34;return Bo(Math.ceil(e.C+e.T+e.A+e.I+5+d))}cp(t){this.Ev!==null&&fi(this.Ev,t)||(this.Ev=t,this.jv=!0,this.Gv.resizeCanvasElement(t),this.Jv.resizeCanvasElement(t),this.jv=!1,this.Kv.style.width=`${t.width}px`,this.Kv.style.height=`${t.height}px`)}dp(){return D(this.Ev).width}Gi(t){this.Li!==t&&(this.Li!==null&&this.Li.Ko().p(this),this.Li=t,t.Ko().l(this.fo.bind(this),this))}Dt(){return this.Li}nr(){const t=this.tn.fp();this.tn.$v().$t().E_(t,D(this.Dt()))}vp(t){if(this.Ev===null)return;if(t!==1){this.pp(),this.Gv.applySuggestedBitmapSize();const s=di(this.Gv);s!==null&&(s.useBitmapCoordinateSpace(r=>{this.mp(r),this.Ie(r)}),this.tn.bp(s,this.Xv),this.wp(s),this.tn.bp(s,this.Yv),this.gp(s))}this.Jv.applySuggestedBitmapSize();const e=di(this.Jv);e!==null&&(e.useBitmapCoordinateSpace(({context:s,bitmapSize:r})=>{s.clearRect(0,0,r.width,r.height)}),this.Mp(e),this.tn.bp(e,this.Zv))}xp(){return this.Gv.bitmapSize}Sp(t,e,s){const r=this.xp();r.width>0&&r.height>0&&t.drawImage(this.Gv.canvasElement,e,s)}bt(){var t;(t=this.Li)===null||t===void 0||t.Ha()}Qv(t){if(this.Li===null||this.Li.Ni()||!this.cn.handleScale.axisPressedMouseMove.price)return;const e=this.tn.$v().$t(),s=this.tn.fp();this.Nv=!0,e.V_(s,this.Li,t.localY)}tp(t){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const e=this.tn.$v().$t(),s=this.tn.fp(),r=this.Li;e.O_(s,r,t.localY)}ip(){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const t=this.tn.$v().$t(),e=this.tn.fp(),s=this.Li;this.Nv&&(this.Nv=!1,t.B_(e,s))}np(t){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const e=this.tn.$v().$t(),s=this.tn.fp();this.Nv=!1,e.B_(s,this.Li)}sp(t){this.cn.handleScale.axisDoubleClickReset.price&&this.nr()}ep(t){this.Li!==null&&(!this.tn.$v().$t().W().handleScale.axisPressedMouseMove.price||this.Li.Mh()||this.Li.Oo()||this.kp(1))}rp(t){this.kp(0)}up(){const t=[],e=this.Li===null?void 0:this.Li;return(s=>{for(let r=0;r<s.length;++r){const h=s[r].Rn(this.tn.fp(),e);for(let a=0;a<h.length;a++)t.push(h[a])}})(this.tn.fp().Uo()),t}mp({context:t,bitmapSize:e}){const{width:s,height:r}=e,h=this.tn.fp().$t(),a=h.q(),c=h.bd();a===c?Ws(t,0,0,s,r,a):cc(t,0,0,s,r,a,c)}Ie({context:t,bitmapSize:e,horizontalPixelRatio:s}){if(this.Ev===null||this.Li===null||!this.Li.W().borderVisible)return;t.fillStyle=this.Li.W().borderColor;const r=Math.max(1,Math.floor(this.ap().C*s));let h;h=this.qv?e.width-r:0,t.fillRect(h,0,r,e.height)}wp(t){if(this.Ev===null||this.Li===null)return;const e=this.Li.Ha(),s=this.Li.W(),r=this.ap(),h=this.qv?this.Ev.width-r.T:0;s.borderVisible&&s.ticksVisible&&t.useBitmapCoordinateSpace(({context:a,horizontalPixelRatio:c,verticalPixelRatio:d})=>{a.fillStyle=s.borderColor;const m=Math.max(1,Math.floor(d)),p=Math.floor(.5*d),v=Math.round(r.T*c);a.beginPath();for(const w of e)a.rect(Math.floor(h*c),Math.round(w.Ea*d)-p,v,m);a.fill()}),t.useMediaCoordinateSpace(({context:a})=>{var c;a.font=this._p(),a.fillStyle=(c=s.textColor)!==null&&c!==void 0?c:this.ko.textColor,a.textAlign=this.qv?"right":"left",a.textBaseline="middle";const d=this.qv?Math.round(h-r.A):Math.round(h+r.T+r.A),m=e.map(p=>this.Fv.Mi(a,p.so));for(let p=e.length;p--;){const v=e[p];a.fillText(v.so,d,v.Ea+m[p])}})}pp(){if(this.Ev===null||this.Li===null)return;const t=[],e=this.Li.Uo().slice(),s=this.tn.fp(),r=this.ap();this.Li===s.pr()&&this.tn.fp().Uo().forEach(a=>{s.vr(a)&&e.push(a)});const h=this.Li;e.forEach(a=>{a.Rn(s,h).forEach(c=>{c.Oi(null),c.Bi()&&t.push(c)})}),t.forEach(a=>a.Oi(a.ki())),this.Li.W().alignLabels&&this.yp(t,r)}yp(t,e){if(this.Ev===null)return;const s=this.Ev.height/2,r=t.filter(a=>a.ki()<=s),h=t.filter(a=>a.ki()>s);r.sort((a,c)=>c.ki()-a.ki()),h.sort((a,c)=>a.ki()-c.ki());for(const a of t){const c=Math.floor(a.At(e)/2),d=a.ki();d>-c&&d<c&&a.Oi(c),d>this.Ev.height-c&&d<this.Ev.height+c&&a.Oi(this.Ev.height-c)}Eu(r,1,this.Ev.height,e),Eu(h,-1,this.Ev.height,e)}gp(t){if(this.Ev===null)return;const e=this.up(),s=this.ap(),r=this.qv?"right":"left";e.forEach(h=>{h.Ai()&&h.gt(D(this.Li)).X(t,s,this.Fv,r)})}Mp(t){if(this.Ev===null||this.Li===null)return;const e=this.tn.$v().$t(),s=[],r=this.tn.fp(),h=e.Zc().Rn(r,this.Li);h.length&&s.push(h);const a=this.ap(),c=this.qv?"right":"left";s.forEach(d=>{d.forEach(m=>{m.gt(D(this.Li)).X(t,a,this.Fv,c)})})}kp(t){this.Kv.style.cursor=t===1?"ns-resize":"default"}fo(){const t=this.op();this.Wv<t&&this.tn.$v().$t().Kl(),this.Wv=t}_p(){return Ii(this.ko.fontSize,this.ko.fontFamily)}}function b1(o,t){var e,s;return(s=(e=o.ua)===null||e===void 0?void 0:e.call(o,t))!==null&&s!==void 0?s:[]}function zs(o,t){var e,s;return(s=(e=o.Pn)===null||e===void 0?void 0:e.call(o,t))!==null&&s!==void 0?s:[]}function w1(o,t){var e,s;return(s=(e=o.Ji)===null||e===void 0?void 0:e.call(o,t))!==null&&s!==void 0?s:[]}function _1(o,t){var e,s;return(s=(e=o.aa)===null||e===void 0?void 0:e.call(o,t))!==null&&s!==void 0?s:[]}class sl{constructor(t,e){this.Ev=vt({width:0,height:0}),this.Cp=null,this.Tp=null,this.Pp=null,this.Rp=null,this.Dp=!1,this.Vp=new Ct,this.Op=new Ct,this.Bp=0,this.Ap=!1,this.Ip=null,this.zp=!1,this.Lp=null,this.Ep=null,this.jv=!1,this.Hv=()=>{this.jv||this.Np===null||this.$i().Uh()},this.Uv=()=>{this.jv||this.Np===null||this.$i().Uh()},this.Qd=t,this.Np=e,this.Np.W_().l(this.Fp.bind(this),this,!0),this.Wp=document.createElement("td"),this.Wp.style.padding="0",this.Wp.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.jp=document.createElement("td"),this.jp.style.padding="0",this.Hp=document.createElement("td"),this.Hp.style.padding="0",this.Wp.appendChild(s),this.Gv=gi(s,vt({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.Hv);const r=this.Gv.canvasElement;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.Jv=gi(s,vt({width:16,height:16})),this.Jv.subscribeSuggestedBitmapSizeChanged(this.Uv);const h=this.Jv.canvasElement;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0",this.$p=document.createElement("tr"),this.$p.appendChild(this.jp),this.$p.appendChild(this.Wp),this.$p.appendChild(this.Hp),this.Up(),this.hp=new nl(this.Jv.canvasElement,this,{ev:()=>this.Ip===null&&!this.Qd.W().handleScroll.vertTouchDrag,rv:()=>this.Ip===null&&!this.Qd.W().handleScroll.horzTouchDrag})}S(){this.Cp!==null&&this.Cp.S(),this.Tp!==null&&this.Tp.S(),this.Pp=null,this.Jv.unsubscribeSuggestedBitmapSizeChanged(this.Uv),pi(this.Jv.canvasElement),this.Jv.dispose(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.Hv),pi(this.Gv.canvasElement),this.Gv.dispose(),this.Np!==null&&this.Np.W_().p(this),this.hp.S()}fp(){return D(this.Np)}qp(t){var e,s;this.Np!==null&&this.Np.W_().p(this),this.Np=t,this.Np!==null&&this.Np.W_().l(sl.prototype.Fp.bind(this),this,!0),this.Up(),this.Qd.Yp().indexOf(this)===this.Qd.Yp().length-1?(this.Pp=(e=this.Pp)!==null&&e!==void 0?e:new p1(this.Wp,this.Qd),this.Pp.bt()):((s=this.Pp)===null||s===void 0||s.if(),this.Pp=null)}$v(){return this.Qd}lp(){return this.$p}Up(){if(this.Np!==null&&(this.Zp(),this.$i().wt().length!==0)){if(this.Cp!==null){const t=this.Np.R_();this.Cp.Gi(D(t))}if(this.Tp!==null){const t=this.Np.D_();this.Tp.Gi(D(t))}}}Xp(){this.Cp!==null&&this.Cp.bt(),this.Tp!==null&&this.Tp.bt()}M_(){return this.Np!==null?this.Np.M_():0}x_(t){this.Np&&this.Np.x_(t)}Qf(t){if(!this.Np)return;this.Kp();const e=t.localX,s=t.localY;this.Gp(e,s,t)}bv(t){this.Kp(),this.Jp(),this.Gp(t.localX,t.localY,t)}tv(t){var e;if(!this.Np)return;this.Kp();const s=t.localX,r=t.localY;this.Gp(s,r,t);const h=this.wr(s,r);this.Qd.Qp((e=h==null?void 0:h.Lv)!==null&&e!==void 0?e:null),this.$i().jc(h&&{Hc:h.Hc,Iv:h.Iv})}dv(t){this.Np!==null&&(this.Kp(),this.tm(t))}qf(t){this.Np!==null&&this.im(this.Op,t)}jf(t){this.qf(t)}av(t){this.Kp(),this.nm(t),this.Gp(t.localX,t.localY,t)}cv(t){this.Np!==null&&(this.Kp(),this.Ap=!1,this.sm(t))}uv(t){this.Np!==null&&this.tm(t)}Rv(t){if(this.Ap=!0,this.Ip===null){const e={x:t.localX,y:t.localY};this.rm(e,e,t)}}Pv(t){this.Np!==null&&(this.Kp(),this.Np.$t().jc(null),this.hm())}lm(){return this.Vp}am(){return this.Op}xv(){this.Bp=1,this.$i().Un()}Sv(t,e){if(!this.Qd.W().handleScale.pinch)return;const s=5*(e-this.Bp);this.Bp=e,this.$i().Qc(t.nt,s)}pv(t){this.Ap=!1,this.zp=this.Ip!==null,this.Jp();const e=this.$i().Zc();this.Ip!==null&&e.yt()&&(this.Lp={x:e.Yt(),y:e.Zt()},this.Ip={x:t.localX,y:t.localY})}hv(t){if(this.Np===null)return;const e=t.localX,s=t.localY;if(this.Ip===null)this.nm(t);else{this.zp=!1;const r=D(this.Lp),h=r.x+(e-this.Ip.x),a=r.y+(s-this.Ip.y);this.Gp(h,a,t)}}_v(t){this.$v().W().trackingMode.exitMode===0&&(this.zp=!0),this.om(),this.sm(t)}wr(t,e){const s=this.Np;return s===null?null:function(r,h,a){const c=r.Uo(),d=function(m,p,v){var w,_;let C,y;for(const A of m){const $=(_=(w=A.va)===null||w===void 0?void 0:w.call(A,p,v))!==null&&_!==void 0?_:[];for(const U of $)E=U.zOrder,(!(P=C==null?void 0:C.zOrder)||E==="top"&&P!=="top"||E==="normal"&&P==="bottom")&&(C=U,y=A)}var E,P;return C&&y?{zv:C,Hc:y}:null}(c,h,a);if((d==null?void 0:d.zv.zOrder)==="top")return js(d);for(const m of c){if(d&&d.Hc===m&&d.zv.zOrder!=="bottom"&&!d.zv.isBackground)return js(d);const p=x1(m.Pn(r),h,a);if(p!==null)return{Hc:m,Bv:p.Bv,Iv:p.Iv};if(d&&d.Hc===m&&d.zv.zOrder!=="bottom"&&d.zv.isBackground)return js(d)}return d!=null&&d.zv?js(d):null}(s,t,e)}_m(t,e){D(e==="left"?this.Cp:this.Tp).cp(vt({width:t,height:this.Ev.height}))}um(){return this.Ev}cp(t){fi(this.Ev,t)||(this.Ev=t,this.jv=!0,this.Gv.resizeCanvasElement(t),this.Jv.resizeCanvasElement(t),this.jv=!1,this.Wp.style.width=t.width+"px",this.Wp.style.height=t.height+"px")}dm(){const t=D(this.Np);t.P_(t.R_()),t.P_(t.D_());for(const e of t.Ba())if(t.vr(e)){const s=e.Dt();s!==null&&t.P_(s),e.Vn()}}xp(){return this.Gv.bitmapSize}Sp(t,e,s){const r=this.xp();r.width>0&&r.height>0&&t.drawImage(this.Gv.canvasElement,e,s)}vp(t){if(t===0||this.Np===null)return;if(t>1&&this.dm(),this.Cp!==null&&this.Cp.vp(t),this.Tp!==null&&this.Tp.vp(t),t!==1){this.Gv.applySuggestedBitmapSize();const s=di(this.Gv);s!==null&&(s.useBitmapCoordinateSpace(r=>{this.mp(r)}),this.Np&&(this.fm(s,b1),this.vm(s),this.pm(s),this.fm(s,zs),this.fm(s,w1)))}this.Jv.applySuggestedBitmapSize();const e=di(this.Jv);e!==null&&(e.useBitmapCoordinateSpace(({context:s,bitmapSize:r})=>{s.clearRect(0,0,r.width,r.height)}),this.bm(e),this.fm(e,_1))}wm(){return this.Cp}gm(){return this.Tp}bp(t,e){this.fm(t,e)}Fp(){this.Np!==null&&this.Np.W_().p(this),this.Np=null}tm(t){this.im(this.Vp,t)}im(t,e){const s=e.localX,r=e.localY;t.M()&&t.m(this.$i().St().Nu(s),{x:s,y:r},e)}mp({context:t,bitmapSize:e}){const{width:s,height:r}=e,h=this.$i(),a=h.q(),c=h.bd();a===c?Ws(t,0,0,s,r,c):cc(t,0,0,s,r,a,c)}vm(t){const e=D(this.Np).j_().qh().gt();e!==null&&e.X(t,!1)}pm(t){const e=this.$i().Yc();this.Mm(t,zs,Vo,e),this.Mm(t,zs,Os,e)}bm(t){this.Mm(t,zs,Os,this.$i().Zc())}fm(t,e){const s=D(this.Np).Uo();for(const r of s)this.Mm(t,e,Vo,r);for(const r of s)this.Mm(t,e,Os,r)}Mm(t,e,s,r){const h=D(this.Np),a=h.$t().Wc(),c=a!==null&&a.Hc===r,d=a!==null&&c&&a.Iv!==void 0?a.Iv.Mr:void 0;Uo(e,m=>s(m,t,c,d),r,h)}Zp(){if(this.Np===null)return;const t=this.Qd,e=this.Np.R_().W().visible,s=this.Np.D_().W().visible;e||this.Cp===null||(this.jp.removeChild(this.Cp.lp()),this.Cp.S(),this.Cp=null),s||this.Tp===null||(this.Hp.removeChild(this.Tp.lp()),this.Tp.S(),this.Tp=null);const r=t.$t().ud();e&&this.Cp===null&&(this.Cp=new Pu(this,t.W(),r,"left"),this.jp.appendChild(this.Cp.lp())),s&&this.Tp===null&&(this.Tp=new Pu(this,t.W(),r,"right"),this.Hp.appendChild(this.Tp.lp()))}xm(t){return t.Dv&&this.Ap||this.Ip!==null}Sm(t){return Math.max(0,Math.min(t,this.Ev.width-1))}km(t){return Math.max(0,Math.min(t,this.Ev.height-1))}Gp(t,e,s){this.$i().ld(this.Sm(t),this.km(e),s,D(this.Np))}hm(){this.$i().od()}om(){this.zp&&(this.Ip=null,this.hm())}rm(t,e,s){this.Ip=t,this.zp=!1,this.Gp(e.x,e.y,s);const r=this.$i().Zc();this.Lp={x:r.Yt(),y:r.Zt()}}$i(){return this.Qd.$t()}sm(t){if(!this.Dp)return;const e=this.$i(),s=this.fp();if(e.z_(s,s.vn()),this.Rp=null,this.Dp=!1,e.ed(),this.Ep!==null){const r=performance.now(),h=e.St();this.Ep.Vr(h.Hu(),r),this.Ep.Qu(r)||e.Zn(this.Ep)}}Kp(){this.Ip=null}Jp(){if(this.Np){if(this.$i().Un(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)D(document.activeElement).blur();else{const t=document.getSelection();t!==null&&t.removeAllRanges()}!this.Np.vn().Ni()&&this.$i().St().Ni()}}nm(t){if(this.Np===null)return;const e=this.$i(),s=e.St();if(s.Ni())return;const r=this.Qd.W(),h=r.handleScroll,a=r.kineticScroll;if((!h.pressedMouseMove||t.Dv)&&(!h.horzTouchDrag&&!h.vertTouchDrag||!t.Dv))return;const c=this.Np.vn(),d=performance.now();if(this.Rp!==null||this.xm(t)||(this.Rp={x:t.clientX,y:t.clientY,Od:d,ym:t.localX,Cm:t.localY}),this.Rp!==null&&!this.Dp&&(this.Rp.x!==t.clientX||this.Rp.y!==t.clientY)){if(t.Dv&&a.touch||!t.Dv&&a.mouse){const m=s.le();this.Ep=new g1(.2/m,7/m,.997,15/m),this.Ep.Yd(s.Hu(),this.Rp.Od)}else this.Ep=null;c.Ni()||e.A_(this.Np,c,t.localY),e.nd(t.localX),this.Dp=!0}this.Dp&&(c.Ni()||e.I_(this.Np,c,t.localY),e.sd(t.localX),this.Ep!==null&&this.Ep.Yd(s.Hu(),d))}}class ju{constructor(t,e,s,r,h){this.ft=!0,this.Ev=vt({width:0,height:0}),this.Hv=()=>this.vp(3),this.qv=t==="left",this.Oc=s.ud,this.cn=e,this.Tm=r,this.Pm=h,this.Kv=document.createElement("div"),this.Kv.style.width="25px",this.Kv.style.height="100%",this.Kv.style.overflow="hidden",this.Gv=gi(this.Kv,vt({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.Hv)}S(){this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.Hv),pi(this.Gv.canvasElement),this.Gv.dispose()}lp(){return this.Kv}um(){return this.Ev}cp(t){fi(this.Ev,t)||(this.Ev=t,this.Gv.resizeCanvasElement(t),this.Kv.style.width=`${t.width}px`,this.Kv.style.height=`${t.height}px`,this.ft=!0)}vp(t){if(t<3&&!this.ft||this.Ev.width===0||this.Ev.height===0)return;this.ft=!1,this.Gv.applySuggestedBitmapSize();const e=di(this.Gv);e!==null&&e.useBitmapCoordinateSpace(s=>{this.mp(s),this.Ie(s)})}xp(){return this.Gv.bitmapSize}Sp(t,e,s){const r=this.xp();r.width>0&&r.height>0&&t.drawImage(this.Gv.canvasElement,e,s)}Ie({context:t,bitmapSize:e,horizontalPixelRatio:s,verticalPixelRatio:r}){if(!this.Tm())return;t.fillStyle=this.cn.timeScale.borderColor;const h=Math.floor(this.Oc.W().C*s),a=Math.floor(this.Oc.W().C*r),c=this.qv?e.width-h:0;t.fillRect(c,0,h,a)}mp({context:t,bitmapSize:e}){Ws(t,0,0,e.width,e.height,this.Pm())}}function rl(o){return t=>{var e,s;return(s=(e=t.fa)===null||e===void 0?void 0:e.call(t,o))!==null&&s!==void 0?s:[]}}const y1=rl("normal"),S1=rl("top"),C1=rl("bottom");class N1{constructor(t,e){this.Rm=null,this.Dm=null,this.k=null,this.Vm=!1,this.Ev=vt({width:0,height:0}),this.Om=new Ct,this.Fv=new Sn(5),this.jv=!1,this.Hv=()=>{this.jv||this.Qd.$t().Uh()},this.Uv=()=>{this.jv||this.Qd.$t().Uh()},this.Qd=t,this.q_=e,this.cn=t.W().layout,this.Xd=document.createElement("tr"),this.Bm=document.createElement("td"),this.Bm.style.padding="0",this.Am=document.createElement("td"),this.Am.style.padding="0",this.Kv=document.createElement("td"),this.Kv.style.height="25px",this.Kv.style.padding="0",this.Im=document.createElement("div"),this.Im.style.width="100%",this.Im.style.height="100%",this.Im.style.position="relative",this.Im.style.overflow="hidden",this.Kv.appendChild(this.Im),this.Gv=gi(this.Im,vt({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.Hv);const s=this.Gv.canvasElement;s.style.position="absolute",s.style.zIndex="1",s.style.left="0",s.style.top="0",this.Jv=gi(this.Im,vt({width:16,height:16})),this.Jv.subscribeSuggestedBitmapSizeChanged(this.Uv);const r=this.Jv.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this.Xd.appendChild(this.Bm),this.Xd.appendChild(this.Kv),this.Xd.appendChild(this.Am),this.zm(),this.Qd.$t().g_().l(this.zm.bind(this),this),this.hp=new nl(this.Jv.canvasElement,this,{ev:()=>!0,rv:()=>!this.Qd.W().handleScroll.horzTouchDrag})}S(){this.hp.S(),this.Rm!==null&&this.Rm.S(),this.Dm!==null&&this.Dm.S(),this.Jv.unsubscribeSuggestedBitmapSizeChanged(this.Uv),pi(this.Jv.canvasElement),this.Jv.dispose(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.Hv),pi(this.Gv.canvasElement),this.Gv.dispose()}lp(){return this.Xd}Lm(){return this.Rm}Em(){return this.Dm}bv(t){if(this.Vm)return;this.Vm=!0;const e=this.Qd.$t();!e.St().Ni()&&this.Qd.W().handleScale.axisPressedMouseMove.time&&e.Jc(t.localX)}pv(t){this.bv(t)}wv(){const t=this.Qd.$t();!t.St().Ni()&&this.Vm&&(this.Vm=!1,this.Qd.W().handleScale.axisPressedMouseMove.time&&t.hd())}av(t){const e=this.Qd.$t();!e.St().Ni()&&this.Qd.W().handleScale.axisPressedMouseMove.time&&e.rd(t.localX)}hv(t){this.av(t)}cv(){this.Vm=!1;const t=this.Qd.$t();t.St().Ni()&&!this.Qd.W().handleScale.axisPressedMouseMove.time||t.hd()}_v(){this.cv()}qf(){this.Qd.W().handleScale.axisDoubleClickReset.time&&this.Qd.$t().Kn()}jf(){this.qf()}Qf(){this.Qd.$t().W().handleScale.axisPressedMouseMove.time&&this.kp(1)}Pv(){this.kp(0)}um(){return this.Ev}Nm(){return this.Om}Fm(t,e,s){fi(this.Ev,t)||(this.Ev=t,this.jv=!0,this.Gv.resizeCanvasElement(t),this.Jv.resizeCanvasElement(t),this.jv=!1,this.Kv.style.width=`${t.width}px`,this.Kv.style.height=`${t.height}px`,this.Om.m(t)),this.Rm!==null&&this.Rm.cp(vt({width:e,height:t.height})),this.Dm!==null&&this.Dm.cp(vt({width:s,height:t.height}))}Wm(){const t=this.jm();return Math.ceil(t.C+t.T+t.P+t.L+t.B+t.Hm)}bt(){this.Qd.$t().St().Ha()}xp(){return this.Gv.bitmapSize}Sp(t,e,s){const r=this.xp();r.width>0&&r.height>0&&t.drawImage(this.Gv.canvasElement,e,s)}vp(t){if(t===0)return;if(t!==1){this.Gv.applySuggestedBitmapSize();const s=di(this.Gv);s!==null&&(s.useBitmapCoordinateSpace(r=>{this.mp(r),this.Ie(r),this.$m(s,C1)}),this.wp(s),this.$m(s,y1)),this.Rm!==null&&this.Rm.vp(t),this.Dm!==null&&this.Dm.vp(t)}this.Jv.applySuggestedBitmapSize();const e=di(this.Jv);e!==null&&(e.useBitmapCoordinateSpace(({context:s,bitmapSize:r})=>{s.clearRect(0,0,r.width,r.height)}),this.Um([...this.Qd.$t().wt(),this.Qd.$t().Zc()],e),this.$m(e,S1))}$m(t,e){const s=this.Qd.$t().wt();for(const r of s)Uo(e,h=>Vo(h,t,!1,void 0),r,void 0);for(const r of s)Uo(e,h=>Os(h,t,!1,void 0),r,void 0)}mp({context:t,bitmapSize:e}){Ws(t,0,0,e.width,e.height,this.Qd.$t().bd())}Ie({context:t,bitmapSize:e,verticalPixelRatio:s}){if(this.Qd.W().timeScale.borderVisible){t.fillStyle=this.qm();const r=Math.max(1,Math.floor(this.jm().C*s));t.fillRect(0,0,e.width,r)}}wp(t){const e=this.Qd.$t().St(),s=e.Ha();if(!s||s.length===0)return;const r=this.q_.maxTickMarkWeight(s),h=this.jm(),a=e.W();a.borderVisible&&a.ticksVisible&&t.useBitmapCoordinateSpace(({context:c,horizontalPixelRatio:d,verticalPixelRatio:m})=>{c.strokeStyle=this.qm(),c.fillStyle=this.qm();const p=Math.max(1,Math.floor(d)),v=Math.floor(.5*d);c.beginPath();const w=Math.round(h.T*m);for(let _=s.length;_--;){const C=Math.round(s[_].coord*d);c.rect(C-v,0,p,w)}c.fill()}),t.useMediaCoordinateSpace(({context:c})=>{const d=h.C+h.T+h.L+h.P/2;c.textAlign="center",c.textBaseline="middle",c.fillStyle=this.$(),c.font=this._p();for(const m of s)if(m.weight<r){const p=m.needAlignCoordinate?this.Ym(c,m.coord,m.label):m.coord;c.fillText(m.label,p,d)}this.Qd.W().timeScale.allowBoldLabels&&(c.font=this.Zm());for(const m of s)if(m.weight>=r){const p=m.needAlignCoordinate?this.Ym(c,m.coord,m.label):m.coord;c.fillText(m.label,p,d)}})}Ym(t,e,s){const r=this.Fv.xi(t,s),h=r/2,a=Math.floor(e-h)+.5;return a<0?e+=Math.abs(0-a):a+r>this.Ev.width&&(e-=Math.abs(this.Ev.width-(a+r))),e}Um(t,e){const s=this.jm();for(const r of t)for(const h of r.Qi())h.gt().X(e,s)}qm(){return this.Qd.W().timeScale.borderColor}$(){return this.cn.textColor}j(){return this.cn.fontSize}_p(){return Ii(this.j(),this.cn.fontFamily)}Zm(){return Ii(this.j(),this.cn.fontFamily,"bold")}jm(){this.k===null&&(this.k={C:1,N:NaN,L:NaN,B:NaN,ji:NaN,T:5,P:NaN,R:"",Wi:new Sn,Hm:0});const t=this.k,e=this._p();if(t.R!==e){const s=this.j();t.P=s,t.R=e,t.L=3*s/12,t.B=3*s/12,t.ji=9*s/12,t.N=0,t.Hm=4*s/12,t.Wi.nr()}return this.k}kp(t){this.Kv.style.cursor=t===1?"ew-resize":"default"}zm(){const t=this.Qd.$t(),e=t.W();e.leftPriceScale.visible||this.Rm===null||(this.Bm.removeChild(this.Rm.lp()),this.Rm.S(),this.Rm=null),e.rightPriceScale.visible||this.Dm===null||(this.Am.removeChild(this.Dm.lp()),this.Dm.S(),this.Dm=null);const s={ud:this.Qd.$t().ud()},r=()=>e.leftPriceScale.borderVisible&&t.St().W().borderVisible,h=()=>t.bd();e.leftPriceScale.visible&&this.Rm===null&&(this.Rm=new ju("left",e,s,r,h),this.Bm.appendChild(this.Rm.lp())),e.rightPriceScale.visible&&this.Dm===null&&(this.Dm=new ju("right",e,s,r,h),this.Am.appendChild(this.Dm.lp()))}}const M1=!!Wi&&!!navigator.userAgentData&&navigator.userAgentData.brands.some(o=>o.brand.includes("Chromium"))&&!!Wi&&(!((jo=navigator==null?void 0:navigator.userAgentData)===null||jo===void 0)&&jo.platform?navigator.userAgentData.platform==="Windows":navigator.userAgent.toLowerCase().indexOf("win")>=0);var jo;class L1{constructor(t,e,s){var r;this.Xm=[],this.Km=0,this.ho=0,this.__=0,this.Gm=0,this.Jm=0,this.Qm=null,this.tb=!1,this.Vp=new Ct,this.Op=new Ct,this.Rc=new Ct,this.ib=null,this.nb=null,this.Jd=t,this.cn=e,this.q_=s,this.Xd=document.createElement("div"),this.Xd.classList.add("tv-lightweight-charts"),this.Xd.style.overflow="hidden",this.Xd.style.direction="ltr",this.Xd.style.width="100%",this.Xd.style.height="100%",(r=this.Xd).style.userSelect="none",r.style.webkitUserSelect="none",r.style.msUserSelect="none",r.style.MozUserSelect="none",r.style.webkitTapHighlightColor="transparent",this.sb=document.createElement("table"),this.sb.setAttribute("cellspacing","0"),this.Xd.appendChild(this.sb),this.eb=this.rb.bind(this),zo(this.cn)&&this.hb(!0),this.$i=new u1(this.Vc.bind(this),this.cn,s),this.$t().Xc().l(this.lb.bind(this),this),this.ab=new N1(this,this.q_),this.sb.appendChild(this.ab.lp());const h=e.autoSize&&this.ob();let a=this.cn.width,c=this.cn.height;if(h||a===0||c===0){const d=t.getBoundingClientRect();a=a||d.width,c=c||d.height}this._b(a,c),this.ub(),t.appendChild(this.Xd),this.cb(),this.$i.St().ec().l(this.$i.Kl.bind(this.$i),this),this.$i.g_().l(this.$i.Kl.bind(this.$i),this)}$t(){return this.$i}W(){return this.cn}Yp(){return this.Xm}fb(){return this.ab}S(){this.hb(!1),this.Km!==0&&window.cancelAnimationFrame(this.Km),this.$i.Xc().p(this),this.$i.St().ec().p(this),this.$i.g_().p(this),this.$i.S();for(const t of this.Xm)this.sb.removeChild(t.lp()),t.lm().p(this),t.am().p(this),t.S();this.Xm=[],D(this.ab).S(),this.Xd.parentElement!==null&&this.Xd.parentElement.removeChild(this.Xd),this.Rc.S(),this.Vp.S(),this.Op.S(),this.pb()}_b(t,e,s=!1){if(this.ho===e&&this.__===t)return;const r=function(c){const d=Math.floor(c.width),m=Math.floor(c.height);return vt({width:d-d%2,height:m-m%2})}(vt({width:t,height:e}));this.ho=r.height,this.__=r.width;const h=this.ho+"px",a=this.__+"px";D(this.Xd).style.height=h,D(this.Xd).style.width=a,this.sb.style.height=h,this.sb.style.width=a,s?this.mb(Tt.es(),performance.now()):this.$i.Kl()}vp(t){t===void 0&&(t=Tt.es());for(let e=0;e<this.Xm.length;e++)this.Xm[e].vp(t.Hn(e).Fn);this.cn.timeScale.visible&&this.ab.vp(t.jn())}$h(t){const e=zo(this.cn);this.$i.$h(t);const s=zo(this.cn);s!==e&&this.hb(s),this.cb(),this.bb(t)}lm(){return this.Vp}am(){return this.Op}Xc(){return this.Rc}wb(){this.Qm!==null&&(this.mb(this.Qm,performance.now()),this.Qm=null);const t=this.gb(null),e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=D(e.getContext("2d"));return this.gb(s),e}Mb(t){return t==="left"&&!this.xb()||t==="right"&&!this.Sb()||this.Xm.length===0?0:D(t==="left"?this.Xm[0].wm():this.Xm[0].gm()).dp()}kb(){return this.cn.autoSize&&this.ib!==null}yb(){return this.Xd}Qp(t){this.nb=t,this.nb?this.yb().style.setProperty("cursor",t):this.yb().style.removeProperty("cursor")}Cb(){return this.nb}Tb(){return Vt(this.Xm[0]).um()}bb(t){(t.autoSize!==void 0||!this.ib||t.width===void 0&&t.height===void 0)&&(t.autoSize&&!this.ib&&this.ob(),t.autoSize===!1&&this.ib!==null&&this.pb(),t.autoSize||t.width===void 0&&t.height===void 0||this._b(t.width||this.__,t.height||this.ho))}gb(t){let e=0,s=0;const r=this.Xm[0],h=(c,d)=>{let m=0;for(let p=0;p<this.Xm.length;p++){const v=this.Xm[p],w=D(c==="left"?v.wm():v.gm()),_=w.xp();t!==null&&w.Sp(t,d,m),m+=_.height}};this.xb()&&(h("left",0),e+=D(r.wm()).xp().width);for(let c=0;c<this.Xm.length;c++){const d=this.Xm[c],m=d.xp();t!==null&&d.Sp(t,e,s),s+=m.height}e+=r.xp().width,this.Sb()&&(h("right",e),e+=D(r.gm()).xp().width);const a=(c,d,m)=>{D(c==="left"?this.ab.Lm():this.ab.Em()).Sp(D(t),d,m)};if(this.cn.timeScale.visible){const c=this.ab.xp();if(t!==null){let d=0;this.xb()&&(a("left",d,s),d=D(r.wm()).xp().width),this.ab.Sp(t,d,s),d+=c.width,this.Sb()&&a("right",d,s)}s+=c.height}return vt({width:e,height:s})}Pb(){let t=0,e=0,s=0;for(const C of this.Xm)this.xb()&&(e=Math.max(e,D(C.wm()).op(),this.cn.leftPriceScale.minimumWidth)),this.Sb()&&(s=Math.max(s,D(C.gm()).op(),this.cn.rightPriceScale.minimumWidth)),t+=C.M_();e=Bo(e),s=Bo(s);const r=this.__,h=this.ho,a=Math.max(r-e-s,0),c=this.cn.timeScale.visible;let d=c?Math.max(this.ab.Wm(),this.cn.timeScale.minimumHeight):0;var m;d=(m=d)+m%2;const p=0+d,v=h<p?0:h-p,w=v/t;let _=0;for(let C=0;C<this.Xm.length;++C){const y=this.Xm[C];y.qp(this.$i.qc()[C]);let E=0,P=0;P=C===this.Xm.length-1?v-_:Math.round(y.M_()*w),E=Math.max(P,2),_+=E,y.cp(vt({width:a,height:E})),this.xb()&&y._m(e,"left"),this.Sb()&&y._m(s,"right"),y.fp()&&this.$i.Kc(y.fp(),E)}this.ab.Fm(vt({width:c?a:0,height:d}),c?e:0,c?s:0),this.$i.S_(a),this.Gm!==e&&(this.Gm=e),this.Jm!==s&&(this.Jm=s)}hb(t){t?this.Xd.addEventListener("wheel",this.eb,{passive:!1}):this.Xd.removeEventListener("wheel",this.eb)}Rb(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return M1?1/window.devicePixelRatio:1}rb(t){if(!(t.deltaX!==0&&this.cn.handleScroll.mouseWheel||t.deltaY!==0&&this.cn.handleScale.mouseWheel))return;const e=this.Rb(t),s=e*t.deltaX/100,r=-e*t.deltaY/100;if(t.cancelable&&t.preventDefault(),r!==0&&this.cn.handleScale.mouseWheel){const h=Math.sign(r)*Math.min(1,Math.abs(r)),a=t.clientX-this.Xd.getBoundingClientRect().left;this.$t().Qc(a,h)}s!==0&&this.cn.handleScroll.mouseWheel&&this.$t().td(-80*s)}mb(t,e){var s;const r=t.jn();r===3&&this.Db(),r!==3&&r!==2||(this.Vb(t),this.Ob(t,e),this.ab.bt(),this.Xm.forEach(h=>{h.Xp()}),((s=this.Qm)===null||s===void 0?void 0:s.jn())===3&&(this.Qm.ts(t),this.Db(),this.Vb(this.Qm),this.Ob(this.Qm,e),t=this.Qm,this.Qm=null)),this.vp(t)}Ob(t,e){for(const s of t.Qn())this.ns(s,e)}Vb(t){const e=this.$i.qc();for(let s=0;s<e.length;s++)t.Hn(s).Wn&&e[s].N_()}ns(t,e){const s=this.$i.St();switch(t.qn){case 0:s.hc();break;case 1:s.lc(t.Vt);break;case 2:s.Gn(t.Vt);break;case 3:s.Jn(t.Vt);break;case 4:s.qu();break;case 5:t.Vt.Qu(e)||s.Jn(t.Vt.tc(e))}}Vc(t){this.Qm!==null?this.Qm.ts(t):this.Qm=t,this.tb||(this.tb=!0,this.Km=window.requestAnimationFrame(e=>{if(this.tb=!1,this.Km=0,this.Qm!==null){const s=this.Qm;this.Qm=null,this.mb(s,e);for(const r of s.Qn())if(r.qn===5&&!r.Vt.Qu(e)){this.$t().Zn(r.Vt);break}}}))}Db(){this.ub()}ub(){const t=this.$i.qc(),e=t.length,s=this.Xm.length;for(let r=e;r<s;r++){const h=Vt(this.Xm.pop());this.sb.removeChild(h.lp()),h.lm().p(this),h.am().p(this),h.S()}for(let r=s;r<e;r++){const h=new sl(this,t[r]);h.lm().l(this.Bb.bind(this),this),h.am().l(this.Ab.bind(this),this),this.Xm.push(h),this.sb.insertBefore(h.lp(),this.ab.lp())}for(let r=0;r<e;r++){const h=t[r],a=this.Xm[r];a.fp()!==h?a.qp(h):a.Up()}this.cb(),this.Pb()}Ib(t,e,s){var r;const h=new Map;t!==null&&this.$i.wt().forEach(p=>{const v=p.In().ll(t);v!==null&&h.set(p,v)});let a;if(t!==null){const p=(r=this.$i.St().Ui(t))===null||r===void 0?void 0:r.originalTime;p!==void 0&&(a=p)}const c=this.$t().Wc(),d=c!==null&&c.Hc instanceof el?c.Hc:void 0,m=c!==null&&c.Iv!==void 0?c.Iv.gr:void 0;return{zb:a,ee:t??void 0,Lb:e??void 0,Eb:d,Nb:h,Fb:m,Wb:s??void 0}}Bb(t,e,s){this.Vp.m(()=>this.Ib(t,e,s))}Ab(t,e,s){this.Op.m(()=>this.Ib(t,e,s))}lb(t,e,s){this.Rc.m(()=>this.Ib(t,e,s))}cb(){const t=this.cn.timeScale.visible?"":"none";this.ab.lp().style.display=t}xb(){return this.Xm[0].fp().R_().W().visible}Sb(){return this.Xm[0].fp().D_().W().visible}ob(){return"ResizeObserver"in window&&(this.ib=new ResizeObserver(t=>{const e=t.find(s=>s.target===this.Jd);e&&this._b(e.contentRect.width,e.contentRect.height)}),this.ib.observe(this.Jd,{box:"border-box"}),!0)}pb(){this.ib!==null&&this.ib.disconnect(),this.ib=null}}function zo(o){return!!(o.handleScroll.mouseWheel||o.handleScale.mouseWheel)}function E1(o){return function(t){return t.open!==void 0}(o)||function(t){return t.value!==void 0}(o)}function jc(o,t){var e={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.indexOf(s)<0&&(e[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(s=Object.getOwnPropertySymbols(o);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(o,s[r])&&(e[s[r]]=o[s[r]])}return e}function zu(o,t,e,s){const r=e.value,h={ee:t,ot:o,Vt:[r,r,r,r],zb:s};return e.color!==void 0&&(h.V=e.color),h}function P1(o,t,e,s){const r=e.value,h={ee:t,ot:o,Vt:[r,r,r,r],zb:s};return e.lineColor!==void 0&&(h.lt=e.lineColor),e.topColor!==void 0&&(h.Ps=e.topColor),e.bottomColor!==void 0&&(h.Rs=e.bottomColor),h}function j1(o,t,e,s){const r=e.value,h={ee:t,ot:o,Vt:[r,r,r,r],zb:s};return e.topLineColor!==void 0&&(h.Re=e.topLineColor),e.bottomLineColor!==void 0&&(h.De=e.bottomLineColor),e.topFillColor1!==void 0&&(h.ke=e.topFillColor1),e.topFillColor2!==void 0&&(h.ye=e.topFillColor2),e.bottomFillColor1!==void 0&&(h.Ce=e.bottomFillColor1),e.bottomFillColor2!==void 0&&(h.Te=e.bottomFillColor2),h}function z1(o,t,e,s){const r={ee:t,ot:o,Vt:[e.open,e.high,e.low,e.close],zb:s};return e.color!==void 0&&(r.V=e.color),r}function T1(o,t,e,s){const r={ee:t,ot:o,Vt:[e.open,e.high,e.low,e.close],zb:s};return e.color!==void 0&&(r.V=e.color),e.borderColor!==void 0&&(r.Ot=e.borderColor),e.wickColor!==void 0&&(r.Xh=e.wickColor),r}function k1(o,t,e,s,r){const h=Vt(r)(e),a=Math.max(...h),c=Math.min(...h),d=h[h.length-1],m=[d,a,c,d],p=e,{time:v,color:w}=p;return{ee:t,ot:o,Vt:m,zb:s,$e:jc(p,["time","color"]),V:w}}function Ts(o){return o.Vt!==void 0}function Tu(o,t){return t.customValues!==void 0&&(o.jb=t.customValues),o}function ci(o){return(t,e,s,r,h,a)=>function(c,d){return d?d(c):(m=c).open===void 0&&m.value===void 0;var m}(s,a)?Tu({ot:t,ee:e,zb:r},s):Tu(o(t,e,s,r,h),s)}function ku(o){return{Candlestick:ci(T1),Bar:ci(z1),Area:ci(P1),Baseline:ci(j1),Histogram:ci(zu),Line:ci(zu),Custom:ci(k1)}[o]}function Ru(o){return{ee:0,Hb:new Map,la:o}}function Ou(o,t){if(o!==void 0&&o.length!==0)return{$b:t.key(o[0].ot),Ub:t.key(o[o.length-1].ot)}}function Au(o){let t;return o.forEach(e=>{t===void 0&&(t=e.zb)}),Vt(t)}class R1{constructor(t){this.qb=new Map,this.Yb=new Map,this.Zb=new Map,this.Xb=[],this.q_=t}S(){this.qb.clear(),this.Yb.clear(),this.Zb.clear(),this.Xb=[]}Kb(t,e){let s=this.qb.size!==0,r=!1;const h=this.Yb.get(t);if(h!==void 0)if(this.Yb.size===1)s=!1,r=!0,this.qb.clear();else for(const d of this.Xb)d.pointData.Hb.delete(t)&&(r=!0);let a=[];if(e.length!==0){const d=e.map(_=>_.time),m=this.q_.createConverterToInternalObj(e),p=ku(t.Qh()),v=t.Ca(),w=t.Ta();a=e.map((_,C)=>{const y=m(_.time),E=this.q_.key(y);let P=this.qb.get(E);P===void 0&&(P=Ru(y),this.qb.set(E,P),r=!0);const A=p(y,P.ee,_,d[C],v,w);return P.Hb.set(t,A),A})}s&&this.Gb(),this.Jb(t,a);let c=-1;if(r){const d=[];this.qb.forEach(m=>{d.push({timeWeight:0,time:m.la,pointData:m,originalTime:Au(m.Hb)})}),d.sort((m,p)=>this.q_.key(m.time)-this.q_.key(p.time)),c=this.Qb(d)}return this.tw(t,c,function(d,m,p){const v=Ou(d,p),w=Ou(m,p);if(v!==void 0&&w!==void 0)return{ta:v.Ub>=w.Ub&&v.$b>=w.$b}}(this.Yb.get(t),h,this.q_))}vd(t){return this.Kb(t,[])}iw(t,e){const s=e;(function(y){y.zb===void 0&&(y.zb=y.time)})(s),this.q_.preprocessData(e);const r=this.q_.createConverterToInternalObj([e])(e.time),h=this.Zb.get(t);if(h!==void 0&&this.q_.key(r)<this.q_.key(h))throw new Error(`Cannot update oldest data, last time=${h}, new time=${r}`);let a=this.qb.get(this.q_.key(r));const c=a===void 0;a===void 0&&(a=Ru(r),this.qb.set(this.q_.key(r),a));const d=ku(t.Qh()),m=t.Ca(),p=t.Ta(),v=d(r,a.ee,e,s.zb,m,p);a.Hb.set(t,v),this.nw(t,v);const w={ta:Ts(v)};if(!c)return this.tw(t,-1,w);const _={timeWeight:0,time:a.la,pointData:a,originalTime:Au(a.Hb)},C=Mn(this.Xb,this.q_.key(_.time),(y,E)=>this.q_.key(y.time)<E);this.Xb.splice(C,0,_);for(let y=C;y<this.Xb.length;++y)To(this.Xb[y].pointData,y);return this.q_.fillWeightsForPoints(this.Xb,C),this.tw(t,C,w)}nw(t,e){let s=this.Yb.get(t);s===void 0&&(s=[],this.Yb.set(t,s));const r=s.length!==0?s[s.length-1]:null;r===null||this.q_.key(e.ot)>this.q_.key(r.ot)?Ts(e)&&s.push(e):Ts(e)?s[s.length-1]=e:s.splice(-1,1),this.Zb.set(t,e.ot)}Jb(t,e){e.length!==0?(this.Yb.set(t,e.filter(Ts)),this.Zb.set(t,e[e.length-1].ot)):(this.Yb.delete(t),this.Zb.delete(t))}Gb(){for(const t of this.Xb)t.pointData.Hb.size===0&&this.qb.delete(this.q_.key(t.time))}Qb(t){let e=-1;for(let s=0;s<this.Xb.length&&s<t.length;++s){const r=this.Xb[s],h=t[s];if(this.q_.key(r.time)!==this.q_.key(h.time)){e=s;break}h.timeWeight=r.timeWeight,To(h.pointData,s)}if(e===-1&&this.Xb.length!==t.length&&(e=Math.min(this.Xb.length,t.length)),e===-1)return-1;for(let s=e;s<t.length;++s)To(t[s].pointData,s);return this.q_.fillWeightsForPoints(t,e),this.Xb=t,e}sw(){if(this.Yb.size===0)return null;let t=0;return this.Yb.forEach(e=>{e.length!==0&&(t=Math.max(t,e[e.length-1].ee))}),t}tw(t,e,s){const r={ew:new Map,St:{Eu:this.sw()}};if(e!==-1)this.Yb.forEach((h,a)=>{r.ew.set(a,{$e:h,rw:a===t?s:void 0})}),this.Yb.has(t)||r.ew.set(t,{$e:[],rw:s}),r.St.hw=this.Xb,r.St.lw=e;else{const h=this.Yb.get(t);r.ew.set(t,{$e:h||[],rw:s})}return r}}function To(o,t){o.ee=t,o.Hb.forEach(e=>{e.ee=t})}function ol(o){const t={value:o.Vt[3],time:o.zb};return o.jb!==void 0&&(t.customValues=o.jb),t}function Du(o){const t=ol(o);return o.V!==void 0&&(t.color=o.V),t}function O1(o){const t=ol(o);return o.lt!==void 0&&(t.lineColor=o.lt),o.Ps!==void 0&&(t.topColor=o.Ps),o.Rs!==void 0&&(t.bottomColor=o.Rs),t}function A1(o){const t=ol(o);return o.Re!==void 0&&(t.topLineColor=o.Re),o.De!==void 0&&(t.bottomLineColor=o.De),o.ke!==void 0&&(t.topFillColor1=o.ke),o.ye!==void 0&&(t.topFillColor2=o.ye),o.Ce!==void 0&&(t.bottomFillColor1=o.Ce),o.Te!==void 0&&(t.bottomFillColor2=o.Te),t}function zc(o){const t={open:o.Vt[0],high:o.Vt[1],low:o.Vt[2],close:o.Vt[3],time:o.zb};return o.jb!==void 0&&(t.customValues=o.jb),t}function D1(o){const t=zc(o);return o.V!==void 0&&(t.color=o.V),t}function $1(o){const t=zc(o),{V:e,Ot:s,Xh:r}=o;return e!==void 0&&(t.color=e),s!==void 0&&(t.borderColor=s),r!==void 0&&(t.wickColor=r),t}function Ho(o){return{Area:O1,Line:Du,Baseline:A1,Histogram:Du,Bar:D1,Candlestick:$1,Custom:I1}[o]}function I1(o){const t=o.zb;return Object.assign(Object.assign({},o.$e),{time:t})}const W1={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},F1={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},B1={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:Go,attributionLogo:!0},ko={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0},V1={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0},U1={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:Go,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function $u(){return{width:0,height:0,autoSize:!1,layout:B1,crosshair:W1,grid:F1,overlayPriceScales:Object.assign({},ko),leftPriceScale:Object.assign(Object.assign({},ko),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},ko),{visible:!0}),timeScale:V1,watermark:U1,localization:{locale:Wi?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}class H1{constructor(t,e){this.aw=t,this.ow=e}applyOptions(t){this.aw.$t().$c(this.ow,t)}options(){return this.Li().W()}width(){return Bs(this.ow)?this.aw.Mb(this.ow):0}Li(){return D(this.aw.$t().Uc(this.ow)).Dt}}function Iu(o,t,e){const s=jc(o,["time","originalTime"]),r=Object.assign({time:t},s);return e!==void 0&&(r.originalTime=e),r}const K1={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class q1{constructor(t){this.Nh=t}applyOptions(t){this.Nh.$h(t)}options(){return this.Nh.W()}_w(){return this.Nh}}class X1{constructor(t,e,s,r,h){this.uw=new Ct,this.Es=t,this.cw=e,this.dw=s,this.q_=h,this.fw=r}S(){this.uw.S()}priceFormatter(){return this.Es.ba()}priceToCoordinate(t){const e=this.Es.Ct();return e===null?null:this.Es.Dt().Rt(t,e.Vt)}coordinateToPrice(t){const e=this.Es.Ct();return e===null?null:this.Es.Dt().pn(t,e.Vt)}barsInLogicalRange(t){if(t===null)return null;const e=new Di(new bn(t.from,t.to)).lu(),s=this.Es.In();if(s.Ni())return null;const r=s.ll(e.Os(),1),h=s.ll(e.ui(),-1),a=D(s.el()),c=D(s.An());if(r!==null&&h!==null&&r.ee>h.ee)return{barsBefore:t.from-a,barsAfter:c-t.to};const d={barsBefore:r===null||r.ee===a?t.from-a:r.ee-a,barsAfter:h===null||h.ee===c?c-t.to:c-h.ee};return r!==null&&h!==null&&(d.from=r.zb,d.to=h.zb),d}setData(t){this.q_,this.Es.Qh(),this.cw.pw(this.Es,t),this.mw("full")}update(t){this.Es.Qh(),this.cw.bw(this.Es,t),this.mw("update")}dataByIndex(t,e){const s=this.Es.In().ll(t,e);return s===null?null:Ho(this.seriesType())(s)}data(){const t=Ho(this.seriesType());return this.Es.In().ne().map(e=>t(e))}subscribeDataChanged(t){this.uw.l(t)}unsubscribeDataChanged(t){this.uw.v(t)}setMarkers(t){this.q_;const e=t.map(s=>Iu(s,this.q_.convertHorzItemToInternal(s.time),s.time));this.Es.na(e)}markers(){return this.Es.sa().map(t=>Iu(t,t.originalTime,void 0))}applyOptions(t){this.Es.$h(t)}options(){return Ie(this.Es.W())}priceScale(){return this.dw.priceScale(this.Es.Dt().Pa())}createPriceLine(t){const e=we(Ie(K1),t),s=this.Es.ea(e);return new q1(s)}removePriceLine(t){this.Es.ra(t._w())}seriesType(){return this.Es.Qh()}attachPrimitive(t){this.Es.ka(t),t.attached&&t.attached({chart:this.fw,series:this,requestUpdate:()=>this.Es.$t().Kl()})}detachPrimitive(t){this.Es.ya(t),t.detached&&t.detached()}mw(t){this.uw.M()&&this.uw.m(t)}}class G1{constructor(t,e,s){this.ww=new Ct,this.mu=new Ct,this.Om=new Ct,this.$i=t,this.yl=t.St(),this.ab=e,this.yl.nc().l(this.gw.bind(this)),this.yl.sc().l(this.Mw.bind(this)),this.ab.Nm().l(this.xw.bind(this)),this.q_=s}S(){this.yl.nc().p(this),this.yl.sc().p(this),this.ab.Nm().p(this),this.ww.S(),this.mu.S(),this.Om.S()}scrollPosition(){return this.yl.Hu()}scrollToPosition(t,e){e?this.yl.Ju(t,1e3):this.$i.Jn(t)}scrollToRealTime(){this.yl.Gu()}getVisibleRange(){const t=this.yl.Vu();return t===null?null:{from:t.from.originalTime,to:t.to.originalTime}}setVisibleRange(t){const e={from:this.q_.convertHorzItemToInternal(t.from),to:this.q_.convertHorzItemToInternal(t.to)},s=this.yl.Iu(e);this.$i.pd(s)}getVisibleLogicalRange(){const t=this.yl.Du();return t===null?null:{from:t.Os(),to:t.ui()}}setVisibleLogicalRange(t){ti(t.from<=t.to,"The from index cannot be after the to index."),this.$i.pd(t)}resetTimeScale(){this.$i.Kn()}fitContent(){this.$i.hc()}logicalToCoordinate(t){const e=this.$i.St();return e.Ni()?null:e.It(t)}coordinateToLogical(t){return this.yl.Ni()?null:this.yl.Nu(t)}timeToCoordinate(t){const e=this.q_.convertHorzItemToInternal(t),s=this.yl.Va(e,!1);return s===null?null:this.yl.It(s)}coordinateToTime(t){const e=this.$i.St(),s=e.Nu(t),r=e.Ui(s);return r===null?null:r.originalTime}width(){return this.ab.um().width}height(){return this.ab.um().height}subscribeVisibleTimeRangeChange(t){this.ww.l(t)}unsubscribeVisibleTimeRangeChange(t){this.ww.v(t)}subscribeVisibleLogicalRangeChange(t){this.mu.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.mu.v(t)}subscribeSizeChange(t){this.Om.l(t)}unsubscribeSizeChange(t){this.Om.v(t)}applyOptions(t){this.yl.$h(t)}options(){return Object.assign(Object.assign({},Ie(this.yl.W())),{barSpacing:this.yl.le()})}gw(){this.ww.M()&&this.ww.m(this.getVisibleRange())}Mw(){this.mu.M()&&this.mu.m(this.getVisibleLogicalRange())}xw(t){this.Om.m(t.width,t.height)}}function J1(o){if(o===void 0||o.type==="custom")return;const t=o;t.minMove!==void 0&&t.precision===void 0&&(t.precision=function(e){if(e>=1)return 0;let s=0;for(;s<8;s++){const r=Math.round(e);if(Math.abs(r-e)<1e-8)return s;e*=10}return s}(t.minMove))}function Wu(o){return function(t){if(Ss(t.handleScale)){const s=t.handleScale;t.handleScale={axisDoubleClickReset:{time:s,price:s},axisPressedMouseMove:{time:s,price:s},mouseWheel:s,pinch:s}}else if(t.handleScale!==void 0){const{axisPressedMouseMove:s,axisDoubleClickReset:r}=t.handleScale;Ss(s)&&(t.handleScale.axisPressedMouseMove={time:s,price:s}),Ss(r)&&(t.handleScale.axisDoubleClickReset={time:r,price:r})}const e=t.handleScroll;Ss(e)&&(t.handleScroll={horzTouchDrag:e,vertTouchDrag:e,mouseWheel:e,pressedMouseMove:e})}(o),o}class Q1{constructor(t,e,s){this.Sw=new Map,this.kw=new Map,this.yw=new Ct,this.Cw=new Ct,this.Tw=new Ct,this.Pw=new R1(e);const r=s===void 0?Ie($u()):we(Ie($u()),Wu(s));this.q_=e,this.aw=new L1(t,r,e),this.aw.lm().l(a=>{this.yw.M()&&this.yw.m(this.Rw(a()))},this),this.aw.am().l(a=>{this.Cw.M()&&this.Cw.m(this.Rw(a()))},this),this.aw.Xc().l(a=>{this.Tw.M()&&this.Tw.m(this.Rw(a()))},this);const h=this.aw.$t();this.Dw=new G1(h,this.aw.fb(),this.q_)}remove(){this.aw.lm().p(this),this.aw.am().p(this),this.aw.Xc().p(this),this.Dw.S(),this.aw.S(),this.Sw.clear(),this.kw.clear(),this.yw.S(),this.Cw.S(),this.Tw.S(),this.Pw.S()}resize(t,e,s){this.autoSizeActive()||this.aw._b(t,e,s)}addCustomSeries(t,e){const s=Oi(t),r=Object.assign(Object.assign({},oc),s.defaultOptions());return this.Vw("Custom",r,e,s)}addAreaSeries(t){return this.Vw("Area",Rb,t)}addBaselineSeries(t){return this.Vw("Baseline",Ob,t)}addBarSeries(t){return this.Vw("Bar",Tb,t)}addCandlestickSeries(t={}){return function(e){e.borderColor!==void 0&&(e.borderUpColor=e.borderColor,e.borderDownColor=e.borderColor),e.wickColor!==void 0&&(e.wickUpColor=e.wickColor,e.wickDownColor=e.wickColor)}(t),this.Vw("Candlestick",zb,t)}addHistogramSeries(t){return this.Vw("Histogram",Ab,t)}addLineSeries(t){return this.Vw("Line",kb,t)}removeSeries(t){const e=Vt(this.Sw.get(t)),s=this.Pw.vd(e);this.aw.$t().vd(e),this.Ow(s),this.Sw.delete(t),this.kw.delete(e)}pw(t,e){this.Ow(this.Pw.Kb(t,e))}bw(t,e){this.Ow(this.Pw.iw(t,e))}subscribeClick(t){this.yw.l(t)}unsubscribeClick(t){this.yw.v(t)}subscribeCrosshairMove(t){this.Tw.l(t)}unsubscribeCrosshairMove(t){this.Tw.v(t)}subscribeDblClick(t){this.Cw.l(t)}unsubscribeDblClick(t){this.Cw.v(t)}priceScale(t){return new H1(this.aw,t)}timeScale(){return this.Dw}applyOptions(t){this.aw.$h(Wu(t))}options(){return this.aw.W()}takeScreenshot(){return this.aw.wb()}autoSizeActive(){return this.aw.kb()}chartElement(){return this.aw.yb()}paneSize(){const t=this.aw.Tb();return{height:t.height,width:t.width}}setCrosshairPosition(t,e,s){const r=this.Sw.get(s);if(r===void 0)return;const h=this.aw.$t().dr(r);h!==null&&this.aw.$t().ad(t,e,h)}clearCrosshairPosition(){this.aw.$t().od(!0)}Vw(t,e,s={},r){J1(s.priceFormat);const h=we(Ie(lc),Ie(e),s),a=this.aw.$t().dd(t,h,r),c=new X1(a,this,this,this,this.q_);return this.Sw.set(c,a),this.kw.set(a,c),c}Ow(t){const e=this.aw.$t();e._d(t.St.Eu,t.St.hw,t.St.lw),t.ew.forEach((s,r)=>r.J(s.$e,s.rw)),e.Wu()}Bw(t){return Vt(this.kw.get(t))}Rw(t){const e=new Map;t.Nb.forEach((r,h)=>{const a=h.Qh(),c=Ho(a)(r);if(a!=="Custom")ti(E1(c));else{const d=h.Ta();ti(!d||d(c)===!1)}e.set(this.Bw(h),c)});const s=t.Eb!==void 0&&this.kw.has(t.Eb)?this.Bw(t.Eb):void 0;return{time:t.zb,logical:t.ee,point:t.Lb,hoveredSeries:s,hoveredObjectId:t.Fb,seriesData:e,sourceEvent:t.Wb}}}function Y1(o,t,e){let s;if(Nn(o)){const h=document.getElementById(o);ti(h!==null,`Cannot find element in DOM with id=${o}`),s=h}else s=o;const r=new Q1(s,t,e);return t.setOptions(r.options()),r}function Z1(o,t){return Y1(o,new Nu,Nu.Id(t))}Object.assign(Object.assign({},lc),oc);var mn={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var t_=mn.exports,Fu;function e_(){return Fu||(Fu=1,function(o,t){(function(){var e,s="4.17.21",r=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",c="Invalid `variable` option passed into `_.template`",d="__lodash_hash_undefined__",m=500,p="__lodash_placeholder__",v=1,w=2,_=4,C=1,y=2,E=1,P=2,A=4,$=8,U=16,W=32,I=64,R=128,V=256,q=512,rt=30,X="...",tt=800,G=16,wt=1,Et=2,ne=3,Jt=1/0,kt=9007199254740991,Rt=17976931348623157e292,$t=NaN,at=4294967295,ei=at-1,Hs=at>>>1,Uc=[["ary",R],["bind",E],["bindKey",P],["curry",$],["curryRight",U],["flip",q],["partial",W],["partialRight",I],["rearg",V]],xi="[object Arguments]",Ln="[object Array]",Hc="[object AsyncFunction]",Vi="[object Boolean]",Ui="[object Date]",Kc="[object DOMException]",En="[object Error]",Pn="[object Function]",ul="[object GeneratorFunction]",me="[object Map]",Hi="[object Number]",qc="[object Null]",Le="[object Object]",cl="[object Promise]",Xc="[object Proxy]",Ki="[object RegExp]",ge="[object Set]",qi="[object String]",jn="[object Symbol]",Gc="[object Undefined]",Xi="[object WeakMap]",Jc="[object WeakSet]",Gi="[object ArrayBuffer]",bi="[object DataView]",Ks="[object Float32Array]",qs="[object Float64Array]",Xs="[object Int8Array]",Gs="[object Int16Array]",Js="[object Int32Array]",Qs="[object Uint8Array]",Ys="[object Uint8ClampedArray]",Zs="[object Uint16Array]",tr="[object Uint32Array]",Qc=/\b__p \+= '';/g,Yc=/\b(__p \+=) '' \+/g,Zc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,fl=/&(?:amp|lt|gt|quot|#39);/g,dl=/[&<>"']/g,tf=RegExp(fl.source),ef=RegExp(dl.source),nf=/<%-([\s\S]+?)%>/g,sf=/<%([\s\S]+?)%>/g,ml=/<%=([\s\S]+?)%>/g,rf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,of=/^\w*$/,lf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,er=/[\\^$.*+?()[\]{}|]/g,hf=RegExp(er.source),ir=/^\s+/,af=/\s/,uf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,cf=/\{\n\/\* \[wrapped with (.+)\] \*/,ff=/,? & /,df=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,mf=/[()=,{}\[\]\/\s]/,gf=/\\(\\)?/g,pf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gl=/\w*$/,vf=/^[-+]0x[0-9a-f]+$/i,xf=/^0b[01]+$/i,bf=/^\[object .+?Constructor\]$/,wf=/^0o[0-7]+$/i,_f=/^(?:0|[1-9]\d*)$/,yf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,zn=/($^)/,Sf=/['\n\r\u2028\u2029\\]/g,Tn="\\ud800-\\udfff",Cf="\\u0300-\\u036f",Nf="\\ufe20-\\ufe2f",Mf="\\u20d0-\\u20ff",pl=Cf+Nf+Mf,vl="\\u2700-\\u27bf",xl="a-z\\xdf-\\xf6\\xf8-\\xff",Lf="\\xac\\xb1\\xd7\\xf7",Ef="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Pf="\\u2000-\\u206f",jf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",bl="A-Z\\xc0-\\xd6\\xd8-\\xde",wl="\\ufe0e\\ufe0f",_l=Lf+Ef+Pf+jf,nr="['’]",zf="["+Tn+"]",yl="["+_l+"]",kn="["+pl+"]",Sl="\\d+",Tf="["+vl+"]",Cl="["+xl+"]",Nl="[^"+Tn+_l+Sl+vl+xl+bl+"]",sr="\\ud83c[\\udffb-\\udfff]",kf="(?:"+kn+"|"+sr+")",Ml="[^"+Tn+"]",rr="(?:\\ud83c[\\udde6-\\uddff]){2}",or="[\\ud800-\\udbff][\\udc00-\\udfff]",wi="["+bl+"]",Ll="\\u200d",El="(?:"+Cl+"|"+Nl+")",Rf="(?:"+wi+"|"+Nl+")",Pl="(?:"+nr+"(?:d|ll|m|re|s|t|ve))?",jl="(?:"+nr+"(?:D|LL|M|RE|S|T|VE))?",zl=kf+"?",Tl="["+wl+"]?",Of="(?:"+Ll+"(?:"+[Ml,rr,or].join("|")+")"+Tl+zl+")*",Af="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Df="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",kl=Tl+zl+Of,$f="(?:"+[Tf,rr,or].join("|")+")"+kl,If="(?:"+[Ml+kn+"?",kn,rr,or,zf].join("|")+")",Wf=RegExp(nr,"g"),Ff=RegExp(kn,"g"),lr=RegExp(sr+"(?="+sr+")|"+If+kl,"g"),Bf=RegExp([wi+"?"+Cl+"+"+Pl+"(?="+[yl,wi,"$"].join("|")+")",Rf+"+"+jl+"(?="+[yl,wi+El,"$"].join("|")+")",wi+"?"+El+"+"+Pl,wi+"+"+jl,Df,Af,Sl,$f].join("|"),"g"),Vf=RegExp("["+Ll+Tn+pl+wl+"]"),Uf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Hf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Kf=-1,pt={};pt[Ks]=pt[qs]=pt[Xs]=pt[Gs]=pt[Js]=pt[Qs]=pt[Ys]=pt[Zs]=pt[tr]=!0,pt[xi]=pt[Ln]=pt[Gi]=pt[Vi]=pt[bi]=pt[Ui]=pt[En]=pt[Pn]=pt[me]=pt[Hi]=pt[Le]=pt[Ki]=pt[ge]=pt[qi]=pt[Xi]=!1;var gt={};gt[xi]=gt[Ln]=gt[Gi]=gt[bi]=gt[Vi]=gt[Ui]=gt[Ks]=gt[qs]=gt[Xs]=gt[Gs]=gt[Js]=gt[me]=gt[Hi]=gt[Le]=gt[Ki]=gt[ge]=gt[qi]=gt[jn]=gt[Qs]=gt[Ys]=gt[Zs]=gt[tr]=!0,gt[En]=gt[Pn]=gt[Xi]=!1;var qf={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Xf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Gf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Jf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Qf=parseFloat,Yf=parseInt,Rl=typeof bs=="object"&&bs&&bs.Object===Object&&bs,Zf=typeof self=="object"&&self&&self.Object===Object&&self,jt=Rl||Zf||Function("return this")(),hr=t&&!t.nodeType&&t,ii=hr&&!0&&o&&!o.nodeType&&o,Ol=ii&&ii.exports===hr,ar=Ol&&Rl.process,se=function(){try{var M=ii&&ii.require&&ii.require("util").types;return M||ar&&ar.binding&&ar.binding("util")}catch{}}(),Al=se&&se.isArrayBuffer,Dl=se&&se.isDate,$l=se&&se.isMap,Il=se&&se.isRegExp,Wl=se&&se.isSet,Fl=se&&se.isTypedArray;function Qt(M,z,j){switch(j.length){case 0:return M.call(z);case 1:return M.call(z,j[0]);case 2:return M.call(z,j[0],j[1]);case 3:return M.call(z,j[0],j[1],j[2])}return M.apply(z,j)}function td(M,z,j,H){for(var Z=-1,ut=M==null?0:M.length;++Z<ut;){var Nt=M[Z];z(H,Nt,j(Nt),M)}return H}function re(M,z){for(var j=-1,H=M==null?0:M.length;++j<H&&z(M[j],j,M)!==!1;);return M}function ed(M,z){for(var j=M==null?0:M.length;j--&&z(M[j],j,M)!==!1;);return M}function Bl(M,z){for(var j=-1,H=M==null?0:M.length;++j<H;)if(!z(M[j],j,M))return!1;return!0}function Ue(M,z){for(var j=-1,H=M==null?0:M.length,Z=0,ut=[];++j<H;){var Nt=M[j];z(Nt,j,M)&&(ut[Z++]=Nt)}return ut}function Rn(M,z){var j=M==null?0:M.length;return!!j&&_i(M,z,0)>-1}function ur(M,z,j){for(var H=-1,Z=M==null?0:M.length;++H<Z;)if(j(z,M[H]))return!0;return!1}function xt(M,z){for(var j=-1,H=M==null?0:M.length,Z=Array(H);++j<H;)Z[j]=z(M[j],j,M);return Z}function He(M,z){for(var j=-1,H=z.length,Z=M.length;++j<H;)M[Z+j]=z[j];return M}function cr(M,z,j,H){var Z=-1,ut=M==null?0:M.length;for(H&&ut&&(j=M[++Z]);++Z<ut;)j=z(j,M[Z],Z,M);return j}function id(M,z,j,H){var Z=M==null?0:M.length;for(H&&Z&&(j=M[--Z]);Z--;)j=z(j,M[Z],Z,M);return j}function fr(M,z){for(var j=-1,H=M==null?0:M.length;++j<H;)if(z(M[j],j,M))return!0;return!1}var nd=dr("length");function sd(M){return M.split("")}function rd(M){return M.match(df)||[]}function Vl(M,z,j){var H;return j(M,function(Z,ut,Nt){if(z(Z,ut,Nt))return H=ut,!1}),H}function On(M,z,j,H){for(var Z=M.length,ut=j+(H?1:-1);H?ut--:++ut<Z;)if(z(M[ut],ut,M))return ut;return-1}function _i(M,z,j){return z===z?vd(M,z,j):On(M,Ul,j)}function od(M,z,j,H){for(var Z=j-1,ut=M.length;++Z<ut;)if(H(M[Z],z))return Z;return-1}function Ul(M){return M!==M}function Hl(M,z){var j=M==null?0:M.length;return j?gr(M,z)/j:$t}function dr(M){return function(z){return z==null?e:z[M]}}function mr(M){return function(z){return M==null?e:M[z]}}function Kl(M,z,j,H,Z){return Z(M,function(ut,Nt,mt){j=H?(H=!1,ut):z(j,ut,Nt,mt)}),j}function ld(M,z){var j=M.length;for(M.sort(z);j--;)M[j]=M[j].value;return M}function gr(M,z){for(var j,H=-1,Z=M.length;++H<Z;){var ut=z(M[H]);ut!==e&&(j=j===e?ut:j+ut)}return j}function pr(M,z){for(var j=-1,H=Array(M);++j<M;)H[j]=z(j);return H}function hd(M,z){return xt(z,function(j){return[j,M[j]]})}function ql(M){return M&&M.slice(0,Ql(M)+1).replace(ir,"")}function Yt(M){return function(z){return M(z)}}function vr(M,z){return xt(z,function(j){return M[j]})}function Ji(M,z){return M.has(z)}function Xl(M,z){for(var j=-1,H=M.length;++j<H&&_i(z,M[j],0)>-1;);return j}function Gl(M,z){for(var j=M.length;j--&&_i(z,M[j],0)>-1;);return j}function ad(M,z){for(var j=M.length,H=0;j--;)M[j]===z&&++H;return H}var ud=mr(qf),cd=mr(Xf);function fd(M){return"\\"+Jf[M]}function dd(M,z){return M==null?e:M[z]}function yi(M){return Vf.test(M)}function md(M){return Uf.test(M)}function gd(M){for(var z,j=[];!(z=M.next()).done;)j.push(z.value);return j}function xr(M){var z=-1,j=Array(M.size);return M.forEach(function(H,Z){j[++z]=[Z,H]}),j}function Jl(M,z){return function(j){return M(z(j))}}function Ke(M,z){for(var j=-1,H=M.length,Z=0,ut=[];++j<H;){var Nt=M[j];(Nt===z||Nt===p)&&(M[j]=p,ut[Z++]=j)}return ut}function An(M){var z=-1,j=Array(M.size);return M.forEach(function(H){j[++z]=H}),j}function pd(M){var z=-1,j=Array(M.size);return M.forEach(function(H){j[++z]=[H,H]}),j}function vd(M,z,j){for(var H=j-1,Z=M.length;++H<Z;)if(M[H]===z)return H;return-1}function xd(M,z,j){for(var H=j+1;H--;)if(M[H]===z)return H;return H}function Si(M){return yi(M)?wd(M):nd(M)}function pe(M){return yi(M)?_d(M):sd(M)}function Ql(M){for(var z=M.length;z--&&af.test(M.charAt(z)););return z}var bd=mr(Gf);function wd(M){for(var z=lr.lastIndex=0;lr.test(M);)++z;return z}function _d(M){return M.match(lr)||[]}function yd(M){return M.match(Bf)||[]}var Sd=function M(z){z=z==null?jt:Ci.defaults(jt.Object(),z,Ci.pick(jt,Hf));var j=z.Array,H=z.Date,Z=z.Error,ut=z.Function,Nt=z.Math,mt=z.Object,br=z.RegExp,Cd=z.String,oe=z.TypeError,Dn=j.prototype,Nd=ut.prototype,Ni=mt.prototype,$n=z["__core-js_shared__"],In=Nd.toString,ft=Ni.hasOwnProperty,Md=0,Yl=function(){var i=/[^.]+$/.exec($n&&$n.keys&&$n.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Wn=Ni.toString,Ld=In.call(mt),Ed=jt._,Pd=br("^"+In.call(ft).replace(er,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fn=Ol?z.Buffer:e,qe=z.Symbol,Bn=z.Uint8Array,Zl=Fn?Fn.allocUnsafe:e,Vn=Jl(mt.getPrototypeOf,mt),th=mt.create,eh=Ni.propertyIsEnumerable,Un=Dn.splice,ih=qe?qe.isConcatSpreadable:e,Qi=qe?qe.iterator:e,ni=qe?qe.toStringTag:e,Hn=function(){try{var i=hi(mt,"defineProperty");return i({},"",{}),i}catch{}}(),jd=z.clearTimeout!==jt.clearTimeout&&z.clearTimeout,zd=H&&H.now!==jt.Date.now&&H.now,Td=z.setTimeout!==jt.setTimeout&&z.setTimeout,Kn=Nt.ceil,qn=Nt.floor,wr=mt.getOwnPropertySymbols,kd=Fn?Fn.isBuffer:e,nh=z.isFinite,Rd=Dn.join,Od=Jl(mt.keys,mt),Mt=Nt.max,Ot=Nt.min,Ad=H.now,Dd=z.parseInt,sh=Nt.random,$d=Dn.reverse,_r=hi(z,"DataView"),Yi=hi(z,"Map"),yr=hi(z,"Promise"),Mi=hi(z,"Set"),Zi=hi(z,"WeakMap"),tn=hi(mt,"create"),Xn=Zi&&new Zi,Li={},Id=ai(_r),Wd=ai(Yi),Fd=ai(yr),Bd=ai(Mi),Vd=ai(Zi),Gn=qe?qe.prototype:e,en=Gn?Gn.valueOf:e,rh=Gn?Gn.toString:e;function x(i){if(_t(i)&&!et(i)&&!(i instanceof lt)){if(i instanceof le)return i;if(ft.call(i,"__wrapped__"))return oa(i)}return new le(i)}var Ei=function(){function i(){}return function(n){if(!bt(n))return{};if(th)return th(n);i.prototype=n;var l=new i;return i.prototype=e,l}}();function Jn(){}function le(i,n){this.__wrapped__=i,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=e}x.templateSettings={escape:nf,evaluate:sf,interpolate:ml,variable:"",imports:{_:x}},x.prototype=Jn.prototype,x.prototype.constructor=x,le.prototype=Ei(Jn.prototype),le.prototype.constructor=le;function lt(i){this.__wrapped__=i,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=at,this.__views__=[]}function Ud(){var i=new lt(this.__wrapped__);return i.__actions__=Ut(this.__actions__),i.__dir__=this.__dir__,i.__filtered__=this.__filtered__,i.__iteratees__=Ut(this.__iteratees__),i.__takeCount__=this.__takeCount__,i.__views__=Ut(this.__views__),i}function Hd(){if(this.__filtered__){var i=new lt(this);i.__dir__=-1,i.__filtered__=!0}else i=this.clone(),i.__dir__*=-1;return i}function Kd(){var i=this.__wrapped__.value(),n=this.__dir__,l=et(i),u=n<0,g=l?i.length:0,b=sg(0,g,this.__views__),S=b.start,N=b.end,L=N-S,T=u?N:S-1,k=this.__iteratees__,O=k.length,F=0,K=Ot(L,this.__takeCount__);if(!l||!u&&g==L&&K==L)return Ph(i,this.__actions__);var Q=[];t:for(;L--&&F<K;){T+=n;for(var nt=-1,Y=i[T];++nt<O;){var ot=k[nt],ht=ot.iteratee,ee=ot.type,Ft=ht(Y);if(ee==Et)Y=Ft;else if(!Ft){if(ee==wt)continue t;break t}}Q[F++]=Y}return Q}lt.prototype=Ei(Jn.prototype),lt.prototype.constructor=lt;function si(i){var n=-1,l=i==null?0:i.length;for(this.clear();++n<l;){var u=i[n];this.set(u[0],u[1])}}function qd(){this.__data__=tn?tn(null):{},this.size=0}function Xd(i){var n=this.has(i)&&delete this.__data__[i];return this.size-=n?1:0,n}function Gd(i){var n=this.__data__;if(tn){var l=n[i];return l===d?e:l}return ft.call(n,i)?n[i]:e}function Jd(i){var n=this.__data__;return tn?n[i]!==e:ft.call(n,i)}function Qd(i,n){var l=this.__data__;return this.size+=this.has(i)?0:1,l[i]=tn&&n===e?d:n,this}si.prototype.clear=qd,si.prototype.delete=Xd,si.prototype.get=Gd,si.prototype.has=Jd,si.prototype.set=Qd;function Ee(i){var n=-1,l=i==null?0:i.length;for(this.clear();++n<l;){var u=i[n];this.set(u[0],u[1])}}function Yd(){this.__data__=[],this.size=0}function Zd(i){var n=this.__data__,l=Qn(n,i);if(l<0)return!1;var u=n.length-1;return l==u?n.pop():Un.call(n,l,1),--this.size,!0}function tm(i){var n=this.__data__,l=Qn(n,i);return l<0?e:n[l][1]}function em(i){return Qn(this.__data__,i)>-1}function im(i,n){var l=this.__data__,u=Qn(l,i);return u<0?(++this.size,l.push([i,n])):l[u][1]=n,this}Ee.prototype.clear=Yd,Ee.prototype.delete=Zd,Ee.prototype.get=tm,Ee.prototype.has=em,Ee.prototype.set=im;function Pe(i){var n=-1,l=i==null?0:i.length;for(this.clear();++n<l;){var u=i[n];this.set(u[0],u[1])}}function nm(){this.size=0,this.__data__={hash:new si,map:new(Yi||Ee),string:new si}}function sm(i){var n=as(this,i).delete(i);return this.size-=n?1:0,n}function rm(i){return as(this,i).get(i)}function om(i){return as(this,i).has(i)}function lm(i,n){var l=as(this,i),u=l.size;return l.set(i,n),this.size+=l.size==u?0:1,this}Pe.prototype.clear=nm,Pe.prototype.delete=sm,Pe.prototype.get=rm,Pe.prototype.has=om,Pe.prototype.set=lm;function ri(i){var n=-1,l=i==null?0:i.length;for(this.__data__=new Pe;++n<l;)this.add(i[n])}function hm(i){return this.__data__.set(i,d),this}function am(i){return this.__data__.has(i)}ri.prototype.add=ri.prototype.push=hm,ri.prototype.has=am;function ve(i){var n=this.__data__=new Ee(i);this.size=n.size}function um(){this.__data__=new Ee,this.size=0}function cm(i){var n=this.__data__,l=n.delete(i);return this.size=n.size,l}function fm(i){return this.__data__.get(i)}function dm(i){return this.__data__.has(i)}function mm(i,n){var l=this.__data__;if(l instanceof Ee){var u=l.__data__;if(!Yi||u.length<r-1)return u.push([i,n]),this.size=++l.size,this;l=this.__data__=new Pe(u)}return l.set(i,n),this.size=l.size,this}ve.prototype.clear=um,ve.prototype.delete=cm,ve.prototype.get=fm,ve.prototype.has=dm,ve.prototype.set=mm;function oh(i,n){var l=et(i),u=!l&&ui(i),g=!l&&!u&&Ye(i),b=!l&&!u&&!g&&Ti(i),S=l||u||g||b,N=S?pr(i.length,Cd):[],L=N.length;for(var T in i)(n||ft.call(i,T))&&!(S&&(T=="length"||g&&(T=="offset"||T=="parent")||b&&(T=="buffer"||T=="byteLength"||T=="byteOffset")||ke(T,L)))&&N.push(T);return N}function lh(i){var n=i.length;return n?i[kr(0,n-1)]:e}function gm(i,n){return us(Ut(i),oi(n,0,i.length))}function pm(i){return us(Ut(i))}function Sr(i,n,l){(l!==e&&!xe(i[n],l)||l===e&&!(n in i))&&je(i,n,l)}function nn(i,n,l){var u=i[n];(!(ft.call(i,n)&&xe(u,l))||l===e&&!(n in i))&&je(i,n,l)}function Qn(i,n){for(var l=i.length;l--;)if(xe(i[l][0],n))return l;return-1}function vm(i,n,l,u){return Xe(i,function(g,b,S){n(u,g,l(g),S)}),u}function hh(i,n){return i&&Se(n,Pt(n),i)}function xm(i,n){return i&&Se(n,Kt(n),i)}function je(i,n,l){n=="__proto__"&&Hn?Hn(i,n,{configurable:!0,enumerable:!0,value:l,writable:!0}):i[n]=l}function Cr(i,n){for(var l=-1,u=n.length,g=j(u),b=i==null;++l<u;)g[l]=b?e:so(i,n[l]);return g}function oi(i,n,l){return i===i&&(l!==e&&(i=i<=l?i:l),n!==e&&(i=i>=n?i:n)),i}function he(i,n,l,u,g,b){var S,N=n&v,L=n&w,T=n&_;if(l&&(S=g?l(i,u,g,b):l(i)),S!==e)return S;if(!bt(i))return i;var k=et(i);if(k){if(S=og(i),!N)return Ut(i,S)}else{var O=At(i),F=O==Pn||O==ul;if(Ye(i))return Th(i,N);if(O==Le||O==xi||F&&!g){if(S=L||F?{}:Qh(i),!N)return L?Gm(i,xm(S,i)):Xm(i,hh(S,i))}else{if(!gt[O])return g?i:{};S=lg(i,O,N)}}b||(b=new ve);var K=b.get(i);if(K)return K;b.set(i,S),Ma(i)?i.forEach(function(Y){S.add(he(Y,n,l,Y,i,b))}):Ca(i)&&i.forEach(function(Y,ot){S.set(ot,he(Y,n,l,ot,i,b))});var Q=T?L?Ur:Vr:L?Kt:Pt,nt=k?e:Q(i);return re(nt||i,function(Y,ot){nt&&(ot=Y,Y=i[ot]),nn(S,ot,he(Y,n,l,ot,i,b))}),S}function bm(i){var n=Pt(i);return function(l){return ah(l,i,n)}}function ah(i,n,l){var u=l.length;if(i==null)return!u;for(i=mt(i);u--;){var g=l[u],b=n[g],S=i[g];if(S===e&&!(g in i)||!b(S))return!1}return!0}function uh(i,n,l){if(typeof i!="function")throw new oe(a);return un(function(){i.apply(e,l)},n)}function sn(i,n,l,u){var g=-1,b=Rn,S=!0,N=i.length,L=[],T=n.length;if(!N)return L;l&&(n=xt(n,Yt(l))),u?(b=ur,S=!1):n.length>=r&&(b=Ji,S=!1,n=new ri(n));t:for(;++g<N;){var k=i[g],O=l==null?k:l(k);if(k=u||k!==0?k:0,S&&O===O){for(var F=T;F--;)if(n[F]===O)continue t;L.push(k)}else b(n,O,u)||L.push(k)}return L}var Xe=Dh(ye),ch=Dh(Mr,!0);function wm(i,n){var l=!0;return Xe(i,function(u,g,b){return l=!!n(u,g,b),l}),l}function Yn(i,n,l){for(var u=-1,g=i.length;++u<g;){var b=i[u],S=n(b);if(S!=null&&(N===e?S===S&&!te(S):l(S,N)))var N=S,L=b}return L}function _m(i,n,l,u){var g=i.length;for(l=it(l),l<0&&(l=-l>g?0:g+l),u=u===e||u>g?g:it(u),u<0&&(u+=g),u=l>u?0:Ea(u);l<u;)i[l++]=n;return i}function fh(i,n){var l=[];return Xe(i,function(u,g,b){n(u,g,b)&&l.push(u)}),l}function zt(i,n,l,u,g){var b=-1,S=i.length;for(l||(l=ag),g||(g=[]);++b<S;){var N=i[b];n>0&&l(N)?n>1?zt(N,n-1,l,u,g):He(g,N):u||(g[g.length]=N)}return g}var Nr=$h(),dh=$h(!0);function ye(i,n){return i&&Nr(i,n,Pt)}function Mr(i,n){return i&&dh(i,n,Pt)}function Zn(i,n){return Ue(n,function(l){return Re(i[l])})}function li(i,n){n=Je(n,i);for(var l=0,u=n.length;i!=null&&l<u;)i=i[Ce(n[l++])];return l&&l==u?i:e}function mh(i,n,l){var u=n(i);return et(i)?u:He(u,l(i))}function It(i){return i==null?i===e?Gc:qc:ni&&ni in mt(i)?ng(i):pg(i)}function Lr(i,n){return i>n}function ym(i,n){return i!=null&&ft.call(i,n)}function Sm(i,n){return i!=null&&n in mt(i)}function Cm(i,n,l){return i>=Ot(n,l)&&i<Mt(n,l)}function Er(i,n,l){for(var u=l?ur:Rn,g=i[0].length,b=i.length,S=b,N=j(b),L=1/0,T=[];S--;){var k=i[S];S&&n&&(k=xt(k,Yt(n))),L=Ot(k.length,L),N[S]=!l&&(n||g>=120&&k.length>=120)?new ri(S&&k):e}k=i[0];var O=-1,F=N[0];t:for(;++O<g&&T.length<L;){var K=k[O],Q=n?n(K):K;if(K=l||K!==0?K:0,!(F?Ji(F,Q):u(T,Q,l))){for(S=b;--S;){var nt=N[S];if(!(nt?Ji(nt,Q):u(i[S],Q,l)))continue t}F&&F.push(Q),T.push(K)}}return T}function Nm(i,n,l,u){return ye(i,function(g,b,S){n(u,l(g),b,S)}),u}function rn(i,n,l){n=Je(n,i),i=ea(i,n);var u=i==null?i:i[Ce(ue(n))];return u==null?e:Qt(u,i,l)}function gh(i){return _t(i)&&It(i)==xi}function Mm(i){return _t(i)&&It(i)==Gi}function Lm(i){return _t(i)&&It(i)==Ui}function on(i,n,l,u,g){return i===n?!0:i==null||n==null||!_t(i)&&!_t(n)?i!==i&&n!==n:Em(i,n,l,u,on,g)}function Em(i,n,l,u,g,b){var S=et(i),N=et(n),L=S?Ln:At(i),T=N?Ln:At(n);L=L==xi?Le:L,T=T==xi?Le:T;var k=L==Le,O=T==Le,F=L==T;if(F&&Ye(i)){if(!Ye(n))return!1;S=!0,k=!1}if(F&&!k)return b||(b=new ve),S||Ti(i)?Xh(i,n,l,u,g,b):eg(i,n,L,l,u,g,b);if(!(l&C)){var K=k&&ft.call(i,"__wrapped__"),Q=O&&ft.call(n,"__wrapped__");if(K||Q){var nt=K?i.value():i,Y=Q?n.value():n;return b||(b=new ve),g(nt,Y,l,u,b)}}return F?(b||(b=new ve),ig(i,n,l,u,g,b)):!1}function Pm(i){return _t(i)&&At(i)==me}function Pr(i,n,l,u){var g=l.length,b=g,S=!u;if(i==null)return!b;for(i=mt(i);g--;){var N=l[g];if(S&&N[2]?N[1]!==i[N[0]]:!(N[0]in i))return!1}for(;++g<b;){N=l[g];var L=N[0],T=i[L],k=N[1];if(S&&N[2]){if(T===e&&!(L in i))return!1}else{var O=new ve;if(u)var F=u(T,k,L,i,n,O);if(!(F===e?on(k,T,C|y,u,O):F))return!1}}return!0}function ph(i){if(!bt(i)||cg(i))return!1;var n=Re(i)?Pd:bf;return n.test(ai(i))}function jm(i){return _t(i)&&It(i)==Ki}function zm(i){return _t(i)&&At(i)==ge}function Tm(i){return _t(i)&&ps(i.length)&&!!pt[It(i)]}function vh(i){return typeof i=="function"?i:i==null?qt:typeof i=="object"?et(i)?wh(i[0],i[1]):bh(i):Ia(i)}function jr(i){if(!an(i))return Od(i);var n=[];for(var l in mt(i))ft.call(i,l)&&l!="constructor"&&n.push(l);return n}function km(i){if(!bt(i))return gg(i);var n=an(i),l=[];for(var u in i)u=="constructor"&&(n||!ft.call(i,u))||l.push(u);return l}function zr(i,n){return i<n}function xh(i,n){var l=-1,u=Ht(i)?j(i.length):[];return Xe(i,function(g,b,S){u[++l]=n(g,b,S)}),u}function bh(i){var n=Kr(i);return n.length==1&&n[0][2]?Zh(n[0][0],n[0][1]):function(l){return l===i||Pr(l,i,n)}}function wh(i,n){return Xr(i)&&Yh(n)?Zh(Ce(i),n):function(l){var u=so(l,i);return u===e&&u===n?ro(l,i):on(n,u,C|y)}}function ts(i,n,l,u,g){i!==n&&Nr(n,function(b,S){if(g||(g=new ve),bt(b))Rm(i,n,S,l,ts,u,g);else{var N=u?u(Jr(i,S),b,S+"",i,n,g):e;N===e&&(N=b),Sr(i,S,N)}},Kt)}function Rm(i,n,l,u,g,b,S){var N=Jr(i,l),L=Jr(n,l),T=S.get(L);if(T){Sr(i,l,T);return}var k=b?b(N,L,l+"",i,n,S):e,O=k===e;if(O){var F=et(L),K=!F&&Ye(L),Q=!F&&!K&&Ti(L);k=L,F||K||Q?et(N)?k=N:yt(N)?k=Ut(N):K?(O=!1,k=Th(L,!0)):Q?(O=!1,k=kh(L,!0)):k=[]:cn(L)||ui(L)?(k=N,ui(N)?k=Pa(N):(!bt(N)||Re(N))&&(k=Qh(L))):O=!1}O&&(S.set(L,k),g(k,L,u,b,S),S.delete(L)),Sr(i,l,k)}function _h(i,n){var l=i.length;if(l)return n+=n<0?l:0,ke(n,l)?i[n]:e}function yh(i,n,l){n.length?n=xt(n,function(b){return et(b)?function(S){return li(S,b.length===1?b[0]:b)}:b}):n=[qt];var u=-1;n=xt(n,Yt(J()));var g=xh(i,function(b,S,N){var L=xt(n,function(T){return T(b)});return{criteria:L,index:++u,value:b}});return ld(g,function(b,S){return qm(b,S,l)})}function Om(i,n){return Sh(i,n,function(l,u){return ro(i,u)})}function Sh(i,n,l){for(var u=-1,g=n.length,b={};++u<g;){var S=n[u],N=li(i,S);l(N,S)&&ln(b,Je(S,i),N)}return b}function Am(i){return function(n){return li(n,i)}}function Tr(i,n,l,u){var g=u?od:_i,b=-1,S=n.length,N=i;for(i===n&&(n=Ut(n)),l&&(N=xt(i,Yt(l)));++b<S;)for(var L=0,T=n[b],k=l?l(T):T;(L=g(N,k,L,u))>-1;)N!==i&&Un.call(N,L,1),Un.call(i,L,1);return i}function Ch(i,n){for(var l=i?n.length:0,u=l-1;l--;){var g=n[l];if(l==u||g!==b){var b=g;ke(g)?Un.call(i,g,1):Ar(i,g)}}return i}function kr(i,n){return i+qn(sh()*(n-i+1))}function Dm(i,n,l,u){for(var g=-1,b=Mt(Kn((n-i)/(l||1)),0),S=j(b);b--;)S[u?b:++g]=i,i+=l;return S}function Rr(i,n){var l="";if(!i||n<1||n>kt)return l;do n%2&&(l+=i),n=qn(n/2),n&&(i+=i);while(n);return l}function st(i,n){return Qr(ta(i,n,qt),i+"")}function $m(i){return lh(ki(i))}function Im(i,n){var l=ki(i);return us(l,oi(n,0,l.length))}function ln(i,n,l,u){if(!bt(i))return i;n=Je(n,i);for(var g=-1,b=n.length,S=b-1,N=i;N!=null&&++g<b;){var L=Ce(n[g]),T=l;if(L==="__proto__"||L==="constructor"||L==="prototype")return i;if(g!=S){var k=N[L];T=u?u(k,L,N):e,T===e&&(T=bt(k)?k:ke(n[g+1])?[]:{})}nn(N,L,T),N=N[L]}return i}var Nh=Xn?function(i,n){return Xn.set(i,n),i}:qt,Wm=Hn?function(i,n){return Hn(i,"toString",{configurable:!0,enumerable:!1,value:lo(n),writable:!0})}:qt;function Fm(i){return us(ki(i))}function ae(i,n,l){var u=-1,g=i.length;n<0&&(n=-n>g?0:g+n),l=l>g?g:l,l<0&&(l+=g),g=n>l?0:l-n>>>0,n>>>=0;for(var b=j(g);++u<g;)b[u]=i[u+n];return b}function Bm(i,n){var l;return Xe(i,function(u,g,b){return l=n(u,g,b),!l}),!!l}function es(i,n,l){var u=0,g=i==null?u:i.length;if(typeof n=="number"&&n===n&&g<=Hs){for(;u<g;){var b=u+g>>>1,S=i[b];S!==null&&!te(S)&&(l?S<=n:S<n)?u=b+1:g=b}return g}return Or(i,n,qt,l)}function Or(i,n,l,u){var g=0,b=i==null?0:i.length;if(b===0)return 0;n=l(n);for(var S=n!==n,N=n===null,L=te(n),T=n===e;g<b;){var k=qn((g+b)/2),O=l(i[k]),F=O!==e,K=O===null,Q=O===O,nt=te(O);if(S)var Y=u||Q;else T?Y=Q&&(u||F):N?Y=Q&&F&&(u||!K):L?Y=Q&&F&&!K&&(u||!nt):K||nt?Y=!1:Y=u?O<=n:O<n;Y?g=k+1:b=k}return Ot(b,ei)}function Mh(i,n){for(var l=-1,u=i.length,g=0,b=[];++l<u;){var S=i[l],N=n?n(S):S;if(!l||!xe(N,L)){var L=N;b[g++]=S===0?0:S}}return b}function Lh(i){return typeof i=="number"?i:te(i)?$t:+i}function Zt(i){if(typeof i=="string")return i;if(et(i))return xt(i,Zt)+"";if(te(i))return rh?rh.call(i):"";var n=i+"";return n=="0"&&1/i==-1/0?"-0":n}function Ge(i,n,l){var u=-1,g=Rn,b=i.length,S=!0,N=[],L=N;if(l)S=!1,g=ur;else if(b>=r){var T=n?null:Zm(i);if(T)return An(T);S=!1,g=Ji,L=new ri}else L=n?[]:N;t:for(;++u<b;){var k=i[u],O=n?n(k):k;if(k=l||k!==0?k:0,S&&O===O){for(var F=L.length;F--;)if(L[F]===O)continue t;n&&L.push(O),N.push(k)}else g(L,O,l)||(L!==N&&L.push(O),N.push(k))}return N}function Ar(i,n){return n=Je(n,i),i=ea(i,n),i==null||delete i[Ce(ue(n))]}function Eh(i,n,l,u){return ln(i,n,l(li(i,n)),u)}function is(i,n,l,u){for(var g=i.length,b=u?g:-1;(u?b--:++b<g)&&n(i[b],b,i););return l?ae(i,u?0:b,u?b+1:g):ae(i,u?b+1:0,u?g:b)}function Ph(i,n){var l=i;return l instanceof lt&&(l=l.value()),cr(n,function(u,g){return g.func.apply(g.thisArg,He([u],g.args))},l)}function Dr(i,n,l){var u=i.length;if(u<2)return u?Ge(i[0]):[];for(var g=-1,b=j(u);++g<u;)for(var S=i[g],N=-1;++N<u;)N!=g&&(b[g]=sn(b[g]||S,i[N],n,l));return Ge(zt(b,1),n,l)}function jh(i,n,l){for(var u=-1,g=i.length,b=n.length,S={};++u<g;){var N=u<b?n[u]:e;l(S,i[u],N)}return S}function $r(i){return yt(i)?i:[]}function Ir(i){return typeof i=="function"?i:qt}function Je(i,n){return et(i)?i:Xr(i,n)?[i]:ra(ct(i))}var Vm=st;function Qe(i,n,l){var u=i.length;return l=l===e?u:l,!n&&l>=u?i:ae(i,n,l)}var zh=jd||function(i){return jt.clearTimeout(i)};function Th(i,n){if(n)return i.slice();var l=i.length,u=Zl?Zl(l):new i.constructor(l);return i.copy(u),u}function Wr(i){var n=new i.constructor(i.byteLength);return new Bn(n).set(new Bn(i)),n}function Um(i,n){var l=n?Wr(i.buffer):i.buffer;return new i.constructor(l,i.byteOffset,i.byteLength)}function Hm(i){var n=new i.constructor(i.source,gl.exec(i));return n.lastIndex=i.lastIndex,n}function Km(i){return en?mt(en.call(i)):{}}function kh(i,n){var l=n?Wr(i.buffer):i.buffer;return new i.constructor(l,i.byteOffset,i.length)}function Rh(i,n){if(i!==n){var l=i!==e,u=i===null,g=i===i,b=te(i),S=n!==e,N=n===null,L=n===n,T=te(n);if(!N&&!T&&!b&&i>n||b&&S&&L&&!N&&!T||u&&S&&L||!l&&L||!g)return 1;if(!u&&!b&&!T&&i<n||T&&l&&g&&!u&&!b||N&&l&&g||!S&&g||!L)return-1}return 0}function qm(i,n,l){for(var u=-1,g=i.criteria,b=n.criteria,S=g.length,N=l.length;++u<S;){var L=Rh(g[u],b[u]);if(L){if(u>=N)return L;var T=l[u];return L*(T=="desc"?-1:1)}}return i.index-n.index}function Oh(i,n,l,u){for(var g=-1,b=i.length,S=l.length,N=-1,L=n.length,T=Mt(b-S,0),k=j(L+T),O=!u;++N<L;)k[N]=n[N];for(;++g<S;)(O||g<b)&&(k[l[g]]=i[g]);for(;T--;)k[N++]=i[g++];return k}function Ah(i,n,l,u){for(var g=-1,b=i.length,S=-1,N=l.length,L=-1,T=n.length,k=Mt(b-N,0),O=j(k+T),F=!u;++g<k;)O[g]=i[g];for(var K=g;++L<T;)O[K+L]=n[L];for(;++S<N;)(F||g<b)&&(O[K+l[S]]=i[g++]);return O}function Ut(i,n){var l=-1,u=i.length;for(n||(n=j(u));++l<u;)n[l]=i[l];return n}function Se(i,n,l,u){var g=!l;l||(l={});for(var b=-1,S=n.length;++b<S;){var N=n[b],L=u?u(l[N],i[N],N,l,i):e;L===e&&(L=i[N]),g?je(l,N,L):nn(l,N,L)}return l}function Xm(i,n){return Se(i,qr(i),n)}function Gm(i,n){return Se(i,Gh(i),n)}function ns(i,n){return function(l,u){var g=et(l)?td:vm,b=n?n():{};return g(l,i,J(u,2),b)}}function Pi(i){return st(function(n,l){var u=-1,g=l.length,b=g>1?l[g-1]:e,S=g>2?l[2]:e;for(b=i.length>3&&typeof b=="function"?(g--,b):e,S&&Wt(l[0],l[1],S)&&(b=g<3?e:b,g=1),n=mt(n);++u<g;){var N=l[u];N&&i(n,N,u,b)}return n})}function Dh(i,n){return function(l,u){if(l==null)return l;if(!Ht(l))return i(l,u);for(var g=l.length,b=n?g:-1,S=mt(l);(n?b--:++b<g)&&u(S[b],b,S)!==!1;);return l}}function $h(i){return function(n,l,u){for(var g=-1,b=mt(n),S=u(n),N=S.length;N--;){var L=S[i?N:++g];if(l(b[L],L,b)===!1)break}return n}}function Jm(i,n,l){var u=n&E,g=hn(i);function b(){var S=this&&this!==jt&&this instanceof b?g:i;return S.apply(u?l:this,arguments)}return b}function Ih(i){return function(n){n=ct(n);var l=yi(n)?pe(n):e,u=l?l[0]:n.charAt(0),g=l?Qe(l,1).join(""):n.slice(1);return u[i]()+g}}function ji(i){return function(n){return cr(Da(Aa(n).replace(Wf,"")),i,"")}}function hn(i){return function(){var n=arguments;switch(n.length){case 0:return new i;case 1:return new i(n[0]);case 2:return new i(n[0],n[1]);case 3:return new i(n[0],n[1],n[2]);case 4:return new i(n[0],n[1],n[2],n[3]);case 5:return new i(n[0],n[1],n[2],n[3],n[4]);case 6:return new i(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new i(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var l=Ei(i.prototype),u=i.apply(l,n);return bt(u)?u:l}}function Qm(i,n,l){var u=hn(i);function g(){for(var b=arguments.length,S=j(b),N=b,L=zi(g);N--;)S[N]=arguments[N];var T=b<3&&S[0]!==L&&S[b-1]!==L?[]:Ke(S,L);if(b-=T.length,b<l)return Uh(i,n,ss,g.placeholder,e,S,T,e,e,l-b);var k=this&&this!==jt&&this instanceof g?u:i;return Qt(k,this,S)}return g}function Wh(i){return function(n,l,u){var g=mt(n);if(!Ht(n)){var b=J(l,3);n=Pt(n),l=function(N){return b(g[N],N,g)}}var S=i(n,l,u);return S>-1?g[b?n[S]:S]:e}}function Fh(i){return Te(function(n){var l=n.length,u=l,g=le.prototype.thru;for(i&&n.reverse();u--;){var b=n[u];if(typeof b!="function")throw new oe(a);if(g&&!S&&hs(b)=="wrapper")var S=new le([],!0)}for(u=S?u:l;++u<l;){b=n[u];var N=hs(b),L=N=="wrapper"?Hr(b):e;L&&Gr(L[0])&&L[1]==(R|$|W|V)&&!L[4].length&&L[9]==1?S=S[hs(L[0])].apply(S,L[3]):S=b.length==1&&Gr(b)?S[N]():S.thru(b)}return function(){var T=arguments,k=T[0];if(S&&T.length==1&&et(k))return S.plant(k).value();for(var O=0,F=l?n[O].apply(this,T):k;++O<l;)F=n[O].call(this,F);return F}})}function ss(i,n,l,u,g,b,S,N,L,T){var k=n&R,O=n&E,F=n&P,K=n&($|U),Q=n&q,nt=F?e:hn(i);function Y(){for(var ot=arguments.length,ht=j(ot),ee=ot;ee--;)ht[ee]=arguments[ee];if(K)var Ft=zi(Y),ie=ad(ht,Ft);if(u&&(ht=Oh(ht,u,g,K)),b&&(ht=Ah(ht,b,S,K)),ot-=ie,K&&ot<T){var St=Ke(ht,Ft);return Uh(i,n,ss,Y.placeholder,l,ht,St,N,L,T-ot)}var be=O?l:this,Ae=F?be[i]:i;return ot=ht.length,N?ht=vg(ht,N):Q&&ot>1&&ht.reverse(),k&&L<ot&&(ht.length=L),this&&this!==jt&&this instanceof Y&&(Ae=nt||hn(Ae)),Ae.apply(be,ht)}return Y}function Bh(i,n){return function(l,u){return Nm(l,i,n(u),{})}}function rs(i,n){return function(l,u){var g;if(l===e&&u===e)return n;if(l!==e&&(g=l),u!==e){if(g===e)return u;typeof l=="string"||typeof u=="string"?(l=Zt(l),u=Zt(u)):(l=Lh(l),u=Lh(u)),g=i(l,u)}return g}}function Fr(i){return Te(function(n){return n=xt(n,Yt(J())),st(function(l){var u=this;return i(n,function(g){return Qt(g,u,l)})})})}function os(i,n){n=n===e?" ":Zt(n);var l=n.length;if(l<2)return l?Rr(n,i):n;var u=Rr(n,Kn(i/Si(n)));return yi(n)?Qe(pe(u),0,i).join(""):u.slice(0,i)}function Ym(i,n,l,u){var g=n&E,b=hn(i);function S(){for(var N=-1,L=arguments.length,T=-1,k=u.length,O=j(k+L),F=this&&this!==jt&&this instanceof S?b:i;++T<k;)O[T]=u[T];for(;L--;)O[T++]=arguments[++N];return Qt(F,g?l:this,O)}return S}function Vh(i){return function(n,l,u){return u&&typeof u!="number"&&Wt(n,l,u)&&(l=u=e),n=Oe(n),l===e?(l=n,n=0):l=Oe(l),u=u===e?n<l?1:-1:Oe(u),Dm(n,l,u,i)}}function ls(i){return function(n,l){return typeof n=="string"&&typeof l=="string"||(n=ce(n),l=ce(l)),i(n,l)}}function Uh(i,n,l,u,g,b,S,N,L,T){var k=n&$,O=k?S:e,F=k?e:S,K=k?b:e,Q=k?e:b;n|=k?W:I,n&=~(k?I:W),n&A||(n&=-4);var nt=[i,n,g,K,O,Q,F,N,L,T],Y=l.apply(e,nt);return Gr(i)&&ia(Y,nt),Y.placeholder=u,na(Y,i,n)}function Br(i){var n=Nt[i];return function(l,u){if(l=ce(l),u=u==null?0:Ot(it(u),292),u&&nh(l)){var g=(ct(l)+"e").split("e"),b=n(g[0]+"e"+(+g[1]+u));return g=(ct(b)+"e").split("e"),+(g[0]+"e"+(+g[1]-u))}return n(l)}}var Zm=Mi&&1/An(new Mi([,-0]))[1]==Jt?function(i){return new Mi(i)}:uo;function Hh(i){return function(n){var l=At(n);return l==me?xr(n):l==ge?pd(n):hd(n,i(n))}}function ze(i,n,l,u,g,b,S,N){var L=n&P;if(!L&&typeof i!="function")throw new oe(a);var T=u?u.length:0;if(T||(n&=-97,u=g=e),S=S===e?S:Mt(it(S),0),N=N===e?N:it(N),T-=g?g.length:0,n&I){var k=u,O=g;u=g=e}var F=L?e:Hr(i),K=[i,n,l,u,g,k,O,b,S,N];if(F&&mg(K,F),i=K[0],n=K[1],l=K[2],u=K[3],g=K[4],N=K[9]=K[9]===e?L?0:i.length:Mt(K[9]-T,0),!N&&n&($|U)&&(n&=-25),!n||n==E)var Q=Jm(i,n,l);else n==$||n==U?Q=Qm(i,n,N):(n==W||n==(E|W))&&!g.length?Q=Ym(i,n,l,u):Q=ss.apply(e,K);var nt=F?Nh:ia;return na(nt(Q,K),i,n)}function Kh(i,n,l,u){return i===e||xe(i,Ni[l])&&!ft.call(u,l)?n:i}function qh(i,n,l,u,g,b){return bt(i)&&bt(n)&&(b.set(n,i),ts(i,n,e,qh,b),b.delete(n)),i}function tg(i){return cn(i)?e:i}function Xh(i,n,l,u,g,b){var S=l&C,N=i.length,L=n.length;if(N!=L&&!(S&&L>N))return!1;var T=b.get(i),k=b.get(n);if(T&&k)return T==n&&k==i;var O=-1,F=!0,K=l&y?new ri:e;for(b.set(i,n),b.set(n,i);++O<N;){var Q=i[O],nt=n[O];if(u)var Y=S?u(nt,Q,O,n,i,b):u(Q,nt,O,i,n,b);if(Y!==e){if(Y)continue;F=!1;break}if(K){if(!fr(n,function(ot,ht){if(!Ji(K,ht)&&(Q===ot||g(Q,ot,l,u,b)))return K.push(ht)})){F=!1;break}}else if(!(Q===nt||g(Q,nt,l,u,b))){F=!1;break}}return b.delete(i),b.delete(n),F}function eg(i,n,l,u,g,b,S){switch(l){case bi:if(i.byteLength!=n.byteLength||i.byteOffset!=n.byteOffset)return!1;i=i.buffer,n=n.buffer;case Gi:return!(i.byteLength!=n.byteLength||!b(new Bn(i),new Bn(n)));case Vi:case Ui:case Hi:return xe(+i,+n);case En:return i.name==n.name&&i.message==n.message;case Ki:case qi:return i==n+"";case me:var N=xr;case ge:var L=u&C;if(N||(N=An),i.size!=n.size&&!L)return!1;var T=S.get(i);if(T)return T==n;u|=y,S.set(i,n);var k=Xh(N(i),N(n),u,g,b,S);return S.delete(i),k;case jn:if(en)return en.call(i)==en.call(n)}return!1}function ig(i,n,l,u,g,b){var S=l&C,N=Vr(i),L=N.length,T=Vr(n),k=T.length;if(L!=k&&!S)return!1;for(var O=L;O--;){var F=N[O];if(!(S?F in n:ft.call(n,F)))return!1}var K=b.get(i),Q=b.get(n);if(K&&Q)return K==n&&Q==i;var nt=!0;b.set(i,n),b.set(n,i);for(var Y=S;++O<L;){F=N[O];var ot=i[F],ht=n[F];if(u)var ee=S?u(ht,ot,F,n,i,b):u(ot,ht,F,i,n,b);if(!(ee===e?ot===ht||g(ot,ht,l,u,b):ee)){nt=!1;break}Y||(Y=F=="constructor")}if(nt&&!Y){var Ft=i.constructor,ie=n.constructor;Ft!=ie&&"constructor"in i&&"constructor"in n&&!(typeof Ft=="function"&&Ft instanceof Ft&&typeof ie=="function"&&ie instanceof ie)&&(nt=!1)}return b.delete(i),b.delete(n),nt}function Te(i){return Qr(ta(i,e,aa),i+"")}function Vr(i){return mh(i,Pt,qr)}function Ur(i){return mh(i,Kt,Gh)}var Hr=Xn?function(i){return Xn.get(i)}:uo;function hs(i){for(var n=i.name+"",l=Li[n],u=ft.call(Li,n)?l.length:0;u--;){var g=l[u],b=g.func;if(b==null||b==i)return g.name}return n}function zi(i){var n=ft.call(x,"placeholder")?x:i;return n.placeholder}function J(){var i=x.iteratee||ho;return i=i===ho?vh:i,arguments.length?i(arguments[0],arguments[1]):i}function as(i,n){var l=i.__data__;return ug(n)?l[typeof n=="string"?"string":"hash"]:l.map}function Kr(i){for(var n=Pt(i),l=n.length;l--;){var u=n[l],g=i[u];n[l]=[u,g,Yh(g)]}return n}function hi(i,n){var l=dd(i,n);return ph(l)?l:e}function ng(i){var n=ft.call(i,ni),l=i[ni];try{i[ni]=e;var u=!0}catch{}var g=Wn.call(i);return u&&(n?i[ni]=l:delete i[ni]),g}var qr=wr?function(i){return i==null?[]:(i=mt(i),Ue(wr(i),function(n){return eh.call(i,n)}))}:co,Gh=wr?function(i){for(var n=[];i;)He(n,qr(i)),i=Vn(i);return n}:co,At=It;(_r&&At(new _r(new ArrayBuffer(1)))!=bi||Yi&&At(new Yi)!=me||yr&&At(yr.resolve())!=cl||Mi&&At(new Mi)!=ge||Zi&&At(new Zi)!=Xi)&&(At=function(i){var n=It(i),l=n==Le?i.constructor:e,u=l?ai(l):"";if(u)switch(u){case Id:return bi;case Wd:return me;case Fd:return cl;case Bd:return ge;case Vd:return Xi}return n});function sg(i,n,l){for(var u=-1,g=l.length;++u<g;){var b=l[u],S=b.size;switch(b.type){case"drop":i+=S;break;case"dropRight":n-=S;break;case"take":n=Ot(n,i+S);break;case"takeRight":i=Mt(i,n-S);break}}return{start:i,end:n}}function rg(i){var n=i.match(cf);return n?n[1].split(ff):[]}function Jh(i,n,l){n=Je(n,i);for(var u=-1,g=n.length,b=!1;++u<g;){var S=Ce(n[u]);if(!(b=i!=null&&l(i,S)))break;i=i[S]}return b||++u!=g?b:(g=i==null?0:i.length,!!g&&ps(g)&&ke(S,g)&&(et(i)||ui(i)))}function og(i){var n=i.length,l=new i.constructor(n);return n&&typeof i[0]=="string"&&ft.call(i,"index")&&(l.index=i.index,l.input=i.input),l}function Qh(i){return typeof i.constructor=="function"&&!an(i)?Ei(Vn(i)):{}}function lg(i,n,l){var u=i.constructor;switch(n){case Gi:return Wr(i);case Vi:case Ui:return new u(+i);case bi:return Um(i,l);case Ks:case qs:case Xs:case Gs:case Js:case Qs:case Ys:case Zs:case tr:return kh(i,l);case me:return new u;case Hi:case qi:return new u(i);case Ki:return Hm(i);case ge:return new u;case jn:return Km(i)}}function hg(i,n){var l=n.length;if(!l)return i;var u=l-1;return n[u]=(l>1?"& ":"")+n[u],n=n.join(l>2?", ":" "),i.replace(uf,`{
/* [wrapped with `+n+`] */
`)}function ag(i){return et(i)||ui(i)||!!(ih&&i&&i[ih])}function ke(i,n){var l=typeof i;return n=n??kt,!!n&&(l=="number"||l!="symbol"&&_f.test(i))&&i>-1&&i%1==0&&i<n}function Wt(i,n,l){if(!bt(l))return!1;var u=typeof n;return(u=="number"?Ht(l)&&ke(n,l.length):u=="string"&&n in l)?xe(l[n],i):!1}function Xr(i,n){if(et(i))return!1;var l=typeof i;return l=="number"||l=="symbol"||l=="boolean"||i==null||te(i)?!0:of.test(i)||!rf.test(i)||n!=null&&i in mt(n)}function ug(i){var n=typeof i;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?i!=="__proto__":i===null}function Gr(i){var n=hs(i),l=x[n];if(typeof l!="function"||!(n in lt.prototype))return!1;if(i===l)return!0;var u=Hr(l);return!!u&&i===u[0]}function cg(i){return!!Yl&&Yl in i}var fg=$n?Re:fo;function an(i){var n=i&&i.constructor,l=typeof n=="function"&&n.prototype||Ni;return i===l}function Yh(i){return i===i&&!bt(i)}function Zh(i,n){return function(l){return l==null?!1:l[i]===n&&(n!==e||i in mt(l))}}function dg(i){var n=ms(i,function(u){return l.size===m&&l.clear(),u}),l=n.cache;return n}function mg(i,n){var l=i[1],u=n[1],g=l|u,b=g<(E|P|R),S=u==R&&l==$||u==R&&l==V&&i[7].length<=n[8]||u==(R|V)&&n[7].length<=n[8]&&l==$;if(!(b||S))return i;u&E&&(i[2]=n[2],g|=l&E?0:A);var N=n[3];if(N){var L=i[3];i[3]=L?Oh(L,N,n[4]):N,i[4]=L?Ke(i[3],p):n[4]}return N=n[5],N&&(L=i[5],i[5]=L?Ah(L,N,n[6]):N,i[6]=L?Ke(i[5],p):n[6]),N=n[7],N&&(i[7]=N),u&R&&(i[8]=i[8]==null?n[8]:Ot(i[8],n[8])),i[9]==null&&(i[9]=n[9]),i[0]=n[0],i[1]=g,i}function gg(i){var n=[];if(i!=null)for(var l in mt(i))n.push(l);return n}function pg(i){return Wn.call(i)}function ta(i,n,l){return n=Mt(n===e?i.length-1:n,0),function(){for(var u=arguments,g=-1,b=Mt(u.length-n,0),S=j(b);++g<b;)S[g]=u[n+g];g=-1;for(var N=j(n+1);++g<n;)N[g]=u[g];return N[n]=l(S),Qt(i,this,N)}}function ea(i,n){return n.length<2?i:li(i,ae(n,0,-1))}function vg(i,n){for(var l=i.length,u=Ot(n.length,l),g=Ut(i);u--;){var b=n[u];i[u]=ke(b,l)?g[b]:e}return i}function Jr(i,n){if(!(n==="constructor"&&typeof i[n]=="function")&&n!="__proto__")return i[n]}var ia=sa(Nh),un=Td||function(i,n){return jt.setTimeout(i,n)},Qr=sa(Wm);function na(i,n,l){var u=n+"";return Qr(i,hg(u,xg(rg(u),l)))}function sa(i){var n=0,l=0;return function(){var u=Ad(),g=G-(u-l);if(l=u,g>0){if(++n>=tt)return arguments[0]}else n=0;return i.apply(e,arguments)}}function us(i,n){var l=-1,u=i.length,g=u-1;for(n=n===e?u:n;++l<n;){var b=kr(l,g),S=i[b];i[b]=i[l],i[l]=S}return i.length=n,i}var ra=dg(function(i){var n=[];return i.charCodeAt(0)===46&&n.push(""),i.replace(lf,function(l,u,g,b){n.push(g?b.replace(gf,"$1"):u||l)}),n});function Ce(i){if(typeof i=="string"||te(i))return i;var n=i+"";return n=="0"&&1/i==-1/0?"-0":n}function ai(i){if(i!=null){try{return In.call(i)}catch{}try{return i+""}catch{}}return""}function xg(i,n){return re(Uc,function(l){var u="_."+l[0];n&l[1]&&!Rn(i,u)&&i.push(u)}),i.sort()}function oa(i){if(i instanceof lt)return i.clone();var n=new le(i.__wrapped__,i.__chain__);return n.__actions__=Ut(i.__actions__),n.__index__=i.__index__,n.__values__=i.__values__,n}function bg(i,n,l){(l?Wt(i,n,l):n===e)?n=1:n=Mt(it(n),0);var u=i==null?0:i.length;if(!u||n<1)return[];for(var g=0,b=0,S=j(Kn(u/n));g<u;)S[b++]=ae(i,g,g+=n);return S}function wg(i){for(var n=-1,l=i==null?0:i.length,u=0,g=[];++n<l;){var b=i[n];b&&(g[u++]=b)}return g}function _g(){var i=arguments.length;if(!i)return[];for(var n=j(i-1),l=arguments[0],u=i;u--;)n[u-1]=arguments[u];return He(et(l)?Ut(l):[l],zt(n,1))}var yg=st(function(i,n){return yt(i)?sn(i,zt(n,1,yt,!0)):[]}),Sg=st(function(i,n){var l=ue(n);return yt(l)&&(l=e),yt(i)?sn(i,zt(n,1,yt,!0),J(l,2)):[]}),Cg=st(function(i,n){var l=ue(n);return yt(l)&&(l=e),yt(i)?sn(i,zt(n,1,yt,!0),e,l):[]});function Ng(i,n,l){var u=i==null?0:i.length;return u?(n=l||n===e?1:it(n),ae(i,n<0?0:n,u)):[]}function Mg(i,n,l){var u=i==null?0:i.length;return u?(n=l||n===e?1:it(n),n=u-n,ae(i,0,n<0?0:n)):[]}function Lg(i,n){return i&&i.length?is(i,J(n,3),!0,!0):[]}function Eg(i,n){return i&&i.length?is(i,J(n,3),!0):[]}function Pg(i,n,l,u){var g=i==null?0:i.length;return g?(l&&typeof l!="number"&&Wt(i,n,l)&&(l=0,u=g),_m(i,n,l,u)):[]}function la(i,n,l){var u=i==null?0:i.length;if(!u)return-1;var g=l==null?0:it(l);return g<0&&(g=Mt(u+g,0)),On(i,J(n,3),g)}function ha(i,n,l){var u=i==null?0:i.length;if(!u)return-1;var g=u-1;return l!==e&&(g=it(l),g=l<0?Mt(u+g,0):Ot(g,u-1)),On(i,J(n,3),g,!0)}function aa(i){var n=i==null?0:i.length;return n?zt(i,1):[]}function jg(i){var n=i==null?0:i.length;return n?zt(i,Jt):[]}function zg(i,n){var l=i==null?0:i.length;return l?(n=n===e?1:it(n),zt(i,n)):[]}function Tg(i){for(var n=-1,l=i==null?0:i.length,u={};++n<l;){var g=i[n];u[g[0]]=g[1]}return u}function ua(i){return i&&i.length?i[0]:e}function kg(i,n,l){var u=i==null?0:i.length;if(!u)return-1;var g=l==null?0:it(l);return g<0&&(g=Mt(u+g,0)),_i(i,n,g)}function Rg(i){var n=i==null?0:i.length;return n?ae(i,0,-1):[]}var Og=st(function(i){var n=xt(i,$r);return n.length&&n[0]===i[0]?Er(n):[]}),Ag=st(function(i){var n=ue(i),l=xt(i,$r);return n===ue(l)?n=e:l.pop(),l.length&&l[0]===i[0]?Er(l,J(n,2)):[]}),Dg=st(function(i){var n=ue(i),l=xt(i,$r);return n=typeof n=="function"?n:e,n&&l.pop(),l.length&&l[0]===i[0]?Er(l,e,n):[]});function $g(i,n){return i==null?"":Rd.call(i,n)}function ue(i){var n=i==null?0:i.length;return n?i[n-1]:e}function Ig(i,n,l){var u=i==null?0:i.length;if(!u)return-1;var g=u;return l!==e&&(g=it(l),g=g<0?Mt(u+g,0):Ot(g,u-1)),n===n?xd(i,n,g):On(i,Ul,g,!0)}function Wg(i,n){return i&&i.length?_h(i,it(n)):e}var Fg=st(ca);function ca(i,n){return i&&i.length&&n&&n.length?Tr(i,n):i}function Bg(i,n,l){return i&&i.length&&n&&n.length?Tr(i,n,J(l,2)):i}function Vg(i,n,l){return i&&i.length&&n&&n.length?Tr(i,n,e,l):i}var Ug=Te(function(i,n){var l=i==null?0:i.length,u=Cr(i,n);return Ch(i,xt(n,function(g){return ke(g,l)?+g:g}).sort(Rh)),u});function Hg(i,n){var l=[];if(!(i&&i.length))return l;var u=-1,g=[],b=i.length;for(n=J(n,3);++u<b;){var S=i[u];n(S,u,i)&&(l.push(S),g.push(u))}return Ch(i,g),l}function Yr(i){return i==null?i:$d.call(i)}function Kg(i,n,l){var u=i==null?0:i.length;return u?(l&&typeof l!="number"&&Wt(i,n,l)?(n=0,l=u):(n=n==null?0:it(n),l=l===e?u:it(l)),ae(i,n,l)):[]}function qg(i,n){return es(i,n)}function Xg(i,n,l){return Or(i,n,J(l,2))}function Gg(i,n){var l=i==null?0:i.length;if(l){var u=es(i,n);if(u<l&&xe(i[u],n))return u}return-1}function Jg(i,n){return es(i,n,!0)}function Qg(i,n,l){return Or(i,n,J(l,2),!0)}function Yg(i,n){var l=i==null?0:i.length;if(l){var u=es(i,n,!0)-1;if(xe(i[u],n))return u}return-1}function Zg(i){return i&&i.length?Mh(i):[]}function tp(i,n){return i&&i.length?Mh(i,J(n,2)):[]}function ep(i){var n=i==null?0:i.length;return n?ae(i,1,n):[]}function ip(i,n,l){return i&&i.length?(n=l||n===e?1:it(n),ae(i,0,n<0?0:n)):[]}function np(i,n,l){var u=i==null?0:i.length;return u?(n=l||n===e?1:it(n),n=u-n,ae(i,n<0?0:n,u)):[]}function sp(i,n){return i&&i.length?is(i,J(n,3),!1,!0):[]}function rp(i,n){return i&&i.length?is(i,J(n,3)):[]}var op=st(function(i){return Ge(zt(i,1,yt,!0))}),lp=st(function(i){var n=ue(i);return yt(n)&&(n=e),Ge(zt(i,1,yt,!0),J(n,2))}),hp=st(function(i){var n=ue(i);return n=typeof n=="function"?n:e,Ge(zt(i,1,yt,!0),e,n)});function ap(i){return i&&i.length?Ge(i):[]}function up(i,n){return i&&i.length?Ge(i,J(n,2)):[]}function cp(i,n){return n=typeof n=="function"?n:e,i&&i.length?Ge(i,e,n):[]}function Zr(i){if(!(i&&i.length))return[];var n=0;return i=Ue(i,function(l){if(yt(l))return n=Mt(l.length,n),!0}),pr(n,function(l){return xt(i,dr(l))})}function fa(i,n){if(!(i&&i.length))return[];var l=Zr(i);return n==null?l:xt(l,function(u){return Qt(n,e,u)})}var fp=st(function(i,n){return yt(i)?sn(i,n):[]}),dp=st(function(i){return Dr(Ue(i,yt))}),mp=st(function(i){var n=ue(i);return yt(n)&&(n=e),Dr(Ue(i,yt),J(n,2))}),gp=st(function(i){var n=ue(i);return n=typeof n=="function"?n:e,Dr(Ue(i,yt),e,n)}),pp=st(Zr);function vp(i,n){return jh(i||[],n||[],nn)}function xp(i,n){return jh(i||[],n||[],ln)}var bp=st(function(i){var n=i.length,l=n>1?i[n-1]:e;return l=typeof l=="function"?(i.pop(),l):e,fa(i,l)});function da(i){var n=x(i);return n.__chain__=!0,n}function wp(i,n){return n(i),i}function cs(i,n){return n(i)}var _p=Te(function(i){var n=i.length,l=n?i[0]:0,u=this.__wrapped__,g=function(b){return Cr(b,i)};return n>1||this.__actions__.length||!(u instanceof lt)||!ke(l)?this.thru(g):(u=u.slice(l,+l+(n?1:0)),u.__actions__.push({func:cs,args:[g],thisArg:e}),new le(u,this.__chain__).thru(function(b){return n&&!b.length&&b.push(e),b}))});function yp(){return da(this)}function Sp(){return new le(this.value(),this.__chain__)}function Cp(){this.__values__===e&&(this.__values__=La(this.value()));var i=this.__index__>=this.__values__.length,n=i?e:this.__values__[this.__index__++];return{done:i,value:n}}function Np(){return this}function Mp(i){for(var n,l=this;l instanceof Jn;){var u=oa(l);u.__index__=0,u.__values__=e,n?g.__wrapped__=u:n=u;var g=u;l=l.__wrapped__}return g.__wrapped__=i,n}function Lp(){var i=this.__wrapped__;if(i instanceof lt){var n=i;return this.__actions__.length&&(n=new lt(this)),n=n.reverse(),n.__actions__.push({func:cs,args:[Yr],thisArg:e}),new le(n,this.__chain__)}return this.thru(Yr)}function Ep(){return Ph(this.__wrapped__,this.__actions__)}var Pp=ns(function(i,n,l){ft.call(i,l)?++i[l]:je(i,l,1)});function jp(i,n,l){var u=et(i)?Bl:wm;return l&&Wt(i,n,l)&&(n=e),u(i,J(n,3))}function zp(i,n){var l=et(i)?Ue:fh;return l(i,J(n,3))}var Tp=Wh(la),kp=Wh(ha);function Rp(i,n){return zt(fs(i,n),1)}function Op(i,n){return zt(fs(i,n),Jt)}function Ap(i,n,l){return l=l===e?1:it(l),zt(fs(i,n),l)}function ma(i,n){var l=et(i)?re:Xe;return l(i,J(n,3))}function ga(i,n){var l=et(i)?ed:ch;return l(i,J(n,3))}var Dp=ns(function(i,n,l){ft.call(i,l)?i[l].push(n):je(i,l,[n])});function $p(i,n,l,u){i=Ht(i)?i:ki(i),l=l&&!u?it(l):0;var g=i.length;return l<0&&(l=Mt(g+l,0)),vs(i)?l<=g&&i.indexOf(n,l)>-1:!!g&&_i(i,n,l)>-1}var Ip=st(function(i,n,l){var u=-1,g=typeof n=="function",b=Ht(i)?j(i.length):[];return Xe(i,function(S){b[++u]=g?Qt(n,S,l):rn(S,n,l)}),b}),Wp=ns(function(i,n,l){je(i,l,n)});function fs(i,n){var l=et(i)?xt:xh;return l(i,J(n,3))}function Fp(i,n,l,u){return i==null?[]:(et(n)||(n=n==null?[]:[n]),l=u?e:l,et(l)||(l=l==null?[]:[l]),yh(i,n,l))}var Bp=ns(function(i,n,l){i[l?0:1].push(n)},function(){return[[],[]]});function Vp(i,n,l){var u=et(i)?cr:Kl,g=arguments.length<3;return u(i,J(n,4),l,g,Xe)}function Up(i,n,l){var u=et(i)?id:Kl,g=arguments.length<3;return u(i,J(n,4),l,g,ch)}function Hp(i,n){var l=et(i)?Ue:fh;return l(i,gs(J(n,3)))}function Kp(i){var n=et(i)?lh:$m;return n(i)}function qp(i,n,l){(l?Wt(i,n,l):n===e)?n=1:n=it(n);var u=et(i)?gm:Im;return u(i,n)}function Xp(i){var n=et(i)?pm:Fm;return n(i)}function Gp(i){if(i==null)return 0;if(Ht(i))return vs(i)?Si(i):i.length;var n=At(i);return n==me||n==ge?i.size:jr(i).length}function Jp(i,n,l){var u=et(i)?fr:Bm;return l&&Wt(i,n,l)&&(n=e),u(i,J(n,3))}var Qp=st(function(i,n){if(i==null)return[];var l=n.length;return l>1&&Wt(i,n[0],n[1])?n=[]:l>2&&Wt(n[0],n[1],n[2])&&(n=[n[0]]),yh(i,zt(n,1),[])}),ds=zd||function(){return jt.Date.now()};function Yp(i,n){if(typeof n!="function")throw new oe(a);return i=it(i),function(){if(--i<1)return n.apply(this,arguments)}}function pa(i,n,l){return n=l?e:n,n=i&&n==null?i.length:n,ze(i,R,e,e,e,e,n)}function va(i,n){var l;if(typeof n!="function")throw new oe(a);return i=it(i),function(){return--i>0&&(l=n.apply(this,arguments)),i<=1&&(n=e),l}}var to=st(function(i,n,l){var u=E;if(l.length){var g=Ke(l,zi(to));u|=W}return ze(i,u,n,l,g)}),xa=st(function(i,n,l){var u=E|P;if(l.length){var g=Ke(l,zi(xa));u|=W}return ze(n,u,i,l,g)});function ba(i,n,l){n=l?e:n;var u=ze(i,$,e,e,e,e,e,n);return u.placeholder=ba.placeholder,u}function wa(i,n,l){n=l?e:n;var u=ze(i,U,e,e,e,e,e,n);return u.placeholder=wa.placeholder,u}function _a(i,n,l){var u,g,b,S,N,L,T=0,k=!1,O=!1,F=!0;if(typeof i!="function")throw new oe(a);n=ce(n)||0,bt(l)&&(k=!!l.leading,O="maxWait"in l,b=O?Mt(ce(l.maxWait)||0,n):b,F="trailing"in l?!!l.trailing:F);function K(St){var be=u,Ae=g;return u=g=e,T=St,S=i.apply(Ae,be),S}function Q(St){return T=St,N=un(ot,n),k?K(St):S}function nt(St){var be=St-L,Ae=St-T,Wa=n-be;return O?Ot(Wa,b-Ae):Wa}function Y(St){var be=St-L,Ae=St-T;return L===e||be>=n||be<0||O&&Ae>=b}function ot(){var St=ds();if(Y(St))return ht(St);N=un(ot,nt(St))}function ht(St){return N=e,F&&u?K(St):(u=g=e,S)}function ee(){N!==e&&zh(N),T=0,u=L=g=N=e}function Ft(){return N===e?S:ht(ds())}function ie(){var St=ds(),be=Y(St);if(u=arguments,g=this,L=St,be){if(N===e)return Q(L);if(O)return zh(N),N=un(ot,n),K(L)}return N===e&&(N=un(ot,n)),S}return ie.cancel=ee,ie.flush=Ft,ie}var Zp=st(function(i,n){return uh(i,1,n)}),t0=st(function(i,n,l){return uh(i,ce(n)||0,l)});function e0(i){return ze(i,q)}function ms(i,n){if(typeof i!="function"||n!=null&&typeof n!="function")throw new oe(a);var l=function(){var u=arguments,g=n?n.apply(this,u):u[0],b=l.cache;if(b.has(g))return b.get(g);var S=i.apply(this,u);return l.cache=b.set(g,S)||b,S};return l.cache=new(ms.Cache||Pe),l}ms.Cache=Pe;function gs(i){if(typeof i!="function")throw new oe(a);return function(){var n=arguments;switch(n.length){case 0:return!i.call(this);case 1:return!i.call(this,n[0]);case 2:return!i.call(this,n[0],n[1]);case 3:return!i.call(this,n[0],n[1],n[2])}return!i.apply(this,n)}}function i0(i){return va(2,i)}var n0=Vm(function(i,n){n=n.length==1&&et(n[0])?xt(n[0],Yt(J())):xt(zt(n,1),Yt(J()));var l=n.length;return st(function(u){for(var g=-1,b=Ot(u.length,l);++g<b;)u[g]=n[g].call(this,u[g]);return Qt(i,this,u)})}),eo=st(function(i,n){var l=Ke(n,zi(eo));return ze(i,W,e,n,l)}),ya=st(function(i,n){var l=Ke(n,zi(ya));return ze(i,I,e,n,l)}),s0=Te(function(i,n){return ze(i,V,e,e,e,n)});function r0(i,n){if(typeof i!="function")throw new oe(a);return n=n===e?n:it(n),st(i,n)}function o0(i,n){if(typeof i!="function")throw new oe(a);return n=n==null?0:Mt(it(n),0),st(function(l){var u=l[n],g=Qe(l,0,n);return u&&He(g,u),Qt(i,this,g)})}function l0(i,n,l){var u=!0,g=!0;if(typeof i!="function")throw new oe(a);return bt(l)&&(u="leading"in l?!!l.leading:u,g="trailing"in l?!!l.trailing:g),_a(i,n,{leading:u,maxWait:n,trailing:g})}function h0(i){return pa(i,1)}function a0(i,n){return eo(Ir(n),i)}function u0(){if(!arguments.length)return[];var i=arguments[0];return et(i)?i:[i]}function c0(i){return he(i,_)}function f0(i,n){return n=typeof n=="function"?n:e,he(i,_,n)}function d0(i){return he(i,v|_)}function m0(i,n){return n=typeof n=="function"?n:e,he(i,v|_,n)}function g0(i,n){return n==null||ah(i,n,Pt(n))}function xe(i,n){return i===n||i!==i&&n!==n}var p0=ls(Lr),v0=ls(function(i,n){return i>=n}),ui=gh(function(){return arguments}())?gh:function(i){return _t(i)&&ft.call(i,"callee")&&!eh.call(i,"callee")},et=j.isArray,x0=Al?Yt(Al):Mm;function Ht(i){return i!=null&&ps(i.length)&&!Re(i)}function yt(i){return _t(i)&&Ht(i)}function b0(i){return i===!0||i===!1||_t(i)&&It(i)==Vi}var Ye=kd||fo,w0=Dl?Yt(Dl):Lm;function _0(i){return _t(i)&&i.nodeType===1&&!cn(i)}function y0(i){if(i==null)return!0;if(Ht(i)&&(et(i)||typeof i=="string"||typeof i.splice=="function"||Ye(i)||Ti(i)||ui(i)))return!i.length;var n=At(i);if(n==me||n==ge)return!i.size;if(an(i))return!jr(i).length;for(var l in i)if(ft.call(i,l))return!1;return!0}function S0(i,n){return on(i,n)}function C0(i,n,l){l=typeof l=="function"?l:e;var u=l?l(i,n):e;return u===e?on(i,n,e,l):!!u}function io(i){if(!_t(i))return!1;var n=It(i);return n==En||n==Kc||typeof i.message=="string"&&typeof i.name=="string"&&!cn(i)}function N0(i){return typeof i=="number"&&nh(i)}function Re(i){if(!bt(i))return!1;var n=It(i);return n==Pn||n==ul||n==Hc||n==Xc}function Sa(i){return typeof i=="number"&&i==it(i)}function ps(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=kt}function bt(i){var n=typeof i;return i!=null&&(n=="object"||n=="function")}function _t(i){return i!=null&&typeof i=="object"}var Ca=$l?Yt($l):Pm;function M0(i,n){return i===n||Pr(i,n,Kr(n))}function L0(i,n,l){return l=typeof l=="function"?l:e,Pr(i,n,Kr(n),l)}function E0(i){return Na(i)&&i!=+i}function P0(i){if(fg(i))throw new Z(h);return ph(i)}function j0(i){return i===null}function z0(i){return i==null}function Na(i){return typeof i=="number"||_t(i)&&It(i)==Hi}function cn(i){if(!_t(i)||It(i)!=Le)return!1;var n=Vn(i);if(n===null)return!0;var l=ft.call(n,"constructor")&&n.constructor;return typeof l=="function"&&l instanceof l&&In.call(l)==Ld}var no=Il?Yt(Il):jm;function T0(i){return Sa(i)&&i>=-9007199254740991&&i<=kt}var Ma=Wl?Yt(Wl):zm;function vs(i){return typeof i=="string"||!et(i)&&_t(i)&&It(i)==qi}function te(i){return typeof i=="symbol"||_t(i)&&It(i)==jn}var Ti=Fl?Yt(Fl):Tm;function k0(i){return i===e}function R0(i){return _t(i)&&At(i)==Xi}function O0(i){return _t(i)&&It(i)==Jc}var A0=ls(zr),D0=ls(function(i,n){return i<=n});function La(i){if(!i)return[];if(Ht(i))return vs(i)?pe(i):Ut(i);if(Qi&&i[Qi])return gd(i[Qi]());var n=At(i),l=n==me?xr:n==ge?An:ki;return l(i)}function Oe(i){if(!i)return i===0?i:0;if(i=ce(i),i===Jt||i===-1/0){var n=i<0?-1:1;return n*Rt}return i===i?i:0}function it(i){var n=Oe(i),l=n%1;return n===n?l?n-l:n:0}function Ea(i){return i?oi(it(i),0,at):0}function ce(i){if(typeof i=="number")return i;if(te(i))return $t;if(bt(i)){var n=typeof i.valueOf=="function"?i.valueOf():i;i=bt(n)?n+"":n}if(typeof i!="string")return i===0?i:+i;i=ql(i);var l=xf.test(i);return l||wf.test(i)?Yf(i.slice(2),l?2:8):vf.test(i)?$t:+i}function Pa(i){return Se(i,Kt(i))}function $0(i){return i?oi(it(i),-9007199254740991,kt):i===0?i:0}function ct(i){return i==null?"":Zt(i)}var I0=Pi(function(i,n){if(an(n)||Ht(n)){Se(n,Pt(n),i);return}for(var l in n)ft.call(n,l)&&nn(i,l,n[l])}),ja=Pi(function(i,n){Se(n,Kt(n),i)}),xs=Pi(function(i,n,l,u){Se(n,Kt(n),i,u)}),W0=Pi(function(i,n,l,u){Se(n,Pt(n),i,u)}),F0=Te(Cr);function B0(i,n){var l=Ei(i);return n==null?l:hh(l,n)}var V0=st(function(i,n){i=mt(i);var l=-1,u=n.length,g=u>2?n[2]:e;for(g&&Wt(n[0],n[1],g)&&(u=1);++l<u;)for(var b=n[l],S=Kt(b),N=-1,L=S.length;++N<L;){var T=S[N],k=i[T];(k===e||xe(k,Ni[T])&&!ft.call(i,T))&&(i[T]=b[T])}return i}),U0=st(function(i){return i.push(e,qh),Qt(za,e,i)});function H0(i,n){return Vl(i,J(n,3),ye)}function K0(i,n){return Vl(i,J(n,3),Mr)}function q0(i,n){return i==null?i:Nr(i,J(n,3),Kt)}function X0(i,n){return i==null?i:dh(i,J(n,3),Kt)}function G0(i,n){return i&&ye(i,J(n,3))}function J0(i,n){return i&&Mr(i,J(n,3))}function Q0(i){return i==null?[]:Zn(i,Pt(i))}function Y0(i){return i==null?[]:Zn(i,Kt(i))}function so(i,n,l){var u=i==null?e:li(i,n);return u===e?l:u}function Z0(i,n){return i!=null&&Jh(i,n,ym)}function ro(i,n){return i!=null&&Jh(i,n,Sm)}var tv=Bh(function(i,n,l){n!=null&&typeof n.toString!="function"&&(n=Wn.call(n)),i[n]=l},lo(qt)),ev=Bh(function(i,n,l){n!=null&&typeof n.toString!="function"&&(n=Wn.call(n)),ft.call(i,n)?i[n].push(l):i[n]=[l]},J),iv=st(rn);function Pt(i){return Ht(i)?oh(i):jr(i)}function Kt(i){return Ht(i)?oh(i,!0):km(i)}function nv(i,n){var l={};return n=J(n,3),ye(i,function(u,g,b){je(l,n(u,g,b),u)}),l}function sv(i,n){var l={};return n=J(n,3),ye(i,function(u,g,b){je(l,g,n(u,g,b))}),l}var rv=Pi(function(i,n,l){ts(i,n,l)}),za=Pi(function(i,n,l,u){ts(i,n,l,u)}),ov=Te(function(i,n){var l={};if(i==null)return l;var u=!1;n=xt(n,function(b){return b=Je(b,i),u||(u=b.length>1),b}),Se(i,Ur(i),l),u&&(l=he(l,v|w|_,tg));for(var g=n.length;g--;)Ar(l,n[g]);return l});function lv(i,n){return Ta(i,gs(J(n)))}var hv=Te(function(i,n){return i==null?{}:Om(i,n)});function Ta(i,n){if(i==null)return{};var l=xt(Ur(i),function(u){return[u]});return n=J(n),Sh(i,l,function(u,g){return n(u,g[0])})}function av(i,n,l){n=Je(n,i);var u=-1,g=n.length;for(g||(g=1,i=e);++u<g;){var b=i==null?e:i[Ce(n[u])];b===e&&(u=g,b=l),i=Re(b)?b.call(i):b}return i}function uv(i,n,l){return i==null?i:ln(i,n,l)}function cv(i,n,l,u){return u=typeof u=="function"?u:e,i==null?i:ln(i,n,l,u)}var ka=Hh(Pt),Ra=Hh(Kt);function fv(i,n,l){var u=et(i),g=u||Ye(i)||Ti(i);if(n=J(n,4),l==null){var b=i&&i.constructor;g?l=u?new b:[]:bt(i)?l=Re(b)?Ei(Vn(i)):{}:l={}}return(g?re:ye)(i,function(S,N,L){return n(l,S,N,L)}),l}function dv(i,n){return i==null?!0:Ar(i,n)}function mv(i,n,l){return i==null?i:Eh(i,n,Ir(l))}function gv(i,n,l,u){return u=typeof u=="function"?u:e,i==null?i:Eh(i,n,Ir(l),u)}function ki(i){return i==null?[]:vr(i,Pt(i))}function pv(i){return i==null?[]:vr(i,Kt(i))}function vv(i,n,l){return l===e&&(l=n,n=e),l!==e&&(l=ce(l),l=l===l?l:0),n!==e&&(n=ce(n),n=n===n?n:0),oi(ce(i),n,l)}function xv(i,n,l){return n=Oe(n),l===e?(l=n,n=0):l=Oe(l),i=ce(i),Cm(i,n,l)}function bv(i,n,l){if(l&&typeof l!="boolean"&&Wt(i,n,l)&&(n=l=e),l===e&&(typeof n=="boolean"?(l=n,n=e):typeof i=="boolean"&&(l=i,i=e)),i===e&&n===e?(i=0,n=1):(i=Oe(i),n===e?(n=i,i=0):n=Oe(n)),i>n){var u=i;i=n,n=u}if(l||i%1||n%1){var g=sh();return Ot(i+g*(n-i+Qf("1e-"+((g+"").length-1))),n)}return kr(i,n)}var wv=ji(function(i,n,l){return n=n.toLowerCase(),i+(l?Oa(n):n)});function Oa(i){return oo(ct(i).toLowerCase())}function Aa(i){return i=ct(i),i&&i.replace(yf,ud).replace(Ff,"")}function _v(i,n,l){i=ct(i),n=Zt(n);var u=i.length;l=l===e?u:oi(it(l),0,u);var g=l;return l-=n.length,l>=0&&i.slice(l,g)==n}function yv(i){return i=ct(i),i&&ef.test(i)?i.replace(dl,cd):i}function Sv(i){return i=ct(i),i&&hf.test(i)?i.replace(er,"\\$&"):i}var Cv=ji(function(i,n,l){return i+(l?"-":"")+n.toLowerCase()}),Nv=ji(function(i,n,l){return i+(l?" ":"")+n.toLowerCase()}),Mv=Ih("toLowerCase");function Lv(i,n,l){i=ct(i),n=it(n);var u=n?Si(i):0;if(!n||u>=n)return i;var g=(n-u)/2;return os(qn(g),l)+i+os(Kn(g),l)}function Ev(i,n,l){i=ct(i),n=it(n);var u=n?Si(i):0;return n&&u<n?i+os(n-u,l):i}function Pv(i,n,l){i=ct(i),n=it(n);var u=n?Si(i):0;return n&&u<n?os(n-u,l)+i:i}function jv(i,n,l){return l||n==null?n=0:n&&(n=+n),Dd(ct(i).replace(ir,""),n||0)}function zv(i,n,l){return(l?Wt(i,n,l):n===e)?n=1:n=it(n),Rr(ct(i),n)}function Tv(){var i=arguments,n=ct(i[0]);return i.length<3?n:n.replace(i[1],i[2])}var kv=ji(function(i,n,l){return i+(l?"_":"")+n.toLowerCase()});function Rv(i,n,l){return l&&typeof l!="number"&&Wt(i,n,l)&&(n=l=e),l=l===e?at:l>>>0,l?(i=ct(i),i&&(typeof n=="string"||n!=null&&!no(n))&&(n=Zt(n),!n&&yi(i))?Qe(pe(i),0,l):i.split(n,l)):[]}var Ov=ji(function(i,n,l){return i+(l?" ":"")+oo(n)});function Av(i,n,l){return i=ct(i),l=l==null?0:oi(it(l),0,i.length),n=Zt(n),i.slice(l,l+n.length)==n}function Dv(i,n,l){var u=x.templateSettings;l&&Wt(i,n,l)&&(n=e),i=ct(i),n=xs({},n,u,Kh);var g=xs({},n.imports,u.imports,Kh),b=Pt(g),S=vr(g,b),N,L,T=0,k=n.interpolate||zn,O="__p += '",F=br((n.escape||zn).source+"|"+k.source+"|"+(k===ml?pf:zn).source+"|"+(n.evaluate||zn).source+"|$","g"),K="//# sourceURL="+(ft.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Kf+"]")+`
`;i.replace(F,function(Y,ot,ht,ee,Ft,ie){return ht||(ht=ee),O+=i.slice(T,ie).replace(Sf,fd),ot&&(N=!0,O+=`' +
__e(`+ot+`) +
'`),Ft&&(L=!0,O+=`';
`+Ft+`;
__p += '`),ht&&(O+=`' +
((__t = (`+ht+`)) == null ? '' : __t) +
'`),T=ie+Y.length,Y}),O+=`';
`;var Q=ft.call(n,"variable")&&n.variable;if(!Q)O=`with (obj) {
`+O+`
}
`;else if(mf.test(Q))throw new Z(c);O=(L?O.replace(Qc,""):O).replace(Yc,"$1").replace(Zc,"$1;"),O="function("+(Q||"obj")+`) {
`+(Q?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(N?", __e = _.escape":"")+(L?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+O+`return __p
}`;var nt=$a(function(){return ut(b,K+"return "+O).apply(e,S)});if(nt.source=O,io(nt))throw nt;return nt}function $v(i){return ct(i).toLowerCase()}function Iv(i){return ct(i).toUpperCase()}function Wv(i,n,l){if(i=ct(i),i&&(l||n===e))return ql(i);if(!i||!(n=Zt(n)))return i;var u=pe(i),g=pe(n),b=Xl(u,g),S=Gl(u,g)+1;return Qe(u,b,S).join("")}function Fv(i,n,l){if(i=ct(i),i&&(l||n===e))return i.slice(0,Ql(i)+1);if(!i||!(n=Zt(n)))return i;var u=pe(i),g=Gl(u,pe(n))+1;return Qe(u,0,g).join("")}function Bv(i,n,l){if(i=ct(i),i&&(l||n===e))return i.replace(ir,"");if(!i||!(n=Zt(n)))return i;var u=pe(i),g=Xl(u,pe(n));return Qe(u,g).join("")}function Vv(i,n){var l=rt,u=X;if(bt(n)){var g="separator"in n?n.separator:g;l="length"in n?it(n.length):l,u="omission"in n?Zt(n.omission):u}i=ct(i);var b=i.length;if(yi(i)){var S=pe(i);b=S.length}if(l>=b)return i;var N=l-Si(u);if(N<1)return u;var L=S?Qe(S,0,N).join(""):i.slice(0,N);if(g===e)return L+u;if(S&&(N+=L.length-N),no(g)){if(i.slice(N).search(g)){var T,k=L;for(g.global||(g=br(g.source,ct(gl.exec(g))+"g")),g.lastIndex=0;T=g.exec(k);)var O=T.index;L=L.slice(0,O===e?N:O)}}else if(i.indexOf(Zt(g),N)!=N){var F=L.lastIndexOf(g);F>-1&&(L=L.slice(0,F))}return L+u}function Uv(i){return i=ct(i),i&&tf.test(i)?i.replace(fl,bd):i}var Hv=ji(function(i,n,l){return i+(l?" ":"")+n.toUpperCase()}),oo=Ih("toUpperCase");function Da(i,n,l){return i=ct(i),n=l?e:n,n===e?md(i)?yd(i):rd(i):i.match(n)||[]}var $a=st(function(i,n){try{return Qt(i,e,n)}catch(l){return io(l)?l:new Z(l)}}),Kv=Te(function(i,n){return re(n,function(l){l=Ce(l),je(i,l,to(i[l],i))}),i});function qv(i){var n=i==null?0:i.length,l=J();return i=n?xt(i,function(u){if(typeof u[1]!="function")throw new oe(a);return[l(u[0]),u[1]]}):[],st(function(u){for(var g=-1;++g<n;){var b=i[g];if(Qt(b[0],this,u))return Qt(b[1],this,u)}})}function Xv(i){return bm(he(i,v))}function lo(i){return function(){return i}}function Gv(i,n){return i==null||i!==i?n:i}var Jv=Fh(),Qv=Fh(!0);function qt(i){return i}function ho(i){return vh(typeof i=="function"?i:he(i,v))}function Yv(i){return bh(he(i,v))}function Zv(i,n){return wh(i,he(n,v))}var tx=st(function(i,n){return function(l){return rn(l,i,n)}}),ex=st(function(i,n){return function(l){return rn(i,l,n)}});function ao(i,n,l){var u=Pt(n),g=Zn(n,u);l==null&&!(bt(n)&&(g.length||!u.length))&&(l=n,n=i,i=this,g=Zn(n,Pt(n)));var b=!(bt(l)&&"chain"in l)||!!l.chain,S=Re(i);return re(g,function(N){var L=n[N];i[N]=L,S&&(i.prototype[N]=function(){var T=this.__chain__;if(b||T){var k=i(this.__wrapped__),O=k.__actions__=Ut(this.__actions__);return O.push({func:L,args:arguments,thisArg:i}),k.__chain__=T,k}return L.apply(i,He([this.value()],arguments))})}),i}function ix(){return jt._===this&&(jt._=Ed),this}function uo(){}function nx(i){return i=it(i),st(function(n){return _h(n,i)})}var sx=Fr(xt),rx=Fr(Bl),ox=Fr(fr);function Ia(i){return Xr(i)?dr(Ce(i)):Am(i)}function lx(i){return function(n){return i==null?e:li(i,n)}}var hx=Vh(),ax=Vh(!0);function co(){return[]}function fo(){return!1}function ux(){return{}}function cx(){return""}function fx(){return!0}function dx(i,n){if(i=it(i),i<1||i>kt)return[];var l=at,u=Ot(i,at);n=J(n),i-=at;for(var g=pr(u,n);++l<i;)n(l);return g}function mx(i){return et(i)?xt(i,Ce):te(i)?[i]:Ut(ra(ct(i)))}function gx(i){var n=++Md;return ct(i)+n}var px=rs(function(i,n){return i+n},0),vx=Br("ceil"),xx=rs(function(i,n){return i/n},1),bx=Br("floor");function wx(i){return i&&i.length?Yn(i,qt,Lr):e}function _x(i,n){return i&&i.length?Yn(i,J(n,2),Lr):e}function yx(i){return Hl(i,qt)}function Sx(i,n){return Hl(i,J(n,2))}function Cx(i){return i&&i.length?Yn(i,qt,zr):e}function Nx(i,n){return i&&i.length?Yn(i,J(n,2),zr):e}var Mx=rs(function(i,n){return i*n},1),Lx=Br("round"),Ex=rs(function(i,n){return i-n},0);function Px(i){return i&&i.length?gr(i,qt):0}function jx(i,n){return i&&i.length?gr(i,J(n,2)):0}return x.after=Yp,x.ary=pa,x.assign=I0,x.assignIn=ja,x.assignInWith=xs,x.assignWith=W0,x.at=F0,x.before=va,x.bind=to,x.bindAll=Kv,x.bindKey=xa,x.castArray=u0,x.chain=da,x.chunk=bg,x.compact=wg,x.concat=_g,x.cond=qv,x.conforms=Xv,x.constant=lo,x.countBy=Pp,x.create=B0,x.curry=ba,x.curryRight=wa,x.debounce=_a,x.defaults=V0,x.defaultsDeep=U0,x.defer=Zp,x.delay=t0,x.difference=yg,x.differenceBy=Sg,x.differenceWith=Cg,x.drop=Ng,x.dropRight=Mg,x.dropRightWhile=Lg,x.dropWhile=Eg,x.fill=Pg,x.filter=zp,x.flatMap=Rp,x.flatMapDeep=Op,x.flatMapDepth=Ap,x.flatten=aa,x.flattenDeep=jg,x.flattenDepth=zg,x.flip=e0,x.flow=Jv,x.flowRight=Qv,x.fromPairs=Tg,x.functions=Q0,x.functionsIn=Y0,x.groupBy=Dp,x.initial=Rg,x.intersection=Og,x.intersectionBy=Ag,x.intersectionWith=Dg,x.invert=tv,x.invertBy=ev,x.invokeMap=Ip,x.iteratee=ho,x.keyBy=Wp,x.keys=Pt,x.keysIn=Kt,x.map=fs,x.mapKeys=nv,x.mapValues=sv,x.matches=Yv,x.matchesProperty=Zv,x.memoize=ms,x.merge=rv,x.mergeWith=za,x.method=tx,x.methodOf=ex,x.mixin=ao,x.negate=gs,x.nthArg=nx,x.omit=ov,x.omitBy=lv,x.once=i0,x.orderBy=Fp,x.over=sx,x.overArgs=n0,x.overEvery=rx,x.overSome=ox,x.partial=eo,x.partialRight=ya,x.partition=Bp,x.pick=hv,x.pickBy=Ta,x.property=Ia,x.propertyOf=lx,x.pull=Fg,x.pullAll=ca,x.pullAllBy=Bg,x.pullAllWith=Vg,x.pullAt=Ug,x.range=hx,x.rangeRight=ax,x.rearg=s0,x.reject=Hp,x.remove=Hg,x.rest=r0,x.reverse=Yr,x.sampleSize=qp,x.set=uv,x.setWith=cv,x.shuffle=Xp,x.slice=Kg,x.sortBy=Qp,x.sortedUniq=Zg,x.sortedUniqBy=tp,x.split=Rv,x.spread=o0,x.tail=ep,x.take=ip,x.takeRight=np,x.takeRightWhile=sp,x.takeWhile=rp,x.tap=wp,x.throttle=l0,x.thru=cs,x.toArray=La,x.toPairs=ka,x.toPairsIn=Ra,x.toPath=mx,x.toPlainObject=Pa,x.transform=fv,x.unary=h0,x.union=op,x.unionBy=lp,x.unionWith=hp,x.uniq=ap,x.uniqBy=up,x.uniqWith=cp,x.unset=dv,x.unzip=Zr,x.unzipWith=fa,x.update=mv,x.updateWith=gv,x.values=ki,x.valuesIn=pv,x.without=fp,x.words=Da,x.wrap=a0,x.xor=dp,x.xorBy=mp,x.xorWith=gp,x.zip=pp,x.zipObject=vp,x.zipObjectDeep=xp,x.zipWith=bp,x.entries=ka,x.entriesIn=Ra,x.extend=ja,x.extendWith=xs,ao(x,x),x.add=px,x.attempt=$a,x.camelCase=wv,x.capitalize=Oa,x.ceil=vx,x.clamp=vv,x.clone=c0,x.cloneDeep=d0,x.cloneDeepWith=m0,x.cloneWith=f0,x.conformsTo=g0,x.deburr=Aa,x.defaultTo=Gv,x.divide=xx,x.endsWith=_v,x.eq=xe,x.escape=yv,x.escapeRegExp=Sv,x.every=jp,x.find=Tp,x.findIndex=la,x.findKey=H0,x.findLast=kp,x.findLastIndex=ha,x.findLastKey=K0,x.floor=bx,x.forEach=ma,x.forEachRight=ga,x.forIn=q0,x.forInRight=X0,x.forOwn=G0,x.forOwnRight=J0,x.get=so,x.gt=p0,x.gte=v0,x.has=Z0,x.hasIn=ro,x.head=ua,x.identity=qt,x.includes=$p,x.indexOf=kg,x.inRange=xv,x.invoke=iv,x.isArguments=ui,x.isArray=et,x.isArrayBuffer=x0,x.isArrayLike=Ht,x.isArrayLikeObject=yt,x.isBoolean=b0,x.isBuffer=Ye,x.isDate=w0,x.isElement=_0,x.isEmpty=y0,x.isEqual=S0,x.isEqualWith=C0,x.isError=io,x.isFinite=N0,x.isFunction=Re,x.isInteger=Sa,x.isLength=ps,x.isMap=Ca,x.isMatch=M0,x.isMatchWith=L0,x.isNaN=E0,x.isNative=P0,x.isNil=z0,x.isNull=j0,x.isNumber=Na,x.isObject=bt,x.isObjectLike=_t,x.isPlainObject=cn,x.isRegExp=no,x.isSafeInteger=T0,x.isSet=Ma,x.isString=vs,x.isSymbol=te,x.isTypedArray=Ti,x.isUndefined=k0,x.isWeakMap=R0,x.isWeakSet=O0,x.join=$g,x.kebabCase=Cv,x.last=ue,x.lastIndexOf=Ig,x.lowerCase=Nv,x.lowerFirst=Mv,x.lt=A0,x.lte=D0,x.max=wx,x.maxBy=_x,x.mean=yx,x.meanBy=Sx,x.min=Cx,x.minBy=Nx,x.stubArray=co,x.stubFalse=fo,x.stubObject=ux,x.stubString=cx,x.stubTrue=fx,x.multiply=Mx,x.nth=Wg,x.noConflict=ix,x.noop=uo,x.now=ds,x.pad=Lv,x.padEnd=Ev,x.padStart=Pv,x.parseInt=jv,x.random=bv,x.reduce=Vp,x.reduceRight=Up,x.repeat=zv,x.replace=Tv,x.result=av,x.round=Lx,x.runInContext=M,x.sample=Kp,x.size=Gp,x.snakeCase=kv,x.some=Jp,x.sortedIndex=qg,x.sortedIndexBy=Xg,x.sortedIndexOf=Gg,x.sortedLastIndex=Jg,x.sortedLastIndexBy=Qg,x.sortedLastIndexOf=Yg,x.startCase=Ov,x.startsWith=Av,x.subtract=Ex,x.sum=Px,x.sumBy=jx,x.template=Dv,x.times=dx,x.toFinite=Oe,x.toInteger=it,x.toLength=Ea,x.toLower=$v,x.toNumber=ce,x.toSafeInteger=$0,x.toString=ct,x.toUpper=Iv,x.trim=Wv,x.trimEnd=Fv,x.trimStart=Bv,x.truncate=Vv,x.unescape=Uv,x.uniqueId=gx,x.upperCase=Hv,x.upperFirst=oo,x.each=ma,x.eachRight=ga,x.first=ua,ao(x,function(){var i={};return ye(x,function(n,l){ft.call(x.prototype,l)||(i[l]=n)}),i}(),{chain:!1}),x.VERSION=s,re(["bind","bindKey","curry","curryRight","partial","partialRight"],function(i){x[i].placeholder=x}),re(["drop","take"],function(i,n){lt.prototype[i]=function(l){l=l===e?1:Mt(it(l),0);var u=this.__filtered__&&!n?new lt(this):this.clone();return u.__filtered__?u.__takeCount__=Ot(l,u.__takeCount__):u.__views__.push({size:Ot(l,at),type:i+(u.__dir__<0?"Right":"")}),u},lt.prototype[i+"Right"]=function(l){return this.reverse()[i](l).reverse()}}),re(["filter","map","takeWhile"],function(i,n){var l=n+1,u=l==wt||l==ne;lt.prototype[i]=function(g){var b=this.clone();return b.__iteratees__.push({iteratee:J(g,3),type:l}),b.__filtered__=b.__filtered__||u,b}}),re(["head","last"],function(i,n){var l="take"+(n?"Right":"");lt.prototype[i]=function(){return this[l](1).value()[0]}}),re(["initial","tail"],function(i,n){var l="drop"+(n?"":"Right");lt.prototype[i]=function(){return this.__filtered__?new lt(this):this[l](1)}}),lt.prototype.compact=function(){return this.filter(qt)},lt.prototype.find=function(i){return this.filter(i).head()},lt.prototype.findLast=function(i){return this.reverse().find(i)},lt.prototype.invokeMap=st(function(i,n){return typeof i=="function"?new lt(this):this.map(function(l){return rn(l,i,n)})}),lt.prototype.reject=function(i){return this.filter(gs(J(i)))},lt.prototype.slice=function(i,n){i=it(i);var l=this;return l.__filtered__&&(i>0||n<0)?new lt(l):(i<0?l=l.takeRight(-i):i&&(l=l.drop(i)),n!==e&&(n=it(n),l=n<0?l.dropRight(-n):l.take(n-i)),l)},lt.prototype.takeRightWhile=function(i){return this.reverse().takeWhile(i).reverse()},lt.prototype.toArray=function(){return this.take(at)},ye(lt.prototype,function(i,n){var l=/^(?:filter|find|map|reject)|While$/.test(n),u=/^(?:head|last)$/.test(n),g=x[u?"take"+(n=="last"?"Right":""):n],b=u||/^find/.test(n);g&&(x.prototype[n]=function(){var S=this.__wrapped__,N=u?[1]:arguments,L=S instanceof lt,T=N[0],k=L||et(S),O=function(ot){var ht=g.apply(x,He([ot],N));return u&&F?ht[0]:ht};k&&l&&typeof T=="function"&&T.length!=1&&(L=k=!1);var F=this.__chain__,K=!!this.__actions__.length,Q=b&&!F,nt=L&&!K;if(!b&&k){S=nt?S:new lt(this);var Y=i.apply(S,N);return Y.__actions__.push({func:cs,args:[O],thisArg:e}),new le(Y,F)}return Q&&nt?i.apply(this,N):(Y=this.thru(O),Q?u?Y.value()[0]:Y.value():Y)})}),re(["pop","push","shift","sort","splice","unshift"],function(i){var n=Dn[i],l=/^(?:push|sort|unshift)$/.test(i)?"tap":"thru",u=/^(?:pop|shift)$/.test(i);x.prototype[i]=function(){var g=arguments;if(u&&!this.__chain__){var b=this.value();return n.apply(et(b)?b:[],g)}return this[l](function(S){return n.apply(et(S)?S:[],g)})}}),ye(lt.prototype,function(i,n){var l=x[n];if(l){var u=l.name+"";ft.call(Li,u)||(Li[u]=[]),Li[u].push({name:n,func:l})}}),Li[ss(e,P).name]=[{name:"wrapper",func:e}],lt.prototype.clone=Ud,lt.prototype.reverse=Hd,lt.prototype.value=Kd,x.prototype.at=_p,x.prototype.chain=yp,x.prototype.commit=Sp,x.prototype.next=Cp,x.prototype.plant=Mp,x.prototype.reverse=Lp,x.prototype.toJSON=x.prototype.valueOf=x.prototype.value=Ep,x.prototype.first=x.prototype.head,Qi&&(x.prototype[Qi]=Np),x},Ci=Sd();ii?((ii.exports=Ci)._=Ci,hr._=Ci):jt._=Ci}).call(t_)}(mn,mn.exports)),mn.exports}var i_=e_();const Ko=B.createContext(null),n_={background:"#FFFFFF",text:"#121212",grid:"#E5E5E5",border:"#D4D4D8"},s_={background:"#121212",text:"#F5F5F5",grid:"#27272A",border:"#3F3F46"},Tc=B.forwardRef((o,t)=>{const{children:e,container:s,layout:r,onReachStart:h,...a}=o,{theme:c}=Zu(),m=c==="dark"||c==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?s_:n_,p=B.useRef({isRemoved:!1,isLoading:!1,api(){return this._api||(this._api=Z1(s,{...a,layout:{...r,attributionLogo:!1,fontSize:10,background:{color:m.background},textColor:m.text},width:s.clientWidth,height:s.clientHeight,watermark:{visible:!1},rightPriceScale:{borderVisible:!1,minimumWidth:10,borderColor:m.border},timeScale:{borderVisible:!1,borderColor:m.border,timeVisible:!0,secondsVisible:!1,tickMarkFormatter:v=>{const w=new Date(v*1e3);return`${w.getHours().toString().padStart(2,"0")}:${w.getMinutes().toString().padStart(2,"0")}`}},localization:{timeFormatter:v=>{const w=new Date(v*1e3),_=w.getHours().toString().padStart(2,"0"),C=w.getMinutes().toString().padStart(2,"0"),y=(w.getMonth()+1).toString().padStart(2,"0"),E=w.getDate().toString().padStart(2,"0");return`${y}-${E} ${_}:${C}`}},crosshair:{horzLine:{visible:!0,labelVisible:!0},vertLine:{visible:!0,labelVisible:!0,style:1}},grid:{vertLines:{color:m.grid,visible:!0},horzLines:{color:m.grid,visible:!0}}}),this._api.timeScale().fitContent()),this._api},free(v){this._api&&v&&this._api.removeSeries(v)}});return B.useEffect(()=>{p.current._api&&p.current._api.applyOptions({layout:{background:{color:m.background},textColor:m.text},grid:{vertLines:{color:m.grid},horzLines:{color:m.grid}},rightPriceScale:{borderColor:m.border},timeScale:{borderColor:m.border},localization:{timeFormatter:v=>{const w=new Date(v*1e3),_=w.getHours().toString().padStart(2,"0"),C=w.getMinutes().toString().padStart(2,"0"),y=(w.getMonth()+1).toString().padStart(2,"0"),E=w.getDate().toString().padStart(2,"0");return`${y}-${E} ${_}:${C}`}},crosshair:{horzLine:{color:m.text+"80",labelBackgroundColor:m.background},vertLine:{color:m.text+"80",labelBackgroundColor:m.background}}})},[c,m]),B.useEffect(()=>{const v=p.current.api(),w=i_.throttle(async _=>{if(_!=null&&_.from&&_.from<=2&&h&&!p.current.isLoading)try{p.current.isLoading=!0,await Promise.resolve(h())}catch(C){console.error("Error loading historical data:",C)}finally{p.current.isLoading=!1}},500,{leading:!0,trailing:!1});return v.timeScale().subscribeVisibleLogicalRangeChange(w),()=>{v.timeScale().unsubscribeVisibleLogicalRangeChange(w),w.cancel()}},[h]),B.useLayoutEffect(()=>{const w=p.current.api(),_=()=>{w.applyOptions({...a,width:s.clientWidth,height:s.clientHeight})};return window.addEventListener("resize",_),()=>{window.removeEventListener("resize",_),p.current.isRemoved=!0,w.remove()}},[]),B.useLayoutEffect(()=>{p.current.api()},[]),B.useLayoutEffect(()=>{p.current.api().applyOptions(a)},[]),B.useImperativeHandle(t,()=>p.current.api(),[]),B.useEffect(()=>{p.current.api().applyOptions({layout:r})},[r]),f.jsx(Ko.Provider,{value:p.current,children:e})});Tc.displayName="ChartContainer";const kc=B.forwardRef(({className:o,children:t,heightSmall:e="30vh",heightMedium:s="35vh",heightLarge:r="40vh",baseHeight:h=r,mobileHeight:a,customHeight:c},d)=>{const m=Ax(),p=Dx(),v=$x();let w=c;return c||(v&&a?w=a:p?w=e:m?w=s:w=h),f.jsx("div",{ref:d,className:Lt("w-full rounded-md overflow-hidden",o),style:{height:w},children:t})});kc.displayName="ResponsiveContainer";const r_=o=>{var p,v;const{t}=Dt(),{customHeight:e,...s}=o,[r,h]=B.useState(!1),a=B.useCallback(w=>h(w||!1),[]),{tradeInfo:c,tradeDirection:d}=Be(),{config:m}=vi();return f.jsxs(kc,{ref:a,heightLarge:"40vh",heightMedium:"35vh",heightSmall:"30vh",mobileHeight:"45vh",customHeight:e,children:[r&&f.jsx(Tc,{...s,container:r}),c&&d&&m&&f.jsxs("div",{className:"absolute top-2 left-2 bg-background/60 p-2 rounded shadow text-xs z-10",children:[f.jsxs("div",{className:"font-semibold mb-1",children:[t(d==="long"?"trade.long_position":"trade.short_position")," ",t("trade.info")]}),f.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[f.jsxs("span",{className:"text-muted-foreground",children:[t("trade.risk_ratio"),":"]}),f.jsxs("span",{className:"font-medium",children:[(m==null?void 0:m.riskRatio)||1.5,":1"]}),(m==null?void 0:m.partialClose)&&f.jsxs(f.Fragment,{children:[f.jsxs("span",{className:"text-muted-foreground",children:[t("trade.partial_close"),":"]}),f.jsxs("span",{className:"font-medium",children:[m.closeRatio,"%"]})]}),((p=c[d])==null?void 0:p.stoploss)&&f.jsxs(f.Fragment,{children:[f.jsxs("span",{className:"text-muted-foreground",children:[t("trade.stoploss"),":"]}),f.jsxs("span",{className:d==="long"?"text-red-500":"text-green-500",children:[c[d].stoploss.formatted," (",c[d].stoploss.percentage,"%)"]})]}),((v=c[d])==null?void 0:v.target)&&f.jsxs(f.Fragment,{children:[f.jsxs("span",{className:"text-muted-foreground",children:[t("trade.target_price"),":"]}),f.jsxs("span",{className:d==="long"?"text-green-500":"text-red-500",children:[c[d].target.formatted," (",c[d].target.percentage,"%)"]})]})]})]})]})},o_={background:"#FFFFFF",text:"#121212",grid:"#E5E5E5",border:"#D4D4D8",upColor:"rgba(34, 197, 94, 0.8)",downColor:"rgba(239, 68, 68, 0.8)",upVolumeColor:"rgba(34, 197, 94, 0.2)",downVolumeColor:"rgba(239, 68, 68, 0.2)",tpColor:"rgba(34, 197, 94, 0.9)",slColor:"rgba(239, 68, 68, 0.9)",partialTpColor:"rgba(59, 130, 246, 0.9)",labelTextColor:"#FFFFFF"},l_={background:"#121212",text:"#F5F5F5",grid:"#27272A",border:"#3F3F46",upColor:"rgba(34, 197, 94, 0.8)",downColor:"rgba(239, 68, 68, 0.8)",upVolumeColor:"rgba(34, 197, 94, 0.2)",downVolumeColor:"rgba(239, 68, 68, 0.2)",tpColor:"rgba(34, 197, 94, 0.9)",slColor:"rgba(239, 68, 68, 0.9)",partialTpColor:"rgba(96, 165, 250, 0.9)",labelTextColor:"#FFFFFF"},Rc=B.forwardRef((o,t)=>{const{theme:e}=Zu(),s=B.useContext(Ko),{tradeInfo:r,tradeDirection:h}=Be();if(!s)throw new Error("CandleSeries must be used within a Chart Context");const c=e==="dark"||e==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?l_:o_,d=B.useRef(null),m=B.useRef(null),p=B.useRef(null),v=B.useRef({_api:void 0,_volumeApi:void 0,api(){if(!this._api){const{data:_,options:C}=o;this._volumeApi=s.api().addHistogramSeries({priceFormat:{type:"volume"},priceScaleId:""});const y=_.map(E=>({time:E.time,value:E.volume,color:E.close>=E.open?c.upVolumeColor:c.downVolumeColor}));this._volumeApi.setData(y),this._volumeApi.priceScale().applyOptions({scaleMargins:{top:.7,bottom:0}}),this._api=s.api().addCandlestickSeries({upColor:c.upColor,downColor:c.downColor,borderVisible:!1,wickUpColor:c.upColor,wickDownColor:c.downColor,...C}),s.api().applyOptions({layout:{background:{color:c.background},textColor:c.text},grid:{vertLines:{color:c.grid,visible:!0},horzLines:{color:c.grid,visible:!0}},timeScale:{borderColor:c.border,timeVisible:!0},rightPriceScale:{borderColor:c.border}}),this._api.setData(_)}return this._api},free(){this._volumeApi&&!s.isRemoved&&s.free(this._volumeApi),this._api&&(d.current&&this._api.removePriceLine(d.current),m.current&&this._api.removePriceLine(m.current),p.current&&this._api.removePriceLine(p.current)),d.current=null,m.current=null,p.current=null}}),{config:w}=vi();return B.useEffect(()=>{const _=v.current._api;if(_&&(d.current&&(_.removePriceLine(d.current),d.current=null),m.current&&(_.removePriceLine(m.current),m.current=null),p.current&&(_.removePriceLine(p.current),p.current=null)),!_||!r||!h)return;const C=r[h];if(!C||!C.stoploss||!C.target)return;const y=C.stoploss.price,E=C.target.price;y&&(d.current=_.createPriceLine({price:y,color:c.slColor,lineWidth:2,lineStyle:gn.Dashed,axisLabelVisible:!0,title:"SL"})),E&&!(w!=null&&w.partialClose)&&(m.current=_.createPriceLine({price:E,color:c.tpColor,lineWidth:2,lineStyle:gn.Solid,axisLabelVisible:!0,title:`TP (${(w==null?void 0:w.riskRatio)||1.5}:1)`})),w!=null&&w.partialClose&&E&&(p.current=_.createPriceLine({price:E,color:c.partialTpColor,lineWidth:1,lineStyle:gn.Dotted,axisLabelVisible:!0,title:`TP (${w.riskRatio}:1) ${w.closeRatio}% 청산`}))},[r,h,e,c,v.current._api,w]),B.useEffect(()=>{if(v.current._api&&(v.current._api.applyOptions({upColor:c.upColor,downColor:c.downColor,wickUpColor:c.upColor,wickDownColor:c.downColor}),s.api().applyOptions({layout:{background:{color:c.background},textColor:c.text},grid:{vertLines:{color:c.grid},horzLines:{color:c.grid}},timeScale:{borderColor:c.border},rightPriceScale:{borderColor:c.border}}),v.current._volumeApi&&o.data)){const _=o.data.map(C=>({time:C.time,value:C.volume,color:C.close>=C.open?c.upVolumeColor:c.downVolumeColor}));v.current._volumeApi.setData(_)}},[e,c,o.data]),B.useLayoutEffect(()=>{const _=v.current;return _.api(),()=>_.free()},[]),B.useLayoutEffect(()=>{const _=v.current,{data:C,options:y}=o;if(_._api&&(y&&_._api.applyOptions(y),_._api.setData(C),_._volumeApi)){const E=C.map(P=>({time:P.time,value:P.volume,color:P.close>=P.open?c.upVolumeColor:c.downVolumeColor}));_._volumeApi.setData(E)}},[o.data,o.options,c]),B.useImperativeHandle(t,()=>v.current.api(),[]),f.jsx(Ko.Provider,{value:s,children:o.children})});Rc.displayName="CandleSeries";const Oc=B.createContext(null),Ac=()=>{const o=B.useContext(Oc);if(!o)throw new Error("useChartData must be used within a ChartDataProvider");return o},h_=({height:o=400})=>{const{t}=Dt(),[e]=Gt(),{data:s,handleScroll:r,chartformat:h,isLoading:a}=Ac(),c=e.get("timeframe"),d=e.get("exchange"),m=e.get("symbol"),p=B.useRef(null);return B.useEffect(()=>{p.current&&(p.current.setData(s),p.current.applyOptions({priceFormat:{type:"price",...h}}))},[s,h]),f.jsx("div",{className:"relative w-full border rounded-md overflow-hidden h-[35vh]",children:s.length>0?f.jsx(r_,{onReachStart:r,customHeight:o?`${o}px`:void 0,children:f.jsx(Rc,{ref:p,data:s})},d+"-"+m+"-"+c+"-chart"):f.jsx("div",{className:`w-full flex items-center justify-center ${o?"":"h-[40vh] h-lg:h-[35vh] h-xl:h-[30vh]"}`,style:o?{height:`${o}px`}:void 0,children:a?f.jsxs("div",{className:"flex flex-col items-center gap-2",children:[f.jsx(sb,{className:"w-8 h-8 animate-spin text-primary"}),f.jsx("span",{className:"text-sm text-muted-foreground",children:t("common.loading")})]}):f.jsxs("div",{className:"text-center p-4",children:[f.jsx("div",{className:"text-lg font-medium mb-1",children:t("chart.no_data")}),f.jsx("div",{className:"text-sm text-muted-foreground",children:t("chart.try_different")})]})})})},Dc=(o,t)=>{switch(o){case"binance":switch(t){case"60":return"1h";case"240":return"4h";case"D":return"1d";case"W":return"1w";case"M":return"1M";default:return`${t}m`}case"bybit":switch(t){case"D":return"D";case"W":return"W";case"M":return"M";default:return t}case"bitget":switch(t){case"60":return"1h";case"240":return"4h";case"D":return"1d";case"W":return"1w";case"M":return"1M";default:return`${t}m`}default:return t}},ll=o=>{switch(o){case"D":return 24*60*60*1e3;case"W":return 7*24*60*60*1e3;case"M":return 30*24*60*60*1e3;default:return parseInt(o)*60*1e3}},a_=(o,t)=>{const s=ll(t)*250;switch(o){case"binance":return Math.min(s,200*24*60*60*1e3);case"bitget":return Math.min(s,90*24*60*60*1e3);default:return s}},u_=async({pageParam:o,ccxt:t,exchange:e,timeframe:s,symbol:r})=>{var m;if(!t||!t[e])throw new Error("Exchange instances not initialized");const h=t[e].pro,a=o,c=a_(e,s),d=a-c;try{const p=Dc(e,s),v=await h.fetchOHLCV(r,p,d,250,{until:a,...e==="binance"&&{limit:250,endTime:a},...e==="bitget"&&{endTime:a,limit:250},...e==="bybit"&&{limit:250}});if(!v||v.length===0)return{data:[],nextCursor:void 0};const w=v.map(_=>({time:_[0]/1e3,open:_[1],high:_[2],low:_[3],close:_[4],volume:_[5]}));return{data:w,nextCursor:(m=w[0])!=null&&m.time?w[0].time*1e3:void 0}}catch(p){return console.error(`Error fetching OHLCV for ${e}:`,p),{data:[],nextCursor:void 0}}},c_=async({ccxt:o,exchange:t,timeframe:e,symbol:s,lastCandleTime:r})=>{if(!o||!o[t])throw new Error("Exchange instances not initialized");const h=o[t].pro,a=Date.now(),c=ll(e),d=r?r*1e3:a-c*2,m=r?Math.ceil((a-r*1e3)/c):2;try{const p=Dc(t,e),v=await h.fetchOHLCV(s,p,d,m,{...t==="binance"&&{limit:m},...t==="bitget"&&{endTime:a,limit:m},...t==="bybit"&&{limit:m}});return!v||v.length===0?[]:v.map(w=>({time:w[0]/1e3,open:w[1],high:w[2],low:w[3],close:w[4],volume:w[5]}))}catch(p){return console.error(`Error fetching realtime OHLCV for ${t}:`,p),[]}},qo=(o,t,e)=>{const s=[];for(let h=0;h<3;h++)t-h>=0&&o[t-h]&&s.push(o[t-h][e]);if(s.length===0)return o[o.length-1];let r;if(e==="low"?r=s.indexOf(Math.min(...s)):r=s.indexOf(Math.max(...s)),r===0){const h=o.filter(a=>a[e]===s[r]);return h[h.length-1]}return qo(o,t-r,e)},f_=({children:o})=>{const[t]=Gt(),e=t.get("timeframe")?t.get("timeframe"):"30",s=t.get("exchange"),r=t.get("symbol"),[h,a]=B.useState([]),[c,d]=B.useState(!1),m=ll(e),p=B.useCallback(P=>{if(P.length<2)return P;const A=[],$=m/1e3;for(let U=0;U<P.length-1;U++){const W=P[U],I=P[U+1];A.push(W);const R=I.time-W.time,V=Math.floor(R/$)-1;if(V>0)for(let q=1;q<=V;q++){const rt=W.time+$*q;A.push({time:rt,open:W.close,high:W.close,low:W.close,close:W.close,volume:0})}}return A.push(P[P.length-1]),A},[m]);B.useEffect(()=>{a([]),d(!1)},[e]);const v=Bi(),w=db({queryKey:[s,r,e,"historical"],initialPageParam:Date.now(),queryFn:async({pageParam:P})=>await u_({ccxt:v,exchange:s,pageParam:P,timeframe:e,symbol:r}),getNextPageParam:P=>P.nextCursor,enabled:!!v,refetchOnMount:!0,refetchOnReconnect:!0,refetchOnWindowFocus:!0}),_=$i({queryKey:[s,r,e,"realtime",h.length>0?Number(h[h.length-1].time):void 0],queryFn:async()=>await c_({ccxt:v,exchange:s,timeframe:e,symbol:r,lastCandleTime:h.length>0?Number(h[h.length-1].time):void 0}),enabled:!!v,refetchInterval:100,refetchIntervalInBackground:!0,refetchOnMount:!0,refetchOnReconnect:!0,refetchOnWindowFocus:!0});B.useEffect(()=>{if(!c&&w.data){const P=w.data.pages.flatMap(A=>A.data);if(P.length>0){const A=P.sort((U,W)=>U.time-W.time),$=p(A);a($),d(!0)}}},[w.data,c,e,p]),B.useEffect(()=>{var U;if(!c||!((U=_.data)!=null&&U.length))return;const P=_.data,A=P[P.length-1],$=P[P.length-2];a(W=>{const I=[...W],R=I.length-1;if(R<0)return I;const q=I[R].time,rt=A.time;return P.length>2&&P.slice(0,-1).forEach(X=>{const tt=Number(X.time),G=I.findIndex(wt=>Number(wt.time)===tt);G!==-1?I[G]=X:tt>q&&I.push(X)}),q===rt?I[R]=A:q===($==null?void 0:$.time)?(I[R]=$,I.push(A)):rt>q&&I.push(A),I})},[_.data,c]);const C=B.useCallback(async()=>{if(w.hasNextPage&&!w.isFetchingNextPage)try{const P=await w.fetchNextPage();if(!P.data)return;const A=P.data.pages[P.data.pages.length-1];if(!(A!=null&&A.data.length))return;a($=>[...A.data.filter(I=>!$.some(R=>Number(R.time)===Number(I.time))),...$].sort((I,R)=>Number(I.time)-Number(R.time)))}catch(P){console.error("Error fetching next page:",P)}},[w]),y=P=>{var A,$,U,W,I,R,V,q,rt,X;return{precision:((R=(I=(W=(U=($=(A=v==null?void 0:v[s])==null?void 0:A.ccxt)==null?void 0:$.market(P))==null?void 0:U.precision)==null?void 0:W.price)==null?void 0:I.toString().split(".")[1])==null?void 0:R.length)??2,minMove:((X=(rt=(q=(V=v==null?void 0:v[s])==null?void 0:V.ccxt)==null?void 0:q.market(P))==null?void 0:rt.precision)==null?void 0:X.price)??.01}},E={data:h,isLoading:w.isLoading||_.isLoading,hasNextPage:w.hasNextPage,isFetchingNextPage:w.isFetchingNextPage,chartformat:y(r),handleScroll:C};return f.jsx(Oc.Provider,{value:E,children:o})},d_=async(o,t,e,s)=>{if(!(o!=null&&o[t]))throw new Error("Exchange instance not initialized");const r=s?s.exchangeInstance.ccxt:o[t].ccxt;try{if(s&&t!="bitget"){const h=await r.fetchTradingFee(e);if(console.log(h),!(h!=null&&h.maker)||!(h!=null&&h.taker))throw new Error("Invalid fee structure returned from exchange");return{maker:h.maker,taker:h.taker}}else{const h=o[t].ccxt.market(e);if(!(h!=null&&h.maker)||!(h!=null&&h.taker))throw new Error("Market data does not contain fee information");return{maker:h.maker,taker:h.taker}}}catch(h){throw h instanceof Error?new Error(`Failed to fetch trading fees: ${h.message}`):h}},m_=(o,t)=>{const[e]=Gt(),s=e.get("id"),{decryptedAccounts:r}=Ve(),h=Bi();return $i({queryKey:[o,t,"fees",s],queryFn:async()=>{if(!h)throw new Error("CCXT context not initialized");return await d_(h,o,t,s?r==null?void 0:r[s]:void 0)},enabled:!!h,retry:(a,c)=>c instanceof Error&&c.message.includes("authentication")?!1:a<3,staleTime:5*60*1e3})},g_=(o,t,e)=>((e?o-t:t-o)/o*100).toFixed(2),Bu=(o,t,e,s,r)=>{if(e){const h=e.taker*2;return Math.round(o/(Math.abs(t)+h*100)*10)/10}return Math.round(o/Math.abs(t)*10)/10},p_=(o,t,e,s,r)=>{const h=Math.abs(o-t);if(r){const a=r.maker*1,c=h*(1+a);return s?o+c*e:o-c*e}return s?o+h*e:o-h*e},v_=(o,t)=>((t-o)/o*100).toFixed(2);function x_(o,t,e){if(!(e!=null&&e.length))return{leverage:125,maxPositionSize:o};const s=[...e].sort((c,d)=>(d.maxNotional??0)-(c.maxNotional??0));let r;for(const c of s)if(c.maxNotional&&o<=c.maxNotional)r=c;else break;r||(r=s[0]);const h=t*(r.maxLeverage??125),a=Math.min(r.maxNotional??o,h);return{leverage:r.maxLeverage??125,maxPositionSize:a}}const Vu=({currentPrice:o,stopLossPrice:t,riskRatio:e,risk:s,ccxtInstance:r,symbol:h,isLong:a,leverageInfo:c,availableBalance:d,tradingFee:m})=>{var C,y,E,P,A;console.log("사용 가능한 자본:",d);const p=g_(o,t,a),v=p_(o,t,e,a,m),w=Bu(s,parseFloat(p),m),_={stoploss:{price:t,percentage:p,formatted:r.priceToPrecision(h,t)},target:{price:v,percentage:v_(o,v),formatted:r.priceToPrecision(h,v)},leverage:Math.min(w,c.maxLeverage),calculatedLeverage:Math.min(w,c.maxLeverage)};if(d&&m)try{const $=h.includes("USDT"),U=Math.abs((o-t)/o*100),W=m.taker*2;if($){const R=d*(s/100)/(U/100+W);console.log("usdt기준 계산 전 포지션 규모:",R);const{leverage:V,maxPositionSize:q}=x_(R,d,c.leverageTier||[]);console.log("usdt기준 계산 후 포지션 규모:",q);const rt=Math.min(R,q),X=rt/o,tt=r.market(h),G=((y=(C=tt==null?void 0:tt.limits)==null?void 0:C.amount)==null?void 0:y.min)||0;if(X<G)_.insufficientCapital={calculatedSize:X,minRequiredSize:G,message:`자본이 부족합니다. 최소 주문 수량은 ${G}이지만 계산된 수량은 ${X.toFixed(8)}입니다.`};else{const wt=rt/V,Et=rt*W,Jt=rt*(U/100)+Et;_.position={size:Number(r.amountToPrecision(h,X)),margin:Number(r.costToPrecision(h,wt)),fee:Number(r.costToPrecision(h,Et)),totalLoss:Number(r.costToPrecision(h,Jt))},_.calculatedLeverage=V}}else{console.log("========== 인버스 계약 계산 ==========");const I=Math.abs((o-t)/o*100),R=m.taker*2,q=d*o*(s/100)/(I/100+R);console.log("계산된 계약 규모:",q);const rt=Bu(s,parseFloat(p),m);let X,tt=rt,G=q;if((E=c.leverageTier)!=null&&E.length){console.log("원래 티어 정보:",JSON.stringify(c.leverageTier,null,2));const Rt=[...c.leverageTier].sort((at,ei)=>(at.maxNotional??0)-(ei.maxNotional??0)),$t=q/o;console.log("계산된 계약 규모(USD):",q),console.log("BTC로 변환된 계약 규모:",$t);for(const at of Rt){const ei=(at.maxNotional??0)*o;if(console.log(`티어 ${at.tier}: maxNotional(BTC) ${at.maxNotional}, maxNotional(USD) ${ei}`),at.maxNotional&&$t<=at.maxNotional){X=at,tt=at.maxLeverage??c.maxLeverage,console.log("최대 레버리지 적용:",tt,"× (목표 레버리지:",rt,")"),G=q,G=q,console.log(`티어 ${at.tier} 선택: maxNotional(BTC) ${at.maxNotional}, maxNotional(USD) ${ei}, 레버리지 ${tt}`);break}}if(!X){X=Rt[Rt.length-1],tt=(X==null?void 0:X.maxLeverage)??c.maxLeverage,console.log("최대 레버리지 적용:",tt,"× (목표 레버리지:",rt,")");const at=((X==null?void 0:X.maxNotional)??0)*o;G=Math.min(q,at),console.log(`최대 티어 선택: tier ${X==null?void 0:X.tier}, maxNotional(BTC) ${X==null?void 0:X.maxNotional}, maxNotional(USD) ${at}, 레버리지 ${tt}`)}}const wt=r.market(h);let Et=((A=(P=wt==null?void 0:wt.limits)==null?void 0:P.amount)==null?void 0:A.min)||1;wt!=null&&wt.contractSize&&(Et=Math.max(Et,Number(wt.contractSize)||1)),G<Et&&(G=Et),G=Math.floor(G),console.log("최종 계약 규모:",G),console.log("최종 레버리지:",tt);const ne=G/tt,Jt=d*o;console.log("필요 마진:",ne),console.log("가용 마진(USD):",Jt);const kt=Jt*.95;if(console.log("사용 가능한 마진 (95%):",kt),ne>kt){console.log("자본 부족 상태 감지: 필요 마진이 가용 마진보다 큼");const Rt=Math.floor(kt*tt);if(Rt<Et)_.insufficientCapital={calculatedSize:G,minRequiredSize:Et,message:`자본이 부족합니다. 필요 마진: ${ne.toFixed(2)} USD, 가용 마진: ${Jt.toFixed(2)} USD`};else{console.log("계약 크기 조정: 원래",G,"→ 조정됨",Rt),G=Rt;const $t=G/tt;console.log("조정된 마진:",$t);const at=G*R,Hs=G*(I/100)+at;return _.position={size:Math.floor(G),margin:Number(r.costToPrecision(h,$t)),fee:Number(r.costToPrecision(h,at)),totalLoss:Number(r.costToPrecision(h,Hs))},_.calculatedLeverage=tt,_}}else{const Rt=G*R,at=G*(I/100)+Rt;_.position={size:Math.floor(G),margin:Number(r.costToPrecision(h,ne)),fee:Number(r.costToPrecision(h,Rt)),totalLoss:Number(r.costToPrecision(h,at))},_.calculatedLeverage=tt}}}catch($){console.error("Failed to calculate position details:",$),_.error={message:$ instanceof Error?$.message:"Unknown error",type:"calculation_error"}}return _},b_=()=>{const[o,t]=B.useState(!1),[e,s]=B.useState(),{decryptedAccounts:r,isLoading:h}=Ve(),{cache:a,isLoading:c}=Ix(),[d,m]=Gt(),p=d.get("exchange"),v=d.get("timeframe"),w=d.get("id"),_=Bi();return B.useEffect(()=>{!o&&!v&&!c&&m(C=>{const y=new URLSearchParams(C);return y.set("timeframe",(a==null?void 0:a.data.timeframe)||"30"),y})},[a,o,c,m,d,v,_]),B.useEffect(()=>{if(!h&&!o&&v){if(r){const C=Object.values(r).filter(y=>y.exchange==p);s(C),C&&C.length>0&&m(y=>{const E=new URLSearchParams(y);return E.set("id",C[0].id),E})}t(!0)}},[r,h,o,w,m,p,v]),{isLoaded:o,exchangeAccounts:e}},w_=(o,t,e)=>{const[s,r]=B.useState(),{accountsBalance:h,isLoading:a}=Ve(),c=t==null?void 0:t.split(":")[1];return B.useEffect(()=>{var p;if(!!(o&&t&&e&&c)&&!!(h&&!a)){const v=h[o],w=(p=v==null?void 0:v.balance)==null?void 0:p.usd,_=v==null?void 0:v.balance[c];if(!w&&!_)return;const C={total:$e(w.total),used:$e(w.used),free:$e(w.free)};let y={total:"0",used:"0",free:"0"};c=="USDT"||c=="USDC"?y={total:$e(_.total),used:$e(_.used),free:$e(_.free)}:y={..._},r({base:{...y,name:c},usd:C})}},[h,a,o,t,e,c]),s},__=(o,t,e,s,r)=>{const[h,a]=B.useState(),c=Bi(),{config:d,isLoading:m}=vi(),{data:p,isLoading:v}=Ac(),{data:w,isLoading:_}=m_(o,t),{data:C,isLoading:y}=tc(o,t),{decryptedAccounts:E,isLoading:P}=Ve(),A=r&&E?E[r]:null;return B.useEffect(()=>{const $=!!p&&p.length>0&&!v,U=!!w&&!_,W=!!C&&!y,I=!!d&&!m,R=!!e;if(console.log(w),c&&$&&U&&W&&I&&R){const V=p[p.length-1].close,q=qo(p,p.length-1,"high").high,rt=qo(p,p.length-1,"low").low,X={maker:w.maker,taker:w.taker},tt=Vu({currentPrice:V,stopLossPrice:rt,riskRatio:d.riskRatio,risk:d.risk,ccxtInstance:c[o].ccxt,symbol:t,isLong:!0,availableBalance:s,leverageInfo:e,tradingFee:X}),G=Vu({currentPrice:V,stopLossPrice:q,riskRatio:d.riskRatio,risk:d.risk,ccxtInstance:c[o].ccxt,symbol:t,isLong:!1,availableBalance:s,leverageInfo:e,tradingFee:X});tt&&G&&(A&&(tt.account={positionMode:A.positionMode||"oneway"},G.account={positionMode:A.positionMode||"oneway"},console.log(`[Debug] Adding account positionMode to trade info: ${A.positionMode||"oneway"}`)),a({long:tt,short:G,currentPrice:V,tradingfee:X,leverageInfo:e}))}},[s,c,o,t,d,p,w,C,e,v,_,y,m,A,r,P]),h},y_=(o,t,e)=>{const s=Bi();return $i({queryKey:["maxLeverage",o,t,e==null?void 0:e.id],queryFn:async()=>{if(!s)return;const r=e?e.exchangeInstance.ccxt:s[o].ccxt;try{if(o==="bitget"||o=="bybit"){const m=await r.fetchMarketLeverageTiers(t);return console.log("Bitget leverage tiers:",m),!m||m.length===0?{maxLeverage:125,leverageTier:[]}:{leverageTier:m,maxLeverage:m[0].maxLeverage??125}}if(o==="binance"&&!e)return{maxLeverage:125,leverageTier:[]};const h=await r.fetchLeverageTiers(void 0,{category:"linear"});console.log("Linear tiers:",h);const a=await r.fetchLeverageTiers(void 0,{category:"inverse"});console.log("Inverse tiers:",a);const d={...a,...h}[t];return console.log("Combined tiers for symbol:",d),!d||d.length===0?{maxLeverage:125,leverageTier:[]}:{leverageTier:d,maxLeverage:d[0].maxLeverage??125}}catch(h){return console.error("Error fetching leverage tiers:",h),{maxLeverage:125,leverageTier:[]}}},enabled:!!t&&!!o})},S_=({children:o})=>{var A,$,U,W,I,R,V,q;const{isLoaded:t,exchangeAccounts:e}=b_(),[s]=Gt(),[r,h]=B.useState("long"),a=s.get("exchange"),c=decodeURIComponent(s.get("symbol")),d=s.get("id"),m=c==null?void 0:c.split(":")[1],{accountsBalance:p,decryptedAccounts:v,isLoading:w}=Ve(),_=w_(d,c,a),{data:C}=y_(a,c,d?v==null?void 0:v[d]:void 0),y=__(a,c,C,a=="binance"?($=(A=p==null?void 0:p[d])==null?void 0:A.balance[m])!=null&&$.total?Number((W=(U=p[d])==null?void 0:U.balance[m])==null?void 0:W.total):0:(R=(I=p==null?void 0:p[d])==null?void 0:I.balance[m])!=null&&R.free?Number((q=(V=p[d])==null?void 0:V.balance[m])==null?void 0:q.free):0,d),E=tc(a,c),P=nb({exchange:a,symbol:c});return f.jsx(rc.Provider,{value:{tradeInfo:y,marketInfoQuery:E,tickerQuery:P,exchangeAccounts:e,accountsBalance:p,isAccountsLoading:w,isLoaded:t,balanceInfo:_,tradeDirection:r,setTradeDirection:h},children:o})};function Fi({className:o,children:t,variant:e="default",onClick:s}){return f.jsx(As,{className:Lt("w-full border rounded-lg bg-card overflow-hidden",e==="compact"&&`p-${Ba.SM}`,e==="default"&&`p-${Ba.MD}`,e==="minimal"&&"border-0 shadow-none",s&&"cursor-pointer hover:border-primary/50 transition-colors",o),onClick:s,children:t})}const C_=()=>{const{t:o}=Dt(),[t]=Gt(),e=Xo(),s=t.get("exchange"),r=t.get("id"),h=t.get("symbol"),{decryptedAccounts:a,isLoading:c}=Ve(),d=r&&a?a[r]:null,{data:m,isLoading:p,error:v}=$i({queryKey:["openOrders",s,r],queryFn:async()=>{if(!d||!d.exchangeInstance)throw new Error(o("trade.account_or_instance_not_found"));return await d.exchangeInstance.ccxt.fetchOpenOrders(h??void 0)},enabled:!!d&&!!d.exchangeInstance,refetchInterval:200,staleTime:1/0}),w=async(y,E)=>{if(!(d!=null&&d.exchangeInstance)){Bt.error(o("trade.account_instance_error"));return}try{await d.exchangeInstance.ccxt.cancelOrder(y,E),Bt.success(o("trade.order_cancelled")),e.invalidateQueries({queryKey:["openOrders",s,r]})}catch{Bt.error(o("trade.order_cancel_failed"))}};if(c||p)return f.jsxs("div",{className:"space-y-2",children:[f.jsx("div",{className:"px-1 text-sm font-medium text-muted-foreground",children:o("trade.pending_orders")}),[...Array(3)].map((y,E)=>f.jsx(Fi,{children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex flex-col gap-1",children:[f.jsx(dt,{className:"w-24 h-5"}),f.jsx(dt,{className:"w-32 h-4"})]}),f.jsxs("div",{className:"flex flex-col items-end gap-1",children:[f.jsx(dt,{className:"w-20 h-5"}),f.jsx(dt,{className:"w-16 h-4"})]})]})},E))]});if(v)return f.jsxs("div",{className:"py-8 text-center text-red-500",children:[f.jsx("div",{children:o("trade.order_loading_failed")}),f.jsx(Fe,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>e.refetchQueries({queryKey:["openOrders",s,r]}),children:o("trade.retry")})]});const C=m==null?void 0:m.map(y=>{var $;const E=y.side==="buy",P=y.filled?y.filled/y.amount*100:0,A=P>0&&P<100;return{id:y.id,symbol:y.symbol,type:y.type,isLong:E,leverage:(($=y.info)==null?void 0:$.leverage)||0,entryPrice:y.price??0,size:y.amount,profit:0,profitPercentage:0,onCancelOrder:()=>w(y.id,y.symbol),meta:{status:y.status,filled:y.filled,remaining:y.remaining,filledPercentage:P,isPartiallyFilled:A,createdAt:y.timestamp?new Date(y.timestamp):void 0}}});return f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"px-1 text-sm font-medium text-muted-foreground",children:[o("trade.pending_orders")," (",(C==null?void 0:C.length)??0,")"]}),C&&C.length>0?C.map(y=>f.jsx(Fi,{children:f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"font-semibold",children:y.symbol}),f.jsx("div",{className:`px-2 py-0.5 rounded text-xs font-medium ${y.isLong?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"}`,children:y.isLong?o("trade.long"):o("trade.short")}),f.jsx("div",{className:"text-xs px-2 py-0.5 rounded bg-accent/50",children:y.type==="limit"?f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(sc,{className:"w-3 h-3"})," ",o("trade.limit_order")]}):f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(bb,{className:"w-3 h-3"})," ",o("trade.market_order")]})})]}),f.jsxs("div",{className:"text-sm font-medium",children:["$",y.entryPrice.toFixed(2)]})]}),f.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[f.jsxs("span",{children:[o("trade.size"),": ",y.size," ",y.symbol.replace("USDT","")]}),f.jsxs("span",{children:[y.meta.filledPercentage.toFixed(1),"% ",o("trade.execution")]})]}),y.meta.isPartiallyFilled&&f.jsx("div",{className:"h-1.5 bg-accent rounded-full overflow-hidden",children:f.jsx("div",{className:"h-full bg-primary",style:{width:`${y.meta.filledPercentage}%`}})}),f.jsx("div",{className:"flex justify-end pt-1 border-t border-border/30",children:f.jsxs(Fe,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:E=>{E.stopPropagation(),y.onCancelOrder()},children:[f.jsx(Hu,{className:"w-3 h-3 mr-1"}),o("trade.cancel_order")]})})]})},y.id)):f.jsx("div",{className:"py-8 text-center text-muted-foreground",children:o("trade.no_pending_orders")})]})},N_=()=>{var c;const{t:o}=Dt(),[t]=Gt(),e=t.get("id"),{accountsBalance:s,isLoading:r}=Ve(),h=e?(c=s==null?void 0:s[e])==null?void 0:c.balance:null,a=h?Object.entries(h).filter(([d,m])=>m.total>0&&!["USD","USDC"].includes(d)).map(([d,m],p)=>({id:p,asset:d,amount:m.total})):[];return r?f.jsxs("div",{className:"space-y-2",children:[f.jsx("div",{className:"px-1 text-sm font-medium text-muted-foreground",children:o("trade.owned_assets")}),[...Array(4)].map((d,m)=>f.jsx(Fi,{variant:"compact",children:f.jsxs("div",{className:"flex items-center justify-between py-1",children:[f.jsx(dt,{className:"w-16 h-5"}),f.jsx(dt,{className:"w-20 h-5"})]})},m))]}):f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"px-1 text-sm font-medium text-muted-foreground",children:[o("trade.owned_assets")," (",a.length,")"]}),a.length>0?a.map(d=>f.jsx(M_,{...d},d.id)):f.jsx("div",{className:"py-8 text-center text-muted-foreground",children:o("trade.no_owned_assets")})]})},M_=({asset:o,amount:t})=>f.jsx(Fi,{variant:"compact",children:f.jsxs("div",{className:"flex items-center justify-between py-1",children:[f.jsx("div",{className:"flex items-center gap-2",children:f.jsx("span",{className:"font-medium",children:o})}),f.jsx("div",{className:"font-semibold",children:t.toFixed(2)})]})});async function L_({ccxtInstance:o,symbol:t,positionSide:e,exchange:s,price:r,stopLossPrice:h,takeProfitPrice:a,accountId:c}){console.log(`Updating position for account ${c}`);const d=Bt.loading(`${e==="long"?"롱":"숏"} 포지션 설정 업데이트 중...`,{position:"bottom-center",style:{borderRadius:"10px",background:"#333",color:"#fff"}});try{const m=e==="long"?"sell":"buy",p=await E_(o,s,t),v=[],_=(await o.fetchPositions([t])).find(y=>y.symbol===t&&y.side===e);if(!_||!_.contracts||_.contracts===0)throw new Error("현재 포지션을 찾을 수 없습니다.");const C=_.contracts;try{const E=(await o.fetchOpenOrders(t)).filter(P=>{var A,$;return(P.reduceOnly===!0||((A=P.info)==null?void 0:A.reduceOnly)===!0||(($=P.info)==null?void 0:$.reduce_only)===!0)&&(e==="long"?P.side==="sell":P.side==="buy")});for(const P of E)await o.cancelOrder(P.id,t);console.log(`${E.length}개의 기존 TP/SL 주문 취소 완료`)}catch(y){console.warn("기존 주문 취소 중 오류 발생:",y)}if(h)try{let y={reduceOnly:!0};if(s==="binance")y={...y,positionSide:e.toUpperCase(),stopLossPrice:h,hedged:!0};else if(s==="bybit"){const P=e==="long"?"below":"above";p?y={...y,positionIdx:e==="long"?1:2,triggerPrice:h,stopPrice:h,triggerDirection:P,closeOnTrigger:!0,reduceOnly:!0}:y={...y,positionIdx:0,triggerPrice:h,stopPrice:h,triggerDirection:P,closeOnTrigger:!0,reduceOnly:!0}}else s==="bitget"&&(y={...y,stopLoss:{triggerPrice:h},holdSide:e,hedged:!0});let E;if(s==="bybit"){const P={orderType:"market",reduceOnly:!0,triggerPrice:h,triggerDirection:e==="long"?2:1,orderLinkId:`sl_${t}_${Date.now()}`,...p?{positionIdx:e==="long"?1:2}:{positionIdx:0}};E=await o.createOrder(t,"market",m,C,void 0,P),console.log("Bybit 손절 주문 결과:",E)}else E=await o.createOrder(t,"stop",m,C,r||h,y);v.push(E),console.log("손절가 설정 완료:",E)}catch(y){throw console.error("손절가 설정 실패:",y),new Error(`손절가 설정 실패: ${y instanceof Error?y.message:"알 수 없는 오류"}`)}if(a)try{let y={reduceOnly:!0};s==="binance"?y={...y,positionSide:e.toUpperCase(),takeProfitPrice:a,hedged:!0}:s==="bybit"?p?y={...y,positionIdx:e==="long"?1:2}:y={...y,positionIdx:0}:s==="bitget"&&(y={...y,holdSide:e,hedged:!0});let E;if(s==="bybit"){const P={reduceOnly:!0,orderLinkId:`tp_${t}_${Date.now()}`,...p?{positionIdx:e==="long"?1:2}:{positionIdx:0}};E=await o.createOrder(t,"limit",m,C,a,P),console.log("Bybit 타겟 주문 결과:",E)}else E=await o.createOrder(t,"limit",m,C,a,y);v.push(E),console.log("타겟가 설정 완료:",E)}catch(y){throw console.error("타겟가 설정 실패:",y),new Error(`타겟가 설정 실패: ${y instanceof Error?y.message:"알 수 없는 오류"}`)}return Bt.success(`${t} ${e==="long"?"롱":"숏"} 포지션 설정 업데이트 완료!`,{id:d,icon:"✅",style:{borderRadius:"10px",background:e==="long"?"#10b981":"#ef4444",color:"#fff"}}),v}catch(m){throw console.error("포지션 설정 업데이트 실패:",m),Bt.error(`설정 업데이트 실패: ${m instanceof Error?m.message:"알 수 없는 오류"}`,{id:d,icon:"❌",duration:5e3,style:{borderRadius:"10px",background:"#f43f5e",color:"#fff"}}),m}}async function E_(o,t,e){try{if(t==="binance"){const s=await o.fapiPrivateGetPositionSideDual();return s.dualSidePosition===!0||s.dualSidePosition==="true"}else if(t==="bybit"){const s=await o.fetchPositionMode(e);return!!(s&&typeof s=="object"&&"hedged"in s&&(s.hedged===!0||s.hedged==="true"))}else if(t==="bitget")return!0;return!1}catch(s){return console.warn("포지션 모드 확인 중 오류 발생:",s),!1}}function P_(){const o=Xo();return Ku({mutationFn:L_,onSuccess:(t,e)=>{const{symbol:s,exchange:r,accountId:h}=e;o.invalidateQueries({queryKey:["positions",r,h,s]}),o.invalidateQueries({queryKey:["openOrders",r,h]})}})}function j_({open:o,onOpenChange:t,position:e,ccxtInstance:s,exchange:r,accountId:h}){const[a,c]=B.useState(""),[d,m]=B.useState(""),[p,v]=B.useState(""),[w,_]=B.useState(""),C=P_();B.useEffect(()=>{o&&e&&(e.currentTakeProfitPrice?(c(e.currentTakeProfitPrice.toString()),y(e.currentTakeProfitPrice)):(c(""),v("")),e.currentStopLossPrice?(m(e.currentStopLossPrice.toString()),E(e.currentStopLossPrice)):(m(""),_("")))},[o,e]);const y=I=>{if(!I||!e.entryPrice)return;const R=e.side==="long"?(I-e.entryPrice)/e.entryPrice*100:(e.entryPrice-I)/e.entryPrice*100;v(R.toFixed(2))},E=I=>{if(!I||!e.entryPrice)return;const R=e.side==="long"?(e.entryPrice-I)/e.entryPrice*100:(I-e.entryPrice)/e.entryPrice*100;_(R.toFixed(2))},P=I=>{const R=I.target.value;c(R);const V=parseFloat(R);isNaN(V)?v(""):y(V)},A=I=>{const R=I.target.value;m(R);const V=parseFloat(R);isNaN(V)?_(""):E(V)},$=I=>{const R=I.target.value;v(R);const V=parseFloat(R);if(!isNaN(V)&&e.entryPrice){const q=e.side==="long"?e.entryPrice*(1+V/100):e.entryPrice*(1-V/100);c(q.toFixed(e.symbol.includes("BTC")?1:2))}else c("")},U=I=>{const R=I.target.value;_(R);const V=parseFloat(R);if(!isNaN(V)&&e.entryPrice){const q=e.side==="long"?e.entryPrice*(1-V/100):e.entryPrice*(1+V/100);m(q.toFixed(e.symbol.includes("BTC")?1:2))}else m("")},W=async()=>{if(!s||!r){Bt.error("거래소 인스턴스나 계정 정보가 없습니다");return}const I=h||"unknown";try{await C.mutateAsync({ccxtInstance:s,symbol:e.symbol,positionSide:e.side,exchange:r,stopLossPrice:d?parseFloat(d):void 0,takeProfitPrice:a?parseFloat(a):void 0,accountId:I}),t(!1),Bt.success("타겟/손절 가격이 설정되었습니다.")}catch(R){console.error("TP/SL 설정 실패:",R),Bt.error("타겟/손절 설정에 실패했습니다.")}};return f.jsx(rb,{open:o,onOpenChange:t,children:f.jsxs(ob,{className:"sm:max-w-md",children:[f.jsxs(lb,{children:[f.jsx(hb,{children:f.jsxs("div",{className:"flex items-center gap-2",children:[e.side==="long"?f.jsxs("div",{className:"flex items-center text-green-500",children:[f.jsx(nc,{className:"w-5 h-5 mr-1"}),"롱 포지션"]}):f.jsxs("div",{className:"flex items-center text-red-500",children:[f.jsx(ic,{className:"w-5 h-5 mr-1"}),"숏 포지션"]}),f.jsx("span",{className:"ml-2",children:e.symbol})]})}),f.jsx(ab,{children:e.currentTakeProfitPrice||e.currentStopLossPrice?f.jsxs("div",{className:"text-sm",children:[e.currentTakeProfitPrice&&f.jsxs("div",{className:"inline-flex items-center mr-3 text-green-500",children:[f.jsx(Io,{className:"w-3 h-3 mr-1"}),"현재 타겟: $",e.currentTakeProfitPrice]}),e.currentStopLossPrice&&f.jsxs("div",{className:"inline-flex items-center text-red-500",children:[f.jsx($o,{className:"w-3 h-3 mr-1"}),"현재 손절: $",e.currentStopLossPrice]})]}):f.jsx("div",{children:"포지션의 타겟(익절) 및 손절 가격을 설정하세요."})})]}),f.jsxs("div",{className:"grid gap-6 py-4",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx(De,{className:"text-xs text-muted-foreground",children:"진입가"}),f.jsx("div",{className:"font-medium",children:e.entryPrice})]}),f.jsxs("div",{children:[f.jsx(De,{className:"text-xs text-muted-foreground",children:"현재가"}),f.jsx("div",{className:"font-medium",children:e.markPrice})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Io,{className:"w-4 h-4 text-green-500"}),f.jsx(De,{htmlFor:"tp-price",className:"font-medium",children:"타겟 가격 (익절)"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"space-y-1",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx(De,{htmlFor:"tp-price",className:"text-xs text-muted-foreground",children:"가격"}),e.currentTakeProfitPrice?f.jsxs("span",{className:"text-xs text-green-500",children:["현재: $",e.currentTakeProfitPrice]}):f.jsx("span",{className:"text-xs text-muted-foreground",children:"직접 입력"})]}),f.jsx(ws,{id:"tp-price",placeholder:"타겟 가격",value:a,onChange:P,className:"bg-background"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx(De,{htmlFor:"tp-percentage",className:"text-xs text-muted-foreground",children:"퍼센트 (%)"}),e.currentTakeProfitPrice?f.jsx("span",{className:"text-xs text-green-500",children:e.side==="long"?`+${((e.currentTakeProfitPrice-e.entryPrice)/e.entryPrice*100).toFixed(2)}%`:`+${((e.entryPrice-e.currentTakeProfitPrice)/e.entryPrice*100).toFixed(2)}%`}):f.jsx("span",{className:"text-xs text-muted-foreground",children:"직접 입력"})]}),f.jsx(ws,{id:"tp-percentage",placeholder:"이익 %",value:p,onChange:$,className:"bg-background"})]})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx($o,{className:"w-4 h-4 text-red-500"}),f.jsx(De,{htmlFor:"sl-price",className:"font-medium",children:"손절 가격"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"space-y-1",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx(De,{htmlFor:"sl-price",className:"text-xs text-muted-foreground",children:"가격"}),e.currentStopLossPrice?f.jsxs("span",{className:"text-xs text-red-500",children:["현재: $",e.currentStopLossPrice]}):f.jsx("span",{className:"text-xs text-muted-foreground",children:"직접 입력"})]}),f.jsx(ws,{id:"sl-price",placeholder:"손절 가격",value:d,onChange:A,className:"bg-background"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx(De,{htmlFor:"sl-percentage",className:"text-xs text-muted-foreground",children:"퍼센트 (%)"}),e.currentStopLossPrice?f.jsx("span",{className:"text-xs text-red-500",children:e.side==="long"?`-${((e.entryPrice-e.currentStopLossPrice)/e.entryPrice*100).toFixed(2)}%`:`-${((e.currentStopLossPrice-e.entryPrice)/e.entryPrice*100).toFixed(2)}%`}):f.jsx("span",{className:"text-xs text-muted-foreground",children:"직접 입력"})]}),f.jsx(ws,{id:"sl-percentage",placeholder:"손실 %",value:w,onChange:U,className:"bg-background"})]})]})]})]}),f.jsxs(ub,{className:"flex space-x-2 sm:justify-end",children:[f.jsx(cb,{asChild:!0,children:f.jsx(Fe,{type:"button",variant:"secondary",children:"취소"})}),f.jsx(Fe,{type:"button",onClick:W,disabled:C.isPending,className:e.side==="long"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:C.isPending?"설정 중...":"설정 완료"})]})]})})}const z_=()=>{const{t:o}=Dt(),[t]=Gt(),e=Xo(),s=t.get("exchange"),r=t.get("id"),h=t.get("symbol"),{decryptedAccounts:a,isLoading:c}=Ve(),[d,m]=B.useState(!1),[p,v]=B.useState(null),w=r&&a?a[r]:null,{data:_,isLoading:C,error:y}=$i({queryKey:["positions",s,r,h],queryFn:async()=>{if(!w||!w.exchangeInstance)throw new Error(o("trade.account_or_instance_not_found"));let R;return s==="bybit"&&h?R=await w.exchangeInstance.ccxt.fetchPositions([h]):R=await w.exchangeInstance.ccxt.fetchPositions(),R},enabled:!!w&&!!w.exchangeInstance,refetchInterval:200,staleTime:1/0}),{data:E}=$i({queryKey:["openOrders",s,r],queryFn:async()=>{if(!w||!w.exchangeInstance)throw new Error(o("trade.account_or_instance_not_found"));return await w.exchangeInstance.ccxt.fetchOpenOrders(h??void 0)},enabled:!!w&&!!w.exchangeInstance,refetchInterval:200,staleTime:1/0}),P=(R,V)=>{if(!E)return{takeProfitPrice:void 0,stopLossPrice:void 0};const q=E.filter(G=>{var wt,Et;return G.symbol===R&&(G.reduceOnly===!0||((wt=G.info)==null?void 0:wt.reduceOnly)===!0||((Et=G.info)==null?void 0:Et.reduce_only)===!0)}),rt=q.find(G=>G.type==="limit"&&(V==="long"&&G.side==="sell"||V==="short"&&G.side==="buy")),X=q.find(G=>(G.type==="stop"||G.type==="stop_market"||G.type==="market"||G.type==="stop_limit")&&(V==="long"&&G.side==="sell"||V==="short"&&G.side==="buy"));let tt;return X&&(typeof X.stopPrice=="number"?tt=X.stopPrice:X.info&&typeof X.info.triggerPrice=="number"?tt=X.info.triggerPrice:typeof X.price=="number"&&(tt=X.price)),{takeProfitPrice:rt==null?void 0:rt.price,stopLossPrice:tt}},A=async(R,V,q)=>{if(!w||!w.exchangeInstance){Bt.error(o("trade.account_not_selected_or_instance_unavailable"));return}const rt=V==="long"?"sell":"buy";let X={};s==="binance"?X={positionSide:V==="long"?"LONG":"SHORT"}:s==="bybit"?w.positionMode==="hedge"?X={reduceOnly:!0,positionIdx:V==="long"?1:2}:X={reduceOnly:!0,positionIdx:0}:X={reduceOnly:!0};try{const tt=await w.exchangeInstance.ccxt.createOrder(R,"market",rt,q,void 0,X);Bt.success(o("trade.position_closed_successfully",{symbol:R,orderId:tt.id})),e.invalidateQueries({queryKey:["positions",s,r]}),e.invalidateQueries({queryKey:["accountsBalance"]})}catch(tt){throw console.error(o("trade.position_close_failed"),tt),Bt.error(o("trade.position_close_failed_with_error",{error:tt.message})),tt}},$=(R,V,q,rt,X,tt)=>{v({symbol:R,side:V,entryPrice:q,markPrice:rt,currentStopLossPrice:X,currentTakeProfitPrice:tt}),m(!0)};if(c||C)return f.jsxs("div",{className:"space-y-2",children:[f.jsx("div",{className:"px-1 text-sm font-medium text-muted-foreground",children:o("trade.active_positions")}),[...Array(3)].map((R,V)=>f.jsx(Fi,{children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex flex-col gap-1",children:[f.jsx(dt,{className:"w-24 h-5"}),f.jsx(dt,{className:"w-32 h-4"})]}),f.jsxs("div",{className:"flex flex-col items-end gap-1",children:[f.jsx(dt,{className:"w-20 h-5"}),f.jsx(dt,{className:"w-16 h-4"})]})]})},V))]});if(y)return f.jsxs("div",{className:"py-8 text-center text-red-500",children:[o("trade.position_loading_error"),": ",y.message]});const W=_==null?void 0:_.filter(R=>R.contracts&&R.contracts>0),I=W==null?void 0:W.map(R=>{const{takeProfitPrice:V,stopLossPrice:q}=P(R.symbol,R.side);return{id:R.symbol+R.side,symbol:R.symbol,type:"position",isLong:R.side==="long",leverage:R.leverage??0,entryPrice:R.entryPrice??0,size:R.contracts??0,profit:R.unrealizedPnl??0,profitPercentage:R.percentage??0,liquidationPrice:R.liquidationPrice,markPrice:R.markPrice,takeProfitPrice:V,stopLossPrice:q,onClosePosition:()=>A(R.symbol,R.side==="long"?"long":"short",R.contracts??0),onOpenTPSLDialog:()=>{const rt=R.symbol,X=R.side==="long"?"long":"short",tt=R.entryPrice??0,G=R.markPrice??0;$(rt,X,tt,G,typeof q=="number"?q:void 0,typeof V=="number"?V:void 0)},exchange:s,accountId:r||void 0}});return f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"px-1 text-sm font-medium text-muted-foreground",children:[o("trade.active_positions")," (",(I==null?void 0:I.length)??0,")"]}),I&&I.length>0?I.map(R=>f.jsx(T_,{...R},R.id)):f.jsx("div",{className:"py-8 text-center text-muted-foreground",children:o("trade.no_active_positions")}),p&&w&&s&&f.jsx(j_,{open:d,onOpenChange:m,position:p,ccxtInstance:w.exchangeInstance.ccxt,exchange:s,accountId:r})]})},T_=({symbol:o,leverage:t,entryPrice:e,size:s,profit:r,profitPercentage:h,isLong:a=!0,onClosePosition:c,onOpenTPSLDialog:d,stopLossPrice:m,takeProfitPrice:p})=>{const{t:v}=Dt(),[w,_]=B.useState(!1),C=r>0,y=a?f.jsx(nc,{className:"w-4 h-4 text-green-500"}):f.jsx(ic,{className:"w-4 h-4 text-red-500"});return f.jsx(Fi,{children:f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex flex-col gap-1",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-base font-semibold",children:o}),f.jsxs("div",{className:`px-2 py-0.5 rounded text-xs font-medium inline-flex items-center gap-1 ${a?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"}`,children:[y,v(a?"trade.long":"trade.short")]}),f.jsxs("span",{className:"text-xs px-2 py-0.5 rounded bg-accent/50",children:[t,"x"]})]}),f.jsxs("div",{className:"flex gap-2 mt-1 text-xs text-muted-foreground",children:[f.jsxs("span",{children:[v("trade.entry_price"),": $",e]}),f.jsx("span",{children:"•"}),f.jsxs("span",{children:[v("trade.size"),": ",s," ",o.replace("USDT","")]})]})]}),f.jsxs("div",{className:"flex flex-col items-end gap-1",children:[f.jsxs("div",{className:`text-base font-semibold ${C?Va.POSITIVE:Va.NEGATIVE}`,children:[C?"+":"",r.toFixed(2)," USD"]}),f.jsxs("div",{className:`text-xs px-2 py-0.5 rounded-full ${C?"bg-green-500/10":"bg-red-500/10"}`,children:[v("trade.pnl"),": ",C?"+":"",h.toFixed(2),"%"]})]})]}),(m||p)&&f.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-1 border-t border-border/30 text-xs",children:[p&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Io,{className:"w-3 h-3 text-green-500"}),f.jsxs("span",{className:"text-muted-foreground",children:[v("trade.target"),":"]}),f.jsxs("span",{className:"font-medium",children:["$",p]})]}),m&&f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx($o,{className:"w-3 h-3 text-red-500"}),f.jsxs("span",{className:"text-muted-foreground",children:[v("trade.stoploss"),":"]}),f.jsxs("span",{className:"font-medium",children:["$",m]})]})]}),f.jsxs("div",{className:"flex items-center justify-end gap-2 pt-1 border-t border-border/30",children:[d&&f.jsxs(Fe,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:E=>{E.stopPropagation(),d()},children:[f.jsx(vb,{className:"w-3 h-3 mr-1"}),v("trade.target_stoploss")]}),c&&f.jsxs(Fe,{variant:"destructive",size:"sm",className:"h-7 text-xs",onClick:async E=>{E.stopPropagation(),_(!0);try{await c()}catch{}finally{_(!1)}},disabled:w,children:[f.jsx(Hu,{className:"w-3 h-3 mr-1"}),v(w?"trade.closing":"trade.close_position")]})]})]})})},k_=()=>{const{t:o}=Dt(),[t,e]=B.useState("positions");return f.jsxs("div",{className:"flex flex-col w-full h-full bg-card",children:[f.jsxs("div",{className:"sticky top-0 z-10 flex px-2 border-b bg-background",children:[f.jsx(Ro,{isActive:t==="positions",onClick:()=>e("positions"),icon:f.jsx(gb,{className:"w-4 h-4 mr-1"}),children:o("trade.positions")}),f.jsx(Ro,{isActive:t==="orders",onClick:()=>e("orders"),icon:f.jsx(pb,{className:"w-4 h-4 mr-1"}),children:o("trade.orders")}),f.jsx(Ro,{isActive:t==="assets",onClick:()=>e("assets"),icon:f.jsx(Yu,{className:"w-4 h-4 mr-1"}),children:o("trade.assets")})]}),f.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-border scrollbar-track-background",children:f.jsxs("div",{className:"w-full p-2 space-y-2",children:[t==="orders"&&f.jsx(C_,{}),t==="positions"&&f.jsx(z_,{}),t==="assets"&&f.jsx(N_,{})]})})]})},Ro=({children:o,isActive:t,onClick:e,icon:s})=>f.jsxs("button",{onClick:r=>{r.stopPropagation(),e()},className:Lt("px-3 py-2 text-sm font-medium transition-colors rounded-t-md flex items-center","hover:bg-accent/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary/50",t?"border-b-2 border-primary text-primary bg-accent/30":"text-muted-foreground"),children:[s,o]});var hl="Switch",[R_,oy]=Bx(hl),[O_,A_]=R_(hl),$c=B.forwardRef((o,t)=>{const{__scopeSwitch:e,name:s,checked:r,defaultChecked:h,required:a,disabled:c,value:d="on",onCheckedChange:m,form:p,...v}=o,[w,_]=B.useState(null),C=Wx(t,$=>_($)),y=B.useRef(!1),E=w?p||!!w.closest("form"):!0,[P=!1,A]=Fx({prop:r,defaultProp:h,onChange:m});return f.jsxs(O_,{scope:e,checked:P,disabled:c,children:[f.jsx(qu.button,{type:"button",role:"switch","aria-checked":P,"aria-required":a,"data-state":Fc(P),"data-disabled":c?"":void 0,disabled:c,value:d,...v,ref:C,onClick:Vx(o.onClick,$=>{A(U=>!U),E&&(y.current=$.isPropagationStopped(),y.current||$.stopPropagation())})}),E&&f.jsx(D_,{control:w,bubbles:!y.current,name:s,value:d,checked:P,required:a,disabled:c,form:p,style:{transform:"translateX(-100%)"}})]})});$c.displayName=hl;var Ic="SwitchThumb",Wc=B.forwardRef((o,t)=>{const{__scopeSwitch:e,...s}=o,r=A_(Ic,e);return f.jsx(qu.span,{"data-state":Fc(r.checked),"data-disabled":r.disabled?"":void 0,...s,ref:t})});Wc.displayName=Ic;var D_=o=>{const{control:t,checked:e,bubbles:s=!0,...r}=o,h=B.useRef(null),a=Qx(e),c=Ux(t);return B.useEffect(()=>{const d=h.current,m=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(m,"checked").set;if(a!==e&&v){const w=new Event("click",{bubbles:s});v.call(d,e),d.dispatchEvent(w)}},[a,e,s]),f.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...r,tabIndex:-1,ref:h,style:{...o.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Fc(o){return o?"checked":"unchecked"}var Bc=$c,$_=Wc;const Vc=B.forwardRef(({className:o,...t},e)=>f.jsx(Bc,{className:Lt("peer inline-flex h-3 w-7 h-lg:h-4 h-lg:w-8 h-xl:h-5 h-xl:w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-zinc-900 data-[state=unchecked]:bg-zinc-200 dark:focus-visible:ring-zinc-300 dark:focus-visible:ring-offset-zinc-950 dark:data-[state=checked]:bg-zinc-50 dark:data-[state=unchecked]:bg-zinc-800",o),...t,ref:e,children:f.jsx($_,{className:Lt("pointer-events-none block h-2 w-2 h-lg:h-3 h-lg:w-3 h-xl:h-4 h-xl:w-4 rounded-full bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0 dark:bg-zinc-950")})}));Vc.displayName=Bc.displayName;async function I_({ccxtInstance:o,symbol:t,tradeType:e,exchange:s,info:r,config:h}){var c;if(!r.position)throw new Error("Position info is required");const a=Bt.loading(`${e==="long"?"롱":"숏"} 포지션 생성 중...`,{position:"bottom-center",style:{borderRadius:"10px",background:"#333",color:"#fff"}});try{const d=t.split(":")[1]==="USDT",m=e==="long"?"buy":"sell",p=e==="long"?"sell":"buy";try{await o.setLeverage(r.calculatedLeverage,t)}catch(_){console.warn("Failed to set leverage:",_)}try{await o.setMarginMode("cross",t)}catch(_){console.warn("Failed to set margin mode:",_)}if(s==="binance"){try{await o.fapiPrivatePostPositionSideDual({dualSidePosition:"true"})}catch(_){console.warn("Failed to set hedge mode:",_)}try{await o.fapiPrivatePostMultiAssetsMargin({multiAssetsMargin:"true"})}catch(_){console.warn("Failed to set multi-assets mode:",_)}}else try{await o.setPositionMode(!0,t)}catch(_){console.warn("Failed to set position mode:",_)}const v=d?r.position.size:r.position.size/100;let w;if(s==="binance")w=await Promise.all([o.createOrder(t,"market",m,v,void 0,{marginMode:"cross",positionSide:e.toUpperCase(),hedged:!0}),o.createOrder(t,"market",p,v,void 0,{marginMode:"cross",reduceOnly:!0,positionSide:e.toUpperCase(),stopLossPrice:r.stoploss.price,hedged:!0}),o.createOrder(t,"limit",p,h.partialClose?v*(h.closeRatio/100):v,r.target.price,{marginMode:"cross",reduceOnly:!0,positionSide:e.toUpperCase(),takeProfitPrice:r.target.price,hedged:!0})]);else if(s==="bybit"){const _=t.includes("USDT"),C=((c=r.account)==null?void 0:c.positionMode)==="hedge";let y=0;if(_&&C?(y=e==="long"?1:2,console.log(`[Debug] Using hedge mode with positionIdx: ${y} for ${e} position on USDT market`)):console.log(`[Debug] Using one-way mode with positionIdx: 0 ${_?"":"(inverse market)"}`),_)try{await o.setPositionMode(C,t),console.log(`[Debug] Successfully set position mode to ${C?"hedge":"one-way"} for ${t}`)}catch(E){console.warn(`[Warning] Failed to set position mode for ${t}:`,E)}else console.log(`[Debug] Skipping position mode setting for inverse market ${t}`);w=await Promise.all([o.createOrder(t,"market",m,r.position.size,void 0,{positionIdx:y,stopLoss:{triggerPrice:r.stoploss.price}}),o.createOrder(t,"limit",p,h.partialClose?r.position.size*(h.closeRatio/100):r.position.size,r.target.price,{positionIdx:y,reduceOnly:!0})])}else if(s==="bitget")w=await Promise.all([o.createOrder(t,"market",m,r.position.size,void 0,{stopLoss:{triggerPrice:r.stoploss.price},hedged:!0}),o.createOrder(t,"limit",p,h.partialClose?r.position.size*(h.closeRatio/100):r.position.size,r.target.price,{holdSide:e,reduceOnly:!0,hedged:!0})]);else throw new Error(`지원하지 않는 거래소입니다: ${s}`);return Bt.success(`${t} ${e==="long"?"롱":"숏"} 포지션 생성 성공!`,{id:a,icon:"✅",style:{borderRadius:"10px",background:e==="long"?"#10b981":"#ef4444",color:"#fff"}}),w}catch(d){throw console.error("Order execution failed:",d),Bt.error(`주문 실행 실패: ${d instanceof Error?d.message:"알 수 없는 오류"}`,{id:a,icon:"❌",duration:5e3,style:{borderRadius:"10px",background:"#f43f5e",color:"#fff"}}),d}}function W_(){return Ku({mutationFn:I_,onMutate:o=>{console.log(`Starting ${o.tradeType} position creation for ${o.symbol}`)}})}const ks=({tradeDirection:o="long"})=>{var $,U;const{t}=Dt(),[e]=Gt(),s=e.get("id"),r=e.get("exchange"),h=e.get("symbol"),{accountsBalance:a,decryptedAccounts:c}=Ve(),{tradeInfo:d}=Be(),m=!!(s&&a)&&a[s],p=!!(s&&c)&&c[s],{config:v}=vi(),w=W_(),{trackEvent:_}=Uu(),[C,y]=B.useState(!0),E=async()=>{if(!m||!p||!h||!r||!d||!d.long||!d.short||!v)return;const W=p.exchangeInstance.ccxt,I=d[o];if(I.position)try{await w.mutateAsync({ccxtInstance:W,symbol:h,tradeType:o,exchange:r,info:I,config:v}),_({action:"trade_executed",category:"trading",label:o,symbol:h,exchange:r,risk_percent:v.risk,risk_ratio:v.riskRatio,partial_close:v.partialClose,close_ratio:v.closeRatio})}catch(R){console.error(t("trade.trade_execution_failed"),R),_({action:"trade_failed",category:"trading",label:o,symbol:h,exchange:r,error:R instanceof Error?R.message:t("trade.unknown_error")})}},P=o==="long"?"bg-gradient-to-b from-green-500 to-green-600 hover:from-green-400 hover:to-green-500":"bg-gradient-to-b from-red-500 to-red-600 hover:from-red-400 hover:to-red-500",A=()=>{if(!(d!=null&&d[o]))return null;const W=d[o];return W.insufficientCapital?f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{className:"text-sm",children:[t("trade.leverage"),":"]}),f.jsxs("span",{className:"text-sm font-medium",children:[W.leverage,"x"]})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{className:"text-sm",children:[t("trade.stoploss"),":"]}),f.jsxs("span",{className:`text-sm font-medium ${o==="long"?"text-red-500":"text-green-500"}`,children:[W.stoploss.formatted," (",W.stoploss.percentage,"%)"]})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{className:"text-sm",children:[t("trade.target_price"),":"]}),f.jsxs("span",{className:`text-sm font-medium ${o==="long"?"text-green-500":"text-red-500"}`,children:[W.target.formatted," (",W.target.percentage,"%)"]})]}),f.jsxs("div",{className:"mt-2 p-2 bg-yellow-100/20 border border-yellow-300/30 rounded-md text-yellow-600 text-xs",children:[f.jsx(mo,{className:"h-3 w-3 inline-block mr-1"}),t("trade.insufficient_capital")]})]}):W.error?f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{className:"text-sm",children:[t("trade.leverage"),":"]}),f.jsxs("span",{className:"text-sm font-medium",children:[W.leverage,"x"]})]}),f.jsxs("div",{className:"mt-2 p-2 bg-red-100/20 border border-red-300/30 rounded-md text-red-600 text-xs",children:[f.jsx(mo,{className:"h-3 w-3 inline-block mr-1"}),t("trade.calculation_error")]})]}):W.position?f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{className:"text-sm",children:[t("trade.leverage"),":"]}),f.jsxs("span",{className:"text-sm font-medium",children:[W.leverage,"x"]})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{className:"text-sm",children:[t("trade.stoploss"),":"]}),f.jsxs("span",{className:`text-sm font-medium ${o==="long"?"text-red-500":"text-green-500"}`,children:[W.stoploss.formatted," (",W.stoploss.percentage,"%)"]})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{className:"text-sm",children:[t("trade.target_price"),":"]}),f.jsxs("span",{className:`text-sm font-medium ${o==="long"?"text-green-500":"text-red-500"}`,children:[W.target.formatted," (",W.target.percentage,"%)"]})]})]}):f.jsx("div",{className:"text-sm text-center text-muted-foreground",children:t("trade.no_info")})};return f.jsxs("div",{className:"flex flex-col items-center justify-between h-full w-full rounded-md p-2",children:[f.jsxs("div",{className:"w-full mb-2 cursor-pointer flex items-center justify-between",onClick:()=>y(!C),children:[f.jsxs("div",{className:"text-sm font-medium border-b pb-1 flex items-center gap-1",children:[f.jsx("span",{children:t("trade.trade_settings")}),f.jsx(Xu,{children:f.jsxs(Gu,{children:[f.jsx(Ju,{children:f.jsx(ec,{className:"h-3.5 w-3.5 text-muted-foreground"})}),f.jsx(Qu,{children:f.jsx("p",{children:t("trade.trade_settings")})})]})})]}),f.jsx("span",{className:"text-xs text-muted-foreground",children:t(C?"trade.collapse":"trade.expand")})]}),C&&f.jsxs("div",{className:"space-y-3 w-full bg-accent/10 p-2 rounded-md mb-2",children:[f.jsx(F_,{}),f.jsx(V_,{}),f.jsx(B_,{})]}),f.jsx("div",{className:"w-full",children:f.jsx(As,{className:Lt("border",o==="long"?"bg-green-100/10 border-green-200/20":"bg-red-100/10 border-red-200/20"),children:f.jsxs(Do,{className:"p-3",children:[f.jsx("div",{className:Lt("text-center text-sm font-semibold mb-2",o==="long"?"text-green-600":"text-red-600"),children:t(o==="long"?"trade.long_trade_summary":"trade.short_trade_summary")}),A()||f.jsx("div",{className:"text-sm text-center text-muted-foreground",children:t("trade.no_info")})]})})}),!m&&f.jsxs("div",{className:"w-full flex items-center gap-2 p-2 bg-yellow-100/20 border border-yellow-300/30 rounded-md mb-3 text-yellow-600",children:[f.jsx(mo,{className:"h-4 w-4 flex-none"}),f.jsx("p",{className:"text-sm",children:t("trade.select_account_warning")})]}),f.jsx("div",{className:"w-full mt-auto",children:f.jsx(Fe,{onClick:E,className:Lt("w-full py-3 text-base font-bold shadow-md hover:shadow-lg transition-all",P),disabled:!m||w.isPending||!!(($=d==null?void 0:d[o])!=null&&$.insufficientCapital)||!!((U=d==null?void 0:d[o])!=null&&U.error),children:w.isPending?t("trade.processing"):t(o==="long"?"trade.long_entry":"trade.short_entry")})})]})},al=({label:o,value:t,unit:e,onDecrease:s,onIncrease:r,disabled:h=!1,tooltipText:a})=>f.jsxs("div",{className:"flex flex-col w-full",children:[f.jsxs("div",{className:"flex items-center justify-between mb-1",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx("span",{className:"text-sm font-medium",children:o}),a&&f.jsx(Xu,{children:f.jsxs(Gu,{children:[f.jsx(Ju,{children:f.jsx(ec,{className:"h-3.5 w-3.5 text-muted-foreground"})}),f.jsx(Qu,{children:f.jsx("p",{className:"max-w-xs text-xs",children:a})})]})})]}),f.jsxs("div",{className:"font-semibold text-sm bg-accent/30 px-2 py-0.5 rounded",children:[t,e]})]}),f.jsxs("div",{className:"flex items-center justify-between gap-2",children:[f.jsx(Fe,{variant:"outline",size:"sm",className:"flex-1 h-7 bg-background/80",disabled:h,onClick:s,children:f.jsx(Yx,{className:"h-3 w-3"})}),f.jsx(Fe,{variant:"outline",size:"sm",className:"flex-1 h-7 bg-background/80",disabled:h,onClick:r,children:f.jsx(Zx,{className:"h-3 w-3"})})]})]}),F_=()=>{const{t:o}=Dt(),{config:t,updateConfig:e,isLoading:s}=vi();return f.jsxs("div",{className:"w-full space-y-2",children:[f.jsxs("div",{className:"w-full flex items-center gap-2",children:[f.jsx(Vc,{id:"partial-close",checked:t==null?void 0:t.partialClose,onCheckedChange:r=>{e({partialClose:r})},disabled:s}),f.jsx(De,{htmlFor:"partial-close",className:"text-sm font-medium cursor-pointer",children:o("trade.partial_close")})]}),(t==null?void 0:t.partialClose)&&f.jsx(al,{label:o("trade.close_ratio"),value:t.closeRatio,unit:"%",disabled:s,onDecrease:()=>{const r=t!=null&&t.closeRatio?t.closeRatio-5<5?5:t.closeRatio-5:50;e({closeRatio:r})},onIncrease:()=>{const r=t!=null&&t.closeRatio?t.closeRatio+5>100?100:t.closeRatio+5:50;e({closeRatio:r})},tooltipText:o("trade.close_ratio_tooltip")})]})},B_=()=>{const{t:o}=Dt(),{config:t,isLoading:e,updateConfig:s}=vi();return f.jsx(al,{label:o("trade.risk_ratio"),value:(t==null?void 0:t.riskRatio)??1.5,unit:" : 1",disabled:e,onDecrease:()=>{const r=t!=null&&t.riskRatio?t.riskRatio-.5<.5?.5:t.riskRatio-.5:1.5;s({riskRatio:r})},onIncrease:()=>{const r=t!=null&&t.riskRatio?t.riskRatio+.5>5?5:t.riskRatio+.5:1.5;s({riskRatio:r})},tooltipText:o("trade.risk_ratio_tooltip")})},V_=()=>{const{t:o}=Dt(),{config:t,updateConfig:e,isLoading:s}=vi();return f.jsx(al,{label:o("trade.risk_percentage"),value:(t==null?void 0:t.risk)??1.5,unit:"%",disabled:s,onDecrease:()=>{const r=t!=null&&t.risk?t.risk-.5<.5?.5:t.risk-.5:1.5;e({risk:r})},onIncrease:()=>{const r=t!=null&&t.risk?t.risk+.5>5?5:t.risk+.5:1.5;e({risk:r})},tooltipText:o("trade.risk_percentage_tooltip")})},Rs=({tradeDirection:o="long"})=>{var _,C;const{t}=Dt(),[e]=Gt(),{tradeInfo:s,balanceInfo:r,tickerQuery:h,marketInfoQuery:a,isAccountsLoading:c}=Be(),{exchangeAccounts:d}=Be(),m=e.get("exchange"),p=h.isLoading||a.isLoading||!s,v=!d&&(c||!r),w=o==="long"?{bgColor:"bg-green-500/10",textColor:"text-green-500",infoBoxBg:"bg-green-500/5"}:{bgColor:"bg-red-500/10",textColor:"text-red-500",infoBoxBg:"bg-red-500/5"};return f.jsxs("div",{className:"h-full w-full flex flex-col gap-3 overflow-hidden p-2",children:[f.jsxs("div",{className:"flex w-full items-center justify-between bg-muted/20 p-2.5 rounded-md",children:[f.jsx("span",{className:"text-sm font-medium",children:t(o==="long"?"trade.long_position_info":"trade.short_position_info")}),f.jsx("div",{className:"flex gap-4 text-xs",children:p?f.jsxs(f.Fragment,{children:[f.jsx(dt,{className:"h-3.5 w-16"}),f.jsx(dt,{className:"h-3.5 w-16"})]}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("span",{className:"text-muted-foreground",children:t("trade.maker_fee")}),f.jsx("span",{className:"font-semibold",children:(_=s==null?void 0:s.tradingfee)==null?void 0:_.maker})]}),f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("span",{className:"text-muted-foreground",children:t("trade.taker_fee")}),f.jsx("span",{className:"font-semibold",children:(C=s==null?void 0:s.tradingfee)==null?void 0:C.taker})]})]})})]}),p?f.jsxs("div",{className:"flex-1 w-full bg-accent/10 rounded-md p-3 border",children:[f.jsx("div",{className:"flex justify-center mb-3",children:f.jsx("div",{className:Lt("px-4 py-1 rounded-md text-center",w.bgColor,w.textColor),children:f.jsx("span",{className:"font-semibold text-sm",children:t(o==="long"?"trade.long_position":"trade.short_position")})})}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.stoploss")}),f.jsx("div",{className:"text-right",children:f.jsx(dt,{className:"h-4 w-full ml-auto"})})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.target_price")}),f.jsx("div",{className:"text-right",children:f.jsx(dt,{className:"h-4 w-full ml-auto"})})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.leverage")}),f.jsx("div",{className:"text-right",children:f.jsx(dt,{className:"h-4 w-16 ml-auto"})})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.position_size")}),f.jsx("div",{className:"text-right",children:f.jsx(dt,{className:"h-4 w-full ml-auto"})})]})]})]}):f.jsxs("div",{className:"flex-1 w-full bg-accent/10 rounded-md p-3 border",children:[f.jsx("div",{className:"flex justify-center mb-3",children:f.jsx("div",{className:Lt("px-4 py-1 rounded-md text-center",w.bgColor,w.textColor),children:f.jsx("span",{className:"font-semibold text-sm",children:t(o==="long"?"trade.long_position":"trade.short_position")})})}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.stoploss")}),f.jsxs("div",{className:Lt("text-right p-1.5 rounded-md",w.infoBoxBg),children:[f.jsx("div",{className:"font-medium text-sm",children:s==null?void 0:s[o].stoploss.formatted}),f.jsxs("div",{className:"text-xs text-muted-foreground",children:["(",s==null?void 0:s[o].stoploss.percentage,"%)"]})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.target_price")}),f.jsxs("div",{className:Lt("text-right p-1.5 rounded-md",w.infoBoxBg),children:[f.jsx("div",{className:"font-medium text-sm",children:s==null?void 0:s[o].target.formatted}),f.jsxs("div",{className:"text-xs text-muted-foreground",children:["(",s==null?void 0:s[o].target.percentage,"%)"]})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.leverage")}),f.jsxs("div",{className:"text-right font-bold text-sm",children:[s==null?void 0:s[o].leverage,"x"]})]}),(s==null?void 0:s[o].position)&&f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.position_size")}),f.jsx("div",{className:"text-right font-medium text-sm",children:s==null?void 0:s[o].position.size})]}),(s==null?void 0:s[o].position)&&f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("div",{className:"text-sm text-muted-foreground",children:t("trade.margin_amount")}),f.jsx("div",{className:"text-right text-sm",children:s==null?void 0:s[o].position.margin})]})]})]}),v?f.jsxs("div",{className:"w-full border rounded-md p-3 bg-muted/10",children:[f.jsx("div",{className:"text-sm font-medium mb-2",children:t("trade.balance_info")}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[f.jsx("div",{className:"text-xs text-muted-foreground",children:t("trade.asset")}),f.jsx("div",{className:"text-xs text-muted-foreground",children:t("trade.total_amount")}),f.jsx("div",{className:"text-xs text-muted-foreground",children:t("trade.available_amount")}),f.jsx("div",{className:"text-xs text-muted-foreground",children:t("trade.in_use_amount")})]}),f.jsxs("div",{className:"grid grid-cols-4 gap-2 items-center",children:[f.jsx("div",{className:"text-xs font-medium",children:"USDT"}),f.jsx(dt,{className:"h-3.5 w-full"}),f.jsx(dt,{className:"h-3.5 w-full"}),f.jsx(dt,{className:"h-3.5 w-full"})]}),f.jsxs("div",{className:"grid grid-cols-4 gap-2 items-center border-t pt-2",children:[f.jsx("div",{className:"text-xs font-medium",children:t("trade.total")}),f.jsx(dt,{className:"h-3.5 w-full"}),f.jsx(dt,{className:"h-3.5 w-full"}),f.jsx(dt,{className:"h-3.5 w-full"})]})]})]}):r?f.jsxs("div",{className:"w-full border rounded-md p-3 bg-muted/10",children:[f.jsx("div",{className:"text-sm font-medium mb-2",children:t("trade.balance_info")}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[f.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:t("trade.asset")}),f.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:t("trade.total_amount")}),f.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:t("trade.available_amount")}),f.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:t("trade.in_use_amount")})]}),f.jsxs("div",{className:"grid grid-cols-4 gap-2 items-center",children:[f.jsx("div",{className:"text-xs font-semibold",children:r.base.name??"USDT"}),f.jsx("div",{className:"text-xs",children:r.base.total??0}),f.jsx("div",{className:"text-xs",children:r.base.free??0}),f.jsx("div",{className:"text-xs",children:r.base.used??0})]}),f.jsxs("div",{className:"grid grid-cols-4 gap-2 items-center border-t pt-2",children:[f.jsx("div",{className:"text-xs font-bold",children:t("trade.total_usd")}),f.jsx("div",{className:"text-xs font-bold",children:r.usd.total}),f.jsx("div",{className:"text-xs",children:r.usd.free}),f.jsx("div",{className:"text-xs",children:r.usd.used})]})]})]}):f.jsxs(Ao,{to:`/account/add?exchange=${m}`,className:"w-full border rounded-md p-3 bg-accent/10 font-medium text-center flex flex-col gap-1 hover:bg-accent/20 transition-colors",children:[f.jsx("span",{className:"text-sm",children:`${m} ${t("trade.api_key_missing")}`}),f.jsx("span",{className:"text-xs text-primary",children:t("trade.click_to_add_api_key")})]})]})};function Oo(o){const[t,e]=B.useState(!1);return B.useEffect(()=>{const s=window.matchMedia(o);s.matches!==t&&e(s.matches);const r=()=>{e(s.matches)};return s.addEventListener("change",r),()=>{s.removeEventListener("change",r)}},[t,o]),t}const U_=()=>{const{t:o}=Dt(),t=Oo("(max-width: 768px)"),e=Oo("(min-width: 1024px)"),s=Oo("(min-width: 1280px)"),{setTradeDirection:r,tradeDirection:h}=Be(),a=c=>{(c==="long"||c==="short")&&r(c)};return t?f.jsx("div",{className:"w-full min-h-[180px] h-auto border rounded-md shadow-sm p-2",children:f.jsxs(Ua,{defaultValue:"long",value:h,onValueChange:a,className:"w-full h-full",children:[f.jsxs(Ha,{className:"w-full grid grid-cols-2 mb-2",children:[f.jsx(_s,{value:"long",className:"data-[state=active]:bg-green-500 data-[state=active]:text-white",children:o("trade.long_position")}),f.jsx(_s,{value:"short",className:"data-[state=active]:bg-red-500 data-[state=active]:text-white",children:o("trade.short_position")})]}),f.jsx(ys,{value:"long",className:"mt-1",children:f.jsxs("div",{className:"space-y-3",children:[f.jsx(Rs,{tradeDirection:"long"}),f.jsx(ks,{tradeDirection:"long"})]})}),f.jsx(ys,{value:"short",className:"mt-1",children:f.jsxs("div",{className:"space-y-3",children:[f.jsx(Rs,{tradeDirection:"short"}),f.jsx(ks,{tradeDirection:"short"})]})})]})}):f.jsx("div",{className:"w-full min-h-[180px] h-auto lg:h-full border rounded-md shadow-sm p-3 bg-card/20",children:f.jsxs(Ua,{defaultValue:"long",value:h,onValueChange:a,className:"w-full h-full",children:[f.jsxs(Ha,{className:"w-full h-min grid grid-cols-2 mb-3",children:[f.jsx(_s,{value:"long",className:`py-1 md:py-1.5 text-xs md:text-sm font-medium data-[state=active]:bg-green-500 data-[state=active]:text-white
              ${e?"lg:text-base lg:py-1.5":""}
              ${s?"xl:py-2 xl:px-2":""}`,children:o("trade.long_position")}),f.jsx(_s,{value:"short",className:`py-1 md:py-1.5 text-xs md:text-sm font-medium data-[state=active]:bg-red-500 data-[state=active]:text-white
              ${e?"lg:text-base lg:py-1.5":""}
              ${s?"xl:py-2 xl:px-2":""}`,children:o("trade.short_position")})]}),f.jsx(ys,{value:"long",className:"mt-1 h-[calc(100%-50px)]",children:f.jsxs("div",{className:"flex flex-col md:flex-row gap-3 h-full",children:[f.jsx("div",{className:"w-full md:w-2/3 flex-grow",children:f.jsx(Rs,{tradeDirection:"long"})}),f.jsx("div",{className:"w-full md:w-1/3 flex-none",children:f.jsx(ks,{tradeDirection:"long"})})]})}),f.jsx(ys,{value:"short",className:"mt-1 h-[calc(100%-50px)]",children:f.jsxs("div",{className:"flex flex-col md:flex-row gap-3 h-full",children:[f.jsx("div",{className:"w-full md:w-2/3 flex-grow",children:f.jsx(Rs,{tradeDirection:"short"})}),f.jsx("div",{className:"w-full md:w-1/3 flex-none",children:f.jsx(ks,{tradeDirection:"short"})})]})})]})})},H_=()=>{var p;const{tickerQuery:o}=Be(),[t]=Gt(),e=t.get("symbol"),[s,r]=B.useState("desktop"),[h,a]=B.useState("normal"),[c,d]=B.useState(400),m=B.useRef(null);return B.useEffect(()=>{const v=()=>{const w=window.innerWidth>=fn.TABLET;r(w?"desktop":"mobile");const _=window.innerHeight<fn.HEIGHT_LARGE;a(_?"compact":"normal"),window.innerWidth>=fn.DESKTOP?d(650):window.innerWidth>=fn.TABLET?d(550):window.innerWidth>=fn.MOBILE?d(500):d(450)};return v(),window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v)}},[]),f.jsxs(ib,{className:["flex flex-col h-full"],headerProps:{ticker:{symbol:e||void 0,percentage:(p=o.data)==null?void 0:p.percentage,isTickerLoading:o.isLoading},backButton:!0},children:[f.jsx("div",{className:"flex-none sticky top-0 z-10 bg-background pb-1.5 border-b",children:f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-1.5 md:gap-2",children:[f.jsx(Sb,{}),f.jsxs("div",{className:"w-full flex items-center justify-between space-x-2",children:[f.jsx(yb,{}),f.jsx(wb,{})]})]})}),f.jsxs("div",{ref:m,className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-border scrollbar-track-background mb-10",children:[f.jsx("div",{className:Lt("w-full py-2",h==="compact"?"mb-1":"mb-2"),children:f.jsx(h_,{height:c})}),f.jsxs("div",{className:Lt("gap-2",s==="desktop"?"flex flex-row":"flex flex-col"),children:[f.jsx("div",{className:Lt(s==="desktop"?"w-1/2":"w-full","min-h-[200px]"),children:f.jsx(U_,{})}),f.jsx("div",{className:Lt(s==="desktop"?"w-1/2":"w-full","min-h-[300px] border rounded-md my-2"),children:f.jsx(k_,{})})]})]})]})},ly=()=>f.jsx(f_,{children:f.jsx(S_,{children:f.jsx(H_,{})})});export{ly as default};
