import{b as I,d as $,e as E,r as o,i as D,k as G,j as e,B as y,X as O,V as n}from"./index--mJaizsc.js";import{o as R,s as B,A as Q,a as W,b as X,t as q}from"./alert-Fao-om9Q.js";import{u as K,F as H,a as J,b as U,c as Y,d as Z}from"./form-CnYccCye.js";import{G as ee,m as u,L as P,A as te,I as se,a as h,b as x,c as ae}from"./proxy-D7BGffrU.js";import{C as re,a as ne}from"./card-BfKKBDHD.js";import{R as ie}from"./refresh-cw-wChuhh6Z.js";import"./label-DparRnXT.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=I("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=I("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),d=5,oe=[[1,2,3],[4,5,6],[7,8,9],["clear",0,"delete"]],je=()=>{const{t}=$(),{encryptedPin:N,validatePin:S}=E(),[c,b]=o.useState(0),[p,C]=o.useState(!1),[A,T]=o.useState(!1),[k,_]=o.useState(!1),[v,f]=o.useState(!1),V=D(),{trackEvent:j}=G(),z=R({pin:B().length(4,{message:t("auth.pin_must_be_4_digits","PIN은 4자리 숫자여야 합니다")})}),i=K({resolver:q(z),defaultValues:{pin:""}});o.useEffect(()=>{c>=2&&T(!0)},[c]);const g=async()=>{const s=n.loading(t("auth.resetting_app_data","앱 데이터를 초기화 중입니다..."));try{j({action:"reset_data",category:"security",label:"max_pin_attempts",value:d}),await chrome.storage.local.clear(),V.resetQueries(),n.dismiss(s),n.success(t("auth.all_data_reset","모든 데이터가 초기화되었습니다. 앱을 다시 시작합니다."),{duration:3e3,icon:"🔄"}),setTimeout(()=>{window.location.reload()},2e3)}catch(a){n.dismiss(s),n.error(t("auth.error_resetting_data","데이터 초기화 중 오류가 발생했습니다.")),console.error("데이터 초기화 오류:",a)}},w=async s=>{if(!N)return;f(!0);const a=n.loading(t("auth.verifying_pin","PIN 확인 중..."));try{const r=await S({encryptedPin:N,pin:s.pin});n.dismiss(a),f(!1),r?(n.success(t("auth.pin_verification_success","PIN 확인 성공! 환영합니다."),{icon:"🔓",duration:2e3}),j({action:"pin_validation",category:"security",label:"success"})):(_(!0),setTimeout(()=>_(!1),500),j({action:"pin_validation",category:"security",label:"failed",value:c+1}),b(m=>{const l=m+1;if(l>=d)n.error(t("auth.pin_attempts_exceeded","PIN 시도 횟수를 초과했습니다. 데이터를 초기화합니다."),{duration:4e3,icon:"⚠️"}),g();else{const M=d-l;n.error(t("auth.incorrect_pin_remaining_attempts","PIN이 올바르지 않습니다. 남은 시도 횟수: {{count}}회",{count:M}),{icon:"❌",duration:3e3})}return l}),i.reset())}catch(r){n.dismiss(a),f(!1),n.error(t("auth.pin_verification_error","PIN 확인 중 오류가 발생했습니다.")),b(m=>{const l=m+1;return console.log(r),l>=d&&g(),l}),i.reset()}},F=s=>{const a=i.getValues("pin");s==="clear"?i.setValue("pin",""):s==="delete"?i.setValue("pin",a.slice(0,-1)):typeof s=="number"&&a.length<4&&(i.setValue("pin",a+s),a.length===3&&setTimeout(()=>{i.handleSubmit(w)()},300))},L=()=>{window.open("https://github.com/lazy-dinosaur","_blank")};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-4",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-primary mb-2",children:"LazyTrading"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-muted-foreground",children:[e.jsx("span",{children:"by"}),e.jsxs("button",{onClick:L,className:"flex items-center gap-1 hover:text-primary transition-colors",children:["lazy-dinosaur",e.jsx(ee,{className:"h-3 w-3"})]})]})]}),e.jsx(re,{className:"w-full max-w-md shadow-lg border-2",children:e.jsxs(ne,{className:"p-6",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(u.div,{initial:{scale:.8},animate:{scale:1,rotate:[0,-5,5,-5,5,0],transition:{duration:.5,rotate:{repeat:1/0,repeatType:"mirror",repeatDelay:5}}},className:"w-20 h-20 bg-primary/10 flex items-center justify-center rounded-full",children:e.jsx(P,{className:"h-10 w-10 text-primary"})})}),e.jsx(te,{mode:"wait",children:e.jsxs(u.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t("auth.unlock")}),e.jsxs("p",{className:"text-muted-foreground mt-2",children:[t("auth.enter_pin_to_access"),c>0&&e.jsxs("span",{className:"text-destructive font-medium",children:[" ",t("auth.remaining_attempts","(남은 시도: {{count}}회)",{count:d-c})]})]})]},"unlock-title")}),A&&e.jsxs(Q,{variant:"destructive",className:"mb-6",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(W,{children:t("auth.pin_entry_warning","PIN 입력 주의")}),e.jsx(X,{className:"text-xs",children:t("auth.pin_reset_warning","PIN을 {{count}}회 이상 잘못 입력하면 모든 데이터가 초기화됩니다. PIN이 기억나지 않으면 앱을 재설치하고 API 키를 다시 설정해야 합니다.",{count:d})})]}),e.jsx(H,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(w),className:"space-y-6",children:[e.jsx(J,{control:i.control,name:"pin",render:({field:s})=>e.jsxs(U,{className:"space-y-4",children:[e.jsx(Y,{children:e.jsx(u.div,{animate:k?{x:[0,-10,10,-10,10,0]}:{},transition:{duration:.5},className:"w-full flex justify-center",children:e.jsxs(se,{maxLength:4,value:s.value,onChange:a=>{const r=a.replace(/\D/g,"");s.onChange(r)},className:"flex justify-center gap-4",pattern:"[0-9]*",inputMode:"numeric",type:p?"text":"password",children:[e.jsx(h,{children:e.jsx(x,{index:0,className:`h-16 w-16 text-2xl border-2 ${s.value[0]?"border-primary":""}`})}),e.jsx(h,{children:e.jsx(x,{index:1,className:`h-16 w-16 text-2xl border-2 ${s.value[1]?"border-primary":""}`})}),e.jsx(h,{children:e.jsx(x,{index:2,className:`h-16 w-16 text-2xl border-2 ${s.value[2]?"border-primary":""}`})}),e.jsx(h,{children:e.jsx(x,{index:3,className:`h-16 w-16 text-2xl border-2 ${s.value[3]?"border-primary":""}`})})]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(!p),className:"text-xs",children:p?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"})," ",t("auth.hide_pin","PIN 숨기기")]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"})," ",t("auth.show_pin","PIN 표시하기")]})})}),e.jsx(Z,{className:"text-center"})]})}),e.jsxs("div",{className:"mt-6 flex justify-center",children:[" ",e.jsx("div",{className:"grid grid-cols-3 gap-3",children:oe.map((s,a)=>s.map((r,m)=>e.jsx(u.div,{whileTap:{scale:.95},children:e.jsx(y,{type:"button",variant:r==="clear"||r==="delete"?"outline":"secondary",size:"lg",className:`h-14 w-14 text-xl font-semibold ${typeof r=="number"?"hover:bg-primary hover:text-primary-foreground":""}`,onClick:()=>F(r),disabled:v,children:r==="clear"?e.jsx(ie,{className:"h-5 w-5"}):r==="delete"?e.jsx(O,{className:"h-5 w-5"}):r})},`${a}-${m}`)))})]}),c>=3&&e.jsx("div",{className:"pt-2 flex justify-center",children:e.jsxs(y,{type:"button",variant:"destructive",size:"sm",onClick:()=>{window.confirm(t("auth.confirm_reset_data","정말로 모든 데이터를 초기화하시겠습니까? 이 작업은 되돌릴 수 없습니다."))&&g()},className:"text-xs flex items-center gap-1",disabled:v,children:[e.jsx(le,{className:"h-3 w-3"}),t("auth.reset_data","데이터 초기화")]})})]})})]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-4 text-center",children:t("auth.forgot_pin_message")})]})};export{je as default};
